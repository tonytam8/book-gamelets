var ol=Object.defineProperty;var al=(i,t,e)=>t in i?ol(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var N=(i,t,e)=>(al(i,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerpolicy&&(r.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?r.credentials="include":n.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();var Ve=(i=>(i[i.WEBGL_LEGACY=0]="WEBGL_LEGACY",i[i.WEBGL=1]="WEBGL",i[i.WEBGL2=2]="WEBGL2",i))(Ve||{}),Bn=(i=>(i[i.COLOR=16384]="COLOR",i[i.DEPTH=256]="DEPTH",i[i.STENCIL=1024]="STENCIL",i))(Bn||{}),$=(i=>(i[i.NORMAL=0]="NORMAL",i[i.ADD=1]="ADD",i[i.MULTIPLY=2]="MULTIPLY",i[i.SCREEN=3]="SCREEN",i[i.OVERLAY=4]="OVERLAY",i[i.DARKEN=5]="DARKEN",i[i.LIGHTEN=6]="LIGHTEN",i[i.COLOR_DODGE=7]="COLOR_DODGE",i[i.COLOR_BURN=8]="COLOR_BURN",i[i.HARD_LIGHT=9]="HARD_LIGHT",i[i.SOFT_LIGHT=10]="SOFT_LIGHT",i[i.DIFFERENCE=11]="DIFFERENCE",i[i.EXCLUSION=12]="EXCLUSION",i[i.HUE=13]="HUE",i[i.SATURATION=14]="SATURATION",i[i.COLOR=15]="COLOR",i[i.LUMINOSITY=16]="LUMINOSITY",i[i.NORMAL_NPM=17]="NORMAL_NPM",i[i.ADD_NPM=18]="ADD_NPM",i[i.SCREEN_NPM=19]="SCREEN_NPM",i[i.NONE=20]="NONE",i[i.SRC_OVER=0]="SRC_OVER",i[i.SRC_IN=21]="SRC_IN",i[i.SRC_OUT=22]="SRC_OUT",i[i.SRC_ATOP=23]="SRC_ATOP",i[i.DST_OVER=24]="DST_OVER",i[i.DST_IN=25]="DST_IN",i[i.DST_OUT=26]="DST_OUT",i[i.DST_ATOP=27]="DST_ATOP",i[i.ERASE=26]="ERASE",i[i.SUBTRACT=28]="SUBTRACT",i[i.XOR=29]="XOR",i))($||{}),qt=(i=>(i[i.POINTS=0]="POINTS",i[i.LINES=1]="LINES",i[i.LINE_LOOP=2]="LINE_LOOP",i[i.LINE_STRIP=3]="LINE_STRIP",i[i.TRIANGLES=4]="TRIANGLES",i[i.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",i[i.TRIANGLE_FAN=6]="TRIANGLE_FAN",i))(qt||{}),U=(i=>(i[i.RGBA=6408]="RGBA",i[i.RGB=6407]="RGB",i[i.RG=33319]="RG",i[i.RED=6403]="RED",i[i.RGBA_INTEGER=36249]="RGBA_INTEGER",i[i.RGB_INTEGER=36248]="RGB_INTEGER",i[i.RG_INTEGER=33320]="RG_INTEGER",i[i.RED_INTEGER=36244]="RED_INTEGER",i[i.ALPHA=6406]="ALPHA",i[i.LUMINANCE=6409]="LUMINANCE",i[i.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",i[i.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",i[i.DEPTH_STENCIL=34041]="DEPTH_STENCIL",i))(U||{}),ri=(i=>(i[i.TEXTURE_2D=3553]="TEXTURE_2D",i[i.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",i[i.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",i[i.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",i[i.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",i[i.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",i[i.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",i))(ri||{}),Z=(i=>(i[i.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",i[i.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",i[i.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",i[i.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",i[i.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",i[i.UNSIGNED_INT=5125]="UNSIGNED_INT",i[i.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",i[i.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",i[i.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",i[i.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",i[i.BYTE=5120]="BYTE",i[i.SHORT=5122]="SHORT",i[i.INT=5124]="INT",i[i.FLOAT=5126]="FLOAT",i[i.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",i[i.HALF_FLOAT=36193]="HALF_FLOAT",i))(Z||{}),Dn=(i=>(i[i.FLOAT=0]="FLOAT",i[i.INT=1]="INT",i[i.UINT=2]="UINT",i))(Dn||{}),Jt=(i=>(i[i.NEAREST=0]="NEAREST",i[i.LINEAR=1]="LINEAR",i))(Jt||{}),_e=(i=>(i[i.CLAMP=33071]="CLAMP",i[i.REPEAT=10497]="REPEAT",i[i.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",i))(_e||{}),se=(i=>(i[i.OFF=0]="OFF",i[i.POW2=1]="POW2",i[i.ON=2]="ON",i[i.ON_MANUAL=3]="ON_MANUAL",i))(se||{}),Wt=(i=>(i[i.NPM=0]="NPM",i[i.UNPACK=1]="UNPACK",i[i.PMA=2]="PMA",i[i.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",i[i.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",i[i.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",i))(Wt||{}),Me=(i=>(i[i.NO=0]="NO",i[i.YES=1]="YES",i[i.AUTO=2]="AUTO",i[i.BLEND=0]="BLEND",i[i.CLEAR=1]="CLEAR",i[i.BLIT=2]="BLIT",i))(Me||{}),mr=(i=>(i[i.AUTO=0]="AUTO",i[i.MANUAL=1]="MANUAL",i))(mr||{}),Ft=(i=>(i.LOW="lowp",i.MEDIUM="mediump",i.HIGH="highp",i))(Ft||{}),bt=(i=>(i[i.NONE=0]="NONE",i[i.SCISSOR=1]="SCISSOR",i[i.STENCIL=2]="STENCIL",i[i.SPRITE=3]="SPRITE",i[i.COLOR=4]="COLOR",i))(bt||{}),wt=(i=>(i[i.NONE=0]="NONE",i[i.LOW=2]="LOW",i[i.MEDIUM=4]="MEDIUM",i[i.HIGH=8]="HIGH",i))(wt||{}),te=(i=>(i[i.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",i[i.ARRAY_BUFFER=34962]="ARRAY_BUFFER",i[i.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",i))(te||{});const hl={createCanvas:(i,t)=>{const e=document.createElement("canvas");return e.width=i,e.height=t,e},getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>{var i;return(i=document.baseURI)!=null?i:window.location.href},getFontFaceSet:()=>document.fonts,fetch:(i,t)=>fetch(i,t)};var nn=/iPhone/i,Lr=/iPod/i,kr=/iPad/i,Or=/\biOS-universal(?:.+)Mac\b/i,rn=/\bAndroid(?:.+)Mobile\b/i,Ur=/Android/i,We=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,qi=/Silk/i,oe=/Windows Phone/i,Nr=/\bWindows(?:.+)ARM\b/i,Gr=/BlackBerry/i,Hr=/BB10/i,zr=/Opera Mini/i,Vr=/\b(CriOS|Chrome)(?:.+)Mobile/i,Xr=/Mobile(?:.+)Firefox\b/i,Wr=function(i){return typeof i<"u"&&i.platform==="MacIntel"&&typeof i.maxTouchPoints=="number"&&i.maxTouchPoints>1&&typeof MSStream>"u"};function ll(i){return function(t){return t.test(i)}}function cl(i){var t={userAgent:"",platform:"",maxTouchPoints:0};!i&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof i=="string"?t.userAgent=i:i&&i.userAgent&&(t={userAgent:i.userAgent,platform:i.platform,maxTouchPoints:i.maxTouchPoints||0});var e=t.userAgent,s=e.split("[FBAN");typeof s[1]<"u"&&(e=s[0]),s=e.split("Twitter"),typeof s[1]<"u"&&(e=s[0]);var n=ll(e),r={apple:{phone:n(nn)&&!n(oe),ipod:n(Lr),tablet:!n(nn)&&(n(kr)||Wr(t))&&!n(oe),universal:n(Or),device:(n(nn)||n(Lr)||n(kr)||n(Or)||Wr(t))&&!n(oe)},amazon:{phone:n(We),tablet:!n(We)&&n(qi),device:n(We)||n(qi)},android:{phone:!n(oe)&&n(We)||!n(oe)&&n(rn),tablet:!n(oe)&&!n(We)&&!n(rn)&&(n(qi)||n(Ur)),device:!n(oe)&&(n(We)||n(qi)||n(rn)||n(Ur))||n(/\bokhttp\b/i)},windows:{phone:n(oe),tablet:n(Nr),device:n(oe)||n(Nr)},other:{blackberry:n(Gr),blackberry10:n(Hr),opera:n(zr),firefox:n(Xr),chrome:n(Vr),device:n(Gr)||n(Hr)||n(zr)||n(Xr)||n(Vr)},any:!1,phone:!1,tablet:!1};return r.any=r.apple.device||r.android.device||r.windows.device||r.other.device,r.phone=r.apple.phone||r.android.phone||r.windows.phone,r.tablet=r.apple.tablet||r.android.tablet||r.windows.tablet,r}const le=cl(globalThis.navigator);function ul(){return!le.apple.device}function dl(i){let t=!0;if(le.tablet||le.phone){if(le.apple.device){const e=navigator.userAgent.match(/OS (\d+)_(\d+)?/);e&&parseInt(e[1],10)<11&&(t=!1)}if(le.android.device){const e=navigator.userAgent.match(/Android\s([0-9.]*)/);e&&parseInt(e[1],10)<7&&(t=!1)}}return t?i:4}const O={ADAPTER:hl,MIPMAP_TEXTURES:se.POW2,ANISOTROPIC_LEVEL:0,RESOLUTION:1,FILTER_RESOLUTION:1,FILTER_MULTISAMPLE:wt.NONE,SPRITE_MAX_TEXTURES:dl(32),SPRITE_BATCH_SIZE:4096,RENDER_OPTIONS:{view:null,antialias:!1,autoDensity:!1,backgroundColor:0,backgroundAlpha:1,useContextAlpha:!0,clearBeforeRender:!0,preserveDrawingBuffer:!1,width:800,height:600,legacy:!1,hello:!1},GC_MODE:mr.AUTO,GC_MAX_IDLE:60*60,GC_MAX_CHECK_COUNT:60*10,WRAP_MODE:_e.CLAMP,SCALE_MODE:Jt.LINEAR,PRECISION_VERTEX:Ft.HIGH,PRECISION_FRAGMENT:le.apple.device?Ft.HIGH:Ft.MEDIUM,CAN_UPLOAD_SAME_BUFFER:ul(),CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};O.PREFER_ENV=Ve.WEBGL2;O.STRICT_TEXTURE_CACHE=!1;var z=(i=>(i.Renderer="renderer",i.Application="application",i.RendererSystem="renderer-webgl-system",i.RendererPlugin="renderer-webgl-plugin",i.CanvasRendererSystem="renderer-canvas-system",i.CanvasRendererPlugin="renderer-canvas-plugin",i.Asset="asset",i.LoadParser="load-parser",i.ResolveParser="resolve-parser",i.CacheParser="cache-parser",i.DetectionParser="detection-parser",i))(z||{});const jr=i=>{if((typeof i=="function"||typeof i=="object"&&i.extension)&&(i={...typeof i.extension!="object"?{type:i.extension}:i.extension,ref:i}),typeof i=="object")i={...i};else throw new Error("Invalid extension type");return typeof i.type=="string"&&(i.type=[i.type]),i},Y={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...i){return i.map(jr).forEach(t=>{t.type.forEach(e=>{var s,n;return(n=(s=this._removeHandlers)[e])==null?void 0:n.call(s,t)})}),this},add(...i){return i.map(jr).forEach(t=>{t.type.forEach(e=>{const s=this._addHandlers,n=this._queue;s[e]?s[e](t):(n[e]=n[e]||[],n[e].push(t))})}),this},handle(i,t,e){const s=this._addHandlers,n=this._removeHandlers;s[i]=t,n[i]=e;const r=this._queue;return r[i]&&(r[i].forEach(o=>t(o)),delete r[i]),this},handleByMap(i,t){return this.handle(i,e=>{t[e.name]=e.ref},e=>{delete t[e.name]})},handleByList(i,t){return this.handle(i,e=>{t.includes(e.ref)||(t.push(e.ref),t.sort((s,n)=>{var r,o;return((r=n.priority)!=null?r:-1)-((o=s.priority)!=null?o:-1)}))},e=>{const s=t.indexOf(e.ref);s!==-1&&t.splice(s,1)})}},Ss=Math.PI*2,fl=180/Math.PI,pl=Math.PI/180;var St=(i=>(i[i.POLY=0]="POLY",i[i.RECT=1]="RECT",i[i.CIRC=2]="CIRC",i[i.ELIP=3]="ELIP",i[i.RREC=4]="RREC",i))(St||{});class G{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new G(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}}const Ji=[new G,new G,new G,new G];class q{constructor(t=0,e=0,s=0,n=0){this.x=Number(t),this.y=Number(e),this.width=Number(s),this.height=Number(n),this.type=St.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new q(0,0,0,0)}clone(){return new q(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}intersects(t,e){if(!e){const E=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=E)return!1;const C=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>C}const s=this.left,n=this.right,r=this.top,o=this.bottom;if(n<=s||o<=r)return!1;const a=Ji[0].set(t.left,t.top),h=Ji[1].set(t.left,t.bottom),c=Ji[2].set(t.right,t.top),l=Ji[3].set(t.right,t.bottom);if(c.x<=a.x||h.y<=a.y)return!1;const f=Math.sign(e.a*e.d-e.b*e.c);if(f===0||(e.apply(a,a),e.apply(h,h),e.apply(c,c),e.apply(l,l),Math.max(a.x,h.x,c.x,l.x)<=s||Math.min(a.x,h.x,c.x,l.x)>=n||Math.max(a.y,h.y,c.y,l.y)<=r||Math.min(a.y,h.y,c.y,l.y)>=o))return!1;const d=f*(h.y-a.y),u=f*(a.x-h.x),p=d*s+u*r,m=d*n+u*r,g=d*s+u*o,_=d*n+u*o;if(Math.max(p,m,g,_)<=d*a.x+u*a.y||Math.min(p,m,g,_)>=d*l.x+u*l.y)return!1;const A=f*(a.y-c.y),y=f*(c.x-a.x),v=A*s+y*r,x=A*n+y*r,b=A*s+y*o,w=A*n+y*o;return!(Math.max(v,x,b,w)<=A*a.x+y*a.y||Math.min(v,x,b,w)>=A*l.x+y*l.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this}fit(t){const e=Math.max(this.x,t.x),s=Math.min(this.x+this.width,t.x+t.width),n=Math.max(this.y,t.y),r=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(s-e,0),this.y=n,this.height=Math.max(r-n,0),this}ceil(t=1,e=.001){const s=Math.ceil((this.x+this.width-e)*t)/t,n=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=s-this.x,this.height=n-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),s=Math.max(this.x+this.width,t.x+t.width),n=Math.min(this.y,t.y),r=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=s-e,this.y=n,this.height=r-n,this}}class gr{constructor(t=0,e=0,s=0){this.x=t,this.y=e,this.radius=s,this.type=St.CIRC}clone(){return new gr(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const s=this.radius*this.radius;let n=this.x-t,r=this.y-e;return n*=n,r*=r,n+r<=s}getBounds(){return new q(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}}class vr{constructor(t=0,e=0,s=0,n=0){this.x=t,this.y=e,this.width=s,this.height=n,this.type=St.ELIP}clone(){return new vr(this.x,this.y,this.width,this.height)}contains(t,e){if(this.width<=0||this.height<=0)return!1;let s=(t-this.x)/this.width,n=(e-this.y)/this.height;return s*=s,n*=n,s+n<=1}getBounds(){return new q(this.x-this.width,this.y-this.height,this.width,this.height)}}class oi{constructor(...t){let e=Array.isArray(t[0])?t[0]:t;if(typeof e[0]!="number"){const s=[];for(let n=0,r=e.length;n<r;n++)s.push(e[n].x,e[n].y);e=s}this.points=e,this.type=St.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),e=new oi(t);return e.closeStroke=this.closeStroke,e}contains(t,e){let s=!1;const n=this.points.length/2;for(let r=0,o=n-1;r<n;o=r++){const a=this.points[r*2],h=this.points[r*2+1],c=this.points[o*2],l=this.points[o*2+1];h>e!=l>e&&t<(c-a)*((e-h)/(l-h))+a&&(s=!s)}return s}}class _r{constructor(t=0,e=0,s=0,n=0,r=20){this.x=t,this.y=e,this.width=s,this.height=n,this.radius=r,this.type=St.RREC}clone(){return new _r(this.x,this.y,this.width,this.height,this.radius)}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const s=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+s&&e<=this.y+this.height-s||t>=this.x+s&&t<=this.x+this.width-s)return!0;let n=t-(this.x+s),r=e-(this.y+s);const o=s*s;if(n*n+r*r<=o||(n=t-(this.x+this.width-s),n*n+r*r<=o)||(r=e-(this.y+this.height-s),n*n+r*r<=o)||(n=t-(this.x+s),n*n+r*r<=o))return!0}return!1}}class Ct{constructor(t,e,s=0,n=0){this._x=s,this._y=n,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new Ct(t,e,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}class gt{constructor(t=1,e=0,s=0,n=1,r=0,o=0){this.array=null,this.a=t,this.b=e,this.c=s,this.d=n,this.tx=r,this.ty=o}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,s,n,r,o){return this.a=t,this.b=e,this.c=s,this.d=n,this.tx=r,this.ty=o,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const s=e||this.array;return t?(s[0]=this.a,s[1]=this.b,s[2]=0,s[3]=this.c,s[4]=this.d,s[5]=0,s[6]=this.tx,s[7]=this.ty,s[8]=1):(s[0]=this.a,s[1]=this.c,s[2]=this.tx,s[3]=this.b,s[4]=this.d,s[5]=this.ty,s[6]=0,s[7]=0,s[8]=1),s}apply(t,e){e=e||new G;const s=t.x,n=t.y;return e.x=this.a*s+this.c*n+this.tx,e.y=this.b*s+this.d*n+this.ty,e}applyInverse(t,e){e=e||new G;const s=1/(this.a*this.d+this.c*-this.b),n=t.x,r=t.y;return e.x=this.d*s*n+-this.c*s*r+(this.ty*this.c-this.tx*this.d)*s,e.y=this.a*s*r+-this.b*s*n+(-this.ty*this.a+this.tx*this.b)*s,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),s=Math.sin(t),n=this.a,r=this.c,o=this.tx;return this.a=n*e-this.b*s,this.b=n*s+this.b*e,this.c=r*e-this.d*s,this.d=r*s+this.d*e,this.tx=o*e-this.ty*s,this.ty=o*s+this.ty*e,this}append(t){const e=this.a,s=this.b,n=this.c,r=this.d;return this.a=t.a*e+t.b*n,this.b=t.a*s+t.b*r,this.c=t.c*e+t.d*n,this.d=t.c*s+t.d*r,this.tx=t.tx*e+t.ty*n+this.tx,this.ty=t.tx*s+t.ty*r+this.ty,this}setTransform(t,e,s,n,r,o,a,h,c){return this.a=Math.cos(a+c)*r,this.b=Math.sin(a+c)*r,this.c=-Math.sin(a-h)*o,this.d=Math.cos(a-h)*o,this.tx=t-(s*this.a+n*this.c),this.ty=e-(s*this.b+n*this.d),this}prepend(t){const e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const s=this.a,n=this.c;this.a=s*t.a+this.b*t.c,this.b=s*t.b+this.b*t.d,this.c=n*t.a+this.d*t.c,this.d=n*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,s=this.b,n=this.c,r=this.d,o=t.pivot,a=-Math.atan2(-n,r),h=Math.atan2(s,e),c=Math.abs(a+h);return c<1e-5||Math.abs(Ss-c)<1e-5?(t.rotation=h,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=a,t.skew.y=h),t.scale.x=Math.sqrt(e*e+s*s),t.scale.y=Math.sqrt(n*n+r*r),t.position.x=this.tx+(o.x*e+o.y*n),t.position.y=this.ty+(o.x*s+o.y*r),t}invert(){const t=this.a,e=this.b,s=this.c,n=this.d,r=this.tx,o=t*n-e*s;return this.a=n/o,this.b=-e/o,this.c=-s/o,this.d=t/o,this.tx=(s*this.ty-n*r)/o,this.ty=-(t*this.ty-e*r)/o,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new gt;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}static get IDENTITY(){return new gt}static get TEMP_MATRIX(){return new gt}}const Be=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],De=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Fe=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Le=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Fn=[],da=[],ts=Math.sign;function ml(){for(let i=0;i<16;i++){const t=[];Fn.push(t);for(let e=0;e<16;e++){const s=ts(Be[i]*Be[e]+Fe[i]*De[e]),n=ts(De[i]*Be[e]+Le[i]*De[e]),r=ts(Be[i]*Fe[e]+Fe[i]*Le[e]),o=ts(De[i]*Fe[e]+Le[i]*Le[e]);for(let a=0;a<16;a++)if(Be[a]===s&&De[a]===n&&Fe[a]===r&&Le[a]===o){t.push(a);break}}}for(let i=0;i<16;i++){const t=new gt;t.set(Be[i],De[i],Fe[i],Le[i],0,0),da.push(t)}}ml();const dt={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:i=>Be[i],uY:i=>De[i],vX:i=>Fe[i],vY:i=>Le[i],inv:i=>i&8?i&15:-i&7,add:(i,t)=>Fn[i][t],sub:(i,t)=>Fn[i][dt.inv(t)],rotate180:i=>i^4,isVertical:i=>(i&3)===2,byDirection:(i,t)=>Math.abs(i)*2<=Math.abs(t)?t>=0?dt.S:dt.N:Math.abs(t)*2<=Math.abs(i)?i>0?dt.E:dt.W:t>0?i>0?dt.SE:dt.SW:i>0?dt.NE:dt.NW,matrixAppendRotationInv:(i,t,e=0,s=0)=>{const n=da[dt.inv(t)];n.tx=e,n.ty=s,i.append(n)}},fa=class{constructor(){this.worldTransform=new gt,this.localTransform=new gt,this.position=new Ct(this.onChange,this,0,0),this.scale=new Ct(this.onChange,this,1,1),this.pivot=new Ct(this.onChange,this,0,0),this.skew=new Ct(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const i=this.localTransform;this._localID!==this._currentLocalID&&(i.a=this._cx*this.scale.x,i.b=this._sx*this.scale.x,i.c=this._cy*this.scale.y,i.d=this._sy*this.scale.y,i.tx=this.position.x-(this.pivot.x*i.a+this.pivot.y*i.c),i.ty=this.position.y-(this.pivot.x*i.b+this.pivot.y*i.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(i){const t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==i._worldID){const e=i.worldTransform,s=this.worldTransform;s.a=t.a*e.a+t.b*e.c,s.b=t.a*e.b+t.b*e.d,s.c=t.c*e.a+t.d*e.c,s.d=t.c*e.b+t.d*e.d,s.tx=t.tx*e.a+t.ty*e.c+e.tx,s.ty=t.tx*e.b+t.ty*e.d+e.ty,this._parentID=i._worldID,this._worldID++}}setFromMatrix(i){i.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(i){this._rotation!==i&&(this._rotation=i,this.updateSkew())}};let Xs=fa;Xs.IDENTITY=new fa;class zt{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,s,n,r,o,a,h){if(arguments.length>8)throw new Error("max arguments reached");const{name:c,items:l}=this;this._aliasCount++;for(let f=0,d=l.length;f<d;f++)l[f][c](t,e,s,n,r,o,a,h);return l===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return e!==-1&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(zt.prototype,{dispatch:{value:zt.prototype.emit},run:{value:zt.prototype.emit}});O.TARGET_FPMS=.06;var ye=(i=>(i[i.HIGH=25]="HIGH",i[i.NORMAL=0]="NORMAL",i[i.LOW=-25]="LOW",i[i.UTILITY=-50]="UTILITY",i))(ye||{});class on{constructor(t,e=null,s=0,n=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=s,this.once=n}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}class st{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new on(null,null,1/0),this.deltaMS=1/O.TARGET_FPMS,this.elapsedMS=1/O.TARGET_FPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,s=ye.NORMAL){return this._addListener(new on(t,e,s))}addOnce(t,e,s=ye.NORMAL){return this._addListener(new on(t,e,s,!0))}_addListener(t){let e=this._head.next,s=this._head;if(!e)t.connect(s);else{for(;e;){if(t.priority>e.priority){t.connect(s);break}s=e,e=e.next}t.previous||t.connect(s)}return this._startIfPossible(),this}remove(t,e){let s=this._head.next;for(;s;)s.match(t,e)?s=s.destroy():s=s.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const r=t-this._lastFrame|0;if(r<this._minElapsedMS)return;this._lastFrame=t-r%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*O.TARGET_FPMS;const s=this._head;let n=s.next;for(;n;)n=n.emit(this.deltaTime);s.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),s=Math.min(Math.max(0,e)/1e3,O.TARGET_FPMS);this._maxElapsedMS=1/s}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!st._shared){const t=st._shared=new st;t.autoStart=!0,t._protected=!0}return st._shared}static get system(){if(!st._system){const t=st._system=new st;t.autoStart=!0,t._protected=!0}return st._system}}class pa{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,ye.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?st.shared:new st,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}pa.extension=z.Application;Y.add(pa);var ai=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ws={exports:{}};(function(i){var t=Object.prototype.hasOwnProperty,e="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(e=!1));function n(h,c,l){this.fn=h,this.context=c,this.once=l||!1}function r(h,c,l,f,d){if(typeof l!="function")throw new TypeError("The listener must be a function");var u=new n(l,f||h,d),p=e?e+c:c;return h._events[p]?h._events[p].fn?h._events[p]=[h._events[p],u]:h._events[p].push(u):(h._events[p]=u,h._eventsCount++),h}function o(h,c){--h._eventsCount===0?h._events=new s:delete h._events[c]}function a(){this._events=new s,this._eventsCount=0}a.prototype.eventNames=function(){var c=[],l,f;if(this._eventsCount===0)return c;for(f in l=this._events)t.call(l,f)&&c.push(e?f.slice(1):f);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(l)):c},a.prototype.listeners=function(c){var l=e?e+c:c,f=this._events[l];if(!f)return[];if(f.fn)return[f.fn];for(var d=0,u=f.length,p=new Array(u);d<u;d++)p[d]=f[d].fn;return p},a.prototype.listenerCount=function(c){var l=e?e+c:c,f=this._events[l];return f?f.fn?1:f.length:0},a.prototype.emit=function(c,l,f,d,u,p){var m=e?e+c:c;if(!this._events[m])return!1;var g=this._events[m],_=arguments.length,A,y;if(g.fn){switch(g.once&&this.removeListener(c,g.fn,void 0,!0),_){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,l),!0;case 3:return g.fn.call(g.context,l,f),!0;case 4:return g.fn.call(g.context,l,f,d),!0;case 5:return g.fn.call(g.context,l,f,d,u),!0;case 6:return g.fn.call(g.context,l,f,d,u,p),!0}for(y=1,A=new Array(_-1);y<_;y++)A[y-1]=arguments[y];g.fn.apply(g.context,A)}else{var v=g.length,x;for(y=0;y<v;y++)switch(g[y].once&&this.removeListener(c,g[y].fn,void 0,!0),_){case 1:g[y].fn.call(g[y].context);break;case 2:g[y].fn.call(g[y].context,l);break;case 3:g[y].fn.call(g[y].context,l,f);break;case 4:g[y].fn.call(g[y].context,l,f,d);break;default:if(!A)for(x=1,A=new Array(_-1);x<_;x++)A[x-1]=arguments[x];g[y].fn.apply(g[y].context,A)}}return!0},a.prototype.on=function(c,l,f){return r(this,c,l,f,!1)},a.prototype.once=function(c,l,f){return r(this,c,l,f,!0)},a.prototype.removeListener=function(c,l,f,d){var u=e?e+c:c;if(!this._events[u])return this;if(!l)return o(this,u),this;var p=this._events[u];if(p.fn)p.fn===l&&(!d||p.once)&&(!f||p.context===f)&&o(this,u);else{for(var m=0,g=[],_=p.length;m<_;m++)(p[m].fn!==l||d&&!p[m].once||f&&p[m].context!==f)&&g.push(p[m]);g.length?this._events[u]=g.length===1?g[0]:g:o(this,u)}return this},a.prototype.removeAllListeners=function(c){var l;return c?(l=e?e+c:c,this._events[l]&&o(this,l)):(this._events=new s,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=e,a.EventEmitter=a,i.exports=a})(Ws);const re=Ws.exports;var yr={exports:{}};yr.exports=js;yr.exports.default=js;function js(i,t,e){e=e||2;var s=t&&t.length,n=s?t[0]*e:i.length,r=ma(i,0,n,e,!0),o=[];if(!r||r.next===r.prev)return o;var a,h,c,l,f,d,u;if(s&&(r=xl(i,t,r,e)),i.length>80*e){a=c=i[0],h=l=i[1];for(var p=e;p<n;p+=e)f=i[p],d=i[p+1],f<a&&(a=f),d<h&&(h=d),f>c&&(c=f),d>l&&(l=d);u=Math.max(c-a,l-h),u=u!==0?32767/u:0}return Di(r,o,e,a,h,u,0),o}function ma(i,t,e,s,n){var r,o;if(n===On(i,t,e,s)>0)for(r=t;r<e;r+=s)o=Yr(r,i[r],i[r+1],o);else for(r=e-s;r>=t;r-=s)o=Yr(r,i[r],i[r+1],o);return o&&Ys(o,o.next)&&(Li(o),o=o.next),o}function Ge(i,t){if(!i)return i;t||(t=i);var e=i,s;do if(s=!1,!e.steiner&&(Ys(e,e.next)||ft(e.prev,e,e.next)===0)){if(Li(e),e=t=e.prev,e===e.next)break;s=!0}else e=e.next;while(s||e!==t);return t}function Di(i,t,e,s,n,r,o){if(!!i){!o&&r&&Tl(i,s,n,r);for(var a=i,h,c;i.prev!==i.next;){if(h=i.prev,c=i.next,r?vl(i,s,n,r):gl(i)){t.push(h.i/e|0),t.push(i.i/e|0),t.push(c.i/e|0),Li(i),i=c.next,a=c.next;continue}if(i=c,i===a){o?o===1?(i=_l(Ge(i),t,e),Di(i,t,e,s,n,r,2)):o===2&&yl(i,t,e,s,n,r):Di(Ge(i),t,e,s,n,r,1);break}}}}function gl(i){var t=i.prev,e=i,s=i.next;if(ft(t,e,s)>=0)return!1;for(var n=t.x,r=e.x,o=s.x,a=t.y,h=e.y,c=s.y,l=n<r?n<o?n:o:r<o?r:o,f=a<h?a<c?a:c:h<c?h:c,d=n>r?n>o?n:o:r>o?r:o,u=a>h?a>c?a:c:h>c?h:c,p=s.next;p!==t;){if(p.x>=l&&p.x<=d&&p.y>=f&&p.y<=u&&Je(n,a,r,h,o,c,p.x,p.y)&&ft(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function vl(i,t,e,s){var n=i.prev,r=i,o=i.next;if(ft(n,r,o)>=0)return!1;for(var a=n.x,h=r.x,c=o.x,l=n.y,f=r.y,d=o.y,u=a<h?a<c?a:c:h<c?h:c,p=l<f?l<d?l:d:f<d?f:d,m=a>h?a>c?a:c:h>c?h:c,g=l>f?l>d?l:d:f>d?f:d,_=Ln(u,p,t,e,s),A=Ln(m,g,t,e,s),y=i.prevZ,v=i.nextZ;y&&y.z>=_&&v&&v.z<=A;){if(y.x>=u&&y.x<=m&&y.y>=p&&y.y<=g&&y!==n&&y!==o&&Je(a,l,h,f,c,d,y.x,y.y)&&ft(y.prev,y,y.next)>=0||(y=y.prevZ,v.x>=u&&v.x<=m&&v.y>=p&&v.y<=g&&v!==n&&v!==o&&Je(a,l,h,f,c,d,v.x,v.y)&&ft(v.prev,v,v.next)>=0))return!1;v=v.nextZ}for(;y&&y.z>=_;){if(y.x>=u&&y.x<=m&&y.y>=p&&y.y<=g&&y!==n&&y!==o&&Je(a,l,h,f,c,d,y.x,y.y)&&ft(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;v&&v.z<=A;){if(v.x>=u&&v.x<=m&&v.y>=p&&v.y<=g&&v!==n&&v!==o&&Je(a,l,h,f,c,d,v.x,v.y)&&ft(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function _l(i,t,e){var s=i;do{var n=s.prev,r=s.next.next;!Ys(n,r)&&ga(n,s,s.next,r)&&Fi(n,r)&&Fi(r,n)&&(t.push(n.i/e|0),t.push(s.i/e|0),t.push(r.i/e|0),Li(s),Li(s.next),s=i=r),s=s.next}while(s!==i);return Ge(s)}function yl(i,t,e,s,n,r){var o=i;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&Il(o,a)){var h=va(o,a);o=Ge(o,o.next),h=Ge(h,h.next),Di(o,t,e,s,n,r,0),Di(h,t,e,s,n,r,0);return}a=a.next}o=o.next}while(o!==i)}function xl(i,t,e,s){var n=[],r,o,a,h,c;for(r=0,o=t.length;r<o;r++)a=t[r]*s,h=r<o-1?t[r+1]*s:i.length,c=ma(i,a,h,s,!1),c===c.next&&(c.steiner=!0),n.push(Cl(c));for(n.sort(wl),r=0;r<n.length;r++)e=bl(n[r],e);return e}function wl(i,t){return i.x-t.x}function bl(i,t){var e=Al(i,t);if(!e)return t;var s=va(e,i);return Ge(s,s.next),Ge(e,e.next)}function Al(i,t){var e=t,s=i.x,n=i.y,r=-1/0,o;do{if(n<=e.y&&n>=e.next.y&&e.next.y!==e.y){var a=e.x+(n-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(a<=s&&a>r&&(r=a,o=e.x<e.next.x?e:e.next,a===s))return o}e=e.next}while(e!==t);if(!o)return null;var h=o,c=o.x,l=o.y,f=1/0,d;e=o;do s>=e.x&&e.x>=c&&s!==e.x&&Je(n<l?s:r,n,c,l,n<l?r:s,n,e.x,e.y)&&(d=Math.abs(n-e.y)/(s-e.x),Fi(e,i)&&(d<f||d===f&&(e.x>o.x||e.x===o.x&&El(o,e)))&&(o=e,f=d)),e=e.next;while(e!==h);return o}function El(i,t){return ft(i.prev,i,t.prev)<0&&ft(t.next,i,i.next)<0}function Tl(i,t,e,s){var n=i;do n.z===0&&(n.z=Ln(n.x,n.y,t,e,s)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==i);n.prevZ.nextZ=null,n.prevZ=null,Sl(n)}function Sl(i){var t,e,s,n,r,o,a,h,c=1;do{for(e=i,i=null,r=null,o=0;e;){for(o++,s=e,a=0,t=0;t<c&&(a++,s=s.nextZ,!!s);t++);for(h=c;a>0||h>0&&s;)a!==0&&(h===0||!s||e.z<=s.z)?(n=e,e=e.nextZ,a--):(n=s,s=s.nextZ,h--),r?r.nextZ=n:i=n,n.prevZ=r,r=n;e=s}r.nextZ=null,c*=2}while(o>1);return i}function Ln(i,t,e,s,n){return i=(i-e)*n|0,t=(t-s)*n|0,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,i|t<<1}function Cl(i){var t=i,e=i;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==i);return e}function Je(i,t,e,s,n,r,o,a){return(n-o)*(t-a)>=(i-o)*(r-a)&&(i-o)*(s-a)>=(e-o)*(t-a)&&(e-o)*(r-a)>=(n-o)*(s-a)}function Il(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!Pl(i,t)&&(Fi(i,t)&&Fi(t,i)&&Rl(i,t)&&(ft(i.prev,i,t.prev)||ft(i,t.prev,t))||Ys(i,t)&&ft(i.prev,i,i.next)>0&&ft(t.prev,t,t.next)>0)}function ft(i,t,e){return(t.y-i.y)*(e.x-t.x)-(t.x-i.x)*(e.y-t.y)}function Ys(i,t){return i.x===t.x&&i.y===t.y}function ga(i,t,e,s){var n=is(ft(i,t,e)),r=is(ft(i,t,s)),o=is(ft(e,s,i)),a=is(ft(e,s,t));return!!(n!==r&&o!==a||n===0&&es(i,e,t)||r===0&&es(i,s,t)||o===0&&es(e,i,s)||a===0&&es(e,t,s))}function es(i,t,e){return t.x<=Math.max(i.x,e.x)&&t.x>=Math.min(i.x,e.x)&&t.y<=Math.max(i.y,e.y)&&t.y>=Math.min(i.y,e.y)}function is(i){return i>0?1:i<0?-1:0}function Pl(i,t){var e=i;do{if(e.i!==i.i&&e.next.i!==i.i&&e.i!==t.i&&e.next.i!==t.i&&ga(e,e.next,i,t))return!0;e=e.next}while(e!==i);return!1}function Fi(i,t){return ft(i.prev,i,i.next)<0?ft(i,t,i.next)>=0&&ft(i,i.prev,t)>=0:ft(i,t,i.prev)<0||ft(i,i.next,t)<0}function Rl(i,t){var e=i,s=!1,n=(i.x+t.x)/2,r=(i.y+t.y)/2;do e.y>r!=e.next.y>r&&e.next.y!==e.y&&n<(e.next.x-e.x)*(r-e.y)/(e.next.y-e.y)+e.x&&(s=!s),e=e.next;while(e!==i);return s}function va(i,t){var e=new kn(i.i,i.x,i.y),s=new kn(t.i,t.x,t.y),n=i.next,r=t.prev;return i.next=t,t.prev=i,e.next=n,n.prev=e,s.next=e,e.prev=s,r.next=s,s.prev=r,s}function Yr(i,t,e,s){var n=new kn(i,t,e);return s?(n.next=s.next,n.prev=s,s.next.prev=n,s.next=n):(n.prev=n,n.next=n),n}function Li(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function kn(i,t,e){this.i=i,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}js.deviation=function(i,t,e,s){var n=t&&t.length,r=n?t[0]*e:i.length,o=Math.abs(On(i,0,r,e));if(n)for(var a=0,h=t.length;a<h;a++){var c=t[a]*e,l=a<h-1?t[a+1]*e:i.length;o-=Math.abs(On(i,c,l,e))}var f=0;for(a=0;a<s.length;a+=3){var d=s[a]*e,u=s[a+1]*e,p=s[a+2]*e;f+=Math.abs((i[d]-i[p])*(i[u+1]-i[d+1])-(i[d]-i[u])*(i[p+1]-i[d+1]))}return o===0&&f===0?0:Math.abs((f-o)/o)};function On(i,t,e,s){for(var n=0,r=t,o=e-s;r<e;r+=s)n+=(i[o]-i[r])*(i[r+1]+i[o+1]),o=r;return n}js.flatten=function(i){for(var t=i[0][0].length,e={vertices:[],holes:[],dimensions:t},s=0,n=0;n<i.length;n++){for(var r=0;r<i[n].length;r++)for(var o=0;o<t;o++)e.vertices.push(i[n][r][o]);n>0&&(s+=i[n-1].length,e.holes.push(s))}return e};var Un={exports:{}};/*! https://mths.be/punycode v1.3.2 by @mathias */(function(i,t){(function(e){var s=t&&!t.nodeType&&t,n=i&&!i.nodeType&&i,r=typeof ai=="object"&&ai;(r.global===r||r.window===r||r.self===r)&&(e=r);var o,a=2147483647,h=36,c=1,l=26,f=38,d=700,u=72,p=128,m="-",g=/^xn--/,_=/[^\x20-\x7E]/,A=/[\x2E\u3002\uFF0E\uFF61]/g,y={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},v=h-c,x=Math.floor,b=String.fromCharCode,w;function E(B){throw RangeError(y[B])}function S(B,V){for(var K=B.length,Q=[];K--;)Q[K]=V(B[K]);return Q}function C(B,V){var K=B.split("@"),Q="";K.length>1&&(Q=K[0]+"@",B=K[1]),B=B.replace(A,".");var tt=B.split("."),nt=S(tt,V).join(".");return Q+nt}function T(B){for(var V=[],K=0,Q=B.length,tt,nt;K<Q;)tt=B.charCodeAt(K++),tt>=55296&&tt<=56319&&K<Q?(nt=B.charCodeAt(K++),(nt&64512)==56320?V.push(((tt&1023)<<10)+(nt&1023)+65536):(V.push(tt),K--)):V.push(tt);return V}function I(B){return S(B,function(V){var K="";return V>65535&&(V-=65536,K+=b(V>>>10&1023|55296),V=56320|V&1023),K+=b(V),K}).join("")}function P(B){return B-48<10?B-22:B-65<26?B-65:B-97<26?B-97:h}function R(B,V){return B+22+75*(B<26)-((V!=0)<<5)}function L(B,V,K){var Q=0;for(B=K?x(B/d):B>>1,B+=x(B/V);B>v*l>>1;Q+=h)B=x(B/v);return x(Q+(v+1)*B/(B+f))}function k(B){var V=[],K=B.length,Q,tt=0,nt=p,it=u,rt,At,Tt,xt,ot,at,mt,Pt,Mt;for(rt=B.lastIndexOf(m),rt<0&&(rt=0),At=0;At<rt;++At)B.charCodeAt(At)>=128&&E("not-basic"),V.push(B.charCodeAt(At));for(Tt=rt>0?rt+1:0;Tt<K;){for(xt=tt,ot=1,at=h;Tt>=K&&E("invalid-input"),mt=P(B.charCodeAt(Tt++)),(mt>=h||mt>x((a-tt)/ot))&&E("overflow"),tt+=mt*ot,Pt=at<=it?c:at>=it+l?l:at-it,!(mt<Pt);at+=h)Mt=h-Pt,ot>x(a/Mt)&&E("overflow"),ot*=Mt;Q=V.length+1,it=L(tt-xt,Q,xt==0),x(tt/Q)>a-nt&&E("overflow"),nt+=x(tt/Q),tt%=Q,V.splice(tt++,0,nt)}return I(V)}function F(B){var V,K,Q,tt,nt,it,rt,At,Tt,xt,ot,at=[],mt,Pt,Mt,me;for(B=T(B),mt=B.length,V=p,K=0,nt=u,it=0;it<mt;++it)ot=B[it],ot<128&&at.push(b(ot));for(Q=tt=at.length,tt&&at.push(m);Q<mt;){for(rt=a,it=0;it<mt;++it)ot=B[it],ot>=V&&ot<rt&&(rt=ot);for(Pt=Q+1,rt-V>x((a-K)/Pt)&&E("overflow"),K+=(rt-V)*Pt,V=rt,it=0;it<mt;++it)if(ot=B[it],ot<V&&++K>a&&E("overflow"),ot==V){for(At=K,Tt=h;xt=Tt<=nt?c:Tt>=nt+l?l:Tt-nt,!(At<xt);Tt+=h)me=At-xt,Mt=h-xt,at.push(b(R(xt+me%Mt,0))),At=x(me/Mt);at.push(b(R(At,0))),nt=L(K,Pt,Q==tt),K=0,++Q}++K,++V}return at.join("")}function W(B){return C(B,function(V){return g.test(V)?k(V.slice(4).toLowerCase()):V})}function j(B){return C(B,function(V){return _.test(V)?"xn--"+F(V):V})}if(o={version:"1.3.2",ucs2:{decode:T,encode:I},decode:k,encode:F,toASCII:j,toUnicode:W},s&&n)if(i.exports==s)n.exports=o;else for(w in o)o.hasOwnProperty(w)&&(s[w]=o[w]);else e.punycode=o})(ai)})(Un,Un.exports);var Ml={isString:function(i){return typeof i=="string"},isObject:function(i){return typeof i=="object"&&i!==null},isNull:function(i){return i===null},isNullOrUndefined:function(i){return i==null}},ki={};function Bl(i,t){return Object.prototype.hasOwnProperty.call(i,t)}var Dl=function(i,t,e,s){t=t||"&",e=e||"=";var n={};if(typeof i!="string"||i.length===0)return n;var r=/\+/g;i=i.split(t);var o=1e3;s&&typeof s.maxKeys=="number"&&(o=s.maxKeys);var a=i.length;o>0&&a>o&&(a=o);for(var h=0;h<a;++h){var c=i[h].replace(r,"%20"),l=c.indexOf(e),f,d,u,p;l>=0?(f=c.substr(0,l),d=c.substr(l+1)):(f=c,d=""),u=decodeURIComponent(f),p=decodeURIComponent(d),Bl(n,u)?Array.isArray(n[u])?n[u].push(p):n[u]=[n[u],p]:n[u]=p}return n},fi=function(i){switch(typeof i){case"string":return i;case"boolean":return i?"true":"false";case"number":return isFinite(i)?i:"";default:return""}},Fl=function(i,t,e,s){return t=t||"&",e=e||"=",i===null&&(i=void 0),typeof i=="object"?Object.keys(i).map(function(n){var r=encodeURIComponent(fi(n))+e;return Array.isArray(i[n])?i[n].map(function(o){return r+encodeURIComponent(fi(o))}).join(t):r+encodeURIComponent(fi(i[n]))}).join(t):s?encodeURIComponent(fi(s))+e+encodeURIComponent(fi(i)):""};ki.decode=ki.parse=Dl;ki.encode=ki.stringify=Fl;var Ll=Un.exports,Qt=Ml,kl=Ks,Ol=Kl,Ul=Yl;function Vt(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var Nl=/^([a-z0-9.+-]+:)/i,Gl=/:[0-9]*$/,Hl=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,zl=["<",">",'"',"`"," ","\r",`
`,"	"],Vl=["{","}","|","\\","^","`"].concat(zl),Nn=["'"].concat(Vl),Kr=["%","/","?",";","#"].concat(Nn),Zr=["/","?","#"],Xl=255,Qr=/^[+a-z0-9A-Z_-]{0,63}$/,Wl=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,jl={javascript:!0,"javascript:":!0},Gn={javascript:!0,"javascript:":!0},hi={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},Hn=ki;function Ks(i,t,e){if(i&&Qt.isObject(i)&&i instanceof Vt)return i;var s=new Vt;return s.parse(i,t,e),s}Vt.prototype.parse=function(i,t,e){if(!Qt.isString(i))throw new TypeError("Parameter 'url' must be a string, not "+typeof i);var s=i.indexOf("?"),n=s!==-1&&s<i.indexOf("#")?"?":"#",r=i.split(n),o=/\\/g;r[0]=r[0].replace(o,"/"),i=r.join(n);var a=i;if(a=a.trim(),!e&&i.split("#").length===1){var h=Hl.exec(a);if(h)return this.path=a,this.href=a,this.pathname=h[1],h[2]?(this.search=h[2],t?this.query=Hn.parse(this.search.substr(1)):this.query=this.search.substr(1)):t&&(this.search="",this.query={}),this}var c=Nl.exec(a);if(c){c=c[0];var l=c.toLowerCase();this.protocol=l,a=a.substr(c.length)}if(e||c||a.match(/^\/\/[^@\/]+@[^@\/]+/)){var f=a.substr(0,2)==="//";f&&!(c&&Gn[c])&&(a=a.substr(2),this.slashes=!0)}if(!Gn[c]&&(f||c&&!hi[c])){for(var d=-1,u=0;u<Zr.length;u++){var p=a.indexOf(Zr[u]);p!==-1&&(d===-1||p<d)&&(d=p)}var m,g;d===-1?g=a.lastIndexOf("@"):g=a.lastIndexOf("@",d),g!==-1&&(m=a.slice(0,g),a=a.slice(g+1),this.auth=decodeURIComponent(m)),d=-1;for(var u=0;u<Kr.length;u++){var p=a.indexOf(Kr[u]);p!==-1&&(d===-1||p<d)&&(d=p)}d===-1&&(d=a.length),this.host=a.slice(0,d),a=a.slice(d),this.parseHost(),this.hostname=this.hostname||"";var _=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!_)for(var A=this.hostname.split(/\./),u=0,y=A.length;u<y;u++){var v=A[u];if(!!v&&!v.match(Qr)){for(var x="",b=0,w=v.length;b<w;b++)v.charCodeAt(b)>127?x+="x":x+=v[b];if(!x.match(Qr)){var E=A.slice(0,u),S=A.slice(u+1),C=v.match(Wl);C&&(E.push(C[1]),S.unshift(C[2])),S.length&&(a="/"+S.join(".")+a),this.hostname=E.join(".");break}}}this.hostname.length>Xl?this.hostname="":this.hostname=this.hostname.toLowerCase(),_||(this.hostname=Ll.toASCII(this.hostname));var T=this.port?":"+this.port:"",I=this.hostname||"";this.host=I+T,this.href+=this.host,_&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),a[0]!=="/"&&(a="/"+a))}if(!jl[l])for(var u=0,y=Nn.length;u<y;u++){var P=Nn[u];if(a.indexOf(P)!==-1){var R=encodeURIComponent(P);R===P&&(R=escape(P)),a=a.split(P).join(R)}}var L=a.indexOf("#");L!==-1&&(this.hash=a.substr(L),a=a.slice(0,L));var k=a.indexOf("?");if(k!==-1?(this.search=a.substr(k),this.query=a.substr(k+1),t&&(this.query=Hn.parse(this.query)),a=a.slice(0,k)):t&&(this.search="",this.query={}),a&&(this.pathname=a),hi[l]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var T=this.pathname||"",F=this.search||"";this.path=T+F}return this.href=this.format(),this};function Yl(i){return Qt.isString(i)&&(i=Ks(i)),i instanceof Vt?i.format():Vt.prototype.format.call(i)}Vt.prototype.format=function(){var i=this.auth||"";i&&(i=encodeURIComponent(i),i=i.replace(/%3A/i,":"),i+="@");var t=this.protocol||"",e=this.pathname||"",s=this.hash||"",n=!1,r="";this.host?n=i+this.host:this.hostname&&(n=i+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(n+=":"+this.port)),this.query&&Qt.isObject(this.query)&&Object.keys(this.query).length&&(r=Hn.stringify(this.query));var o=this.search||r&&"?"+r||"";return t&&t.substr(-1)!==":"&&(t+=":"),this.slashes||(!t||hi[t])&&n!==!1?(n="//"+(n||""),e&&e.charAt(0)!=="/"&&(e="/"+e)):n||(n=""),s&&s.charAt(0)!=="#"&&(s="#"+s),o&&o.charAt(0)!=="?"&&(o="?"+o),e=e.replace(/[?#]/g,function(a){return encodeURIComponent(a)}),o=o.replace("#","%23"),t+n+e+o+s};function Kl(i,t){return Ks(i,!1,!0).resolve(t)}Vt.prototype.resolve=function(i){return this.resolveObject(Ks(i,!1,!0)).format()};Vt.prototype.resolveObject=function(i){if(Qt.isString(i)){var t=new Vt;t.parse(i,!1,!0),i=t}for(var e=new Vt,s=Object.keys(this),n=0;n<s.length;n++){var r=s[n];e[r]=this[r]}if(e.hash=i.hash,i.href==="")return e.href=e.format(),e;if(i.slashes&&!i.protocol){for(var o=Object.keys(i),a=0;a<o.length;a++){var h=o[a];h!=="protocol"&&(e[h]=i[h])}return hi[e.protocol]&&e.hostname&&!e.pathname&&(e.path=e.pathname="/"),e.href=e.format(),e}if(i.protocol&&i.protocol!==e.protocol){if(!hi[i.protocol]){for(var c=Object.keys(i),l=0;l<c.length;l++){var f=c[l];e[f]=i[f]}return e.href=e.format(),e}if(e.protocol=i.protocol,!i.host&&!Gn[i.protocol]){for(var y=(i.pathname||"").split("/");y.length&&!(i.host=y.shift()););i.host||(i.host=""),i.hostname||(i.hostname=""),y[0]!==""&&y.unshift(""),y.length<2&&y.unshift(""),e.pathname=y.join("/")}else e.pathname=i.pathname;if(e.search=i.search,e.query=i.query,e.host=i.host||"",e.auth=i.auth,e.hostname=i.hostname||i.host,e.port=i.port,e.pathname||e.search){var d=e.pathname||"",u=e.search||"";e.path=d+u}return e.slashes=e.slashes||i.slashes,e.href=e.format(),e}var p=e.pathname&&e.pathname.charAt(0)==="/",m=i.host||i.pathname&&i.pathname.charAt(0)==="/",g=m||p||e.host&&i.pathname,_=g,A=e.pathname&&e.pathname.split("/")||[],y=i.pathname&&i.pathname.split("/")||[],v=e.protocol&&!hi[e.protocol];if(v&&(e.hostname="",e.port=null,e.host&&(A[0]===""?A[0]=e.host:A.unshift(e.host)),e.host="",i.protocol&&(i.hostname=null,i.port=null,i.host&&(y[0]===""?y[0]=i.host:y.unshift(i.host)),i.host=null),g=g&&(y[0]===""||A[0]==="")),m)e.host=i.host||i.host===""?i.host:e.host,e.hostname=i.hostname||i.hostname===""?i.hostname:e.hostname,e.search=i.search,e.query=i.query,A=y;else if(y.length)A||(A=[]),A.pop(),A=A.concat(y),e.search=i.search,e.query=i.query;else if(!Qt.isNullOrUndefined(i.search)){if(v){e.hostname=e.host=A.shift();var x=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;x&&(e.auth=x.shift(),e.host=e.hostname=x.shift())}return e.search=i.search,e.query=i.query,(!Qt.isNull(e.pathname)||!Qt.isNull(e.search))&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.href=e.format(),e}if(!A.length)return e.pathname=null,e.search?e.path="/"+e.search:e.path=null,e.href=e.format(),e;for(var b=A.slice(-1)[0],w=(e.host||i.host||A.length>1)&&(b==="."||b==="..")||b==="",E=0,S=A.length;S>=0;S--)b=A[S],b==="."?A.splice(S,1):b===".."?(A.splice(S,1),E++):E&&(A.splice(S,1),E--);if(!g&&!_)for(;E--;E)A.unshift("..");g&&A[0]!==""&&(!A[0]||A[0].charAt(0)!=="/")&&A.unshift(""),w&&A.join("/").substr(-1)!=="/"&&A.push("");var C=A[0]===""||A[0]&&A[0].charAt(0)==="/";if(v){e.hostname=e.host=C?"":A.length?A.shift():"";var x=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;x&&(e.auth=x.shift(),e.host=e.hostname=x.shift())}return g=g||e.host&&A.length,g&&!C&&A.unshift(""),A.length?e.pathname=A.join("/"):(e.pathname=null,e.path=null),(!Qt.isNull(e.pathname)||!Qt.isNull(e.search))&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.auth=i.auth||e.auth,e.slashes=e.slashes||i.slashes,e.href=e.format(),e};Vt.prototype.parseHost=function(){var i=this.host,t=Gl.exec(i);t&&(t=t[0],t!==":"&&(this.port=t.substr(1)),i=i.substr(0,i.length-t.length)),i&&(this.hostname=i)};const Zl={parse:kl,format:Ul,resolve:Ol};function kt(i){if(typeof i!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(i)}`)}function $r(i){return i.split("?")[0].split("#")[0]}function Ql(i){return i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function $l(i,t,e){return i.replace(new RegExp(Ql(t),"g"),e)}function ql(i,t){let e="",s=0,n=-1,r=0,o;for(let a=0;a<=i.length;++a){if(a<i.length)o=i.charCodeAt(a);else{if(o===47)break;o=47}if(o===47){if(!(n===a-1||r===1))if(n!==a-1&&r===2){if(e.length<2||s!==2||e.charCodeAt(e.length-1)!==46||e.charCodeAt(e.length-2)!==46){if(e.length>2){const h=e.lastIndexOf("/");if(h!==e.length-1){h===-1?(e="",s=0):(e=e.slice(0,h),s=e.length-1-e.lastIndexOf("/")),n=a,r=0;continue}}else if(e.length===2||e.length===1){e="",s=0,n=a,r=0;continue}}t&&(e.length>0?e+="/..":e="..",s=2)}else e.length>0?e+=`/${i.slice(n+1,a)}`:e=i.slice(n+1,a),s=a-n-1;n=a,r=0}else o===46&&r!==-1?++r:r=-1}return e}const yt={toPosix(i){return $l(i,"\\","/")},isUrl(i){return/^https?:/.test(this.toPosix(i))},isDataUrl(i){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(i)},hasProtocol(i){return/^[^/:]+:\//.test(this.toPosix(i))},getProtocol(i){kt(i),i=this.toPosix(i);let t="";const e=/^file:\/\/\//.exec(i),s=/^[^/:]+:\/\//.exec(i),n=/^[^/:]+:\//.exec(i);if(e||s||n){const r=(e==null?void 0:e[0])||(s==null?void 0:s[0])||(n==null?void 0:n[0]);t=r,i=i.slice(r.length)}return t},toAbsolute(i,t,e){if(this.isDataUrl(i))return i;const s=$r(this.toPosix(t!=null?t:O.ADAPTER.getBaseUrl())),n=$r(this.toPosix(e!=null?e:this.rootname(s)));return kt(i),i=this.toPosix(i),i.startsWith("/")?yt.join(n,i.slice(1)):this.isAbsolute(i)?i:this.join(s,i)},normalize(i){if(i=this.toPosix(i),kt(i),i.length===0)return".";let t="";const e=i.startsWith("/");this.hasProtocol(i)&&(t=this.rootname(i),i=i.slice(t.length));const s=i.endsWith("/");return i=ql(i,!1),i.length>0&&s&&(i+="/"),e?`/${i}`:t+i},isAbsolute(i){return kt(i),i=this.toPosix(i),this.hasProtocol(i)?!0:i.startsWith("/")},join(...i){var e;if(i.length===0)return".";let t;for(let s=0;s<i.length;++s){const n=i[s];if(kt(n),n.length>0)if(t===void 0)t=n;else{const r=(e=i[s-1])!=null?e:"";this.extname(r)?t+=`/../${n}`:t+=`/${n}`}}return t===void 0?".":this.normalize(t)},dirname(i){if(kt(i),i.length===0)return".";i=this.toPosix(i);let t=i.charCodeAt(0);const e=t===47;let s=-1,n=!0;const r=this.getProtocol(i),o=i;i=i.slice(r.length);for(let a=i.length-1;a>=1;--a)if(t=i.charCodeAt(a),t===47){if(!n){s=a;break}}else n=!1;return s===-1?e?"/":this.isUrl(o)?r+i:r:e&&s===1?"//":r+i.slice(0,s)},rootname(i){kt(i),i=this.toPosix(i);let t="";if(i.startsWith("/")?t="/":t=this.getProtocol(i),this.isUrl(i)){const e=i.indexOf("/",t.length);e!==-1?t=i.slice(0,e):t=i,t.endsWith("/")||(t+="/")}return t},basename(i,t){kt(i),t&&kt(t),i=this.toPosix(i);let e=0,s=-1,n=!0,r;if(t!==void 0&&t.length>0&&t.length<=i.length){if(t.length===i.length&&t===i)return"";let o=t.length-1,a=-1;for(r=i.length-1;r>=0;--r){const h=i.charCodeAt(r);if(h===47){if(!n){e=r+1;break}}else a===-1&&(n=!1,a=r+1),o>=0&&(h===t.charCodeAt(o)?--o===-1&&(s=r):(o=-1,s=a))}return e===s?s=a:s===-1&&(s=i.length),i.slice(e,s)}for(r=i.length-1;r>=0;--r)if(i.charCodeAt(r)===47){if(!n){e=r+1;break}}else s===-1&&(n=!1,s=r+1);return s===-1?"":i.slice(e,s)},extname(i){kt(i),i=this.toPosix(i);let t=-1,e=0,s=-1,n=!0,r=0;for(let o=i.length-1;o>=0;--o){const a=i.charCodeAt(o);if(a===47){if(!n){e=o+1;break}continue}s===-1&&(n=!1,s=o+1),a===46?t===-1?t=o:r!==1&&(r=1):t!==-1&&(r=-1)}return t===-1||s===-1||r===0||r===1&&t===s-1&&t===e+1?"":i.slice(t,s)},parse(i){kt(i);const t={root:"",dir:"",base:"",ext:"",name:""};if(i.length===0)return t;i=this.toPosix(i);let e=i.charCodeAt(0);const s=this.isAbsolute(i);let n;t.root=this.rootname(i),s||this.hasProtocol(i)?n=1:n=0;let r=-1,o=0,a=-1,h=!0,c=i.length-1,l=0;for(;c>=n;--c){if(e=i.charCodeAt(c),e===47){if(!h){o=c+1;break}continue}a===-1&&(h=!1,a=c+1),e===46?r===-1?r=c:l!==1&&(l=1):r!==-1&&(l=-1)}return r===-1||a===-1||l===0||l===1&&r===a-1&&r===o+1?a!==-1&&(o===0&&s?t.base=t.name=i.slice(1,a):t.base=t.name=i.slice(o,a)):(o===0&&s?(t.name=i.slice(1,r),t.base=i.slice(1,a)):(t.name=i.slice(o,r),t.base=i.slice(o,a)),t.ext=i.slice(r,a)),t.dir=this.dirname(i),t},sep:"/",delimiter:":"};O.RETINA_PREFIX=/@([0-9\.]+)x/;O.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;let an;function Jl(){return typeof an>"u"&&(an=function(){const t={stencil:!0,failIfMajorPerformanceCaveat:O.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!O.ADAPTER.getWebGLRenderingContext())return!1;const e=O.ADAPTER.createCanvas();let s=e.getContext("webgl",t)||e.getContext("experimental-webgl",t);const n=!!(s&&s.getContextAttributes().stencil);if(s){const r=s.getExtension("WEBGL_lose_context");r&&r.loseContext()}return s=null,n}catch{return!1}}()),an}var tc="#f0f8ff",ec="#faebd7",ic="#00ffff",sc="#7fffd4",nc="#f0ffff",rc="#f5f5dc",oc="#ffe4c4",ac="#000000",hc="#ffebcd",lc="#0000ff",cc="#8a2be2",uc="#a52a2a",dc="#deb887",fc="#5f9ea0",pc="#7fff00",mc="#d2691e",gc="#ff7f50",vc="#6495ed",_c="#fff8dc",yc="#dc143c",xc="#00ffff",wc="#00008b",bc="#008b8b",Ac="#b8860b",Ec="#a9a9a9",Tc="#006400",Sc="#a9a9a9",Cc="#bdb76b",Ic="#8b008b",Pc="#556b2f",Rc="#ff8c00",Mc="#9932cc",Bc="#8b0000",Dc="#e9967a",Fc="#8fbc8f",Lc="#483d8b",kc="#2f4f4f",Oc="#2f4f4f",Uc="#00ced1",Nc="#9400d3",Gc="#ff1493",Hc="#00bfff",zc="#696969",Vc="#696969",Xc="#1e90ff",Wc="#b22222",jc="#fffaf0",Yc="#228b22",Kc="#ff00ff",Zc="#dcdcdc",Qc="#f8f8ff",$c="#daa520",qc="#ffd700",Jc="#808080",tu="#008000",eu="#adff2f",iu="#808080",su="#f0fff0",nu="#ff69b4",ru="#cd5c5c",ou="#4b0082",au="#fffff0",hu="#f0e68c",lu="#fff0f5",cu="#e6e6fa",uu="#7cfc00",du="#fffacd",fu="#add8e6",pu="#f08080",mu="#e0ffff",gu="#fafad2",vu="#d3d3d3",_u="#90ee90",yu="#d3d3d3",xu="#ffb6c1",wu="#ffa07a",bu="#20b2aa",Au="#87cefa",Eu="#778899",Tu="#778899",Su="#b0c4de",Cu="#ffffe0",Iu="#00ff00",Pu="#32cd32",Ru="#faf0e6",Mu="#ff00ff",Bu="#800000",Du="#66cdaa",Fu="#0000cd",Lu="#ba55d3",ku="#9370db",Ou="#3cb371",Uu="#7b68ee",Nu="#00fa9a",Gu="#48d1cc",Hu="#c71585",zu="#191970",Vu="#f5fffa",Xu="#ffe4e1",Wu="#ffe4b5",ju="#ffdead",Yu="#000080",Ku="#fdf5e6",Zu="#808000",Qu="#6b8e23",$u="#ffa500",qu="#ff4500",Ju="#da70d6",td="#eee8aa",ed="#98fb98",id="#afeeee",sd="#db7093",nd="#ffefd5",rd="#ffdab9",od="#cd853f",ad="#ffc0cb",hd="#dda0dd",ld="#b0e0e6",cd="#800080",ud="#663399",dd="#ff0000",fd="#bc8f8f",pd="#4169e1",md="#8b4513",gd="#fa8072",vd="#f4a460",_d="#2e8b57",yd="#fff5ee",xd="#a0522d",wd="#c0c0c0",bd="#87ceeb",Ad="#6a5acd",Ed="#708090",Td="#708090",Sd="#fffafa",Cd="#00ff7f",Id="#4682b4",Pd="#d2b48c",Rd="#008080",Md="#d8bfd8",Bd="#ff6347",Dd="#40e0d0",Fd="#ee82ee",Ld="#f5deb3",kd="#ffffff",Od="#f5f5f5",Ud="#ffff00",Nd="#9acd32",Gd={aliceblue:tc,antiquewhite:ec,aqua:ic,aquamarine:sc,azure:nc,beige:rc,bisque:oc,black:ac,blanchedalmond:hc,blue:lc,blueviolet:cc,brown:uc,burlywood:dc,cadetblue:fc,chartreuse:pc,chocolate:mc,coral:gc,cornflowerblue:vc,cornsilk:_c,crimson:yc,cyan:xc,darkblue:wc,darkcyan:bc,darkgoldenrod:Ac,darkgray:Ec,darkgreen:Tc,darkgrey:Sc,darkkhaki:Cc,darkmagenta:Ic,darkolivegreen:Pc,darkorange:Rc,darkorchid:Mc,darkred:Bc,darksalmon:Dc,darkseagreen:Fc,darkslateblue:Lc,darkslategray:kc,darkslategrey:Oc,darkturquoise:Uc,darkviolet:Nc,deeppink:Gc,deepskyblue:Hc,dimgray:zc,dimgrey:Vc,dodgerblue:Xc,firebrick:Wc,floralwhite:jc,forestgreen:Yc,fuchsia:Kc,gainsboro:Zc,ghostwhite:Qc,goldenrod:$c,gold:qc,gray:Jc,green:tu,greenyellow:eu,grey:iu,honeydew:su,hotpink:nu,indianred:ru,indigo:ou,ivory:au,khaki:hu,lavenderblush:lu,lavender:cu,lawngreen:uu,lemonchiffon:du,lightblue:fu,lightcoral:pu,lightcyan:mu,lightgoldenrodyellow:gu,lightgray:vu,lightgreen:_u,lightgrey:yu,lightpink:xu,lightsalmon:wu,lightseagreen:bu,lightskyblue:Au,lightslategray:Eu,lightslategrey:Tu,lightsteelblue:Su,lightyellow:Cu,lime:Iu,limegreen:Pu,linen:Ru,magenta:Mu,maroon:Bu,mediumaquamarine:Du,mediumblue:Fu,mediumorchid:Lu,mediumpurple:ku,mediumseagreen:Ou,mediumslateblue:Uu,mediumspringgreen:Nu,mediumturquoise:Gu,mediumvioletred:Hu,midnightblue:zu,mintcream:Vu,mistyrose:Xu,moccasin:Wu,navajowhite:ju,navy:Yu,oldlace:Ku,olive:Zu,olivedrab:Qu,orange:$u,orangered:qu,orchid:Ju,palegoldenrod:td,palegreen:ed,paleturquoise:id,palevioletred:sd,papayawhip:nd,peachpuff:rd,peru:od,pink:ad,plum:hd,powderblue:ld,purple:cd,rebeccapurple:ud,red:dd,rosybrown:fd,royalblue:pd,saddlebrown:md,salmon:gd,sandybrown:vd,seagreen:_d,seashell:yd,sienna:xd,silver:wd,skyblue:bd,slateblue:Ad,slategray:Ed,slategrey:Td,snow:Sd,springgreen:Cd,steelblue:Id,tan:Pd,teal:Rd,thistle:Md,tomato:Bd,turquoise:Dd,violet:Fd,wheat:Ld,white:kd,whitesmoke:Od,yellow:Ud,yellowgreen:Nd};function Oi(i,t=[]){return t[0]=(i>>16&255)/255,t[1]=(i>>8&255)/255,t[2]=(i&255)/255,t}function _a(i){let t=i.toString(16);return t="000000".substring(0,6-t.length)+t,`#${t}`}function xr(i){if(typeof i=="string"&&(i=Gd[i.toLowerCase()]||i,i[0]==="#"&&(i=i.slice(1)),i.length===3)){const[t,e,s]=i;i=t+t+e+e+s+s}return parseInt(i,16)}function Hd(){const i=[],t=[];for(let s=0;s<32;s++)i[s]=s,t[s]=s;i[$.NORMAL_NPM]=$.NORMAL,i[$.ADD_NPM]=$.ADD,i[$.SCREEN_NPM]=$.SCREEN,t[$.NORMAL]=$.NORMAL_NPM,t[$.ADD]=$.ADD_NPM,t[$.SCREEN]=$.SCREEN_NPM;const e=[];return e.push(t),e.push(i),e}const ya=Hd();function xa(i,t){return ya[t?1:0][i]}function zd(i,t,e,s){return e=e||new Float32Array(4),s||s===void 0?(e[0]=i[0]*t,e[1]=i[1]*t,e[2]=i[2]*t):(e[0]=i[0],e[1]=i[1],e[2]=i[2]),e[3]=t,e}function wr(i,t){if(t===1)return(t*255<<24)+i;if(t===0)return 0;let e=i>>16&255,s=i>>8&255,n=i&255;return e=e*t+.5|0,s=s*t+.5|0,n=n*t+.5|0,(t*255<<24)+(e<<16)+(s<<8)+n}function wa(i,t,e,s){return e=e||new Float32Array(4),e[0]=(i>>16&255)/255,e[1]=(i>>8&255)/255,e[2]=(i&255)/255,(s||s===void 0)&&(e[0]*=t,e[1]*=t,e[2]*=t),e[3]=t,e}function Vd(i,t=null){const e=i*6;if(t=t||new Uint16Array(e),t.length!==e)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${e}`);for(let s=0,n=0;s<e;s+=6,n+=4)t[s+0]=n+0,t[s+1]=n+1,t[s+2]=n+2,t[s+3]=n+0,t[s+4]=n+2,t[s+5]=n+3;return t}function ba(i){if(i.BYTES_PER_ELEMENT===4)return i instanceof Float32Array?"Float32Array":i instanceof Uint32Array?"Uint32Array":"Int32Array";if(i.BYTES_PER_ELEMENT===2){if(i instanceof Uint16Array)return"Uint16Array"}else if(i.BYTES_PER_ELEMENT===1&&i instanceof Uint8Array)return"Uint8Array";return null}function Cs(i){return i+=i===0?1:0,--i,i|=i>>>1,i|=i>>>2,i|=i>>>4,i|=i>>>8,i|=i>>>16,i+1}function qr(i){return!(i&i-1)&&!!i}function Jr(i){let t=(i>65535?1:0)<<4;i>>>=t;let e=(i>255?1:0)<<3;return i>>>=e,t|=e,e=(i>15?1:0)<<2,i>>>=e,t|=e,e=(i>3?1:0)<<1,i>>>=e,t|=e,t|i>>1}function li(i,t,e){const s=i.length;let n;if(t>=s||e===0)return;e=t+e>s?s-t:e;const r=s-e;for(n=t;n<r;++n)i[n]=i[n+e];i.length=r}function ti(i){return i===0?0:i<0?-1:1}let Xd=0;function He(){return++Xd}const to={},ae=Object.create(null),Ie=Object.create(null);class eo{constructor(t,e,s){this.canvas=O.ADAPTER.createCanvas(),this.context=this.canvas.getContext("2d"),this.resolution=s||O.RESOLUTION,this.resize(t,e)}clear(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}resize(t,e){this.canvas.width=Math.round(t*this.resolution),this.canvas.height=Math.round(e*this.resolution)}destroy(){this.context=null,this.canvas=null}get width(){return this.canvas.width}set width(t){this.canvas.width=Math.round(t)}get height(){return this.canvas.height}set height(t){this.canvas.height=Math.round(t)}}function Wd(i){let t=i.width,e=i.height;const s=i.getContext("2d",{willReadFrequently:!0}),r=s.getImageData(0,0,t,e).data,o=r.length,a={top:null,left:null,right:null,bottom:null};let h=null,c,l,f;for(c=0;c<o;c+=4)r[c+3]!==0&&(l=c/4%t,f=~~(c/4/t),a.top===null&&(a.top=f),(a.left===null||l<a.left)&&(a.left=l),(a.right===null||a.right<l)&&(a.right=l+1),(a.bottom===null||a.bottom<f)&&(a.bottom=f));return a.top!==null&&(t=a.right-a.left,e=a.bottom-a.top+1,h=s.getImageData(a.left,a.top,t,e)),{height:e,width:t,data:h}}let ss;function jd(i,t=globalThis.location){if(i.startsWith("data:"))return"";t=t||globalThis.location,ss||(ss=document.createElement("a")),ss.href=i;const e=Zl.parse(ss.href),s=!e.port&&t.port===""||e.port===t.port;return e.hostname!==t.hostname||!s||e.protocol!==t.protocol?"anonymous":""}function xe(i,t=1){const e=O.RETINA_PREFIX.exec(i);return e?parseFloat(e[1]):t}const zn=[];function Aa(i,t){if(!i)return null;let e="";if(typeof i=="string"){const s=/\.(\w{3,4})(?:$|\?|#)/i.exec(i);s&&(e=s[1].toLowerCase())}for(let s=zn.length-1;s>=0;--s){const n=zn[s];if(n.test&&n.test(i,e))return new n(i,t)}throw new Error("Unrecognized source type to auto-detect Resource")}class Ui{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new zt("setRealSize"),this.onUpdate=new zt("update"),this.onError=new zt("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){(t!==this._width||e!==this._height)&&(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,s){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}}class Yi extends Ui{constructor(t,e){const{width:s,height:n}=e||{};if(!s||!n)throw new Error("BufferResource width or height invalid");super(s,n),this.data=t}upload(t,e,s){const n=t.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===Wt.UNPACK);const r=e.realWidth,o=e.realHeight;return s.width===r&&s.height===o?n.texSubImage2D(e.target,0,0,0,r,o,e.format,s.type,this.data):(s.width=r,s.height=o,n.texImage2D(e.target,0,s.internalFormat,r,o,0,e.format,s.type,this.data)),!0}dispose(){this.data=null}static test(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array}}const Yd={scaleMode:Jt.NEAREST,format:U.RGBA,alphaMode:Wt.NPM},wi=class extends re{constructor(i=null,t=null){super(),t=t||{};const{alphaMode:e,mipmap:s,anisotropicLevel:n,scaleMode:r,width:o,height:a,wrapMode:h,format:c,type:l,target:f,resolution:d,resourceOptions:u}=t;i&&!(i instanceof Ui)&&(i=Aa(i,u),i.internal=!0),this.resolution=d||O.RESOLUTION,this.width=Math.round((o||0)*this.resolution)/this.resolution,this.height=Math.round((a||0)*this.resolution)/this.resolution,this._mipmap=s!=null?s:O.MIPMAP_TEXTURES,this.anisotropicLevel=n!=null?n:O.ANISOTROPIC_LEVEL,this._wrapMode=h||O.WRAP_MODE,this._scaleMode=r!=null?r:O.SCALE_MODE,this.format=c||U.RGBA,this.type=l||Z.UNSIGNED_BYTE,this.target=f||ri.TEXTURE_2D,this.alphaMode=e!=null?e:Wt.UNPACK,this.uid=He(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=o>0&&a>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(i)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(i){this._mipmap!==i&&(this._mipmap=i,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(i){this._scaleMode!==i&&(this._scaleMode=i,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(i){this._wrapMode!==i&&(this._wrapMode=i,this.dirtyStyleId++)}setStyle(i,t){let e;return i!==void 0&&i!==this.scaleMode&&(this.scaleMode=i,e=!0),t!==void 0&&t!==this.mipmap&&(this.mipmap=t,e=!0),e&&this.dirtyStyleId++,this}setSize(i,t,e){return e=e||this.resolution,this.setRealSize(i*e,t*e,e)}setRealSize(i,t,e){return this.resolution=e||this.resolution,this.width=Math.round(i)/this.resolution,this.height=Math.round(t)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=qr(this.realWidth)&&qr(this.realHeight)}setResolution(i){const t=this.resolution;return t===i?this:(this.resolution=i,this.valid&&(this.width=Math.round(this.width*t)/i,this.height=Math.round(this.height*t)/i,this.emit("update",this)),this._refreshPOT(),this)}setResource(i){if(this.resource===i)return this;if(this.resource)throw new Error("Resource can be set only once");return i.bind(this),this.resource=i,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(i){this.emit("error",this,i)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Ie[this.cacheId],delete ae[this.cacheId],this.cacheId=null),this.dispose(),wi.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(i,t,e=O.STRICT_TEXTURE_CACHE){const s=typeof i=="string";let n=null;if(s)n=i;else{if(!i._pixiId){const o=(t==null?void 0:t.pixiIdPrefix)||"pixiid";i._pixiId=`${o}_${He()}`}n=i._pixiId}let r=Ie[n];if(s&&e&&!r)throw new Error(`The cacheId "${n}" does not exist in BaseTextureCache.`);return r||(r=new wi(i,t),r.cacheId=n,wi.addToCache(r,n)),r}static fromBuffer(i,t,e,s){i=i||new Float32Array(t*e*4);const n=new Yi(i,{width:t,height:e}),r=i instanceof Float32Array?Z.FLOAT:Z.UNSIGNED_BYTE;return new wi(n,Object.assign({},Yd,s||{width:t,height:e,type:r}))}static addToCache(i,t){t&&(i.textureCacheIds.includes(t)||i.textureCacheIds.push(t),Ie[t]&&console.warn(`BaseTexture added to the cache with an id [${t}] that already had an entry`),Ie[t]=i)}static removeFromCache(i){if(typeof i=="string"){const t=Ie[i];if(t){const e=t.textureCacheIds.indexOf(i);return e>-1&&t.textureCacheIds.splice(e,1),delete Ie[i],t}}else if(i!=null&&i.textureCacheIds){for(let t=0;t<i.textureCacheIds.length;++t)delete Ie[i.textureCacheIds[t]];return i.textureCacheIds.length=0,i}return null}};let J=wi;J._globalBatch=0;class Ea extends Ui{constructor(t,e){const{width:s,height:n}=e||{};super(s,n),this.items=[],this.itemDirtyIds=[];for(let r=0;r<t;r++){const o=new J;this.items.push(o),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let s=0;s<this.length;s++)!t[s]||(t[s].castToBaseTexture?this.addBaseTextureAt(t[s].castToBaseTexture(),s):t[s]instanceof Ui?this.addResourceAt(t[s],s):this.addResourceAt(Aa(t[s],e),s))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;const e=this.items.map(s=>s.resource).filter(s=>s).map(s=>s.load());return this._load=Promise.all(e).then(()=>{const{realWidth:s,realHeight:n}=this.items[0];return this.resize(s,n),Promise.resolve(this)}),this._load}}class Kd extends Ea{constructor(t,e){const{width:s,height:n}=e||{};let r,o;Array.isArray(t)?(r=t,o=t.length):o=t,super(o,{width:s,height:n}),r&&this.initFromArray(r,e)}addBaseTextureAt(t,e){if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(t){super.bind(t),t.target=ri.TEXTURE_2D_ARRAY}upload(t,e,s){const{length:n,itemDirtyIds:r,items:o}=this,{gl:a}=t;s.dirtyId<0&&a.texImage3D(a.TEXTURE_2D_ARRAY,0,s.internalFormat,this._width,this._height,n,0,e.format,s.type,null);for(let h=0;h<n;h++){const c=o[h];r[h]<c.dirtyId&&(r[h]=c.dirtyId,c.valid&&a.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,h,c.resource.width,c.resource.height,1,e.format,s.type,c.resource.source))}return!0}}class we extends Ui{constructor(t){const e=t,s=e.naturalWidth||e.videoWidth||e.width,n=e.naturalHeight||e.videoHeight||e.height;super(s,n),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,s){s===void 0&&!e.startsWith("data:")?t.crossOrigin=jd(e):s!==!1&&(t.crossOrigin=typeof s=="string"?s:"anonymous")}upload(t,e,s,n){const r=t.gl,o=e.realWidth,a=e.realHeight;if(n=n||this.source,typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement){if(!n.complete||n.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement&&n.readyState<=1&&n.buffered.length===0)return!1;return r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===Wt.UNPACK),!this.noSubImage&&e.target===r.TEXTURE_2D&&s.width===o&&s.height===a?r.texSubImage2D(r.TEXTURE_2D,0,0,0,e.format,s.type,n):(s.width=o,s.height=a,r.texImage2D(e.target,0,s.internalFormat,e.format,s.type,n)),!0}update(){if(this.destroyed)return;const t=this.source,e=t.naturalWidth||t.videoWidth||t.width,s=t.naturalHeight||t.videoHeight||t.height;this.resize(e,s),super.update()}dispose(){this.source=null}}class Zd extends we{constructor(t){super(t)}static test(t){const{OffscreenCanvas:e}=globalThis;return e&&t instanceof e?!0:globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}}const bi=class extends Ea{constructor(i,t){const{width:e,height:s,autoLoad:n,linkBaseTexture:r}=t||{};if(i&&i.length!==bi.SIDES)throw new Error(`Invalid length. Got ${i.length}, expected 6`);super(6,{width:e,height:s});for(let o=0;o<bi.SIDES;o++)this.items[o].target=ri.TEXTURE_CUBE_MAP_POSITIVE_X+o;this.linkBaseTexture=r!==!1,i&&this.initFromArray(i,t),n!==!1&&this.load()}bind(i){super.bind(i),i.target=ri.TEXTURE_CUBE_MAP}addBaseTextureAt(i,t,e){if(e===void 0&&(e=this.linkBaseTexture),!this.items[t])throw new Error(`Index ${t} is out of bounds`);if(!this.linkBaseTexture||i.parentTextureArray||Object.keys(i._glTextures).length>0)if(i.resource)this.addResourceAt(i.resource,t);else throw new Error("CubeResource does not support copying of renderTexture.");else i.target=ri.TEXTURE_CUBE_MAP_POSITIVE_X+t,i.parentTextureArray=this.baseTexture,this.items[t]=i;return i.valid&&!this.valid&&this.resize(i.realWidth,i.realHeight),this.items[t]=i,this}upload(i,t,e){const s=this.itemDirtyIds;for(let n=0;n<bi.SIDES;n++){const r=this.items[n];(s[n]<r.dirtyId||e.dirtyId<t.dirtyId)&&(r.valid&&r.resource?(r.resource.upload(i,r,e),s[n]=r.dirtyId):s[n]<-1&&(i.gl.texImage2D(r.target,0,e.internalFormat,t.realWidth,t.realHeight,0,t.format,e.type,null),s[n]=-1))}return!0}static test(i){return Array.isArray(i)&&i.length===bi.SIDES}};let Ta=bi;Ta.SIDES=6;class Sa extends we{constructor(t,e){var s;if(e=e||{},typeof t=="string"){const n=new Image;we.crossOrigin(n,t,e.crossorigin),n.src=t,t=n}super(t),!t.complete&&!!this._width&&!!this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=((s=e.createBitmap)!=null?s:O.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.bitmap=null,this._load=null,e.autoLoad!==!1&&this.load()}load(t){return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise((e,s)=>{const n=this.source;this.url=n.src;const r=()=>{this.destroyed||(n.onload=null,n.onerror=null,this.resize(n.width,n.height),this._load=null,this.createBitmap?e(this.process()):e(this))};n.complete&&n.src?r():(n.onload=r,n.onerror=o=>{s(o),this.onError.emit(o)})}),this._load)}process(){const t=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const e=globalThis.createImageBitmap,s=!t.crossOrigin||t.crossOrigin==="anonymous";return this._process=fetch(t.src,{mode:s?"cors":"no-cors"}).then(n=>n.blob()).then(n=>e(n,0,0,t.width,t.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Wt.UNPACK?"premultiply":"none"})).then(n=>this.destroyed?Promise.reject():(this.bitmap=n,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(t,e,s){if(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,s);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,s,this.bitmap),!this.preserveBitmap){let n=!0;const r=e._glTextures;for(const o in r){const a=r[o];if(a!==s&&a.dirtyId!==e.dirtyId){n=!1;break}}n&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&(typeof t=="string"||t instanceof HTMLImageElement)}}const ys=class extends we{constructor(i,t){t=t||{},super(O.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=i,this.scale=t.scale||1,this._overrideWidth=t.width,this._overrideHeight=t.height,this._resolve=null,this._crossorigin=t.crossorigin,this._load=null,t.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(i=>{if(this._resolve=()=>{this.resize(this.source.width,this.source.height),i(this)},ys.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const i=new Image;we.crossOrigin(i,this.svg,this._crossorigin),i.src=this.svg,i.onerror=t=>{!this._resolve||(i.onerror=null,this.onError.emit(t))},i.onload=()=>{if(!this._resolve)return;const t=i.width,e=i.height;if(!t||!e)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let s=t*this.scale,n=e*this.scale;(this._overrideWidth||this._overrideHeight)&&(s=this._overrideWidth||this._overrideHeight/e*t,n=this._overrideHeight||this._overrideWidth/t*e),s=Math.round(s),n=Math.round(n);const r=this.source;r.width=s,r.height=n,r._pixiId=`canvas_${He()}`,r.getContext("2d").drawImage(i,0,0,t,e,0,0,s,n),this._resolve(),this._resolve=null}}static getSize(i){const t=ys.SVG_SIZE.exec(i),e={};return t&&(e[t[1]]=Math.round(parseFloat(t[3])),e[t[5]]=Math.round(parseFloat(t[7]))),e}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(i,t){return t==="svg"||typeof i=="string"&&i.startsWith("data:image/svg+xml")||typeof i=="string"&&ys.SVG_XML.test(i)}};let Ni=ys;Ni.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m;Ni.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;const Vn=class extends we{constructor(i,t){if(t=t||{},!(i instanceof HTMLVideoElement)){const e=document.createElement("video");e.setAttribute("preload","auto"),e.setAttribute("webkit-playsinline",""),e.setAttribute("playsinline",""),typeof i=="string"&&(i=[i]);const s=i[0].src||i[0];we.crossOrigin(e,s,t.crossorigin);for(let n=0;n<i.length;++n){const r=document.createElement("source");let{src:o,mime:a}=i[n];o=o||i[n];const h=o.split("?").shift().toLowerCase(),c=h.slice(h.lastIndexOf(".")+1);a=a||Vn.MIME_TYPES[c]||`video/${c}`,r.src=o,r.type=a,e.appendChild(r)}i=e}super(i),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=t.autoPlay!==!1,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),t.autoLoad!==!1&&this.load()}update(i=0){if(!this.destroyed){const t=st.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t),(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}load(){if(this._load)return this._load;const i=this.source;return(i.readyState===i.HAVE_ENOUGH_DATA||i.readyState===i.HAVE_FUTURE_DATA)&&i.width&&i.height&&(i.complete=!0),i.addEventListener("play",this._onPlayStart.bind(this)),i.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(i.addEventListener("canplay",this._onCanPlay),i.addEventListener("canplaythrough",this._onCanPlay),i.addEventListener("error",this._onError,!0)),this._load=new Promise(t=>{this.valid?t(this):(this._resolve=t,i.load())}),this._load}_onError(i){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(i)}_isSourcePlaying(){const i=this.source;return!i.paused&&!i.ended&&this._isSourceReady()}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(st.shared.add(this.update,this),this._isConnectedToTicker=!0)}_onPlayStop(){this._isConnectedToTicker&&(st.shared.remove(this.update,this),this._isConnectedToTicker=!1)}_onCanPlay(){const i=this.source;i.removeEventListener("canplay",this._onCanPlay),i.removeEventListener("canplaythrough",this._onCanPlay);const t=this.valid;this.resize(i.videoWidth,i.videoHeight),!t&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&i.play()}dispose(){this._isConnectedToTicker&&(st.shared.remove(this.update,this),this._isConnectedToTicker=!1);const i=this.source;i&&(i.removeEventListener("error",this._onError,!0),i.pause(),i.src="",i.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(i){i!==this._autoUpdate&&(this._autoUpdate=i,!this._autoUpdate&&this._isConnectedToTicker?(st.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(st.shared.add(this.update,this),this._isConnectedToTicker=!0))}get updateFPS(){return this._updateFPS}set updateFPS(i){i!==this._updateFPS&&(this._updateFPS=i)}static test(i,t){return globalThis.HTMLVideoElement&&i instanceof HTMLVideoElement||Vn.TYPES.includes(t)}};let br=Vn;br.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"];br.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};class ei extends we{constructor(t,e){var n;var s=(...r)=>{super(...r)};e=e||{},typeof t=="string"?(s(ei.EMPTY),this.url=t):(s(t),this.url=null),this.crossOrigin=(n=e.crossOrigin)!=null?n:!0,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(t,e)=>{if(this.url===null){t(this);return}try{const s=await O.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const n=await s.blob();if(this.destroyed)return;const r=await createImageBitmap(n,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Wt.UNPACK?"premultiply":"none"});if(this.destroyed)return;this.source=r,this.update(),t(this)}catch(s){if(this.destroyed)return;e(s),this.onError.emit(s)}}),this._load)}upload(t,e,s){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),super.upload(t,e,s)):(this.load(),!1)}dispose(){this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof t=="string"||t instanceof ImageBitmap)}static get EMPTY(){var t;return ei._EMPTY=(t=ei._EMPTY)!=null?t:O.ADAPTER.createCanvas(0,0),ei._EMPTY}}zn.push(ei,Sa,Zd,br,Ni,Yi,Ta,Kd);class Qd extends Yi{upload(t,e,s){const n=t.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===Wt.UNPACK);const r=e.realWidth,o=e.realHeight;return s.width===r&&s.height===o?n.texSubImage2D(e.target,0,0,0,r,o,e.format,s.type,this.data):(s.width=r,s.height=o,n.texImage2D(e.target,0,s.internalFormat,r,o,0,e.format,s.type,this.data)),!0}}class Xn{constructor(t,e){this.width=Math.round(t||100),this.height=Math.round(e||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new zt("disposeFramebuffer"),this.multisample=wt.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new J(null,{scaleMode:Jt.NEAREST,resolution:1,mipmap:se.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new J(new Qd(null,{width:this.width,height:this.height}),{scaleMode:Jt.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:se.OFF,format:U.DEPTH_COMPONENT,type:Z.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),!(t===this.width&&e===this.height)){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let s=0;s<this.colorTextures.length;s++){const n=this.colorTextures[s],r=n.resolution;n.setSize(t/r,e/r)}if(this.depthTexture){const s=this.depthTexture.resolution;this.depthTexture.setSize(t/s,e/s)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class Ca extends J{constructor(t={}){var e;if(typeof t=="number"){const s=arguments[0],n=arguments[1],r=arguments[2],o=arguments[3];t={width:s,height:n,scaleMode:r,resolution:o}}t.width=t.width||100,t.height=t.height||100,(e=t.multisample)!=null||(t.multisample=wt.NONE),super(null,t),this.mipmap=se.OFF,this.valid=!0,this.clearColor=[0,0,0,0],this.framebuffer=new Xn(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class Ia{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,s){const n=e.width,r=e.height;if(s){const o=t.width/2/n,a=t.height/2/r,h=t.x/n+o,c=t.y/r+a;s=dt.add(s,dt.NW),this.x0=h+o*dt.uX(s),this.y0=c+a*dt.uY(s),s=dt.add(s,2),this.x1=h+o*dt.uX(s),this.y1=c+a*dt.uY(s),s=dt.add(s,2),this.x2=h+o*dt.uX(s),this.y2=c+a*dt.uY(s),s=dt.add(s,2),this.x3=h+o*dt.uX(s),this.y3=c+a*dt.uY(s)}else this.x0=t.x/n,this.y0=t.y/r,this.x1=(t.x+t.width)/n,this.y1=t.y/r,this.x2=(t.x+t.width)/n,this.y2=(t.y+t.height)/r,this.x3=t.x/n,this.y3=(t.y+t.height)/r;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}const io=new Ia;function ns(i){i.destroy=function(){},i.on=function(){},i.once=function(){},i.emit=function(){}}class H extends re{constructor(t,e,s,n,r,o){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new q(0,0,1,1)),t instanceof H&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=n,this.valid=!1,this._uvs=io,this.uvMatrix=null,this.orig=s||e,this._rotate=Number(r||0),r===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=o?new G(o.x,o.y):new G(0,0),this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:e}=this.baseTexture;(e==null?void 0:e.url)&&ae[e.url]&&H.removeFromCache(e.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,H.removeFromCache(this),this.textureCacheIds=null}clone(){var n;const t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),s=new H(this.baseTexture,!this.noFrame&&t,e,(n=this.trim)==null?void 0:n.clone(),this.rotate,this.defaultAnchor);return this.noFrame&&(s._frame=t),s}updateUvs(){this._uvs===io&&(this._uvs=new Ia),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},s=O.STRICT_TEXTURE_CACHE){const n=typeof t=="string";let r=null;if(n)r=t;else if(t instanceof J){if(!t.cacheId){const a=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t.cacheId=`${a}-${He()}`,J.addToCache(t,t.cacheId)}r=t.cacheId}else{if(!t._pixiId){const a=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t._pixiId=`${a}_${He()}`}r=t._pixiId}let o=ae[r];if(n&&s&&!o)throw new Error(`The cacheId "${r}" does not exist in TextureCache.`);return!o&&!(t instanceof J)?(e.resolution||(e.resolution=xe(t)),o=new H(new J(t,e)),o.baseTexture.cacheId=r,J.addToCache(o.baseTexture,r),H.addToCache(o,r)):!o&&t instanceof J&&(o=new H(t),H.addToCache(o,r)),o}static fromURL(t,e){const s=Object.assign({autoLoad:!1},e==null?void 0:e.resourceOptions),n=H.from(t,Object.assign({resourceOptions:s},e),!1),r=n.baseTexture.resource;return n.baseTexture.valid?Promise.resolve(n):r.load().then(()=>Promise.resolve(n))}static fromBuffer(t,e,s,n){return new H(J.fromBuffer(t,e,s,n))}static fromLoader(t,e,s,n){const r=new J(t,Object.assign({scaleMode:O.SCALE_MODE,resolution:xe(e)},n)),{resource:o}=r;o instanceof Sa&&(o.url=e);const a=new H(r);return s||(s=e),J.addToCache(a.baseTexture,s),H.addToCache(a,s),s!==e&&(J.addToCache(a.baseTexture,e),H.addToCache(a,e)),a.baseTexture.valid?Promise.resolve(a):new Promise(h=>{a.baseTexture.once("loaded",()=>h(a))})}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),ae[e]&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),ae[e]=t)}static removeFromCache(t){if(typeof t=="string"){const e=ae[t];if(e){const s=e.textureCacheIds.indexOf(t);return s>-1&&e.textureCacheIds.splice(s,1),delete ae[t],e}}else if(t!=null&&t.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)ae[t.textureCacheIds[e]]===t&&delete ae[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:e,y:s,width:n,height:r}=t,o=e+n>this.baseTexture.width,a=s+r>this.baseTexture.height;if(o||a){const h=o&&a?"and":"or",c=`X: ${e} + ${n} = ${e+n} > ${this.baseTexture.width}`,l=`Y: ${s} + ${r} = ${s+r} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${c} ${h} ${l}`)}this.valid=n&&r&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return H._EMPTY||(H._EMPTY=new H(new J),ns(H._EMPTY),ns(H._EMPTY.baseTexture)),H._EMPTY}static get WHITE(){if(!H._WHITE){const t=O.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),H._WHITE=new H(J.from(t)),ns(H._WHITE),ns(H._WHITE.baseTexture)}return H._WHITE}}class be extends H{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,s=!0){const n=this.baseTexture.resolution,r=Math.round(t*n)/n,o=Math.round(e*n)/n;this.valid=r>0&&o>0,this._frame.width=this.orig.width=r,this._frame.height=this.orig.height=o,s&&this.baseTexture.resize(r,o),this.updateUvs()}setResolution(t){const{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new be(new Ca(t))}}class Pa{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,s=wt.NONE){const n=new Ca(Object.assign({width:t,height:e,resolution:1,multisample:s},this.textureOptions));return new be(n)}getOptimalTexture(t,e,s=1,n=wt.NONE){let r;t=Math.ceil(t*s-1e-6),e=Math.ceil(e*s-1e-6),!this.enableFullScreen||t!==this._pixelsWidth||e!==this._pixelsHeight?(t=Cs(t),e=Cs(e),r=((t&65535)<<16|e&65535)>>>0,n>1&&(r+=n*4294967296)):r=n>1?-n:-1,this.texturePool[r]||(this.texturePool[r]=[]);let o=this.texturePool[r].pop();return o||(o=this.createTexture(t,e,n)),o.filterPoolKey=r,o.setResolution(s),o}getFilterTexture(t,e,s){const n=this.getOptimalTexture(t.width,t.height,e||t.resolution,s||wt.NONE);return n.filterFrame=t.filterFrame,n}returnTexture(t){const e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=t!==!1,t)for(const e in this.texturePool){const s=this.texturePool[e];if(s)for(let n=0;n<s.length;n++)s[n].destroy(!0)}this.texturePool={}}setScreenSize(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(const e in this.texturePool){if(!(Number(e)<0))continue;const s=this.texturePool[e];if(s)for(let n=0;n<s.length;n++)s[n].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}Pa.SCREEN_KEY=-1;class Is{constructor(t,e=0,s=!1,n=Z.FLOAT,r,o,a){this.buffer=t,this.size=e,this.normalized=s,this.type=n,this.stride=r,this.start=o,this.instance=a}destroy(){this.buffer=null}static from(t,e,s,n,r){return new Is(t,e,s,n,r)}}let $d=0;class _t{constructor(t,e=!0,s=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=s,this.static=e,this.id=$d++,this.disposeRunner=new zt("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?te.ELEMENT_ARRAY_BUFFER:te.ARRAY_BUFFER}get index(){return this.type===te.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new _t(t)}}const qd={Float32Array,Uint32Array,Int32Array,Uint8Array};function Jd(i,t){let e=0,s=0;const n={};for(let h=0;h<i.length;h++)s+=t[h],e+=i[h].length;const r=new ArrayBuffer(e*4);let o=null,a=0;for(let h=0;h<i.length;h++){const c=t[h],l=i[h],f=ba(l);n[f]||(n[f]=new qd[f](r)),o=n[f];for(let d=0;d<l.length;d++){const u=(d/c|0)*s+a,p=d%c;o[u+p]=l[d]}a+=c}return new Float32Array(r)}const so={5126:4,5123:2,5121:1};let tf=0;const ef={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class Ae{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=tf++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new zt("disposeGeometry"),this.refCount=0}addAttribute(t,e,s=0,n=!1,r,o,a,h=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof _t||(e instanceof Array&&(e=new Float32Array(e)),e=new _t(e));const c=t.split("|");if(c.length>1){for(let f=0;f<c.length;f++)this.addAttribute(c[f],e,s,n,r);return this}let l=this.buffers.indexOf(e);return l===-1&&(this.buffers.push(e),l=this.buffers.length-1),this.attributes[t]=new Is(l,s,n,r,o,a,h),this.instanced=this.instanced||h,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof _t||(t instanceof Array&&(t=new Uint16Array(t)),t=new _t(t)),t.type=te.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const t=[],e=[],s=new _t;let n;for(n in this.attributes){const r=this.attributes[n],o=this.buffers[r.buffer];t.push(o.data),e.push(r.size*so[r.type]/4),r.buffer=0}for(s.data=Jd(t,e),n=0;n<this.buffers.length;n++)this.buffers[n]!==this.indexBuffer&&this.buffers[n].destroy();return this.buffers=[s],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new Ae;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new _t(this.buffers[e].data.slice(0));for(const e in this.attributes){const s=this.attributes[e];t.attributes[e]=new Is(s.buffer,s.size,s.normalized,s.type,s.stride,s.start,s.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=te.ELEMENT_ARRAY_BUFFER),t}static merge(t){const e=new Ae,s=[],n=[],r=[];let o;for(let a=0;a<t.length;a++){o=t[a];for(let h=0;h<o.buffers.length;h++)n[h]=n[h]||0,n[h]+=o.buffers[h].data.length,r[h]=0}for(let a=0;a<o.buffers.length;a++)s[a]=new ef[ba(o.buffers[a].data)](n[a]),e.buffers[a]=new _t(s[a]);for(let a=0;a<t.length;a++){o=t[a];for(let h=0;h<o.buffers.length;h++)s[h].set(o.buffers[h].data,r[h]),r[h]+=o.buffers[h].data.length}if(e.attributes=o.attributes,o.indexBuffer){e.indexBuffer=e.buffers[o.buffers.indexOf(o.indexBuffer)],e.indexBuffer.type=te.ELEMENT_ARRAY_BUFFER;let a=0,h=0,c=0,l=0;for(let f=0;f<o.buffers.length;f++)if(o.buffers[f]!==o.indexBuffer){l=f;break}for(const f in o.attributes){const d=o.attributes[f];(d.buffer|0)===l&&(h+=d.size*so[d.type]/4)}for(let f=0;f<t.length;f++){const d=t[f].indexBuffer.data;for(let u=0;u<d.length;u++)e.indexBuffer.data[u+c]+=a;a+=t[f].buffers[l].data.length/h,c+=d.length}}return e}}class sf extends Ae{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class Ra extends Ae{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new _t(this.vertices),this.uvBuffer=new _t(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let s=0,n=0;return this.uvs[0]=s,this.uvs[1]=n,this.uvs[2]=s+e.width/t.width,this.uvs[3]=n,this.uvs[4]=s+e.width/t.width,this.uvs[5]=n+e.height/t.height,this.uvs[6]=s,this.uvs[7]=n+e.height/t.height,s=e.x,n=e.y,this.vertices[0]=s,this.vertices[1]=n,this.vertices[2]=s+e.width,this.vertices[3]=n,this.vertices[4]=s+e.width,this.vertices[5]=n+e.height,this.vertices[6]=s,this.vertices[7]=n+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}let nf=0;class Xt{constructor(t,e,s){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=nf++,this.static=!!e,this.ubo=!!s,t instanceof _t?(this.buffer=t,this.buffer.type=te.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new _t(new Float32Array(1)),this.buffer.type=te.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,s){if(!this.ubo)this.uniforms[t]=new Xt(e,s);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(t,e,s){return new Xt(t,e,s)}static uboFrom(t,e){return new Xt(t,e!=null?e:!0,!0)}}class rf{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=wt.NONE,this.sourceFrame=new q,this.destinationFrame=new q,this.bindingSourceFrame=new q,this.bindingDestinationFrame=new q,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const rs=[new G,new G,new G,new G],hn=new gt;class Ma{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new Pa,this.statePool=[],this.quad=new sf,this.quadUv=new Ra,this.tempRect=new q,this.activeState={},this.globalUniforms=new Xt({outputFrame:new q,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){var p,m;const s=this.renderer,n=this.defaultFilterStack,r=this.statePool.pop()||new rf,o=this.renderer.renderTexture;let a=e[0].resolution,h=e[0].multisample,c=e[0].padding,l=e[0].autoFit,f=(p=e[0].legacy)!=null?p:!0;for(let g=1;g<e.length;g++){const _=e[g];a=Math.min(a,_.resolution),h=Math.min(h,_.multisample),c=this.useMaxPadding?Math.max(c,_.padding):c+_.padding,l=l&&_.autoFit,f=f||((m=_.legacy)!=null?m:!0)}n.length===1&&(this.defaultFilterStack[0].renderTexture=o.current),n.push(r),r.resolution=a,r.multisample=h,r.legacy=f,r.target=t,r.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),r.sourceFrame.pad(c);const d=this.tempRect.copyFrom(o.sourceFrame);s.projection.transform&&this.transformAABB(hn.copyFrom(s.projection.transform).invert(),d),l?(r.sourceFrame.fit(d),(r.sourceFrame.width<=0||r.sourceFrame.height<=0)&&(r.sourceFrame.width=0,r.sourceFrame.height=0)):r.sourceFrame.intersects(d)||(r.sourceFrame.width=0,r.sourceFrame.height=0),this.roundFrame(r.sourceFrame,o.current?o.current.resolution:s.resolution,o.sourceFrame,o.destinationFrame,s.projection.transform),r.renderTexture=this.getOptimalFilterTexture(r.sourceFrame.width,r.sourceFrame.height,a,h),r.filters=e,r.destinationFrame.width=r.renderTexture.width,r.destinationFrame.height=r.renderTexture.height;const u=this.tempRect;u.x=0,u.y=0,u.width=r.sourceFrame.width,u.height=r.sourceFrame.height,r.renderTexture.filterFrame=r.sourceFrame,r.bindingSourceFrame.copyFrom(o.sourceFrame),r.bindingDestinationFrame.copyFrom(o.destinationFrame),r.transform=s.projection.transform,s.projection.transform=null,o.bind(r.renderTexture,r.sourceFrame,u),s.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,e=t.pop(),s=e.filters;this.activeState=e;const n=this.globalUniforms.uniforms;n.outputFrame=e.sourceFrame,n.resolution=e.resolution;const r=n.inputSize,o=n.inputPixel,a=n.inputClamp;if(r[0]=e.destinationFrame.width,r[1]=e.destinationFrame.height,r[2]=1/r[0],r[3]=1/r[1],o[0]=Math.round(r[0]*e.resolution),o[1]=Math.round(r[1]*e.resolution),o[2]=1/o[0],o[3]=1/o[1],a[0]=.5*o[2],a[1]=.5*o[3],a[2]=e.sourceFrame.width*r[2]-.5*o[2],a[3]=e.sourceFrame.height*r[3]-.5*o[3],e.legacy){const c=n.filterArea;c[0]=e.destinationFrame.width,c[1]=e.destinationFrame.height,c[2]=e.sourceFrame.x,c[3]=e.sourceFrame.y,n.filterClamp=n.inputClamp}this.globalUniforms.update();const h=t[t.length-1];if(this.renderer.framebuffer.blit(),s.length===1)s[0].apply(this,e.renderTexture,h.renderTexture,Me.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let c=e.renderTexture,l=this.getOptimalFilterTexture(c.width,c.height,e.resolution);l.filterFrame=c.filterFrame;let f=0;for(f=0;f<s.length-1;++f){f===1&&e.multisample>1&&(l=this.getOptimalFilterTexture(c.width,c.height,e.resolution),l.filterFrame=c.filterFrame),s[f].apply(this,c,l,Me.CLEAR,e);const d=c;c=l,l=d}s[f].apply(this,c,h.renderTexture,Me.BLEND,e),f>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(c),this.returnFilterTexture(l)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=Me.CLEAR){const{renderTexture:s,state:n}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t!=null&&t.filterFrame){const o=this.tempRect;o.x=0,o.y=0,o.width=t.filterFrame.width,o.height=t.filterFrame.height,s.bind(t,t.filterFrame,o)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?s.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const r=n.stateId&1||this.forceClear;(e===Me.CLEAR||e===Me.BLIT&&r)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,s,n){const r=this.renderer;r.state.set(t.state),this.bindAndClear(s,n),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,r.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),r.geometry.bind(this.quadUv),r.geometry.draw(qt.TRIANGLES)):(r.geometry.bind(this.quad),r.geometry.draw(qt.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){const{sourceFrame:s,destinationFrame:n}=this.activeState,{orig:r}=e._texture,o=t.set(n.width,0,0,n.height,s.x,s.y),a=e.worldTransform.copyTo(gt.TEMP_MATRIX);return a.invert(),o.prepend(a),o.scale(1/r.width,1/r.height),o.translate(e.anchor.x,e.anchor.y),o}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,s=1,n=wt.NONE){return this.texturePool.getOptimalTexture(t,e,s,n)}getFilterTexture(t,e,s){if(typeof t=="number"){const r=t;t=e,e=r}t=t||this.activeState.renderTexture;const n=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,s||wt.NONE);return n.filterFrame=t.filterFrame,n}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){const s=rs[0],n=rs[1],r=rs[2],o=rs[3];s.set(e.left,e.top),n.set(e.left,e.bottom),r.set(e.right,e.top),o.set(e.right,e.bottom),t.apply(s,s),t.apply(n,n),t.apply(r,r),t.apply(o,o);const a=Math.min(s.x,n.x,r.x,o.x),h=Math.min(s.y,n.y,r.y,o.y),c=Math.max(s.x,n.x,r.x,o.x),l=Math.max(s.y,n.y,r.y,o.y);e.x=a,e.y=h,e.width=c-a,e.height=l-h}roundFrame(t,e,s,n,r){if(!(t.width<=0||t.height<=0||s.width<=0||s.height<=0)){if(r){const{a:o,b:a,c:h,d:c}=r;if((Math.abs(a)>1e-4||Math.abs(h)>1e-4)&&(Math.abs(o)>1e-4||Math.abs(c)>1e-4))return}r=r?hn.copyFrom(r):hn.identity(),r.translate(-s.x,-s.y).scale(n.width/s.width,n.height/s.height).translate(n.x,n.y),this.transformAABB(r,t),t.ceil(e),this.transformAABB(r.invert(),t)}}}Ma.extension={type:z.RendererSystem,name:"filter"};Y.add(Ma);class Zs{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}class Ba{constructor(t){this.renderer=t,this.emptyRenderer=new Zs(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){const{boundTextures:s}=this.renderer.texture;for(let n=e-1;n>=0;--n)t[n]=s[n]||null,t[n]&&(t[n]._batchLocation=n)}boundArray(t,e,s,n){const{elements:r,ids:o,count:a}=t;let h=0;for(let c=0;c<a;c++){const l=r[c],f=l._batchLocation;if(f>=0&&f<n&&e[f]===l){o[c]=f;continue}for(;h<n;){const d=e[h];if(d&&d._batchEnabled===s&&d._batchLocation===h){h++;continue}o[c]=h,l._batchLocation=h,e[h]=l;break}}}destroy(){this.renderer=null}}Ba.extension={type:z.RendererSystem,name:"batch"};Y.add(Ba);let no=0;class Da{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=no++,t.isContextLost()&&t.getExtension("WEBGL_lose_context")&&t.getExtension("WEBGL_lose_context").restoreContext()}init(t){var e;if(t.context)this.initFromContext(t.context);else{const s=this.renderer.background.alpha<1,n=(e=t.premultipliedAlpha)!=null?e:!0;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:s,premultipliedAlpha:n,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=no++,this.renderer.runners.contextChange.emit(t);const e=this.renderer.view;e.addEventListener!==void 0&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let s;if(O.PREFER_ENV>=Ve.WEBGL2&&(s=t.getContext("webgl2",e)),s)this.webGLVersion=2;else if(this.webGLVersion=1,s=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!s)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=s,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),loseContext:t.getExtension("WEBGL_lose_context"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault()}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,t.removeEventListener!==void 0&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const e=t.getContextAttributes(),s="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;s&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const n=s||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=n,n||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}Da.extension={type:z.RendererSystem,name:"context"};Y.add(Da);class of{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=wt.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const af=new q;class Fa{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new Xn(10,10),this.msaaSamples=null}contextChange(){const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new q,this.hasMRT=!0,this.writeDepthTexture=!0,this.disposeAll(!0),this.renderer.context.webGLVersion===1){let e=this.renderer.context.extensions.drawBuffers,s=this.renderer.context.extensions.depthTexture;O.PREFER_ENV===Ve.WEBGL_LEGACY&&(e=null,s=null),e?t.drawBuffers=n=>e.drawBuffersWEBGL(n):(this.hasMRT=!1,t.drawBuffers=()=>{}),s||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,s=0){const{gl:n}=this;if(t){const r=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,n.bindFramebuffer(n.FRAMEBUFFER,r.framebuffer)),r.mipLevel!==s&&(t.dirtyId++,t.dirtyFormat++,r.mipLevel=s),r.dirtyId!==t.dirtyId&&(r.dirtyId=t.dirtyId,r.dirtyFormat!==t.dirtyFormat?(r.dirtyFormat=t.dirtyFormat,r.dirtySize=t.dirtySize,this.updateFramebuffer(t,s)):r.dirtySize!==t.dirtySize&&(r.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let o=0;o<t.colorTextures.length;o++){const a=t.colorTextures[o];this.renderer.texture.unbind(a.parentTextureArray||a)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){const o=e.width>>s,a=e.height>>s,h=o/e.width;this.setViewport(e.x*h,e.y*h,o,a)}else{const o=t.width>>s,a=t.height>>s;this.setViewport(0,0,o,a)}}else this.current&&(this.current=null,n.bindFramebuffer(n.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,s,n){const r=this.viewport;t=Math.round(t),e=Math.round(e),s=Math.round(s),n=Math.round(n),(r.width!==s||r.height!==n||r.x!==t||r.y!==e)&&(r.x=t,r.y=e,r.width=s,r.height=n,this.gl.viewport(t,e,s,n))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,s,n,r=Bn.COLOR|Bn.DEPTH){const{gl:o}=this;o.clearColor(t,e,s,n),o.clear(r)}initFramebuffer(t){const{gl:e}=this,s=new of(e.createFramebuffer());return s.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=s,this.managedFramebuffers.push(t),t.disposeRunner.add(this),s}resizeFramebuffer(t){const{gl:e}=this,s=t.glFramebuffers[this.CONTEXT_UID];s.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,s.stencil),s.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,s.multisample,e.DEPTH24_STENCIL8,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height));const n=t.colorTextures;let r=n.length;e.drawBuffers||(r=Math.min(r,1));for(let o=0;o<r;o++){const a=n[o],h=a.parentTextureArray||a;this.renderer.texture.bind(h,0),o===0&&s.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,s.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,s.multisample,h._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){const{gl:s}=this,n=t.glFramebuffers[this.CONTEXT_UID],r=t.colorTextures;let o=r.length;s.drawBuffers||(o=Math.min(o,1)),n.multisample>1&&this.canMultisampleFramebuffer(t)?n.msaaBuffer=n.msaaBuffer||s.createRenderbuffer():n.msaaBuffer&&(s.deleteRenderbuffer(n.msaaBuffer),n.msaaBuffer=null,n.blitFramebuffer&&(n.blitFramebuffer.dispose(),n.blitFramebuffer=null));const a=[];for(let h=0;h<o;h++){const c=r[h],l=c.parentTextureArray||c;this.renderer.texture.bind(l,0),h===0&&n.msaaBuffer?(s.bindRenderbuffer(s.RENDERBUFFER,n.msaaBuffer),s.renderbufferStorageMultisample(s.RENDERBUFFER,n.multisample,l._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.RENDERBUFFER,n.msaaBuffer)):(s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+h,c.target,l._glTextures[this.CONTEXT_UID].texture,e),a.push(s.COLOR_ATTACHMENT0+h))}if(a.length>1&&s.drawBuffers(a),t.depthTexture&&this.writeDepthTexture){const c=t.depthTexture;this.renderer.texture.bind(c,0),s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.TEXTURE_2D,c._glTextures[this.CONTEXT_UID].texture,e)}(t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)?(n.stencil=n.stencil||s.createRenderbuffer(),s.bindRenderbuffer(s.RENDERBUFFER,n.stencil),n.msaaBuffer?s.renderbufferStorageMultisample(s.RENDERBUFFER,n.multisample,s.DEPTH24_STENCIL8,t.width,t.height):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,t.width,t.height),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,n.stencil)):n.stencil&&(s.deleteRenderbuffer(n.stencil),n.stencil=null)}canMultisampleFramebuffer(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:e}=this;let s=wt.NONE;if(t<=1||e===null)return s;for(let n=0;n<e.length;n++)if(e[n]<=t){s=e[n];break}return s===1&&(s=wt.NONE),s}blit(t,e,s){const{current:n,renderer:r,gl:o,CONTEXT_UID:a}=this;if(r.context.webGLVersion!==2||!n)return;const h=n.glFramebuffers[a];if(!h)return;if(!t){if(!h.msaaBuffer)return;const l=n.colorTextures[0];if(!l)return;h.blitFramebuffer||(h.blitFramebuffer=new Xn(n.width,n.height),h.blitFramebuffer.addColorTexture(0,l)),t=h.blitFramebuffer,t.colorTextures[0]!==l&&(t.colorTextures[0]=l,t.dirtyId++,t.dirtyFormat++),(t.width!==n.width||t.height!==n.height)&&(t.width=n.width,t.height=n.height,t.dirtyId++,t.dirtySize++)}e||(e=af,e.width=n.width,e.height=n.height),s||(s=e);const c=e.width===s.width&&e.height===s.height;this.bind(t),o.bindFramebuffer(o.READ_FRAMEBUFFER,h.framebuffer),o.blitFramebuffer(e.left,e.top,e.right,e.bottom,s.left,s.top,s.right,s.bottom,o.COLOR_BUFFER_BIT,c?o.NEAREST:o.LINEAR)}disposeFramebuffer(t,e){const s=t.glFramebuffers[this.CONTEXT_UID],n=this.gl;if(!s)return;delete t.glFramebuffers[this.CONTEXT_UID];const r=this.managedFramebuffers.indexOf(t);r>=0&&this.managedFramebuffers.splice(r,1),t.disposeRunner.remove(this),e||(n.deleteFramebuffer(s.framebuffer),s.msaaBuffer&&n.deleteRenderbuffer(s.msaaBuffer),s.stencil&&n.deleteRenderbuffer(s.stencil)),s.blitFramebuffer&&s.blitFramebuffer.dispose()}disposeAll(t){const e=this.managedFramebuffers;this.managedFramebuffers=[];for(let s=0;s<e.length;s++)this.disposeFramebuffer(e[s],t)}forceStencil(){const t=this.current;if(!t)return;const e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil)return;t.stencil=!0;const s=t.width,n=t.height,r=this.gl,o=r.createRenderbuffer();r.bindRenderbuffer(r.RENDERBUFFER,o),e.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,e.multisample,r.DEPTH24_STENCIL8,s,n):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,s,n),e.stencil=o,r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,o)}reset(){this.current=this.unknownFramebuffer,this.viewport=new q}destroy(){this.renderer=null}}Fa.extension={type:z.RendererSystem,name:"framebuffer"};Y.add(Fa);const ln={5126:4,5123:2,5121:1};class La{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,e.webGLVersion!==2){let s=this.renderer.context.extensions.vertexArrayObject;O.PREFER_ENV===Ve.WEBGL_LEGACY&&(s=null),s?(t.createVertexArray=()=>s.createVertexArrayOES(),t.bindVertexArray=n=>s.bindVertexArrayOES(n),t.deleteVertexArray=n=>s.deleteVertexArrayOES(n)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(e.webGLVersion!==2){const s=t.getExtension("ANGLE_instanced_arrays");s?(t.vertexAttribDivisor=(n,r)=>s.vertexAttribDivisorANGLE(n,r),t.drawElementsInstanced=(n,r,o,a,h)=>s.drawElementsInstancedANGLE(n,r,o,a,h),t.drawArraysInstanced=(n,r,o,a)=>s.drawArraysInstancedANGLE(n,r,o,a)):this.hasInstance=!1}this.canUseUInt32ElementIndex=e.webGLVersion===2||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;const{gl:s}=this;let n=t.glVertexArrayObjects[this.CONTEXT_UID],r=!1;n||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=n={},r=!0);const o=n[e.program.id]||this.initGeometryVao(t,e,r);this._activeGeometry=t,this._activeVao!==o&&(this._activeVao=o,this.hasVao?s.bindVertexArray(o):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let s=0;s<t.buffers.length;s++){const n=t.buffers[s];e.update(n)}}checkCompatibility(t,e){const s=t.attributes,n=e.attributeData;for(const r in n)if(!s[r])throw new Error(`shader and geometry incompatible, geometry missing the "${r}" attribute`)}getSignature(t,e){const s=t.attributes,n=e.attributeData,r=["g",t.id];for(const o in s)n[o]&&r.push(o,n[o].location);return r.join("-")}initGeometryVao(t,e,s=!0){const n=this.gl,r=this.CONTEXT_UID,o=this.renderer.buffer,a=e.program;a.glPrograms[r]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,a);const h=this.getSignature(t,a),c=t.glVertexArrayObjects[this.CONTEXT_UID];let l=c[h];if(l)return c[a.id]=l,l;const f=t.buffers,d=t.attributes,u={},p={};for(const m in f)u[m]=0,p[m]=0;for(const m in d)!d[m].size&&a.attributeData[m]?d[m].size=a.attributeData[m].size:d[m].size||console.warn(`PIXI Geometry attribute '${m}' size cannot be determined (likely the bound shader does not have the attribute)`),u[d[m].buffer]+=d[m].size*ln[d[m].type];for(const m in d){const g=d[m],_=g.size;g.stride===void 0&&(u[g.buffer]===_*ln[g.type]?g.stride=0:g.stride=u[g.buffer]),g.start===void 0&&(g.start=p[g.buffer],p[g.buffer]+=_*ln[g.type])}l=n.createVertexArray(),n.bindVertexArray(l);for(let m=0;m<f.length;m++){const g=f[m];o.bind(g),s&&g._glBuffers[r].refCount++}return this.activateVao(t,a),c[a.id]=l,c[h]=l,n.bindVertexArray(null),o.unbind(te.ARRAY_BUFFER),l}disposeGeometry(t,e){var a;if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const s=t.glVertexArrayObjects[this.CONTEXT_UID],n=this.gl,r=t.buffers,o=(a=this.renderer)==null?void 0:a.buffer;if(t.disposeRunner.remove(this),!!s){if(o)for(let h=0;h<r.length;h++){const c=r[h]._glBuffers[this.CONTEXT_UID];c&&(c.refCount--,c.refCount===0&&!e&&o.dispose(r[h],e))}if(!e){for(const h in s)if(h[0]==="g"){const c=s[h];this._activeVao===c&&this.unbind(),n.deleteVertexArray(c)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const e=Object.keys(this.managedGeometries);for(let s=0;s<e.length;s++)this.disposeGeometry(this.managedGeometries[e[s]],t)}activateVao(t,e){const s=this.gl,n=this.CONTEXT_UID,r=this.renderer.buffer,o=t.buffers,a=t.attributes;t.indexBuffer&&r.bind(t.indexBuffer);let h=null;for(const c in a){const l=a[c],f=o[l.buffer],d=f._glBuffers[n];if(e.attributeData[c]){h!==d&&(r.bind(f),h=d);const u=e.attributeData[c].location;if(s.enableVertexAttribArray(u),s.vertexAttribPointer(u,l.size,l.type||s.FLOAT,l.normalized,l.stride,l.start),l.instance)if(this.hasInstance)s.vertexAttribDivisor(u,1);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(t,e,s,n){const{gl:r}=this,o=this._activeGeometry;if(o.indexBuffer){const a=o.indexBuffer.data.BYTES_PER_ELEMENT,h=a===2?r.UNSIGNED_SHORT:r.UNSIGNED_INT;a===2||a===4&&this.canUseUInt32ElementIndex?o.instanced?r.drawElementsInstanced(t,e||o.indexBuffer.data.length,h,(s||0)*a,n||1):r.drawElements(t,e||o.indexBuffer.data.length,h,(s||0)*a):console.warn("unsupported index buffer type: uint32")}else o.instanced?r.drawArraysInstanced(t,s,e||o.getSize(),n||1):r.drawArrays(t,s,e||o.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}La.extension={type:z.RendererSystem,name:"geometry"};Y.add(La);class hf{constructor(t=null){this.type=bt.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=O.FILTER_MULTISAMPLE,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=bt.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}function ro(i,t,e){const s=i.createShader(t);return i.shaderSource(s,e),i.compileShader(s),s}function oo(i,t){const e=i.getShaderSource(t).split(`
`).map((c,l)=>`${l}: ${c}`),s=i.getShaderInfoLog(t),n=s.split(`
`),r={},o=n.map(c=>parseFloat(c.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(c=>c&&!r[c]?(r[c]=!0,!0):!1),a=[""];o.forEach(c=>{e[c-1]=`%c${e[c-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const h=e.join(`
`);a[0]=h,console.error(s),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}function lf(i,t,e,s){i.getProgramParameter(t,i.LINK_STATUS)||(i.getShaderParameter(e,i.COMPILE_STATUS)||oo(i,e),i.getShaderParameter(s,i.COMPILE_STATUS)||oo(i,s),console.error("PixiJS Error: Could not initialize shader."),i.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",i.getProgramInfoLog(t)))}function cn(i){const t=new Array(i);for(let e=0;e<t.length;e++)t[e]=!1;return t}function ka(i,t){switch(i){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return cn(2*t);case"bvec3":return cn(3*t);case"bvec4":return cn(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const Oa={};let je=Oa;function cf(){if(je===Oa||(je==null?void 0:je.isContextLost())){const i=O.ADAPTER.createCanvas();let t;O.PREFER_ENV>=Ve.WEBGL2&&(t=i.getContext("webgl2",{})),t||(t=i.getContext("webgl",{})||i.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),je=t}return je}let os;function uf(){if(!os){os=Ft.MEDIUM;const i=cf();i&&i.getShaderPrecisionFormat&&(os=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT).precision?Ft.HIGH:Ft.MEDIUM)}return os}function ao(i,t,e){if(i.substring(0,9)!=="precision"){let s=t;return t===Ft.HIGH&&e!==Ft.HIGH&&(s=Ft.MEDIUM),`precision ${s} float;
${i}`}else if(e!==Ft.HIGH&&i.substring(0,15)==="precision highp")return i.replace("precision highp","precision mediump");return i}const df={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Ua(i){return df[i]}let as=null;const ho={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function Na(i,t){if(!as){const e=Object.keys(ho);as={};for(let s=0;s<e.length;++s){const n=e[s];as[i[n]]=ho[n]}}return as[t]}const ci=[{test:i=>i.type==="float"&&i.size===1&&!i.isArray,code:i=>`
            if(uv["${i}"] !== ud["${i}"].value)
            {
                ud["${i}"].value = uv["${i}"]
                gl.uniform1f(ud["${i}"].location, uv["${i}"])
            }
            `},{test:(i,t)=>(i.type==="sampler2D"||i.type==="samplerCube"||i.type==="sampler2DArray")&&i.size===1&&!i.isArray&&(t==null||t.castToBaseTexture!==void 0),code:i=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${i}"], t);

            if(ud["${i}"].value !== t)
            {
                ud["${i}"].value = t;
                gl.uniform1i(ud["${i}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(i,t)=>i.type==="mat3"&&i.size===1&&!i.isArray&&t.a!==void 0,code:i=>`
            gl.uniformMatrix3fv(ud["${i}"].location, false, uv["${i}"].toArray(true));
            `,codeUbo:i=>`
                var ${i}_matrix = uv.${i}.toArray(true);

                data[offset] = ${i}_matrix[0];
                data[offset+1] = ${i}_matrix[1];
                data[offset+2] = ${i}_matrix[2];
        
                data[offset + 4] = ${i}_matrix[3];
                data[offset + 5] = ${i}_matrix[4];
                data[offset + 6] = ${i}_matrix[5];
        
                data[offset + 8] = ${i}_matrix[6];
                data[offset + 9] = ${i}_matrix[7];
                data[offset + 10] = ${i}_matrix[8];
            `},{test:(i,t)=>i.type==="vec2"&&i.size===1&&!i.isArray&&t.x!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${i}"].location, v.x, v.y);
                }`,codeUbo:i=>`
                v = uv.${i};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:i=>i.type==="vec2"&&i.size===1&&!i.isArray,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${i}"].location, v[0], v[1]);
                }
            `},{test:(i,t)=>i.type==="vec4"&&i.size===1&&!i.isArray&&t.width!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${i}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:i=>i.type==="vec4"&&i.size===1&&!i.isArray,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${i}"].location, v[0], v[1], v[2], v[3])
                }`}],ff={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},pf={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function mf(i,t){var s;const e=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const n in i.uniforms){const r=t[n];if(!r){(s=i.uniforms[n])!=null&&s.group&&(i.uniforms[n].ubo?e.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${n}, '${n}');
                    `):e.push(`
                        renderer.shader.syncUniformGroup(uv.${n}, syncData);
                    `));continue}const o=i.uniforms[n];let a=!1;for(let h=0;h<ci.length;h++)if(ci[h].test(r,o)){e.push(ci[h].code(n,o)),a=!0;break}if(!a){const c=(r.size===1&&!r.isArray?ff:pf)[r.type].replace("location",`ud["${n}"].location`);e.push(`
            cu = ud["${n}"];
            cv = cu.value;
            v = uv["${n}"];
            ${c};`)}}return new Function("ud","uv","renderer","syncData",e.join(`
`))}const gf=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function vf(i){let t="";for(let e=0;e<i;++e)e>0&&(t+=`
else `),e<i-1&&(t+=`if(test == ${e}.0){}`);return t}function _f(i,t){if(i===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const e=t.createShader(t.FRAGMENT_SHADER);for(;;){const s=gf.replace(/%forloop%/gi,vf(i));if(t.shaderSource(e,s),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))i=i/2|0;else break}return i}let pi;function yf(){if(typeof pi=="boolean")return pi;try{pi=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{pi=!1}return pi}var xf=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,wf=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;let bf=0;const hs={};class de{constructor(t,e,s="pixi-shader",n={}){this.extra={},this.id=bf++,this.vertexSrc=t||de.defaultVertexSrc,this.fragmentSrc=e||de.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=n,this.vertexSrc.substring(0,8)!=="#version"&&(s=s.replace(/\s+/g,"-"),hs[s]?(hs[s]++,s+=`-${hs[s]}`):hs[s]=1,this.vertexSrc=`#define SHADER_NAME ${s}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${s}
${this.fragmentSrc}`,this.vertexSrc=ao(this.vertexSrc,O.PRECISION_VERTEX,Ft.HIGH),this.fragmentSrc=ao(this.fragmentSrc,O.PRECISION_FRAGMENT,uf())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return wf}static get defaultFragmentSrc(){return xf}static from(t,e,s){const n=t+e;let r=to[n];return r||(to[n]=r=new de(t,e,s)),r}}class ee{constructor(t,e){this.uniformBindCount=0,this.program=t,e?e instanceof Xt?this.uniformGroup=e:this.uniformGroup=new Xt(e):this.uniformGroup=new Xt({}),this.disposeRunner=new zt("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(const s in e.uniforms){const n=e.uniforms[s];if(n.group&&this.checkUniformExists(t,n))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,s){const n=de.from(t,e);return new ee(n,s)}}const un=0,dn=1,fn=2,pn=3,mn=4,gn=5;class pe{constructor(){this.data=0,this.blendMode=$.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<un)}set blend(t){!!(this.data&1<<un)!==t&&(this.data^=1<<un)}get offsets(){return!!(this.data&1<<dn)}set offsets(t){!!(this.data&1<<dn)!==t&&(this.data^=1<<dn)}get culling(){return!!(this.data&1<<fn)}set culling(t){!!(this.data&1<<fn)!==t&&(this.data^=1<<fn)}get depthTest(){return!!(this.data&1<<pn)}set depthTest(t){!!(this.data&1<<pn)!==t&&(this.data^=1<<pn)}get depthMask(){return!!(this.data&1<<gn)}set depthMask(t){!!(this.data&1<<gn)!==t&&(this.data^=1<<gn)}get clockwiseFrontFace(){return!!(this.data&1<<mn)}set clockwiseFrontFace(t){!!(this.data&1<<mn)!==t&&(this.data^=1<<mn)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==$.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}static for2d(){const t=new pe;return t.depthTest=!1,t.blend=!0,t}}var Af=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,Ef=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;class Gi extends ee{constructor(t,e,s){const n=de.from(t||Gi.defaultVertexSrc,e||Gi.defaultFragmentSrc);super(n,s),this.padding=0,this.resolution=O.FILTER_RESOLUTION,this.multisample=O.FILTER_MULTISAMPLE,this.enabled=!0,this.autoFit=!0,this.state=new pe}apply(t,e,s,n,r){t.applyFilter(this,e,s,n)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return Ef}static get defaultFragmentSrc(){return Af}}var Tf=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`,Sf=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`;const lo=new gt;class Ar{constructor(t,e){this._texture=t,this.mapCoord=new gt,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof e>"u"?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){e===void 0&&(e=t);const s=this.mapCoord;for(let n=0;n<t.length;n+=2){const r=t[n],o=t[n+1];e[n]=r*s.a+o*s.c+s.tx,e[n+1]=r*s.b+o*s.d+s.ty}return e}update(t){const e=this._texture;if(!e||!e.valid||!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;const s=e._uvs;this.mapCoord.set(s.x1-s.x0,s.y1-s.y0,s.x3-s.x0,s.y3-s.y0,s.x0,s.y0);const n=e.orig,r=e.trim;r&&(lo.set(n.width/r.width,0,0,n.height/r.height,-r.x/r.width,-r.y/r.height),this.mapCoord.append(lo));const o=e.baseTexture,a=this.uClampFrame,h=this.clampMargin/o.resolution,c=this.clampOffset;return a[0]=(e._frame.x+h+c)/o.width,a[1]=(e._frame.y+h+c)/o.height,a[2]=(e._frame.x+e._frame.width-h+c)/o.width,a[3]=(e._frame.y+e._frame.height-h+c)/o.height,this.uClampOffset[0]=c/o.realWidth,this.uClampOffset[1]=c/o.realHeight,this.isSimple=e._frame.width===o.width&&e._frame.height===o.height&&e.rotate===0,!0}}class Cf extends Gi{constructor(t,e,s){let n=null;typeof t!="string"&&e===void 0&&s===void 0&&(n=t,t=void 0,e=void 0,s=void 0),super(t||Tf,e||Sf,s),this.maskSprite=n,this.maskMatrix=new gt}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,s,n){const r=this._maskSprite,o=r._texture;!o.valid||(o.uvMatrix||(o.uvMatrix=new Ar(o,0)),o.uvMatrix.update(),this.uniforms.npmAlpha=o.baseTexture.alphaMode?0:1,this.uniforms.mask=o,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,r).prepend(o.uvMatrix.mapCoord),this.uniforms.alpha=r.worldAlpha,this.uniforms.maskClamp=o.uvMatrix.uClampFrame,t.applyFilter(this,e,s,n))}}class Ga{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let s=e;if(!s.isMaskData){const r=this.maskDataPool.pop()||new hf;r.pooled=!0,r.maskObject=e,s=r}const n=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(s.copyCountersOrReset(n),s._colorMask=n?n._colorMask:15,s.autoDetect&&this.detect(s),s._target=t,s.type!==bt.SPRITE&&this.maskStack.push(s),s.enabled)switch(s.type){case bt.SCISSOR:this.renderer.scissor.push(s);break;case bt.STENCIL:this.renderer.stencil.push(s);break;case bt.SPRITE:s.copyCountersOrReset(null),this.pushSpriteMask(s);break;case bt.COLOR:this.pushColorMask(s);break}s.type===bt.SPRITE&&this.maskStack.push(s)}pop(t){const e=this.maskStack.pop();if(!(!e||e._target!==t)){if(e.enabled)switch(e.type){case bt.SCISSOR:this.renderer.scissor.pop(e);break;case bt.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case bt.SPRITE:this.popSpriteMask(e);break;case bt.COLOR:this.popColorMask(e);break}if(e.reset(),e.pooled&&this.maskDataPool.push(e),this.maskStack.length!==0){const s=this.maskStack[this.maskStack.length-1];s.type===bt.SPRITE&&s._filters&&(s._filters[0].maskSprite=s.maskObject)}}}detect(t){const e=t.maskObject;e?e.isSprite?t.type=bt.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=bt.SCISSOR:t.type=bt.STENCIL:t.type=bt.COLOR}pushSpriteMask(t){var l,f;const{maskObject:e}=t,s=t._target;let n=t._filters;n||(n=this.alphaMaskPool[this.alphaMaskIndex],n||(n=this.alphaMaskPool[this.alphaMaskIndex]=[new Cf]));const r=this.renderer,o=r.renderTexture;let a,h;if(o.current){const d=o.current;a=t.resolution||d.resolution,h=(l=t.multisample)!=null?l:d.multisample}else a=t.resolution||r.resolution,h=(f=t.multisample)!=null?f:r.multisample;n[0].resolution=a,n[0].multisample=h,n[0].maskSprite=e;const c=s.filterArea;s.filterArea=e.getBounds(!0),r.filter.push(s,n),s.filterArea=c,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const e=t._colorMask,s=t._colorMask=e&t.colorMask;s!==e&&this.renderer.gl.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)}popColorMask(t){const e=t._colorMask,s=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;s!==e&&this.renderer.gl.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)}destroy(){this.renderer=null}}Ga.extension={type:z.RendererSystem,name:"mask"};Y.add(Ga);class Ha{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:e}=this.renderer,s=this.getStackLength();this.maskStack=t;const n=this.getStackLength();n!==s&&(n===0?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const co=new gt,uo=[],xs=class extends Ha{constructor(i){super(i),this.glConst=O.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const i=this.maskStack[this.maskStack.length-1];return i?i._scissorCounter:0}calcScissorRect(i){var o;if(i._scissorRectLocal)return;const t=i._scissorRect,{maskObject:e}=i,{renderer:s}=this,n=s.renderTexture,r=e.getBounds(!0,(o=uo.pop())!=null?o:new q);this.roundFrameToPixels(r,n.current?n.current.resolution:s.resolution,n.sourceFrame,n.destinationFrame,s.projection.transform),t&&r.fit(t),i._scissorRectLocal=r}static isMatrixRotated(i){if(!i)return!1;const{a:t,b:e,c:s,d:n}=i;return(Math.abs(e)>1e-4||Math.abs(s)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(n)>1e-4)}testScissor(i){const{maskObject:t}=i;if(!t.isFastRect||!t.isFastRect()||xs.isMatrixRotated(t.worldTransform)||xs.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(i);const e=i._scissorRectLocal;return e.width>0&&e.height>0}roundFrameToPixels(i,t,e,s,n){xs.isMatrixRotated(n)||(n=n?co.copyFrom(n):co.identity(),n.translate(-e.x,-e.y).scale(s.width/e.width,s.height/e.height).translate(s.x,s.y),this.renderer.filter.transformAABB(n,i),i.fit(s),i.x=Math.round(i.x*t),i.y=Math.round(i.y*t),i.width=Math.round(i.width*t),i.height=Math.round(i.height*t))}push(i){i._scissorRectLocal||this.calcScissorRect(i);const{gl:t}=this.renderer;i._scissorRect||t.enable(t.SCISSOR_TEST),i._scissorCounter++,i._scissorRect=i._scissorRectLocal,this._useCurrent()}pop(i){const{gl:t}=this.renderer;i&&uo.push(i._scissorRectLocal),this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)}_useCurrent(){const i=this.maskStack[this.maskStack.length-1]._scissorRect;let t;this.renderer.renderTexture.current?t=i.y:t=this.renderer.height-i.height-i.y,this.renderer.gl.scissor(i.x,t,i.width,i.height)}};let za=xs;za.extension={type:z.RendererSystem,name:"scissor"};Y.add(za);class Va extends Ha{constructor(t){super(t),this.glConst=O.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const e=t.maskObject,{gl:s}=this.renderer,n=t._stencilCounter;n===0&&(this.renderer.framebuffer.forceStencil(),s.clearStencil(0),s.clear(s.STENCIL_BUFFER_BIT),s.enable(s.STENCIL_TEST)),t._stencilCounter++;const r=t._colorMask;r!==0&&(t._colorMask=0,s.colorMask(!1,!1,!1,!1)),s.stencilFunc(s.EQUAL,n,4294967295),s.stencilOp(s.KEEP,s.KEEP,s.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,r!==0&&(t._colorMask=r,s.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)),this._useCurrent()}pop(t){const e=this.renderer.gl;if(this.getStackLength()===0)e.disable(e.STENCIL_TEST);else{const s=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,n=s?s._colorMask:15;n!==0&&(s._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,n!==0&&(s._colorMask=n,e.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}Va.extension={type:z.RendererSystem,name:"stencil"};Y.add(Va);class Xa{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new gt,this.transform=null}update(t,e,s,n){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,s,n),this.transform&&this.projectionMatrix.append(this.transform);const r=this.renderer;r.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,r.globalUniforms.update(),r.shader.shader&&r.shader.syncUniformGroup(r.shader.shader.uniforms.globals)}calculateProjection(t,e,s,n){const r=this.projectionMatrix,o=n?-1:1;r.identity(),r.a=1/e.width*2,r.d=o*(1/e.height*2),r.tx=-1-e.x*r.a,r.ty=-o-e.y*r.d}setTransform(t){}destroy(){this.renderer=null}}Xa.extension={type:z.RendererSystem,name:"projection"};Y.add(Xa);const Pe=new q,mi=new q;class Wa{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new q,this.destinationFrame=new q,this.viewportFrame=new q}bind(t=null,e,s){const n=this.renderer;this.current=t;let r,o,a;t?(r=t.baseTexture,a=r.resolution,e||(Pe.width=t.frame.width,Pe.height=t.frame.height,e=Pe),s||(mi.x=t.frame.x,mi.y=t.frame.y,mi.width=e.width,mi.height=e.height,s=mi),o=r.framebuffer):(a=n.resolution,e||(Pe.width=n._view.screen.width,Pe.height=n._view.screen.height,e=Pe),s||(s=Pe,s.width=e.width,s.height=e.height));const h=this.viewportFrame;h.x=s.x*a,h.y=s.y*a,h.width=s.width*a,h.height=s.height*a,t||(h.y=n.view.height-(h.y+h.height)),h.ceil(),this.renderer.framebuffer.bind(o,h),this.renderer.projection.update(s,e,a,!o),t?this.renderer.mask.setMaskStack(r.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(s)}clear(t,e){this.current?t=t||this.current.baseTexture.clearColor:t=t||this.renderer.background.colorRgba;const s=this.destinationFrame,n=this.current?this.current.baseTexture:this.renderer._view.screen,r=s.width!==n.width||s.height!==n.height;if(r){let{x:o,y:a,width:h,height:c}=this.viewportFrame;o=Math.round(o),a=Math.round(a),h=Math.round(h),c=Math.round(c),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(o,a,h,c)}this.renderer.framebuffer.clear(t[0],t[1],t[2],t[3],e),r&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}Wa.extension={type:z.RendererSystem,name:"renderTexture"};Y.add(Wa);function If(i,t,e,s,n){e.buffer.update(n)}const Pf={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},ja={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function Rf(i){const t=i.map(r=>({data:r,offset:0,dataLen:0,dirty:0}));let e=0,s=0,n=0;for(let r=0;r<t.length;r++){const o=t[r];if(e=ja[o.data.type],o.data.size>1&&(e=Math.max(e,16)*o.data.size),o.dataLen=e,s%e!==0&&s<16){const a=s%e%16;s+=a,n+=a}s+e>16?(n=Math.ceil(n/16)*16,o.offset=n,n+=e,s=e):(o.offset=n,s+=e,n+=e)}return n=Math.ceil(n/16)*16,{uboElements:t,size:n}}function Mf(i,t){const e=[];for(const s in i)t[s]&&e.push(t[s]);return e.sort((s,n)=>s.index-n.index),e}function Bf(i,t){if(!i.autoManage)return{size:0,syncFunc:If};const e=Mf(i.uniforms,t),{uboElements:s,size:n}=Rf(e),r=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let o=0;o<s.length;o++){const a=s[o],h=i.uniforms[a.data.name],c=a.data.name;let l=!1;for(let f=0;f<ci.length;f++){const d=ci[f];if(d.codeUbo&&d.test(a.data,h)){r.push(`offset = ${a.offset/4};`,ci[f].codeUbo(a.data.name,h)),l=!0;break}}if(!l)if(a.data.size>1){const f=Ua(a.data.type),d=Math.max(ja[a.data.type]/16,1),u=f/d,p=(4-u%4)%4;r.push(`
                cv = ud.${c}.value;
                v = uv.${c};
                offset = ${a.offset/4};

                t = 0;

                for(var i=0; i < ${a.data.size*d}; i++)
                {
                    for(var j = 0; j < ${u}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${p};
                }

                `)}else{const f=Pf[a.data.type];r.push(`
                cv = ud.${c}.value;
                v = uv.${c};
                offset = ${a.offset/4};
                ${f};
                `)}}return r.push(`
       renderer.buffer.update(buffer);
    `),{size:n,syncFunc:new Function("ud","uv","renderer","syncData","buffer",r.join(`
`))}}class Df{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function Ff(i,t){const e={},s=t.getProgramParameter(i,t.ACTIVE_ATTRIBUTES);for(let n=0;n<s;n++){const r=t.getActiveAttrib(i,n);if(r.name.startsWith("gl_"))continue;const o=Na(t,r.type),a={type:o,name:r.name,size:Ua(o),location:t.getAttribLocation(i,r.name)};e[r.name]=a}return e}function Lf(i,t){const e={},s=t.getProgramParameter(i,t.ACTIVE_UNIFORMS);for(let n=0;n<s;n++){const r=t.getActiveUniform(i,n),o=r.name.replace(/\[.*?\]$/,""),a=!!r.name.match(/\[.*?\]$/),h=Na(t,r.type);e[o]={name:o,index:n,type:h,size:r.size,isArray:a,value:ka(h,r.size)}}return e}function kf(i,t){var h;const e=ro(i,i.VERTEX_SHADER,t.vertexSrc),s=ro(i,i.FRAGMENT_SHADER,t.fragmentSrc),n=i.createProgram();i.attachShader(n,e),i.attachShader(n,s);const r=(h=t.extra)==null?void 0:h.transformFeedbackVaryings;if(r&&(typeof i.transformFeedbackVaryings!="function"||i.transformFeedbackVaryings(n,r.names,r.bufferMode==="separate"?i.SEPARATE_ATTRIBS:i.INTERLEAVED_ATTRIBS)),i.linkProgram(n),i.getProgramParameter(n,i.LINK_STATUS)||lf(i,n,e,s),t.attributeData=Ff(n,i),t.uniformData=Lf(n,i),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){const c=Object.keys(t.attributeData);c.sort((l,f)=>l>f?1:-1);for(let l=0;l<c.length;l++)t.attributeData[c[l]].location=l,i.bindAttribLocation(n,l,c[l]);i.linkProgram(n)}i.deleteShader(e),i.deleteShader(s);const o={};for(const c in t.uniformData){const l=t.uniformData[c];o[c]={location:i.getUniformLocation(n,c),value:ka(l.type,l.size)}}return new Df(n,o)}let Of=0;const ls={textureCount:0,uboCount:0};class Ya{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=Of++}systemCheck(){if(!yf())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const s=t.program,n=s.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==s&&(this.program=s,this.gl.useProgram(n.program)),e||(ls.textureCount=0,ls.uboCount=0,this.syncUniformGroup(t.uniformGroup,ls)),n}setUniforms(t){const e=this.shader.program,s=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(s.uniformData,t,this.renderer)}syncUniformGroup(t,e){const s=this.getGlProgram();(!t.static||t.dirtyId!==s.uniformDirtyGroups[t.id])&&(s.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,s,e))}syncUniforms(t,e,s){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,s)}createSyncGroups(t){const e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=mf(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){const s=this.getGlProgram();if(!t.static||t.dirtyId!==0||!s.uniformGroups[t.id]){t.dirtyId=0;const n=s.uniformGroups[t.id]||this.createSyncBufferGroup(t,s,e);t.buffer.update(),n(s.uniformData,t.uniforms,this.renderer,ls,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,s.uniformBufferBindings[e])}createSyncBufferGroup(t,e,s){const{gl:n}=this.renderer;this.renderer.buffer.bind(t.buffer);const r=this.gl.getUniformBlockIndex(e.program,s);e.uniformBufferBindings[s]=this.shader.uniformBindCount,n.uniformBlockBinding(e.program,r,this.shader.uniformBindCount),this.shader.uniformBindCount++;const o=this.getSignature(t,this.shader.program.uniformData,"ubo");let a=this._uboCache[o];if(a||(a=this._uboCache[o]=Bf(t,this.shader.program.uniformData)),t.autoManage){const h=new Float32Array(a.size/4);t.buffer.update(h)}return e.uniformGroups[t.id]=a.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,s){const n=t.uniforms,r=[`${s}-`];for(const o in n)r.push(o),e[o]&&r.push(e[o].type);return r.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const e=this.gl,s=t.program,n=kf(e,s);return s.glPrograms[this.renderer.CONTEXT_UID]=n,n}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}Ya.extension={type:z.RendererSystem,name:"shader"};Y.add(Ya);function Uf(i,t=[]){return t[$.NORMAL]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[$.ADD]=[i.ONE,i.ONE],t[$.MULTIPLY]=[i.DST_COLOR,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[$.SCREEN]=[i.ONE,i.ONE_MINUS_SRC_COLOR,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[$.OVERLAY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[$.DARKEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[$.LIGHTEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[$.COLOR_DODGE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[$.COLOR_BURN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[$.HARD_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[$.SOFT_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[$.DIFFERENCE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[$.EXCLUSION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[$.HUE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[$.SATURATION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[$.COLOR]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[$.LUMINOSITY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[$.NONE]=[0,0],t[$.NORMAL_NPM]=[i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[$.ADD_NPM]=[i.SRC_ALPHA,i.ONE,i.ONE,i.ONE],t[$.SCREEN_NPM]=[i.SRC_ALPHA,i.ONE_MINUS_SRC_COLOR,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[$.SRC_IN]=[i.DST_ALPHA,i.ZERO],t[$.SRC_OUT]=[i.ONE_MINUS_DST_ALPHA,i.ZERO],t[$.SRC_ATOP]=[i.DST_ALPHA,i.ONE_MINUS_SRC_ALPHA],t[$.DST_OVER]=[i.ONE_MINUS_DST_ALPHA,i.ONE],t[$.DST_IN]=[i.ZERO,i.SRC_ALPHA],t[$.DST_OUT]=[i.ZERO,i.ONE_MINUS_SRC_ALPHA],t[$.DST_ATOP]=[i.ONE_MINUS_DST_ALPHA,i.SRC_ALPHA],t[$.XOR]=[i.ONE_MINUS_DST_ALPHA,i.ONE_MINUS_SRC_ALPHA],t[$.SUBTRACT]=[i.ONE,i.ONE,i.ONE,i.ONE,i.FUNC_REVERSE_SUBTRACT,i.FUNC_ADD],t}const Nf=0,Gf=1,Hf=2,zf=3,Vf=4,Xf=5,Wn=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=$.NONE,this._blendEq=!1,this.map=[],this.map[Nf]=this.setBlend,this.map[Gf]=this.setOffset,this.map[Hf]=this.setCullFace,this.map[zf]=this.setDepthTest,this.map[Vf]=this.setFrontFace,this.map[Xf]=this.setDepthMask,this.checks=[],this.defaultState=new pe,this.defaultState.blend=!0}contextChange(i){this.gl=i,this.blendModes=Uf(i),this.set(this.defaultState),this.reset()}set(i){if(i=i||this.defaultState,this.stateId!==i.data){let t=this.stateId^i.data,e=0;for(;t;)t&1&&this.map[e].call(this,!!(i.data&1<<e)),t=t>>1,e++;this.stateId=i.data}for(let t=0;t<this.checks.length;t++)this.checks[t](this,i)}forceState(i){i=i||this.defaultState;for(let t=0;t<this.map.length;t++)this.map[t].call(this,!!(i.data&1<<t));for(let t=0;t<this.checks.length;t++)this.checks[t](this,i);this.stateId=i.data}setBlend(i){this.updateCheck(Wn.checkBlendMode,i),this.gl[i?"enable":"disable"](this.gl.BLEND)}setOffset(i){this.updateCheck(Wn.checkPolygonOffset,i),this.gl[i?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(i){this.gl[i?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(i){this.gl.depthMask(i)}setCullFace(i){this.gl[i?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(i){this.gl.frontFace(this.gl[i?"CW":"CCW"])}setBlendMode(i){if(i===this.blendMode)return;this.blendMode=i;const t=this.blendModes[i],e=this.gl;t.length===2?e.blendFunc(t[0],t[1]):e.blendFuncSeparate(t[0],t[1],t[2],t[3]),t.length===6?(this._blendEq=!0,e.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD))}setPolygonOffset(i,t){this.gl.polygonOffset(i,t)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(i,t){const e=this.checks.indexOf(i);t&&e===-1?this.checks.push(i):!t&&e!==-1&&this.checks.splice(e,1)}static checkBlendMode(i,t){i.setBlendMode(t.blendMode)}static checkPolygonOffset(i,t){i.setPolygonOffset(1,t.polygonOffset)}destroy(){this.gl=null}};let Ka=Wn;Ka.extension={type:z.RendererSystem,name:"state"};Y.add(Ka);class Za{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=O.GC_MAX_IDLE,this.checkCountMax=O.GC_MAX_CHECK_COUNT,this.mode=O.GC_MODE}postrender(){!this.renderer.objectRenderer.renderingToScreen||(this.count++,this.mode!==mr.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this.renderer.texture,e=t.managedTextures;let s=!1;for(let n=0;n<e.length;n++){const r=e[n];!r.framebuffer&&this.count-r.touched>this.maxIdle&&(t.destroyTexture(r,!0),e[n]=null,s=!0)}if(s){let n=0;for(let r=0;r<e.length;r++)e[r]!==null&&(e[n++]=e[r]);e.length=n}}unload(t){const e=this.renderer.texture,s=t._texture;s&&!s.framebuffer&&e.destroyTexture(s);for(let n=t.children.length-1;n>=0;n--)this.unload(t.children[n])}destroy(){this.renderer=null}}Za.extension={type:z.RendererSystem,name:"textureGC"};Y.add(Za);function Wf(i){let t;return"WebGL2RenderingContext"in globalThis&&i instanceof globalThis.WebGL2RenderingContext?t={[Z.UNSIGNED_BYTE]:{[U.RGBA]:i.RGBA8,[U.RGB]:i.RGB8,[U.RG]:i.RG8,[U.RED]:i.R8,[U.RGBA_INTEGER]:i.RGBA8UI,[U.RGB_INTEGER]:i.RGB8UI,[U.RG_INTEGER]:i.RG8UI,[U.RED_INTEGER]:i.R8UI,[U.ALPHA]:i.ALPHA,[U.LUMINANCE]:i.LUMINANCE,[U.LUMINANCE_ALPHA]:i.LUMINANCE_ALPHA},[Z.BYTE]:{[U.RGBA]:i.RGBA8_SNORM,[U.RGB]:i.RGB8_SNORM,[U.RG]:i.RG8_SNORM,[U.RED]:i.R8_SNORM,[U.RGBA_INTEGER]:i.RGBA8I,[U.RGB_INTEGER]:i.RGB8I,[U.RG_INTEGER]:i.RG8I,[U.RED_INTEGER]:i.R8I},[Z.UNSIGNED_SHORT]:{[U.RGBA_INTEGER]:i.RGBA16UI,[U.RGB_INTEGER]:i.RGB16UI,[U.RG_INTEGER]:i.RG16UI,[U.RED_INTEGER]:i.R16UI,[U.DEPTH_COMPONENT]:i.DEPTH_COMPONENT16},[Z.SHORT]:{[U.RGBA_INTEGER]:i.RGBA16I,[U.RGB_INTEGER]:i.RGB16I,[U.RG_INTEGER]:i.RG16I,[U.RED_INTEGER]:i.R16I},[Z.UNSIGNED_INT]:{[U.RGBA_INTEGER]:i.RGBA32UI,[U.RGB_INTEGER]:i.RGB32UI,[U.RG_INTEGER]:i.RG32UI,[U.RED_INTEGER]:i.R32UI,[U.DEPTH_COMPONENT]:i.DEPTH_COMPONENT24},[Z.INT]:{[U.RGBA_INTEGER]:i.RGBA32I,[U.RGB_INTEGER]:i.RGB32I,[U.RG_INTEGER]:i.RG32I,[U.RED_INTEGER]:i.R32I},[Z.FLOAT]:{[U.RGBA]:i.RGBA32F,[U.RGB]:i.RGB32F,[U.RG]:i.RG32F,[U.RED]:i.R32F,[U.DEPTH_COMPONENT]:i.DEPTH_COMPONENT32F},[Z.HALF_FLOAT]:{[U.RGBA]:i.RGBA16F,[U.RGB]:i.RGB16F,[U.RG]:i.RG16F,[U.RED]:i.R16F},[Z.UNSIGNED_SHORT_5_6_5]:{[U.RGB]:i.RGB565},[Z.UNSIGNED_SHORT_4_4_4_4]:{[U.RGBA]:i.RGBA4},[Z.UNSIGNED_SHORT_5_5_5_1]:{[U.RGBA]:i.RGB5_A1},[Z.UNSIGNED_INT_2_10_10_10_REV]:{[U.RGBA]:i.RGB10_A2,[U.RGBA_INTEGER]:i.RGB10_A2UI},[Z.UNSIGNED_INT_10F_11F_11F_REV]:{[U.RGB]:i.R11F_G11F_B10F},[Z.UNSIGNED_INT_5_9_9_9_REV]:{[U.RGB]:i.RGB9_E5},[Z.UNSIGNED_INT_24_8]:{[U.DEPTH_STENCIL]:i.DEPTH24_STENCIL8},[Z.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[U.DEPTH_STENCIL]:i.DEPTH32F_STENCIL8}}:t={[Z.UNSIGNED_BYTE]:{[U.RGBA]:i.RGBA,[U.RGB]:i.RGB,[U.ALPHA]:i.ALPHA,[U.LUMINANCE]:i.LUMINANCE,[U.LUMINANCE_ALPHA]:i.LUMINANCE_ALPHA},[Z.UNSIGNED_SHORT_5_6_5]:{[U.RGB]:i.RGB},[Z.UNSIGNED_SHORT_4_4_4_4]:{[U.RGBA]:i.RGBA},[Z.UNSIGNED_SHORT_5_5_5_1]:{[U.RGBA]:i.RGBA}},t}class vn{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=Z.UNSIGNED_BYTE,this.internalFormat=U.RGBA,this.samplerType=0}}class Qa{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new J,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=Wf(t);const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let n=0;n<e;n++)this.boundTextures[n]=null;this.emptyTextures={};const s=new vn(t.createTexture());t.bindTexture(t.TEXTURE_2D,s.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=s,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new vn(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let n=0;n<6;n++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let n=0;n<this.boundTextures.length;n++)this.bind(null,n)}bind(t,e=0){const{gl:s}=this;if(t=t==null?void 0:t.castToBaseTexture(),(t==null?void 0:t.valid)&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const n=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,s.activeTexture(s.TEXTURE0+e)),s.bindTexture(t.target,n.texture)),n.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,s.activeTexture(s.TEXTURE0+e)),this.updateTexture(t)):n.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,s.activeTexture(s.TEXTURE0+e)),s.bindTexture(s.TEXTURE_2D,this.emptyTextures[s.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:e,boundTextures:s}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let n=0;n<s.length;n++)s[n]===this.unknownTexture&&this.bind(null,n)}for(let n=0;n<s.length;n++)s[n]===t&&(this.currentLocation!==n&&(e.activeTexture(e.TEXTURE0+n),this.currentLocation=n),e.bindTexture(t.target,this.emptyTextures[t.target].texture),s[n]=null)}ensureSamplerType(t){const{boundTextures:e,hasIntegerTextures:s,CONTEXT_UID:n}=this;if(!!s)for(let r=t-1;r>=0;--r){const o=e[r];o&&o._glTextures[n].samplerType!==Dn.FLOAT&&this.renderer.texture.unbind(o)}}initTexture(t){const e=new vn(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){var s,n;e.internalFormat=(n=(s=this.internalFormats[t.type])==null?void 0:s[t.format])!=null?n:t.format,this.webGLVersion===2&&t.type===Z.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){var n;const e=t._glTextures[this.CONTEXT_UID];if(!e)return;const s=this.renderer;if(this.initTextureType(t,e),(n=t.resource)!=null&&n.upload(s,t,e))e.samplerType!==Dn.FLOAT&&(this.hasIntegerTextures=!0);else{const r=t.realWidth,o=t.realHeight,a=s.gl;(e.width!==r||e.height!==o||e.dirtyId<0)&&(e.width=r,e.height=o,a.texImage2D(t.target,0,e.internalFormat,r,o,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}destroyTexture(t,e){const{gl:s}=this;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),s.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){const n=this.managedTextures.indexOf(t);n!==-1&&li(this.managedTextures,n,1)}}updateTextureStyle(t){var s;const e=t._glTextures[this.CONTEXT_UID];!e||((t.mipmap===se.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?e.mipmap=!1:e.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?e.wrapMode=_e.CLAMP:e.wrapMode=t.wrapMode,(s=t.resource)!=null&&s.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){const s=this.gl;if(e.mipmap&&t.mipmap!==se.ON_MANUAL&&s.generateMipmap(t.target),s.texParameteri(t.target,s.TEXTURE_WRAP_S,e.wrapMode),s.texParameteri(t.target,s.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){s.texParameteri(t.target,s.TEXTURE_MIN_FILTER,t.scaleMode===Jt.LINEAR?s.LINEAR_MIPMAP_LINEAR:s.NEAREST_MIPMAP_NEAREST);const n=this.renderer.context.extensions.anisotropicFiltering;if(n&&t.anisotropicLevel>0&&t.scaleMode===Jt.LINEAR){const r=Math.min(t.anisotropicLevel,s.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT));s.texParameterf(t.target,n.TEXTURE_MAX_ANISOTROPY_EXT,r)}}else s.texParameteri(t.target,s.TEXTURE_MIN_FILTER,t.scaleMode===Jt.LINEAR?s.LINEAR:s.NEAREST);s.texParameteri(t.target,s.TEXTURE_MAG_FILTER,t.scaleMode===Jt.LINEAR?s.LINEAR:s.NEAREST)}destroy(){this.renderer=null}}Qa.extension={type:z.RendererSystem,name:"texture"};Y.add(Qa);const jf=new Xs;class $a{constructor(t){this.renderer=t,this._tempMatrix=new gt}generateTexture(t,e){const{region:s,...n}=e||{},r=s||t.getLocalBounds(null,!0);r.width===0&&(r.width=1),r.height===0&&(r.height=1);const o=be.create({width:r.width,height:r.height,...n});this._tempMatrix.tx=-r.x,this._tempMatrix.ty=-r.y;const a=t.transform;return t.transform=jf,this.renderer.render(t,{renderTexture:o,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=a,o}destroy(){}}$a.extension={type:[z.RendererSystem,z.CanvasRendererSystem],name:"textureGenerator"};Y.add($a);class qa{constructor(){this.clearBeforeRender=!0,this._backgroundColor=0,this._backgroundColorRgba=[0,0,0,1],this._backgroundColorString="#000000",this.color=this._backgroundColor,this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender,t.color&&(this.color=typeof t.color=="string"?xr(t.color):t.color),this.alpha=t.alpha}get color(){return this._backgroundColor}set color(t){this._backgroundColor=t,this._backgroundColorString=_a(t),Oi(t,this._backgroundColorRgba)}get alpha(){return this._backgroundColorRgba[3]}set alpha(t){this._backgroundColorRgba[3]=t}get colorRgba(){return this._backgroundColorRgba}get colorString(){return this._backgroundColorString}destroy(){}}qa.extension={type:[z.RendererSystem,z.CanvasRendererSystem],name:"background"};Y.add(qa);class Ja{constructor(t){this.renderer=t}init(t){this.screen=new q(0,0,t.width,t.height),this.element=t.view||O.ADAPTER.createCanvas(),this.resolution=t.resolution||O.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);const s=this.element.width/this.resolution,n=this.element.height/this.resolution;this.screen.width=s,this.screen.height=n,this.autoDensity&&(this.element.style.width=`${s}px`,this.element.style.height=`${n}px`),this.renderer.emit("resize",s,n),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){var e;t&&((e=this.element.parentNode)==null||e.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}}Ja.extension={type:[z.RendererSystem,z.CanvasRendererSystem],name:"_view"};Y.add(Ja);class th{constructor(t){this.renderer=t,this.plugins={}}init(t){for(const e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}th.extension={type:[z.RendererSystem,z.CanvasRendererSystem],name:"_plugin"};Y.add(th);class Yf extends re{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){var n;this.addRunners(...t.runners);const e=((n=t.priority)!=null?n:[]).filter(r=>t.systems[r]),s=[...e,...Object.keys(t.systems).filter(r=>!e.includes(r))];for(const r of s)this.addSystem(t.systems[r],r)}addRunners(...t){t.forEach(e=>{this.runners[e]=new zt(e)})}addSystem(t,e){const s=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=s,this._systemsHash[e]=s;for(const n in this.runners)this.runners[n].add(s);return this}emitWithCustomOptions(t,e){const s=Object.keys(this._systemsHash);t.items.forEach(n=>{const r=s.find(o=>this._systemsHash[o]===n);n[t.name](e[r])})}destroy(){Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash={}}}class eh{constructor(t){this.renderer=t}run(t){const e=this.renderer;e.emitWithCustomOptions(e.runners.init,t),t.hello&&console.log(`PixiJS 7.0.4 - ${e.rendererLogId} - https://pixijs.com`),e.resize(this.renderer.screen.width,this.renderer.screen.height)}destroy(){}}eh.extension={type:[z.RendererSystem,z.CanvasRendererSystem],name:"startup"};Y.add(eh);class ih{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:s}=this,n=t._glTransformFeedbacks[s]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,n)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){const{gl:s,renderer:n}=this;e&&n.shader.bind(e),s.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:e,renderer:s,CONTEXT_UID:n}=this,r=e.createTransformFeedback();t._glTransformFeedbacks[n]=r,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,r);for(let o=0;o<t.buffers.length;o++){const a=t.buffers[o];!a||(s.buffer.update(a),a._glBuffers[n].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,o,a._glBuffers[n].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),r}disposeTransformFeedback(t,e){const s=t._glTransformFeedbacks[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this);const r=this.renderer.buffer;if(r)for(let o=0;o<t.buffers.length;o++){const a=t.buffers[o];if(!a)continue;const h=a._glBuffers[this.CONTEXT_UID];h&&(h.refCount--,h.refCount===0&&!e&&r.dispose(a,e))}!s||(e||n.deleteTransformFeedback(s),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}ih.extension={type:z.RendererSystem,name:"transformFeedback"};Y.add(ih);const sh=[];Y.handleByList(z.Renderer,sh);function Kf(i){for(const t of sh)if(t.test(i))return new t(i);throw new Error("Unable to auto-detect a suitable renderer.")}var Zf=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const Qf=Zf,jn=class extends Yf{constructor(i){var s,n;super(),i=Object.assign({},O.RENDER_OPTIONS,i),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new Xt({projectionMatrix:new gt},!0);const t={runners:["init","destroy","contextChange","reset","update","postrender","prerender","resize"],systems:jn.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(t);const e={hello:i.hello,_plugin:jn.__plugins,background:{alpha:i.backgroundAlpha,color:(s=i.background)!=null?s:i.backgroundColor,clearBeforeRender:i.clearBeforeRender},_view:{height:i.height,width:i.width,autoDensity:i.autoDensity,resolution:i.resolution,view:i.view},context:{antialias:i.antialias,context:i.context,powerPreference:i.powerPreference,premultipliedAlpha:(n=i.premultipliedAlpha)!=null?n:i.useContextAlpha&&i.useContextAlpha!=="notMultiplied",preserveDrawingBuffer:i.preserveDrawingBuffer}};this.startup.run(e)}static test(i){return i!=null&&i.forceCanvas?!1:Jl()}render(i,t){this.objectRenderer.render(i,t)}resize(i,t){this._view.resizeView(i,t)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(i=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:i}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return this.background.clearBeforeRender}get useContextAlpha(){return this.context.useContextAlpha}get preserveDrawingBuffer(){return this.context.preserveDrawingBuffer}get backgroundColor(){return this.background.color}set backgroundColor(i){this.background.color=i}get backgroundAlpha(){return this.background.color}set backgroundAlpha(i){this.background.alpha=i}get powerPreference(){return this.context.powerPreference}generateTexture(i,t){return this.textureGenerator.generateTexture(i,t)}};let di=jn;di.extension={type:z.Renderer,priority:1};di.__plugins={};di.__systems={};Y.handleByMap(z.RendererPlugin,di.__plugins);Y.handleByMap(z.RendererSystem,di.__systems);Y.add(di);class Yn{constructor(){this.texArray=null,this.blend=0,this.type=qt.TRIANGLES,this.start=0,this.size=0,this.data=null}}class Kn{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}class Zn{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}class $f{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const s=new Int32Array(t);for(let r=0;r<t;r++)s[r]=r;this.defaultGroupCache[t]=Xt.from({uSamplers:s},!0);let n=this.fragTemplate;n=n.replace(/%count%/gi,`${t}`),n=n.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new de(this.vertexSrc,n)}const e={tint:new Float32Array([1,1,1,1]),translationMatrix:new gt,default:this.defaultGroupCache[t]};return new ee(this.programCache[t],e)}generateSampleSrc(t){let e="";e+=`
`,e+=`
`;for(let s=0;s<t;s++)s>0&&(e+=`
else `),s<t-1&&(e+=`if(vTextureId < ${s}.5)`),e+=`
{`,e+=`
	color = texture2D(uSamplers[${s}], vTextureCoord);`,e+=`
}`;return e+=`
`,e+=`
`,e}}class nh extends Ae{constructor(t=!1){super(),this._buffer=new _t(null,t,!1),this._indexBuffer=new _t(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,Z.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,Z.FLOAT).addAttribute("aColor",this._buffer,4,!0,Z.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,Z.FLOAT).addIndex(this._indexBuffer)}}var qf=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`,Jf=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`;const ke=class extends Zs{constructor(i){super(i),this.setShaderGenerator(),this.geometryClass=nh,this.vertexSize=6,this.state=pe.for2d(),this.size=O.SPRITE_BATCH_SIZE*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.MAX_TEXTURES=1,this.renderer.on("prerender",this.onPrerender,this),i.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultVertexSrc(){return qf}static get defaultFragmentTemplate(){return Jf}setShaderGenerator({vertex:i=ke.defaultVertexSrc,fragment:t=ke.defaultFragmentTemplate}={}){this.shaderGenerator=new $f(i,t)}contextChange(){const i=this.renderer.gl;O.PREFER_ENV===Ve.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),O.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=_f(this.MAX_TEXTURES,i)),this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:i,_textureArrayPool:t}=ke,e=this.size/4,s=Math.floor(e/this.MAX_TEXTURES)+1;for(;i.length<e;)i.push(new Yn);for(;t.length<s;)t.push(new Kn);for(let n=0;n<this.MAX_TEXTURES;n++)this._tempBoundTextures[n]=null}onPrerender(){this._flushId=0}render(i){!i._texture.valid||(this._vertexCount+i.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=i.vertexData.length/2,this._indexCount+=i.indices.length,this._bufferedTextures[this._bufferSize]=i._texture.baseTexture,this._bufferedElements[this._bufferSize++]=i)}buildTexturesAndDrawCalls(){const{_bufferedTextures:i,MAX_TEXTURES:t}=this,e=ke._textureArrayPool,s=this.renderer.batch,n=this._tempBoundTextures,r=this.renderer.textureGC.count;let o=++J._globalBatch,a=0,h=e[0],c=0;s.copyBoundTextures(n,t);for(let l=0;l<this._bufferSize;++l){const f=i[l];i[l]=null,f._batchEnabled!==o&&(h.count>=t&&(s.boundArray(h,n,o,t),this.buildDrawCalls(h,c,l),c=l,h=e[++a],++o),f._batchEnabled=o,f.touched=r,h.elements[h.count++]=f)}h.count>0&&(s.boundArray(h,n,o,t),this.buildDrawCalls(h,c,this._bufferSize),++a,++o);for(let l=0;l<n.length;l++)n[l]=null;J._globalBatch=o}buildDrawCalls(i,t,e){const{_bufferedElements:s,_attributeBuffer:n,_indexBuffer:r,vertexSize:o}=this,a=ke._drawCallPool;let h=this._dcIndex,c=this._aIndex,l=this._iIndex,f=a[h];f.start=this._iIndex,f.texArray=i;for(let d=t;d<e;++d){const u=s[d],p=u._texture.baseTexture,m=ya[p.alphaMode?1:0][u.blendMode];s[d]=null,t<d&&f.blend!==m&&(f.size=l-f.start,t=d,f=a[++h],f.texArray=i,f.start=l),this.packInterleavedGeometry(u,n,r,c,l),c+=u.vertexData.length/2*o,l+=u.indices.length,f.blend=m}t<e&&(f.size=l-f.start,++h),this._dcIndex=h,this._aIndex=c,this._iIndex=l}bindAndClearTexArray(i){const t=this.renderer.texture;for(let e=0;e<i.count;e++)t.bind(i.elements[e],i.ids[e]),i.elements[e]=null;i.count=0}updateGeometry(){const{_packedGeometries:i,_attributeBuffer:t,_indexBuffer:e}=this;O.CAN_UPLOAD_SAME_BUFFER?(i[this._flushId]._buffer.update(t.rawBinaryData),i[this._flushId]._indexBuffer.update(e),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,i[this._flushId]=new this.geometryClass),i[this._flushId]._buffer.update(t.rawBinaryData),i[this._flushId]._indexBuffer.update(e),this.renderer.geometry.bind(i[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const i=this._dcIndex,{gl:t,state:e}=this.renderer,s=ke._drawCallPool;let n=null;for(let r=0;r<i;r++){const{texArray:o,type:a,size:h,start:c,blend:l}=s[r];n!==o&&(n=o,this.bindAndClearTexArray(o)),this.state.blendMode=l,e.set(this.state),t.drawElements(a,h,t.UNSIGNED_SHORT,c*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.MAX_TEXTURES),this.renderer.shader.bind(this._shader),O.CAN_UPLOAD_SAME_BUFFER&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let i=0;i<this._packedGeometryPoolSize;i++)this._packedGeometries[i]&&this._packedGeometries[i].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(i){const t=Cs(Math.ceil(i/8)),e=Jr(t),s=t*8;this._aBuffers.length<=e&&(this._iBuffers.length=e+1);let n=this._aBuffers[s];return n||(this._aBuffers[s]=n=new Zn(s*this.vertexSize*4)),n}getIndexBuffer(i){const t=Cs(Math.ceil(i/12)),e=Jr(t),s=t*12;this._iBuffers.length<=e&&(this._iBuffers.length=e+1);let n=this._iBuffers[e];return n||(this._iBuffers[e]=n=new Uint16Array(s)),n}packInterleavedGeometry(i,t,e,s,n){const{uint32View:r,float32View:o}=t,a=s/this.vertexSize,h=i.uvs,c=i.indices,l=i.vertexData,f=i._texture.baseTexture._batchLocation,d=Math.min(i.worldAlpha,1),u=d<1&&i._texture.baseTexture.alphaMode?wr(i._tintRGB,d):i._tintRGB+(d*255<<24);for(let p=0;p<l.length;p+=2)o[s++]=l[p],o[s++]=l[p+1],o[s++]=h[p],o[s++]=h[p+1],r[s++]=u,o[s++]=f;for(let p=0;p<c.length;p++)e[n++]=a+c[p]}};let Qs=ke;Qs.extension={name:"batch",type:z.RendererPlugin};Qs._drawCallPool=[];Qs._textureArrayPool=[];Y.add(Qs);class tp{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class rh{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:s}=this,n=t._glBuffers[s]||this.createGLBuffer(t);e.bindBuffer(t.type,n.buffer)}unbind(t){const{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){const{gl:s,CONTEXT_UID:n}=this;if(this.boundBufferBases[e]!==t){const r=t._glBuffers[n]||this.createGLBuffer(t);this.boundBufferBases[e]=t,s.bindBufferBase(s.UNIFORM_BUFFER,e,r.buffer)}}bindBufferRange(t,e,s){const{gl:n,CONTEXT_UID:r}=this;s=s||0;const o=t._glBuffers[r]||this.createGLBuffer(t);n.bindBufferRange(n.UNIFORM_BUFFER,e||0,o.buffer,s*256,256)}update(t){const{gl:e,CONTEXT_UID:s}=this,n=t._glBuffers[s]||this.createGLBuffer(t);if(t._updateID!==n.updateID)if(n.updateID=t._updateID,e.bindBuffer(t.type,n.buffer),n.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{const r=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;n.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,r)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const s=t._glBuffers[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this),s&&(e||n.deleteBuffer(s.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const e=Object.keys(this.managedBuffers);for(let s=0;s<e.length;s++)this.dispose(this.managedBuffers[e[s]],t)}createGLBuffer(t){const{CONTEXT_UID:e,gl:s}=this;return t._glBuffers[e]=new tp(s.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}}rh.extension={type:z.RendererSystem,name:"buffer"};Y.add(rh);class oh{constructor(t){this.renderer=t}contextChange(t){let e;if(this.renderer.context.webGLVersion===1){const s=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,s)}else{const s=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,s)}e>=wt.HIGH?this.multisample=wt.HIGH:e>=wt.MEDIUM?this.multisample=wt.MEDIUM:e>=wt.LOW?this.multisample=wt.LOW:this.multisample=wt.NONE}destroy(){}}oh.extension={type:z.RendererSystem,name:"_multisample"};Y.add(oh);class ah{constructor(t){this.renderer=t}render(t,e){const s=this.renderer;let n,r,o,a;if(e&&(n=e.renderTexture,r=e.clear,o=e.transform,a=e.skipUpdateTransform),this.renderingToScreen=!n,s.runners.prerender.emit(),s.emit("prerender"),s.projection.transform=o,!s.context.isLost){if(n||(this.lastObjectRendered=t),!a){const h=t.enableTempParent();t.updateTransform(),t.disableTempParent(h)}s.renderTexture.bind(n),s.batch.currentRenderer.start(),(r!=null?r:s.background.clearBeforeRender)&&s.renderTexture.clear(),t.render(s),s.batch.currentRenderer.flush(),n&&(e.blit&&s.framebuffer.blit(),n.baseTexture.update()),s.runners.postrender.emit(),s.projection.transform=null,s.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}ah.extension={type:z.RendererSystem,name:"objectRenderer"};Y.add(ah);var ep=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class fo extends Gi{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(Qf,ep,t),this.alpha=1}_loadMatrix(t,e=!1){let s=t;e&&(this._multiply(s,this.uniforms.m,t),s=this._colorMatrix(s)),this.uniforms.m=s}_multiply(t,e,s){return t[0]=e[0]*s[0]+e[1]*s[5]+e[2]*s[10]+e[3]*s[15],t[1]=e[0]*s[1]+e[1]*s[6]+e[2]*s[11]+e[3]*s[16],t[2]=e[0]*s[2]+e[1]*s[7]+e[2]*s[12]+e[3]*s[17],t[3]=e[0]*s[3]+e[1]*s[8]+e[2]*s[13]+e[3]*s[18],t[4]=e[0]*s[4]+e[1]*s[9]+e[2]*s[14]+e[3]*s[19]+e[4],t[5]=e[5]*s[0]+e[6]*s[5]+e[7]*s[10]+e[8]*s[15],t[6]=e[5]*s[1]+e[6]*s[6]+e[7]*s[11]+e[8]*s[16],t[7]=e[5]*s[2]+e[6]*s[7]+e[7]*s[12]+e[8]*s[17],t[8]=e[5]*s[3]+e[6]*s[8]+e[7]*s[13]+e[8]*s[18],t[9]=e[5]*s[4]+e[6]*s[9]+e[7]*s[14]+e[8]*s[19]+e[9],t[10]=e[10]*s[0]+e[11]*s[5]+e[12]*s[10]+e[13]*s[15],t[11]=e[10]*s[1]+e[11]*s[6]+e[12]*s[11]+e[13]*s[16],t[12]=e[10]*s[2]+e[11]*s[7]+e[12]*s[12]+e[13]*s[17],t[13]=e[10]*s[3]+e[11]*s[8]+e[12]*s[13]+e[13]*s[18],t[14]=e[10]*s[4]+e[11]*s[9]+e[12]*s[14]+e[13]*s[19]+e[14],t[15]=e[15]*s[0]+e[16]*s[5]+e[17]*s[10]+e[18]*s[15],t[16]=e[15]*s[1]+e[16]*s[6]+e[17]*s[11]+e[18]*s[16],t[17]=e[15]*s[2]+e[16]*s[7]+e[17]*s[12]+e[18]*s[17],t[18]=e[15]*s[3]+e[16]*s[8]+e[17]*s[13]+e[18]*s[18],t[19]=e[15]*s[4]+e[16]*s[9]+e[17]*s[14]+e[18]*s[19]+e[19],t}_colorMatrix(t){const e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){const s=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(s,e)}tint(t,e){const s=t>>16&255,n=t>>8&255,r=t&255,o=[s/255,0,0,0,0,0,n/255,0,0,0,0,0,r/255,0,0,0,0,0,1,0];this._loadMatrix(o,e)}greyscale(t,e){const s=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(s,e)}blackAndWhite(t){const e=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(e,t)}hue(t,e){t=(t||0)/180*Math.PI;const s=Math.cos(t),n=Math.sin(t),r=Math.sqrt,o=1/3,a=r(o),h=s+(1-s)*o,c=o*(1-s)-a*n,l=o*(1-s)+a*n,f=o*(1-s)+a*n,d=s+o*(1-s),u=o*(1-s)-a*n,p=o*(1-s)-a*n,m=o*(1-s)+a*n,g=s+o*(1-s),_=[h,c,l,0,0,f,d,u,0,0,p,m,g,0,0,0,0,0,1,0];this._loadMatrix(_,e)}contrast(t,e){const s=(t||0)+1,n=-.5*(s-1),r=[s,0,0,0,n,0,s,0,0,n,0,0,s,0,n,0,0,0,1,0];this._loadMatrix(r,e)}saturate(t=0,e){const s=t*2/3+1,n=(s-1)*-.5,r=[s,n,n,0,0,n,s,n,0,0,n,n,s,0,0,0,0,0,1,0];this._loadMatrix(r,e)}desaturate(){this.saturate(-1)}negative(t){const e=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(e,t)}sepia(t){const e=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(e,t)}technicolor(t){const e=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(e,t)}polaroid(t){const e=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(e,t)}toBGR(t){const e=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(e,t)}kodachrome(t){const e=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(e,t)}browni(t){const e=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(e,t)}vintage(t){const e=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(e,t)}colorTone(t,e,s,n,r){t=t||.2,e=e||.15,s=s||16770432,n=n||3375104;const o=(s>>16&255)/255,a=(s>>8&255)/255,h=(s&255)/255,c=(n>>16&255)/255,l=(n>>8&255)/255,f=(n&255)/255,d=[.3,.59,.11,0,0,o,a,h,t,0,c,l,f,e,0,o-c,a-l,h-f,0,0];this._loadMatrix(d,r)}night(t,e){t=t||.1;const s=[t*-2,-t,0,0,0,-t,0,t,0,0,0,t,t*2,0,0,0,0,0,1,0];this._loadMatrix(s,e)}predator(t,e){const s=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(s,e)}lsd(t){const e=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(e,t)}reset(){const t=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(t,!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}fo.prototype.grayscale=fo.prototype.greyscale;O.SORTABLE_CHILDREN=!1;class Ps{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?q.EMPTY:(t=t||new q(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){const{a:s,b:n,c:r,d:o,tx:a,ty:h}=t,c=s*e.x+r*e.y+a,l=n*e.x+o*e.y+h;this.minX=Math.min(this.minX,c),this.maxX=Math.max(this.maxX,c),this.minY=Math.min(this.minY,l),this.maxY=Math.max(this.maxY,l)}addQuad(t){let e=this.minX,s=this.minY,n=this.maxX,r=this.maxY,o=t[0],a=t[1];e=o<e?o:e,s=a<s?a:s,n=o>n?o:n,r=a>r?a:r,o=t[2],a=t[3],e=o<e?o:e,s=a<s?a:s,n=o>n?o:n,r=a>r?a:r,o=t[4],a=t[5],e=o<e?o:e,s=a<s?a:s,n=o>n?o:n,r=a>r?a:r,o=t[6],a=t[7],e=o<e?o:e,s=a<s?a:s,n=o>n?o:n,r=a>r?a:r,this.minX=e,this.minY=s,this.maxX=n,this.maxY=r}addFrame(t,e,s,n,r){this.addFrameMatrix(t.worldTransform,e,s,n,r)}addFrameMatrix(t,e,s,n,r){const o=t.a,a=t.b,h=t.c,c=t.d,l=t.tx,f=t.ty;let d=this.minX,u=this.minY,p=this.maxX,m=this.maxY,g=o*e+h*s+l,_=a*e+c*s+f;d=g<d?g:d,u=_<u?_:u,p=g>p?g:p,m=_>m?_:m,g=o*n+h*s+l,_=a*n+c*s+f,d=g<d?g:d,u=_<u?_:u,p=g>p?g:p,m=_>m?_:m,g=o*e+h*r+l,_=a*e+c*r+f,d=g<d?g:d,u=_<u?_:u,p=g>p?g:p,m=_>m?_:m,g=o*n+h*r+l,_=a*n+c*r+f,d=g<d?g:d,u=_<u?_:u,p=g>p?g:p,m=_>m?_:m,this.minX=d,this.minY=u,this.maxX=p,this.maxY=m}addVertexData(t,e,s){let n=this.minX,r=this.minY,o=this.maxX,a=this.maxY;for(let h=e;h<s;h+=2){const c=t[h],l=t[h+1];n=c<n?c:n,r=l<r?l:r,o=c>o?c:o,a=l>a?l:a}this.minX=n,this.minY=r,this.maxX=o,this.maxY=a}addVertices(t,e,s,n){this.addVerticesMatrix(t.worldTransform,e,s,n)}addVerticesMatrix(t,e,s,n,r=0,o=r){const a=t.a,h=t.b,c=t.c,l=t.d,f=t.tx,d=t.ty;let u=this.minX,p=this.minY,m=this.maxX,g=this.maxY;for(let _=s;_<n;_+=2){const A=e[_],y=e[_+1],v=a*A+c*y+f,x=l*y+h*A+d;u=Math.min(u,v-r),m=Math.max(m,v+r),p=Math.min(p,x-o),g=Math.max(g,x+o)}this.minX=u,this.minY=p,this.maxX=m,this.maxY=g}addBounds(t){const e=this.minX,s=this.minY,n=this.maxX,r=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<s?t.minY:s,this.maxX=t.maxX>n?t.maxX:n,this.maxY=t.maxY>r?t.maxY:r}addBoundsMask(t,e){const s=t.minX>e.minX?t.minX:e.minX,n=t.minY>e.minY?t.minY:e.minY,r=t.maxX<e.maxX?t.maxX:e.maxX,o=t.maxY<e.maxY?t.maxY:e.maxY;if(s<=r&&n<=o){const a=this.minX,h=this.minY,c=this.maxX,l=this.maxY;this.minX=s<a?s:a,this.minY=n<h?n:h,this.maxX=r>c?r:c,this.maxY=o>l?o:l}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){const s=t.minX>e.x?t.minX:e.x,n=t.minY>e.y?t.minY:e.y,r=t.maxX<e.x+e.width?t.maxX:e.x+e.width,o=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(s<=r&&n<=o){const a=this.minX,h=this.minY,c=this.maxX,l=this.maxY;this.minX=s<a?s:a,this.minY=n<h?n:h,this.maxX=r>c?r:c,this.maxY=o>l?o:l}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,s,n,r,o){t-=r,e-=o,s+=r,n+=o,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>s?this.maxX:s,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>n?this.maxY:n}}class pt extends re{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new Xs,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Ps,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const e=Object.keys(t);for(let s=0;s<e.length;++s){const n=e[s];Object.defineProperty(pt.prototype,n,Object.getOwnPropertyDescriptor(t,n))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new q),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new q),t=this._localBoundsRect),this._localBounds||(this._localBounds=new Ps);const e=this.transform,s=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;const n=this._bounds,r=this._boundsID;this._bounds=this._localBounds;const o=this.getBounds(!1,t);return this.parent=s,this.transform=e,this._bounds=n,this._bounds.updateID+=this._boundsID-r,o}toGlobal(t,e,s=!1){return s||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,s,n){return e&&(t=e.toGlobal(t,s,n)),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,s)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){var t;(t=this.parent)==null||t.removeChild(this)}setTransform(t=0,e=0,s=1,n=1,r=0,o=0,a=0,h=0,c=0){return this.position.x=t,this.position.y=e,this.scale.x=s||1,this.scale.y=n||1,this.rotation=r,this.skew.x=o,this.skew.y=a,this.pivot.x=h,this.pivot.y=c,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new ip),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*fl}set angle(t){this.transform.rotation=t*pl}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount--,e._maskRefCount===0&&(e.renderable=!0,e.isMask=!1))}if(this._mask=t,this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount===0&&(e.renderable=!1,e.isMask=!0),e._maskRefCount++)}}}}class ip extends pt{constructor(){super(...arguments),this.sortDirty=null}}pt.prototype.displayObjectUpdateTransform=pt.prototype.updateTransform;function sp(i,t){return i.zIndex===t.zIndex?i._lastSortedIndex-t._lastSortedIndex:i.zIndex-t.zIndex}class ct extends pt{constructor(){super(),this.children=[],this.sortableChildren=O.SORTABLE_CHILDREN,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{const e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;const s=this.getChildIndex(t),n=this.getChildIndex(e);this.children[s]=e,this.children[n]=t,this.onChildrenChange(s<n?s:n)}getChildIndex(t){const e=this.children.indexOf(t);if(e===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);const s=this.getChildIndex(t);li(this.children,s,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{const e=t[0],s=this.children.indexOf(e);if(s===-1)return null;e.parent=null,e.transform._parentID=-1,li(this.children,s,1),this._boundsID++,this.onChildrenChange(s),e.emit("removed",this),this.emit("childRemoved",e,this,s)}return t[0]}removeChildAt(t){const e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,li(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){const s=t,n=e,r=n-s;let o;if(r>0&&r<=n){o=this.children.splice(s,r);for(let a=0;a<o.length;++a)o[a].parent=null,o[a].transform&&(o[a].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let a=0;a<o.length;++a)o[a].emit("removed",this),this.emit("childRemoved",o[a],this,a);return o}else if(r===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,s=this.children.length;e<s;++e){const n=this.children[e];n._lastSortedIndex=e,!t&&n.zIndex!==0&&(t=!0)}t&&this.children.length>1&&this.children.sort(sp),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){const s=this.children[t];s.visible&&s.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){const e=this.children[t];if(!(!e.visible||!e.renderable))if(e.calculateBounds(),e._mask){const s=e._mask.isMaskData?e._mask.maskObject:e._mask;s?(s.calculateBounds(),this._bounds.addBoundsMask(e._bounds,s._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){const s=super.getLocalBounds(t);if(!e)for(let n=0,r=this.children.length;n<r;++n){const o=this.children[n];o.visible&&o.updateTransform()}return s}_calculateBounds(){}_renderWithCulling(t){const e=t.renderTexture.sourceFrame;if(!(e.width>0&&e.height>0))return;let s,n;if(this.cullArea?(s=this.cullArea,n=this.worldTransform):this._render!==ct.prototype._render&&(s=this.getBounds(!0)),s&&e.intersects(s,n))this._render(t);else if(this.cullArea)return;for(let r=0,o=this.children.length;r<o;++r){const a=this.children[r],h=a.cullable;a.cullable=h||!this.cullArea,a.render(t),a.cullable=h}}render(t){var e;if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||((e=this.filters)==null?void 0:e.length))this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let s=0,n=this.children.length;s<n;++s)this.children[s].render(t)}}renderAdvanced(t){var r,o,a;const e=this.filters,s=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let h=0;h<e.length;h++)e[h].enabled&&this._enabledFilters.push(e[h])}const n=e&&((r=this._enabledFilters)==null?void 0:r.length)||s&&(!s.isMaskData||s.enabled&&(s.autoDetect||s.type!==bt.NONE));if(n&&t.batch.flush(),e&&((o=this._enabledFilters)==null?void 0:o.length)&&t.filter.push(this,this._enabledFilters),s&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let h=0,c=this.children.length;h<c;++h)this.children[h].render(t)}n&&t.batch.flush(),s&&t.mask.pop(this),e&&((a=this._enabledFilters)==null?void 0:a.length)&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;const e=typeof t=="boolean"?t:t==null?void 0:t.children,s=this.removeChildren(0,this.children.length);if(e)for(let n=0;n<s.length;++n)s[n].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){const e=this.getLocalBounds().width;e!==0?this.scale.x=t/e:this.scale.x=1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){const e=this.getLocalBounds().height;e!==0?this.scale.y=t/e:this.scale.y=1,this._height=t}}ct.prototype.containerUpdateTransform=ct.prototype.updateTransform;const gi=new G,np=new Uint16Array([0,1,2,0,2,3]);class ut extends ct{constructor(t){super(),this._anchor=new Ct(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tint=null,this._tintRGB=null,this.tint=16777215,this.blendMode=$.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||H.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=np,this.pluginName="batch",this.isSprite=!0,this._roundPixels=O.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=ti(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=ti(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const e=this.transform.worldTransform,s=e.a,n=e.b,r=e.c,o=e.d,a=e.tx,h=e.ty,c=this.vertexData,l=t.trim,f=t.orig,d=this._anchor;let u=0,p=0,m=0,g=0;if(l?(p=l.x-d._x*f.width,u=p+l.width,g=l.y-d._y*f.height,m=g+l.height):(p=-d._x*f.width,u=p+f.width,g=-d._y*f.height,m=g+f.height),c[0]=s*p+r*g+a,c[1]=o*g+n*p+h,c[2]=s*u+r*g+a,c[3]=o*g+n*u+h,c[4]=s*u+r*m+a,c[5]=o*m+n*u+h,c[6]=s*p+r*m+a,c[7]=o*m+n*p+h,this._roundPixels){const _=O.RESOLUTION;for(let A=0;A<c.length;++A)c[A]=Math.round(c[A]*_)/_}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,e=this.vertexTrimmedData,s=t.orig,n=this._anchor,r=this.transform.worldTransform,o=r.a,a=r.b,h=r.c,c=r.d,l=r.tx,f=r.ty,d=-n._x*s.width,u=d+s.width,p=-n._y*s.height,m=p+s.height;e[0]=o*d+h*p+l,e[1]=c*p+a*d+f,e[2]=o*u+h*p+l,e[3]=c*p+a*u+f,e[4]=o*u+h*m+l,e[5]=c*m+a*u+f,e[6]=o*d+h*m+l,e[7]=c*m+a*d+f}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return this.children.length===0?(this._localBounds||(this._localBounds=new Ps),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new q),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,gi);const e=this._texture.orig.width,s=this._texture.orig.height,n=-e*this.anchor.x;let r=0;return gi.x>=n&&gi.x<n+e&&(r=-s*this.anchor.y,gi.y>=r&&gi.y<r+s)}destroy(t){if(super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof t=="boolean"?t:t==null?void 0:t.texture){const s=typeof t=="boolean"?t:t==null?void 0:t.baseTexture;this._texture.destroy(!!s)}this._texture=null}static from(t,e){const s=t instanceof H?t:H.from(t,e);return new ut(s)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const e=ti(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const e=ti(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tint}set tint(t){this._tint=t,this._tintRGB=(t>>16)+(t&65280)+((t&255)<<16)}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||H.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const hh=new gt;pt.prototype._cacheAsBitmap=!1;pt.prototype._cacheData=null;pt.prototype._cacheAsBitmapResolution=null;pt.prototype._cacheAsBitmapMultisample=null;class rp{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(pt.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(i){i!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=i,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(i){i!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=i,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(i){if(this._cacheAsBitmap===i)return;this._cacheAsBitmap=i;let t;i?(this._cacheData||(this._cacheData=new rp),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}});pt.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))};pt.prototype._initCachedDisplayObject=function(t){var d,u,p;if((d=this._cacheData)!=null&&d.sprite)return;const e=this.alpha;this.alpha=1,t.batch.flush();const s=this.getLocalBounds(null,!0).clone();if((u=this.filters)!=null&&u.length){const m=this.filters[0].padding;s.pad(m)}s.ceil(O.RESOLUTION);const n=t.renderTexture.current,r=t.renderTexture.sourceFrame.clone(),o=t.renderTexture.destinationFrame.clone(),a=t.projection.transform,h=be.create({width:s.width,height:s.height,resolution:this.cacheAsBitmapResolution||t.resolution,multisample:(p=this.cacheAsBitmapMultisample)!=null?p:t.multisample}),c=`cacheAsBitmap_${He()}`;this._cacheData.textureCacheId=c,J.addToCache(h.baseTexture,c),H.addToCache(h,c);const l=this.transform.localTransform.copyTo(hh).invert().translate(-s.x,-s.y);this.render=this._cacheData.originalRender,t.render(this,{renderTexture:h,clear:!0,transform:l,skipUpdateTransform:!1}),t.framebuffer.blit(),t.projection.transform=a,t.renderTexture.bind(n,r,o),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=e;const f=new ut(h);f.transform.worldTransform=this.transform.worldTransform,f.anchor.x=-(s.x/s.width),f.anchor.y=-(s.y/s.height),f.alpha=e,f._bounds=this._bounds,this._cacheData.sprite=f,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=f.containsPoint.bind(f)};pt.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))};pt.prototype._initCachedDisplayObjectCanvas=function(t){var l;if((l=this._cacheData)!=null&&l.sprite)return;const e=this.getLocalBounds(null,!0),s=this.alpha;this.alpha=1;const n=t.canvasContext.activeContext,r=t._projTransform;e.ceil(O.RESOLUTION);const o=be.create({width:e.width,height:e.height}),a=`cacheAsBitmap_${He()}`;this._cacheData.textureCacheId=a,J.addToCache(o.baseTexture,a),H.addToCache(o,a);const h=hh;this.transform.localTransform.copyTo(h),h.invert(),h.tx-=e.x,h.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,{renderTexture:o,clear:!0,transform:h,skipUpdateTransform:!1}),t.canvasContext.activeContext=n,t._projTransform=r,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=s;const c=new ut(o);c.transform.worldTransform=this.transform.worldTransform,c.anchor.x=-(e.x/e.width),c.anchor.y=-(e.y/e.height),c.alpha=s,c._bounds=this._bounds,this._cacheData.sprite=c,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=c.containsPoint.bind(c)};pt.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};pt.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};pt.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,J.removeFromCache(this._cacheData.textureCacheId),H.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};pt.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)};pt.prototype.name=null;ct.prototype.getChildByName=function(t,e){for(let s=0,n=this.children.length;s<n;s++)if(this.children[s].name===t)return this.children[s];if(e)for(let s=0,n=this.children.length;s<n;s++){const r=this.children[s];if(!r.getChildByName)continue;const o=r.getChildByName(t,!0);if(o)return o}return null};pt.prototype.getGlobalPosition=function(t=new G,e=!1){return this.parent?this.parent.toGlobal(this.position,t,e):(t.x=this.position.x,t.y=this.position.y),t};const op={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};class Ki{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=Ki.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new G,this.page=new G,this.AT_TARGET=1,this.BUBBLING_PHASE=2,this.CAPTURING_PHASE=3,this.NONE=0,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,s){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,s,n,r){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class Rs extends Ki{constructor(){super(...arguments),this.client=new G,this.movement=new G,this.offset=new G,this.global=new G,this.screen=new G}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,s,n,r,o,a,h,c,l,f,d,u,p,m){throw new Error("Method not implemented.")}}class Ut extends Rs{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class Qn extends Rs{constructor(){super(...arguments),this.DOM_DELTA_LINE=0,this.DOM_DELTA_PAGE=1,this.DOM_DELTA_PIXEL=2}}const ap=2048,hp=new G,_n=new G;class lp{constructor(t){this.dispatch=new re,this.moveOnAll=!1,this.mappingState={trackingData:{}},this.eventPool=new Map,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort((s,n)=>s.priority-n.priority)}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let s=0,n=e.length;s<n;s++)e[s].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,e){const s=this.hitTestRecursive(this.rootTarget,this.rootTarget.interactive,hp.set(t,e),this.hitTestFn,this.hitPruneFn);return s&&s[0]}propagate(t,e){if(!t.target)return;const s=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let n=0,r=s.length-1;n<r;n++)if(t.currentTarget=s[n],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!(t.propagationStopped||t.propagationImmediatelyStopped)){t.eventPhase=t.BUBBLING_PHASE;for(let n=s.length-2;n>=0;n--)if(t.currentTarget=s[n],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,s=this.rootTarget){t.eventPhase=t.BUBBLING_PHASE;const n=s.children;if(n)for(let r=0;r<n.length;r++)this.all(t,e,n[r]);t.currentTarget=s,this.notifyTarget(t,e)}propagationPath(t){const e=[t];for(let s=0;s<ap&&t!==this.rootTarget;s++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestRecursive(t,e,s,n,r){if(!t||!t.visible||r(t,s))return null;if(t.interactiveChildren&&t.children){const o=t.children;for(let a=o.length-1;a>=0;a--){const h=o[a],c=this.hitTestRecursive(h,e||h.interactive,s,n,r);if(c){if(c.length>0&&!c[c.length-1].parent)continue;return(c.length>0||t.interactive)&&c.push(t),c}}}return e&&n(t,s)?t.interactive?[t]:[]:null}hitPruneFn(t,e){var s;if(t.hitArea&&(t.worldTransform.applyInverse(e,_n),!t.hitArea.contains(_n.x,_n.y)))return!0;if(t._mask){const n=t._mask.isMaskData?t._mask.maskObject:t._mask;if(n&&!((s=n.containsPoint)!=null&&s.call(n,e)))return!0}return!1}hitTestFn(t,e){return t.hitArea?!0:t.containsPoint?t.containsPoint(e):!1}notifyTarget(t,e){e=e!=null?e:t.type;const s=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,s),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof Ut)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),e.pointerType==="touch")this.dispatchEvent(e,"touchstart");else if(e.pointerType==="mouse"||e.pointerType==="pen"){const n=e.button===2;this.dispatchEvent(e,n?"rightdown":"mousedown")}const s=this.trackingData(t.pointerId);s.pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){var a;if(!(t instanceof Ut)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.createPointerEvent(t),s=e.pointerType==="mouse"||e.pointerType==="pen",n=this.trackingData(t.pointerId),r=this.findMountedTarget(n.overTargets);if(n.overTargets&&r!==e.target){const h=t.type==="mousemove"?"mouseout":"pointerout",c=this.createPointerEvent(t,h,r);if(this.dispatchEvent(c,"pointerout"),s&&this.dispatchEvent(c,"mouseout"),!e.composedPath().includes(r)){const l=this.createPointerEvent(t,"pointerleave",r);for(l.eventPhase=l.AT_TARGET;l.target&&!e.composedPath().includes(l.target);)l.currentTarget=l.target,this.notifyTarget(l),s&&this.notifyTarget(l,"mouseleave"),l.target=l.target.parent;this.freeEvent(l)}this.freeEvent(c)}if(r!==e.target){const h=t.type==="mousemove"?"mouseover":"pointerover",c=this.clonePointerEvent(e,h);this.dispatchEvent(c,"pointerover"),s&&this.dispatchEvent(c,"mouseover");let l=r==null?void 0:r.parent;for(;l&&l!==this.rootTarget.parent&&l!==e.target;)l=l.parent;if(!l||l===this.rootTarget.parent){const d=this.clonePointerEvent(e,"pointerenter");for(d.eventPhase=d.AT_TARGET;d.target&&d.target!==r&&d.target!==this.rootTarget.parent;)d.currentTarget=d.target,this.notifyTarget(d),s&&this.notifyTarget(d,"mouseenter"),d.target=d.target.parent;this.freeEvent(d)}this.freeEvent(c)}const o=this.moveOnAll?"all":"dispatchEvent";this[o](e,"pointermove"),e.pointerType==="touch"&&this[o](e,"touchmove"),s&&(this[o](e,"mousemove"),this.cursor=(a=e.target)==null?void 0:a.cursor),n.overTargets=e.composedPath(),this.freeEvent(e)}mapPointerOver(t){var o;if(!(t instanceof Ut)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId),s=this.createPointerEvent(t),n=s.pointerType==="mouse"||s.pointerType==="pen";this.dispatchEvent(s,"pointerover"),n&&this.dispatchEvent(s,"mouseover"),s.pointerType==="mouse"&&(this.cursor=(o=s.target)==null?void 0:o.cursor);const r=this.clonePointerEvent(s,"pointerenter");for(r.eventPhase=r.AT_TARGET;r.target&&r.target!==this.rootTarget.parent;)r.currentTarget=r.target,this.notifyTarget(r),n&&this.notifyTarget(r,"mouseenter"),r.target=r.target.parent;e.overTargets=s.composedPath(),this.freeEvent(s),this.freeEvent(r)}mapPointerOut(t){if(!(t instanceof Ut)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId);if(e.overTargets){const s=t.pointerType==="mouse"||t.pointerType==="pen",n=this.findMountedTarget(e.overTargets),r=this.createPointerEvent(t,"pointerout",n);this.dispatchEvent(r),s&&this.dispatchEvent(r,"mouseout");const o=this.createPointerEvent(t,"pointerleave",n);for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),s&&this.notifyTarget(o,"mouseleave"),o.target=o.target.parent;e.overTargets=null,this.freeEvent(r),this.freeEvent(o)}this.cursor=null}mapPointerUp(t){if(!(t instanceof Ut)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=performance.now(),s=this.createPointerEvent(t);if(this.dispatchEvent(s,"pointerup"),s.pointerType==="touch")this.dispatchEvent(s,"touchend");else if(s.pointerType==="mouse"||s.pointerType==="pen"){const a=s.button===2;this.dispatchEvent(s,a?"rightup":"mouseup")}const n=this.trackingData(t.pointerId),r=this.findMountedTarget(n.pressTargetsByButton[t.button]);let o=r;if(r&&!s.composedPath().includes(r)){let a=r;for(;a&&!s.composedPath().includes(a);){if(s.currentTarget=a,this.notifyTarget(s,"pointerupoutside"),s.pointerType==="touch")this.notifyTarget(s,"touchendoutside");else if(s.pointerType==="mouse"||s.pointerType==="pen"){const h=s.button===2;this.notifyTarget(s,h?"rightupoutside":"mouseupoutside")}a=a.parent}delete n.pressTargetsByButton[t.button],o=a}if(o){const a=this.clonePointerEvent(s,"click");a.target=o,a.path=null,n.clicksByButton[t.button]||(n.clicksByButton[t.button]={clickCount:0,target:a.target,timeStamp:e});const h=n.clicksByButton[t.button];h.target===a.target&&e-h.timeStamp<200?++h.clickCount:h.clickCount=1,h.target=a.target,h.timeStamp=e,a.detail=h.clickCount,a.pointerType==="mouse"?this.dispatchEvent(a,"click"):a.pointerType==="touch"&&this.dispatchEvent(a,"tap"),this.dispatchEvent(a,"pointertap"),this.freeEvent(a)}this.freeEvent(s)}mapPointerUpOutside(t){if(!(t instanceof Ut)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId),s=this.findMountedTarget(e.pressTargetsByButton[t.button]),n=this.createPointerEvent(t);if(s){let r=s;for(;r;)n.currentTarget=r,this.notifyTarget(n,"pointerupoutside"),n.pointerType==="touch"?this.notifyTarget(n,"touchendoutside"):(n.pointerType==="mouse"||n.pointerType==="pen")&&this.notifyTarget(n,n.button===2?"rightupoutside":"mouseupoutside"),r=r.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(n)}mapWheel(t){if(!(t instanceof Qn)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let s=1;s<t.length&&t[s].parent===e;s++)e=t[s];return e}createPointerEvent(t,e,s){const n=this.allocateEvent(Ut);return this.copyPointerData(t,n),this.copyMouseData(t,n),this.copyData(t,n),n.nativeEvent=t.nativeEvent,n.originalEvent=t,n.target=s!=null?s:this.hitTest(n.global.x,n.global.y),typeof e=="string"&&(n.type=e),n}createWheelEvent(t){const e=this.allocateEvent(Qn);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const s=this.allocateEvent(Ut);return s.nativeEvent=t.nativeEvent,s.originalEvent=t.originalEvent,this.copyPointerData(t,s),this.copyMouseData(t,s),this.copyData(t,s),s.target=t.target,s.path=t.composedPath().slice(),s.type=e!=null?e:s.type,s}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof Ut&&e instanceof Ut&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof Rs&&e instanceof Rs&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){const s=t.currentTarget._events[e];if(!!s)if("fn"in s)s.fn.call(s.context,t);else for(let n=0,r=s.length;n<r&&!t.propagationImmediatelyStopped;n++)s[n].fn.call(s[n].context,t)}}const cp=1,up={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"};class lh{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new lp(null),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new Ut(null),this.rootWheelEvent=new Qn(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}init(){const{view:t,resolution:e}=this.renderer;this.setTargetElement(t),this.resolution=e}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;const s=this.cursorStyles[t];if(s)switch(typeof s){case"string":e&&(this.domElement.style.cursor=s);break;case"function":s(t);break;case"object":e&&Object.assign(this.domElement.style,s);break}else e&&typeof t=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}onPointerDown(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch")return;const e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let s=0,n=e.length;s<n;s++){const r=e[s],o=this.bootstrapEvent(this.rootPointerEvent,r);this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch")return;const e=this.normalizeToPointerData(t);for(let s=0,n=e.length;s<n;s++){const r=this.bootstrapEvent(this.rootPointerEvent,e[s]);this.rootBoundary.mapEvent(r)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch")return;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);const s=e!==this.domElement?"outside":"",n=this.normalizeToPointerData(t);for(let r=0,o=n.length;r<o;r++){const a=this.bootstrapEvent(this.rootPointerEvent,n[r]);a.type+=s,this.rootBoundary.mapEvent(a)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch")return;const e=this.normalizeToPointerData(t);for(let s=0,n=e.length;s<n;s++){const r=this.bootstrapEvent(this.rootPointerEvent,e[s]);this.rootBoundary.mapEvent(r)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){const e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0)),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,s){let n;this.domElement.parentElement?n=this.domElement.getBoundingClientRect():n={x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0};const r=1/this.resolution;t.x=(e-n.left)*(this.domElement.width/n.width)*r,t.y=(s-n.top)*(this.domElement.height/n.height)*r}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let s=0,n=t.changedTouches.length;s<n;s++){const r=t.changedTouches[s];typeof r.button>"u"&&(r.button=0),typeof r.buttons>"u"&&(r.buttons=1),typeof r.isPrimary>"u"&&(r.isPrimary=t.touches.length===1&&t.type==="touchstart"),typeof r.width>"u"&&(r.width=r.radiusX||1),typeof r.height>"u"&&(r.height=r.radiusY||1),typeof r.tiltX>"u"&&(r.tiltX=0),typeof r.tiltY>"u"&&(r.tiltY=0),typeof r.pointerType>"u"&&(r.pointerType="touch"),typeof r.pointerId>"u"&&(r.pointerId=r.identifier||0),typeof r.pressure>"u"&&(r.pressure=r.force||.5),typeof r.twist>"u"&&(r.twist=0),typeof r.tangentialPressure>"u"&&(r.tangentialPressure=0),typeof r.layerX>"u"&&(r.layerX=r.offsetX=r.clientX),typeof r.layerY>"u"&&(r.layerY=r.offsetY=r.clientY),r.isNormalized=!0,r.type=t.type,e.push(r)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&(!this.supportsPointerEvents||!(t instanceof globalThis.PointerEvent))){const s=t;typeof s.isPrimary>"u"&&(s.isPrimary=!0),typeof s.width>"u"&&(s.width=1),typeof s.height>"u"&&(s.height=1),typeof s.tiltX>"u"&&(s.tiltX=0),typeof s.tiltY>"u"&&(s.tiltY=0),typeof s.pointerType>"u"&&(s.pointerType="mouse"),typeof s.pointerId>"u"&&(s.pointerId=cp),typeof s.pressure>"u"&&(s.pressure=.5),typeof s.twist>"u"&&(s.twist=0),typeof s.tangentialPressure>"u"&&(s.tangentialPressure=0),s.isNormalized=!0,e.push(s)}else e.push(t);return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,t.type==="pointerleave"&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=up[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}}lh.extension={name:"events",type:[z.RendererSystem,z.CanvasRendererSystem]};Y.add(lh);const dp={interactive:!1,interactiveChildren:!0,hitArea:null,addEventListener(i,t,e){const s=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,n=typeof t=="function"?void 0:t;i=s?`${i}capture`:i,t=typeof t=="function"?t:t.handleEvent,this.on(i,t,n)},removeEventListener(i,t,e){const s=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,n=typeof t=="function"?void 0:t;i=s?`${i}capture`:i,t=typeof t=="function"?t:t.handleEvent,this.off(i,t,n)},dispatchEvent(i){if(!(i instanceof Ki))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return i.defaultPrevented=!1,i.path=null,i.target=this,i.manager.dispatchEvent(i),!i.defaultPrevented}};pt.mixin(dp);pt.mixin(op);const fp=9,cs=100,pp=0,mp=0,po=2,mo=1,gp=-1e3,vp=-1e3,_p=2;class ch{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(le.tablet||le.phone)&&this.createTouchHook();const e=document.createElement("div");e.style.width=`${cs}px`,e.style.height=`${cs}px`,e.style.position="absolute",e.style.top=`${pp}px`,e.style.left=`${mp}px`,e.style.zIndex=po.toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width=`${mo}px`,t.style.height=`${mo}px`,t.style.position="absolute",t.style.top=`${gp}px`,t.style.left=`${vp}px`,t.style.zIndex=_p.toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){!this._hookDiv||(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){var t;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),(t=this.renderer.view.parentNode)==null||t.appendChild(this.div))}deactivate(){var t;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),(t=this.div.parentNode)==null||t.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.interactive&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const e=t.children;if(e)for(let s=0;s<e.length;s++)this.updateAccessibleObjects(e[s])}update(){const t=performance.now();if(le.android.device&&t<this.androidUpdateCount||(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:e,y:s,width:n,height:r}=this.renderer.view.getBoundingClientRect(),{width:o,height:a,resolution:h}=this.renderer,c=n/o*h,l=r/a*h;let f=this.div;f.style.left=`${e}px`,f.style.top=`${s}px`,f.style.width=`${o}px`,f.style.height=`${a}px`;for(let d=0;d<this.children.length;d++){const u=this.children[d];if(u.renderId!==this.renderId)u._accessibleActive=!1,li(this.children,d,1),this.div.removeChild(u._accessibleDiv),this.pool.push(u._accessibleDiv),u._accessibleDiv=null,d--;else{f=u._accessibleDiv;let p=u.hitArea;const m=u.worldTransform;u.hitArea?(f.style.left=`${(m.tx+p.x*m.a)*c}px`,f.style.top=`${(m.ty+p.y*m.d)*l}px`,f.style.width=`${p.width*m.a*c}px`,f.style.height=`${p.height*m.d*l}px`):(p=u.getBounds(),this.capHitArea(p),f.style.left=`${p.x*c}px`,f.style.top=`${p.y*l}px`,f.style.width=`${p.width*c}px`,f.style.height=`${p.height*l}px`,f.title!==u.accessibleTitle&&u.accessibleTitle!==null&&(f.title=u.accessibleTitle),f.getAttribute("aria-label")!==u.accessibleHint&&u.accessibleHint!==null&&f.setAttribute("aria-label",u.accessibleHint)),(u.accessibleTitle!==f.title||u.tabIndex!==f.tabIndex)&&(f.title=u.accessibleTitle,f.tabIndex=u.tabIndex,this.debug&&this.updateDebugHTML(f))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:e,height:s}=this.renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>s&&(t.height=s-t.y)}addChild(t){let e=this.pool.pop();e||(e=document.createElement("button"),e.style.width=`${cs}px`,e.style.height=`${cs}px`,e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=po.toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&t.accessibleTitle!==null?e.title=t.accessibleTitle:(!t.accessibleHint||t.accessibleHint===null)&&(e.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&t.accessibleHint!==null&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,e){const{displayObject:s}=t.target,n=this.renderer.events.rootBoundary,r=Object.assign(new Ki(n),{target:s});n.rootTarget=this.renderer.lastObjectRendered,e.forEach(o=>n.dispatchEvent(r,o))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){t.keyCode===fp&&this.activate()}_onMouseMove(t){t.movementX===0&&t.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}ch.extension={name:"accessibility",type:[z.RendererPlugin,z.CanvasRendererPlugin]};Y.add(ch);const $n=class{constructor(i){this.stage=new ct,i=Object.assign({forceCanvas:!1},i),this.renderer=Kf(i),$n._plugins.forEach(t=>{t.init.call(this,i)})}render(){this.renderer.render(this.stage)}get view(){return this.renderer.view}get screen(){return this.renderer.screen}destroy(i,t){const e=$n._plugins.slice(0);e.reverse(),e.forEach(s=>{s.destroy.call(this)}),this.stage.destroy(t),this.stage=null,this.renderer.destroy(i),this.renderer=null}};let Er=$n;Er._plugins=[];Y.handleByList(z.Application,Er._plugins);class uh{static init(t){Object.defineProperty(this,"resizeTo",{set(e){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{!this._resizeTo||(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let e,s;if(this._resizeTo===globalThis.window)e=globalThis.innerWidth,s=globalThis.innerHeight;else{const{clientWidth:n,clientHeight:r}=this._resizeTo;e=n,s=r}this.renderer.resize(e,s),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}uh.extension=z.Application;Y.add(uh);class yp{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let s=0;s<e;s++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}const fe=(i,t)=>(Array.isArray(i)||(i=[i]),t?i.map(e=>typeof e=="string"?t(e):e):i);function dh(i,t,e,s,n){const r=t[e];for(let o=0;o<r.length;o++){const a=r[o];e<t.length-1?dh(i.replace(s[e],a),t,e+1,s,n):n.push(i.replace(s[e],a))}}function xp(i){const t=/\{(.*?)\}/g,e=i.match(t),s=[];if(e){const n=[];e.forEach(r=>{const o=r.substring(1,r.length-1).split(",");n.push(o)}),dh(i,n,0,e,s)}else s.push(i);return s}const Ms=i=>!Array.isArray(i);class wp{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){return this._cache.get(t)}set(t,e){const s=fe(t);let n;for(let a=0;a<this.parsers.length;a++){const h=this.parsers[a];if(h.test(e)){n=h.getCacheableAssets(s,e);break}}n||(n={},s.forEach(a=>{n[a]=e}));const r=Object.keys(n),o={cacheKeys:r,keys:s};if(s.forEach(a=>{this._cacheMap.set(a,o)}),r.forEach(a=>{this._cache.has(a)&&this._cache.get(a),this._cache.set(a,n[a])}),e instanceof H){const a=e;s.forEach(h=>{a.baseTexture!==H.EMPTY.baseTexture&&J.addToCache(a.baseTexture,h),H.addToCache(a,h)})}}remove(t){if(this._cacheMap.get(t),!this._cacheMap.has(t))return;const e=this._cacheMap.get(t);e.cacheKeys.forEach(n=>{this._cache.delete(n)}),e.keys.forEach(n=>{this._cacheMap.delete(n)})}get parsers(){return this._parsers}}const vi=new wp;class bp{constructor(){this._parsers=[],this.promiseCache={}}reset(){this.promiseCache={}}_getLoadPromiseAndParser(t,e){const s={promise:null,parser:null};return s.promise=(async()=>{var r,o;let n=null;for(let a=0;a<this.parsers.length;a++){const h=this.parsers[a];if(h.load&&((r=h.test)==null?void 0:r.call(h,t,e,this))){n=await h.load(t,e,this),s.parser=h;break}}if(!s.parser)return null;for(let a=0;a<this.parsers.length;a++){const h=this.parsers[a];h.parse&&h.parse&&await((o=h.testParse)==null?void 0:o.call(h,n,e,this))&&(n=await h.parse(n,e,this)||n,s.parser=h)}return n})(),s}async load(t,e){let s=0;const n={},r=Ms(t),o=fe(t,c=>({src:c})),a=o.length,h=o.map(async c=>{const l=yt.toAbsolute(c.src);if(!n[c.src])try{this.promiseCache[l]||(this.promiseCache[l]=this._getLoadPromiseAndParser(l,c)),n[c.src]=await this.promiseCache[l].promise,e&&e(++s/a)}catch(f){throw delete this.promiseCache[l],delete n[c.src],new Error(`[Loader.load] Failed to load ${l}.
${f}`)}});return await Promise.all(h),r?n[o[0].src]:n}async unload(t){const s=fe(t,n=>({src:n})).map(async n=>{var a,h;const r=yt.toAbsolute(n.src),o=this.promiseCache[r];if(o){const c=await o.promise;(h=(a=o.parser)==null?void 0:a.unload)==null||h.call(a,c,n,this),delete this.promiseCache[r]}});await Promise.all(s)}get parsers(){return this._parsers}}class Ap{constructor(){this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}prefer(...t){t.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this._preferredOrder=[],this._resolverHash={},this._assetMap={},this._rootPath=null,this._basePath=null,this._manifest=null}addManifest(t){this._manifest,this._manifest=t,t.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(t,e){const s=[];Array.isArray(e)?e.forEach(n=>{typeof n.name=="string"?s.push(n.name):s.push(...n.name),this.add(n.name,n.srcs)}):Object.keys(e).forEach(n=>{s.push(n),this.add(n,e[n])}),this._bundles[t]=s}add(t,e,s){const n=fe(t);n.forEach(o=>{this._assetMap[o]}),Array.isArray(e)||(typeof e=="string"?e=xp(e):e=[e]);const r=e.map(o=>{var h;let a=o;if(typeof o=="string"){let c=!1;for(let l=0;l<this._parsers.length;l++){const f=this._parsers[l];if(f.test(o)){a=f.parse(o),c=!0;break}}c||(a={src:o})}return a.format||(a.format=a.src.split(".").pop()),a.alias||(a.alias=n),(this._basePath||this._rootPath)&&(a.src=yt.toAbsolute(a.src,this._basePath,this._rootPath)),a.data=(h=a.data)!=null?h:s,a});n.forEach(o=>{this._assetMap[o]=r})}resolveBundle(t){const e=Ms(t);t=fe(t);const s={};return t.forEach(n=>{const r=this._bundles[n];r&&(s[n]=this.resolve(r))}),e?s[t[0]]:s}resolveUrl(t){const e=this.resolve(t);if(typeof t!="string"){const s={};for(const n in e)s[n]=e[n].src;return s}return e.src}resolve(t){const e=Ms(t);t=fe(t);const s={};return t.forEach(n=>{var r;if(!this._resolverHash[n])if(this._assetMap[n]){let o=this._assetMap[n];const a=this._getPreferredOrder(o),h=o[0];a==null||a.priority.forEach(c=>{a.params[c].forEach(l=>{const f=o.filter(d=>d[c]?d[c]===l:!1);f.length&&(o=f)})}),this._resolverHash[n]=(r=o[0])!=null?r:h}else{let o=n;(this._basePath||this._rootPath)&&(o=yt.toAbsolute(o,this._basePath,this._rootPath)),this._resolverHash[n]={src:o}}s[n]=this._resolverHash[n]}),e?s[t[0]]:s}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const s=t[0],n=this._preferredOrder.find(r=>r.params.format.includes(s.format));if(n)return n}return this._preferredOrder[0]}}class Ep{constructor(){this._detections=[],this._initialized=!1,this.resolver=new Ap,this.loader=new bp,this.cache=vi,this._backgroundLoader=new yp(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){var r,o,a,h;if(this._initialized)return;if(this._initialized=!0,t.basePath&&(this.resolver.basePath=t.basePath),t.manifest){let c=t.manifest;typeof c=="string"&&(c=await this.load(c)),this.resolver.addManifest(c)}const e=(o=(r=t.texturePreference)==null?void 0:r.resolution)!=null?o:1,s=typeof e=="number"?[e]:e;let n=[];if((a=t.texturePreference)!=null&&a.format){const c=(h=t.texturePreference)==null?void 0:h.format;n=typeof c=="string"?[c]:c;for(const l of this._detections)await l.test()||(n=await l.remove(n))}else for(const c of this._detections)await c.test()&&(n=await c.add(n));this.resolver.prefer({params:{format:n,resolution:s}})}add(t,e,s){this.resolver.add(t,e,s)}async load(t,e){this._initialized||await this.init();const s=Ms(t),n=fe(t).map(a=>typeof a!="string"?(this.resolver.add(a.src,a),a.src):a),r=this.resolver.resolve(n),o=await this._mapLoadToResolve(r,e);return s?o[n[0]]:o}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let s=!1;typeof t=="string"&&(s=!0,t=[t]);const n=this.resolver.resolveBundle(t),r={},o=Object.keys(n);let a=0,h=0;const c=()=>{e==null||e(++a/h)},l=o.map(f=>{const d=n[f];return h+=Object.keys(d).length,this._mapLoadToResolve(d,c).then(u=>{r[f]=u})});return await Promise.all(l),s?r[t[0]]:r}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach(s=>{this._backgroundLoader.add(Object.values(s))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return vi.get(t);const e={};for(let s=0;s<t.length;s++)e[s]=vi.get(t[s]);return e}async _mapLoadToResolve(t,e){const s=Object.values(t),n=Object.keys(t);this._backgroundLoader.active=!1;const r=await this.loader.load(s,e);this._backgroundLoader.active=!0;const o={};return s.forEach((a,h)=>{const c=r[a.src],l=[a.src];a.alias&&l.push(...a.alias),o[n[h]]=c,vi.set(l,c)}),o}async unload(t){this._initialized||await this.init();const e=fe(t).map(n=>typeof n!="string"?n.src:n),s=this.resolver.resolve(e);await this._unloadFromResolved(s)}async unloadBundle(t){this._initialized||await this.init(),t=fe(t);const e=this.resolver.resolveBundle(t),s=Object.keys(e).map(n=>this._unloadFromResolved(e[n]));await Promise.all(s)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach(s=>{vi.remove(s.src)}),await this.loader.unload(e)}get detections(){return this._detections}}const Ai=new Ep;Y.handleByList(z.LoadParser,Ai.loader.parsers).handleByList(z.ResolveParser,Ai.resolver.parsers).handleByList(z.CacheParser,Ai.cache.parsers).handleByList(z.DetectionParser,Ai.detections);const go={loader:z.LoadParser,resolver:z.ResolveParser,cache:z.CacheParser,detection:z.DetectionParser};Y.handle(z.Asset,i=>{const t=i.ref;Object.entries(go).filter(([e])=>!!t[e]).forEach(([e,s])=>{var n;return Y.add(Object.assign(t[e],{extension:(n=t[e].extension)!=null?n:s}))})},i=>{const t=i.ref;Object.keys(go).filter(e=>!!t[e]).forEach(e=>Y.remove(t[e]))});const Tp={extension:z.CacheParser,test:i=>Array.isArray(i)&&i.every(t=>t instanceof H),getCacheableAssets:(i,t)=>{const e={};return i.forEach(s=>{t.forEach((n,r)=>{e[s+(r===0?"":r+1)]=n})}),e}};Y.add(Tp);var jt=(i=>(i[i.Low=0]="Low",i[i.Normal=1]="Normal",i[i.High=2]="High",i))(jt||{});const Sp={extension:{type:z.LoadParser,priority:jt.Low},test(i){return yt.extname(i).includes(".json")},async load(i){return await(await O.ADAPTER.fetch(i)).json()}};Y.add(Sp);const Cp={extension:{type:z.LoadParser,priority:jt.Low},test(i){return yt.extname(i).includes(".txt")},async load(i){return await(await O.ADAPTER.fetch(i)).text()}};Y.add(Cp);const Ip=["normal","bold","100","200","300","400","500","600","700","800","900"],Pp=["woff","woff2","ttf","otf"];function Rp(i){const t=yt.extname(i);return yt.basename(i,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(r=>r.charAt(0).toUpperCase()+r.slice(1)).join(" ")}const Mp={extension:{type:z.LoadParser,priority:jt.Low},test(i){const e=i.split("?")[0].split(".").pop();return Pp.includes(e)},async load(i,t){var s,n,r,o,a,h;if(!globalThis.navigator.onLine)throw new Error("[loadWebFont] Cannot load font - navigator is offline");const e=O.ADAPTER.getFontFaceSet();if(e){const c=[],l=(n=(s=t.data)==null?void 0:s.family)!=null?n:Rp(i),f=(a=(o=(r=t.data)==null?void 0:r.weights)==null?void 0:o.filter(u=>Ip.includes(u)))!=null?a:["normal"],d=(h=t.data)!=null?h:{};for(let u=0;u<f.length;u++){const p=f[u],m=new FontFace(l,`url(${i})`,{...d,weight:p});await m.load(),e.add(m),c.push(m)}return c.length===1?c[0]:c}return null},unload(i){(Array.isArray(i)?i:[i]).forEach(t=>O.ADAPTER.getFontFaceSet().delete(t))}};Y.add(Mp);let vo=0,yn;const Bp="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",Dp={id:"checkImageBitmap",code:`
    async function checkImageBitmap()
    {
        try
        {
            if (typeof createImageBitmap !== 'function') return false;

            const response = await fetch('${Bp}');
            const imageBlob =  await response.blob();
            const imageBitmap = await createImageBitmap(imageBlob);

            return imageBitmap.width === 1 && imageBitmap.height === 1;
        }
        catch (e)
        {
            return false;
        }
    }
    checkImageBitmap().then((result) => { self.postMessage(result); });
    `},Fp={id:"loadImageBitmap",code:`
    async function loadImageBitmap(url)
    {
        const response = await fetch(url);

        if (!response.ok)
        {
            throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \`
                + \`\${response.status} \${response.statusText}\`);
        }

        const imageBlob =  await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);

        return imageBitmap;
    }
    self.onmessage = async (event) =>
    {
        try
        {
            const imageBitmap = await loadImageBitmap(event.data.data[0]);

            self.postMessage({
                data: imageBitmap,
                uuid: event.data.uuid,
                id: event.data.id,
            }, [imageBitmap]);
        }
        catch(e)
        {
            self.postMessage({
                error: e,
                uuid: event.data.uuid,
                id: event.data.id,
            });
        }
    };`};let xn;class Lp{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const e=URL.createObjectURL(new Blob([Dp.code],{type:"application/javascript"})),s=new Worker(e);s.addEventListener("message",n=>{s.terminate(),URL.revokeObjectURL(e),t(n.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){yn===void 0&&(yn=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<yn&&(xn||(xn=URL.createObjectURL(new Blob([Fp.code],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(xn),t.addEventListener("message",e=>{this.complete(e.data),this.returnWorker(e.target),this.next()})),t}returnWorker(t){this.workerPool.push(t)}complete(t){t.error!==void 0?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();const s=new Promise((n,r)=>{this.queue.push({id:t,arguments:e,resolve:n,reject:r})});return this.next(),s}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const e=this.queue.pop(),s=e.id;this.resolveHash[vo]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:vo++,id:s})}}const _o=new Lp;function Tr(i,t){const e=i.split("?")[0],s=yt.extname(e).toLowerCase();return Array.isArray(t)?t.includes(s.toLowerCase()):s.toLowerCase()===t}function $s(i,t,e){const s=new H(i);return s.baseTexture.on("dispose",()=>{delete t.promiseCache[e]}),s}const wn=[".jpg",".png",".jpeg",".avif",".webp"];async function kp(i){const t=await O.ADAPTER.fetch(i);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${i}: ${t.status} ${t.statusText}`);const e=await t.blob();return await createImageBitmap(e)}const Sr={extension:{type:z.LoadParser,priority:jt.High},config:{preferWorkers:!0},test(i){let t=!1;for(let e=0;e<wn.length;e++)if(i.startsWith(`data:image/${wn[e].slice(1)}`)){t=!0;break}return t||Tr(i,wn)},async load(i,t,e){let s=null;globalThis.createImageBitmap?this.config.preferWorkers&&await _o.isImageBitmapSupported()?s=await _o.loadImageBitmap(i):s=await kp(i):s=await new Promise(r=>{s=new Image,s.crossOrigin="anonymous",s.src=i,s.complete?r(s):s.onload=()=>{r(s)}});const n=new J(s,{resolution:xe(i),...t.data});return n.resource.src=i,$s(n,e,i)},unload(i){i.destroy(!0)}};Y.add(Sr);z.LoadParser,jt.High,Sr.unload;const Op={extension:z.ResolveParser,test:Sr.test,parse:i=>{var t,e;return{resolution:parseFloat((e=(t=O.RETINA_PREFIX.exec(i))==null?void 0:t[1])!=null?e:"1"),format:i.split(".").pop(),src:i}}};Y.add(Op);const Up={extension:{type:z.DetectionParser,priority:1},test:async()=>{if(!globalThis.createImageBitmap)return!1;const i="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=",t=await O.ADAPTER.fetch(i).then(e=>e.blob());return createImageBitmap(t).then(()=>!0,()=>!1)},add:async i=>[...i,"avif"],remove:async i=>i.filter(t=>t!=="avif")};Y.add(Up);const Np={extension:{type:z.DetectionParser,priority:0},test:async()=>{if(!globalThis.createImageBitmap)return!1;const i="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=",t=await O.ADAPTER.fetch(i).then(e=>e.blob());return createImageBitmap(t).then(()=>!0,()=>!1)},add:async i=>[...i,"webp"],remove:async i=>i.filter(t=>t!=="webp")};Y.add(Np);const yo=["png","jpg","jpeg"],Gp={extension:{type:z.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async i=>[...i,...yo],remove:async i=>i.filter(t=>!yo.includes(t))};Y.add(Gp);var Bt=(i=>(i[i.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",i[i.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",i[i.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",i[i.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",i[i.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",i[i.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",i[i.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",i[i.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",i[i.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",i[i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",i[i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",i[i.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",i[i.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",i))(Bt||{});const Bs={[33776]:.5,[33777]:.5,[33778]:1,[33779]:1,[35916]:.5,[35917]:.5,[35918]:1,[35919]:1,[37488]:.5,[37489]:.5,[37490]:1,[37491]:1,[37492]:.5,[37496]:1,[37493]:.5,[37497]:1,[37494]:.5,[37495]:.5,[35840]:.5,[35842]:.5,[35841]:.25,[35843]:.25,[36196]:.5,[35986]:.5,[35986]:1,[34798]:1,[37808]:1};class Hp extends Yi{constructor(t,e={width:1,height:1,autoLoad:!0}){let s,n;typeof t=="string"?(s=t,n=new Uint8Array):(s=null,n=t),super(n,e),this.origin=s,this.buffer=n?new Zn(n):null,this.origin&&e.autoLoad!==!1&&this.load(),n!=null&&n.length&&(this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}async load(){const s=await(await(await fetch(this.origin)).blob()).arrayBuffer();return this.data=new Uint32Array(s),this.buffer=new Zn(s),this.loaded=!0,this.onBlobLoaded(s),this.update(),this}}class Ue extends Hp{constructor(t,e){super(t,e),this.format=e.format,this.levels=e.levels||1,this._width=e.width,this._height=e.height,this._extension=Ue._formatToExtension(this.format),(e.levelBuffers||this.buffer)&&(this._levelBuffers=e.levelBuffers||Ue._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,e,s){const n=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;for(let o=0,a=this.levels;o<a;o++){const{levelID:h,levelWidth:c,levelHeight:l,levelBuffer:f}=this._levelBuffers[o];n.compressedTexImage2D(n.TEXTURE_2D,h,this.format,c,l,0,f)}return!0}onBlobLoaded(){this._levelBuffers=Ue._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(t,e,s,n,r,o,a){const h=new Array(s);let c=t.byteOffset,l=o,f=a,d=l+n-1&~(n-1),u=f+r-1&~(r-1),p=d*u*Bs[e];for(let m=0;m<s;m++)h[m]={levelID:m,levelWidth:s>1?l:d,levelHeight:s>1?f:u,levelBuffer:new Uint8Array(t.buffer,c,p)},c+=p,l=l>>1||1,f=f>>1||1,d=l+n-1&~(n-1),u=f+r-1&~(r-1),p=d*u*Bs[e];return h}}let he,Ke;function xo(){Ke={s3tc:he.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:he.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:he.getExtension("WEBGL_compressed_texture_etc"),etc1:he.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:he.getExtension("WEBGL_compressed_texture_pvrtc")||he.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:he.getExtension("WEBGL_compressed_texture_atc"),astc:he.getExtension("WEBGL_compressed_texture_astc")}}const zp={extension:{type:z.DetectionParser,priority:2},test:async()=>{const t=O.ADAPTER.createCanvas().getContext("webgl");return t?(he=t,!0):!1},add:async i=>{Ke||xo();const t=[];for(const e in Ke)!Ke[e]||t.push(e);return[...t,...i]},remove:async i=>(Ke||xo(),i.filter(t=>!(t in Ke)))};Y.add(zp);const bn=4,us=124,Vp=32,wo=20,Xp=542327876,ds={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},Wp={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},fs={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},jp=1,Yp=2,Kp=4,Zp=64,Qp=512,$p=131072,qp=827611204,Jp=861165636,tm=894720068,em=808540228,im=4,sm={[qp]:Bt.COMPRESSED_RGBA_S3TC_DXT1_EXT,[Jp]:Bt.COMPRESSED_RGBA_S3TC_DXT3_EXT,[tm]:Bt.COMPRESSED_RGBA_S3TC_DXT5_EXT},nm={[70]:Bt.COMPRESSED_RGBA_S3TC_DXT1_EXT,[71]:Bt.COMPRESSED_RGBA_S3TC_DXT1_EXT,[73]:Bt.COMPRESSED_RGBA_S3TC_DXT3_EXT,[74]:Bt.COMPRESSED_RGBA_S3TC_DXT3_EXT,[76]:Bt.COMPRESSED_RGBA_S3TC_DXT5_EXT,[77]:Bt.COMPRESSED_RGBA_S3TC_DXT5_EXT,[72]:Bt.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,[75]:Bt.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,[78]:Bt.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT};function rm(i){const t=new Uint32Array(i);if(t[0]!==Xp)throw new Error("Invalid DDS file magic word");const s=new Uint32Array(i,0,us/Uint32Array.BYTES_PER_ELEMENT),n=s[ds.HEIGHT],r=s[ds.WIDTH],o=s[ds.MIPMAP_COUNT],a=new Uint32Array(i,ds.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,Vp/Uint32Array.BYTES_PER_ELEMENT),h=a[jp];if(h&Kp){const c=a[Wp.FOURCC];if(c!==em){const y=sm[c],v=bn+us,x=new Uint8Array(i,v);return[new Ue(x,{format:y,width:r,height:n,levels:o})]}const l=bn+us,f=new Uint32Array(t.buffer,l,wo/Uint32Array.BYTES_PER_ELEMENT),d=f[fs.DXGI_FORMAT],u=f[fs.RESOURCE_DIMENSION],p=f[fs.MISC_FLAG],m=f[fs.ARRAY_SIZE],g=nm[d];if(g===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${d}`);if(p===im)throw new Error("DDSParser does not support cubemap textures");if(u===6)throw new Error("DDSParser does not supported 3D texture data");const _=new Array,A=bn+us+wo;if(m===1)_.push(new Uint8Array(i,A));else{const y=Bs[g];let v=0,x=r,b=n;for(let E=0;E<o;E++){const S=Math.max(1,x+3&-4),C=Math.max(1,b+3&-4),T=S*C*y;v+=T,x=x>>>1,b=b>>>1}let w=A;for(let E=0;E<m;E++)_.push(new Uint8Array(i,w,v)),w+=v}return _.map(y=>new Ue(y,{format:g,width:r,height:n,levels:o}))}throw h&Zp?new Error("DDSParser does not support uncompressed texture data."):h&Qp?new Error("DDSParser does not supported YUV uncompressed texture data."):h&$p?new Error("DDSParser does not support single-channel (lumninance) texture data!"):h&Yp?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}const bo=[171,75,84,88,32,49,49,187,13,10,26,10],om=67305985,Ot={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},qn=64,Ao={[Z.UNSIGNED_BYTE]:1,[Z.UNSIGNED_SHORT]:2,[Z.INT]:4,[Z.UNSIGNED_INT]:4,[Z.FLOAT]:4,[Z.HALF_FLOAT]:8},am={[U.RGBA]:4,[U.RGB]:3,[U.RG]:2,[U.RED]:1,[U.LUMINANCE]:1,[U.LUMINANCE_ALPHA]:2,[U.ALPHA]:1},hm={[Z.UNSIGNED_SHORT_4_4_4_4]:2,[Z.UNSIGNED_SHORT_5_5_5_1]:2,[Z.UNSIGNED_SHORT_5_6_5]:2};function lm(i,t,e=!1){const s=new DataView(t);if(!cm(i,s))return null;const n=s.getUint32(Ot.ENDIANNESS,!0)===om,r=s.getUint32(Ot.GL_TYPE,n),o=s.getUint32(Ot.GL_FORMAT,n),a=s.getUint32(Ot.GL_INTERNAL_FORMAT,n),h=s.getUint32(Ot.PIXEL_WIDTH,n),c=s.getUint32(Ot.PIXEL_HEIGHT,n)||1,l=s.getUint32(Ot.PIXEL_DEPTH,n)||1,f=s.getUint32(Ot.NUMBER_OF_ARRAY_ELEMENTS,n)||1,d=s.getUint32(Ot.NUMBER_OF_FACES,n),u=s.getUint32(Ot.NUMBER_OF_MIPMAP_LEVELS,n),p=s.getUint32(Ot.BYTES_OF_KEY_VALUE_DATA,n);if(c===0||l!==1)throw new Error("Only 2D textures are supported");if(d!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(f!==1)throw new Error("WebGL does not support array textures");const m=4,g=4,_=h+3&-4,A=c+3&-4,y=new Array(f);let v=h*c;r===0&&(v=_*A);let x;if(r!==0?Ao[r]?x=Ao[r]*am[o]:x=hm[r]:x=Bs[a],x===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const b=e?dm(s,p,n):null;let E=v*x,S=h,C=c,T=_,I=A,P=qn+p;for(let R=0;R<u;R++){const L=s.getUint32(P,n);let k=P+4;for(let F=0;F<f;F++){let W=y[F];W||(W=y[F]=new Array(u)),W[R]={levelID:R,levelWidth:u>1||r!==0?S:T,levelHeight:u>1||r!==0?C:I,levelBuffer:new Uint8Array(t,k,E)},k+=E}P+=L+4,P=P%4!==0?P+4-P%4:P,S=S>>1||1,C=C>>1||1,T=S+m-1&~(m-1),I=C+g-1&~(g-1),E=T*I*x}return r!==0?{uncompressed:y.map(R=>{let L=R[0].levelBuffer,k=!1;return r===Z.FLOAT?L=new Float32Array(R[0].levelBuffer.buffer,R[0].levelBuffer.byteOffset,R[0].levelBuffer.byteLength/4):r===Z.UNSIGNED_INT?(k=!0,L=new Uint32Array(R[0].levelBuffer.buffer,R[0].levelBuffer.byteOffset,R[0].levelBuffer.byteLength/4)):r===Z.INT&&(k=!0,L=new Int32Array(R[0].levelBuffer.buffer,R[0].levelBuffer.byteOffset,R[0].levelBuffer.byteLength/4)),{resource:new Yi(L,{width:R[0].levelWidth,height:R[0].levelHeight}),type:r,format:k?um(o):o}}),kvData:b}:{compressed:y.map(R=>new Ue(null,{format:a,width:h,height:c,levels:u,levelBuffers:R})),kvData:b}}function cm(i,t){for(let e=0;e<bo.length;e++)if(t.getUint8(e)!==bo[e])return!1;return!0}function um(i){switch(i){case U.RGBA:return U.RGBA_INTEGER;case U.RGB:return U.RGB_INTEGER;case U.RG:return U.RG_INTEGER;case U.RED:return U.RED_INTEGER;default:return i}}function dm(i,t,e){const s=new Map;let n=0;for(;n<t;){const r=i.getUint32(qn+n,e),o=qn+n+4,a=3-(r+3)%4;if(r===0||r>t-n){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let h=0;for(;h<r&&i.getUint8(o+h)!==0;h++);if(h===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const c=new TextDecoder().decode(new Uint8Array(i.buffer,o,h)),l=new DataView(i.buffer,o+h+1,r-h-1);s.set(c,l),n+=4+r+a}return s}const fm={extension:{type:z.LoadParser,priority:jt.High},test(i){return Tr(i,".dds")},async load(i,t,e){const n=await(await O.ADAPTER.fetch(i)).arrayBuffer(),o=rm(n).map(a=>{const h=new J(a,{mipmap:se.OFF,alphaMode:Wt.NO_PREMULTIPLIED_ALPHA,resolution:xe(i),...t.data});return $s(h,e,i)});return o.length===1?o[0]:o},unload(i){Array.isArray(i)?i.forEach(t=>t.destroy(!0)):i.destroy(!0)}};Y.add(fm);const pm={extension:{type:z.LoadParser,priority:jt.High},test(i){return Tr(i,".ktx")},async load(i,t,e){const n=await(await O.ADAPTER.fetch(i)).arrayBuffer(),{compressed:r,uncompressed:o,kvData:a}=lm(i,n),h=r!=null?r:o,c={mipmap:se.OFF,alphaMode:Wt.NO_PREMULTIPLIED_ALPHA,resolution:xe(i),...t.data},l=h.map(f=>{h===o&&Object.assign(c,{type:f.type,format:f.format});const d=new J(f,c);return d.ktxKeyValueData=a,$s(d,e,i)});return l.length===1?l[0]:l},unload(i){Array.isArray(i)?i.forEach(t=>t.destroy(!0)):i.destroy(!0)}};Y.add(pm);const mm={extension:z.ResolveParser,test:i=>{const e=i.split("?")[0].split(".").pop();return["basis","ktx","dds"].includes(e)},parse:i=>{var s,n,r,o;if(i.split("?")[0].split(".").pop()==="ktx"){const a=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(a.some(h=>i.endsWith(h)))return{resolution:parseFloat((n=(s=O.RETINA_PREFIX.exec(i))==null?void 0:s[1])!=null?n:"1"),format:a.find(h=>i.endsWith(h)),src:i}}return{resolution:parseFloat((o=(r=O.RETINA_PREFIX.exec(i))==null?void 0:r[1])!=null?o:"1"),format:i.split(".").pop(),src:i}}};Y.add(mm);const Eo=new q,To=4,Jn=class{constructor(i){this.renderer=i}async image(i,t,e){const s=new Image;return s.src=await this.base64(i,t,e),s}async base64(i,t,e){const s=this.canvas(i);if(s.toDataURL!==void 0)return s.toDataURL(t,e);if(s.convertToBlob!==void 0){const n=await s.convertToBlob({type:t,quality:e});return await new Promise(r=>{const o=new FileReader;o.onload=()=>r(o.result),o.readAsDataURL(n)})}throw new Error("Extract.base64() requires ICanvas.toDataURL or ICanvas.convertToBlob to be implemented")}canvas(i,t){const e=this.renderer;let s,n=!1,r,o=!1;i&&(i instanceof be?r=i:(r=this.renderer.generateTexture(i),o=!0)),r?(s=r.baseTexture.resolution,t=t!=null?t:r.frame,n=!1,e.renderTexture.bind(r)):(s=e.resolution,t||(t=Eo,t.width=e.width,t.height=e.height),n=!0,e.renderTexture.bind(null));const a=Math.round(t.width*s),h=Math.round(t.height*s);let c=new eo(a,h,1);const l=new Uint8Array(To*a*h),f=e.gl;f.readPixels(Math.round(t.x*s),Math.round(t.y*s),a,h,f.RGBA,f.UNSIGNED_BYTE,l);const d=c.context.getImageData(0,0,a,h);if(Jn.arrayPostDivide(l,d.data),c.context.putImageData(d,0,0),n){const u=new eo(c.width,c.height,1);u.context.scale(1,-1),u.context.drawImage(c.canvas,0,-h),c.destroy(),c=u}return o&&r.destroy(!0),c.canvas}pixels(i,t){const e=this.renderer;let s,n,r=!1;i&&(i instanceof be?n=i:(n=this.renderer.generateTexture(i),r=!0)),n?(s=n.baseTexture.resolution,t=t!=null?t:n.frame,e.renderTexture.bind(n)):(s=e.resolution,t||(t=Eo,t.width=e.width,t.height=e.height),e.renderTexture.bind(null));const o=Math.round(t.width*s),a=Math.round(t.height*s),h=new Uint8Array(To*o*a),c=e.gl;return c.readPixels(Math.round(t.x*s),Math.round(t.y*s),o,a,c.RGBA,c.UNSIGNED_BYTE,h),r&&n.destroy(!0),Jn.arrayPostDivide(h,h),h}destroy(){this.renderer=null}static arrayPostDivide(i,t){for(let e=0;e<i.length;e+=4){const s=t[e+3]=i[e+3];s!==0?(t[e]=Math.round(Math.min(i[e]*255/s,255)),t[e+1]=Math.round(Math.min(i[e+1]*255/s,255)),t[e+2]=Math.round(Math.min(i[e+2]*255/s,255))):(t[e]=i[e],t[e+1]=i[e+1],t[e+2]=i[e+2])}}};let fh=Jn;fh.extension={name:"extract",type:z.RendererSystem};Y.add(fh);var ge=(i=>(i.MITER="miter",i.BEVEL="bevel",i.ROUND="round",i))(ge||{}),Oe=(i=>(i.BUTT="butt",i.ROUND="round",i.SQUARE="square",i))(Oe||{});const Hi={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(i,t=20){if(!this.adaptive||!i||isNaN(i))return t;let e=Math.ceil(i/this.maxLength);return e<this.minSegments?e=this.minSegments:e>this.maxSegments&&(e=this.maxSegments),e}};class qs{constructor(){this.color=16777215,this.alpha=1,this.texture=H.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new qs;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=H.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}function So(i,t=!1){const e=i.length;if(e<6)return;let s=0;for(let n=0,r=i[e-2],o=i[e-1];n<e;n+=2){const a=i[n],h=i[n+1];s+=(a-r)*(h+o),r=a,o=h}if(!t&&s>0||t&&s<=0){const n=e/2;for(let r=n+n%2;r<e;r+=2){const o=e-r-2,a=e-r-1,h=r,c=r+1;[i[o],i[h]]=[i[h],i[o]],[i[a],i[c]]=[i[c],i[a]]}}}const ph={build(i){i.points=i.shape.points.slice()},triangulate(i,t){let e=i.points;const s=i.holes,n=t.points,r=t.indices;if(e.length>=6){So(e,!1);const o=[];for(let c=0;c<s.length;c++){const l=s[c];So(l.points,!0),o.push(e.length/2),e=e.concat(l.points)}const a=yr.exports(e,o,2);if(!a)return;const h=n.length/2;for(let c=0;c<a.length;c+=3)r.push(a[c]+h),r.push(a[c+1]+h),r.push(a[c+2]+h);for(let c=0;c<e.length;c++)n.push(e[c])}}},Ds={build(i){const t=i.points;let e,s,n,r,o,a;if(i.type===St.CIRC){const p=i.shape;e=p.x,s=p.y,o=a=p.radius,n=r=0}else if(i.type===St.ELIP){const p=i.shape;e=p.x,s=p.y,o=p.width,a=p.height,n=r=0}else{const p=i.shape,m=p.width/2,g=p.height/2;e=p.x+m,s=p.y+g,o=a=Math.max(0,Math.min(p.radius,Math.min(m,g))),n=m-o,r=g-a}if(!(o>=0&&a>=0&&n>=0&&r>=0)){t.length=0;return}const h=Math.ceil(2.3*Math.sqrt(o+a)),c=h*8+(n?4:0)+(r?4:0);if(t.length=c,c===0)return;if(h===0){t.length=8,t[0]=t[6]=e+n,t[1]=t[3]=s+r,t[2]=t[4]=e-n,t[5]=t[7]=s-r;return}let l=0,f=h*4+(n?2:0)+2,d=f,u=c;{const p=n+o,m=r,g=e+p,_=e-p,A=s+m;if(t[l++]=g,t[l++]=A,t[--f]=A,t[--f]=_,r){const y=s-m;t[d++]=_,t[d++]=y,t[--u]=y,t[--u]=g}}for(let p=1;p<h;p++){const m=Math.PI/2*(p/h),g=n+Math.cos(m)*o,_=r+Math.sin(m)*a,A=e+g,y=e-g,v=s+_,x=s-_;t[l++]=A,t[l++]=v,t[--f]=v,t[--f]=y,t[d++]=y,t[d++]=x,t[--u]=x,t[--u]=A}{const p=n,m=r+a,g=e+p,_=e-p,A=s+m,y=s-m;t[l++]=g,t[l++]=A,t[--u]=y,t[--u]=g,n&&(t[l++]=_,t[l++]=A,t[--u]=y,t[--u]=_)}},triangulate(i,t){const e=i.points,s=t.points,n=t.indices;if(e.length===0)return;let r=s.length/2;const o=r;let a,h;if(i.type!==St.RREC){const l=i.shape;a=l.x,h=l.y}else{const l=i.shape;a=l.x+l.width/2,h=l.y+l.height/2}const c=i.matrix;s.push(i.matrix?c.a*a+c.c*h+c.tx:a,i.matrix?c.b*a+c.d*h+c.ty:h),r++,s.push(e[0],e[1]);for(let l=2;l<e.length;l+=2)s.push(e[l],e[l+1]),n.push(r++,o,r);n.push(o+1,o,r)}},gm={build(i){const t=i.shape,e=t.x,s=t.y,n=t.width,r=t.height,o=i.points;o.length=0,n>=0&&r>=0&&o.push(e,s,e+n,s,e+n,s+r,e,s+r)},triangulate(i,t){const e=i.points,s=t.points;if(e.length===0)return;const n=s.length/2;s.push(e[0],e[1],e[2],e[3],e[6],e[7],e[4],e[5]),t.indices.push(n,n+1,n+2,n+1,n+2,n+3)}},vm={build(i){Ds.build(i)},triangulate(i,t){Ds.triangulate(i,t)}};function Co(i,t,e,s,n,r,o,a){const h=i-e*n,c=t-s*n,l=i+e*r,f=t+s*r;let d,u;o?(d=s,u=-e):(d=-s,u=e);const p=h+d,m=c+u,g=l+d,_=f+u;return a.push(p,m),a.push(g,_),2}function Re(i,t,e,s,n,r,o,a){const h=e-i,c=s-t;let l=Math.atan2(h,c),f=Math.atan2(n-i,r-t);a&&l<f?l+=Math.PI*2:!a&&l>f&&(f+=Math.PI*2);let d=l;const u=f-l,p=Math.abs(u),m=Math.sqrt(h*h+c*c),g=(15*p*Math.sqrt(m)/Math.PI>>0)+1,_=u/g;if(d+=_,a){o.push(i,t),o.push(e,s);for(let A=1,y=d;A<g;A++,y+=_)o.push(i,t),o.push(i+Math.sin(y)*m,t+Math.cos(y)*m);o.push(i,t),o.push(n,r)}else{o.push(e,s),o.push(i,t);for(let A=1,y=d;A<g;A++,y+=_)o.push(i+Math.sin(y)*m,t+Math.cos(y)*m),o.push(i,t);o.push(n,r),o.push(i,t)}return g*2}function _m(i,t){const e=i.shape;let s=i.points||e.points.slice();const n=t.closePointEps;if(s.length===0)return;const r=i.lineStyle,o=new G(s[0],s[1]),a=new G(s[s.length-2],s[s.length-1]),h=e.type!==St.POLY||e.closeStroke,c=Math.abs(o.x-a.x)<n&&Math.abs(o.y-a.y)<n;if(h){s=s.slice(),c&&(s.pop(),s.pop(),a.set(s[s.length-2],s[s.length-1]));const F=(o.x+a.x)*.5,W=(a.y+o.y)*.5;s.unshift(F,W),s.push(F,W)}const l=t.points,f=s.length/2;let d=s.length;const u=l.length/2,p=r.width/2,m=p*p,g=r.miterLimit*r.miterLimit;let _=s[0],A=s[1],y=s[2],v=s[3],x=0,b=0,w=-(A-v),E=_-y,S=0,C=0,T=Math.sqrt(w*w+E*E);w/=T,E/=T,w*=p,E*=p;const I=r.alignment,P=(1-I)*2,R=I*2;h||(r.cap===Oe.ROUND?d+=Re(_-w*(P-R)*.5,A-E*(P-R)*.5,_-w*P,A-E*P,_+w*R,A+E*R,l,!0)+2:r.cap===Oe.SQUARE&&(d+=Co(_,A,w,E,P,R,!0,l))),l.push(_-w*P,A-E*P),l.push(_+w*R,A+E*R);for(let F=1;F<f-1;++F){_=s[(F-1)*2],A=s[(F-1)*2+1],y=s[F*2],v=s[F*2+1],x=s[(F+1)*2],b=s[(F+1)*2+1],w=-(A-v),E=_-y,T=Math.sqrt(w*w+E*E),w/=T,E/=T,w*=p,E*=p,S=-(v-b),C=y-x,T=Math.sqrt(S*S+C*C),S/=T,C/=T,S*=p,C*=p;const W=y-_,j=A-v,B=y-x,V=b-v,K=W*B+j*V,Q=j*B-V*W,tt=Q<0;if(Math.abs(Q)<.001*Math.abs(K)){l.push(y-w*P,v-E*P),l.push(y+w*R,v+E*R),K>=0&&(r.join===ge.ROUND?d+=Re(y,v,y-w*P,v-E*P,y-S*P,v-C*P,l,!1)+4:d+=2,l.push(y-S*R,v-C*R),l.push(y+S*P,v+C*P));continue}const nt=(-w+_)*(-E+v)-(-w+y)*(-E+A),it=(-S+x)*(-C+v)-(-S+y)*(-C+b),rt=(W*it-B*nt)/Q,At=(V*nt-j*it)/Q,Tt=(rt-y)*(rt-y)+(At-v)*(At-v),xt=y+(rt-y)*P,ot=v+(At-v)*P,at=y-(rt-y)*R,mt=v-(At-v)*R,Pt=Math.min(W*W+j*j,B*B+V*V),Mt=tt?P:R,me=Pt+Mt*Mt*m;Tt<=me?r.join===ge.BEVEL||Tt/m>g?(tt?(l.push(xt,ot),l.push(y+w*R,v+E*R),l.push(xt,ot),l.push(y+S*R,v+C*R)):(l.push(y-w*P,v-E*P),l.push(at,mt),l.push(y-S*P,v-C*P),l.push(at,mt)),d+=2):r.join===ge.ROUND?tt?(l.push(xt,ot),l.push(y+w*R,v+E*R),d+=Re(y,v,y+w*R,v+E*R,y+S*R,v+C*R,l,!0)+4,l.push(xt,ot),l.push(y+S*R,v+C*R)):(l.push(y-w*P,v-E*P),l.push(at,mt),d+=Re(y,v,y-w*P,v-E*P,y-S*P,v-C*P,l,!1)+4,l.push(y-S*P,v-C*P),l.push(at,mt)):(l.push(xt,ot),l.push(at,mt)):(l.push(y-w*P,v-E*P),l.push(y+w*R,v+E*R),r.join===ge.ROUND?tt?d+=Re(y,v,y+w*R,v+E*R,y+S*R,v+C*R,l,!0)+2:d+=Re(y,v,y-w*P,v-E*P,y-S*P,v-C*P,l,!1)+2:r.join===ge.MITER&&Tt/m<=g&&(tt?(l.push(at,mt),l.push(at,mt)):(l.push(xt,ot),l.push(xt,ot)),d+=2),l.push(y-S*P,v-C*P),l.push(y+S*R,v+C*R),d+=2)}_=s[(f-2)*2],A=s[(f-2)*2+1],y=s[(f-1)*2],v=s[(f-1)*2+1],w=-(A-v),E=_-y,T=Math.sqrt(w*w+E*E),w/=T,E/=T,w*=p,E*=p,l.push(y-w*P,v-E*P),l.push(y+w*R,v+E*R),h||(r.cap===Oe.ROUND?d+=Re(y-w*(P-R)*.5,v-E*(P-R)*.5,y-w*P,v-E*P,y+w*R,v+E*R,l,!1)+2:r.cap===Oe.SQUARE&&(d+=Co(y,v,w,E,P,R,!1,l)));const L=t.indices,k=Hi.epsilon*Hi.epsilon;for(let F=u;F<d+u-2;++F)_=l[F*2],A=l[F*2+1],y=l[(F+1)*2],v=l[(F+1)*2+1],x=l[(F+2)*2],b=l[(F+2)*2+1],!(Math.abs(_*(v-b)+y*(b-A)+x*(A-v))<k)&&L.push(F,F+1,F+2)}function ym(i,t){let e=0;const s=i.shape,n=i.points||s.points,r=s.type!==St.POLY||s.closeStroke;if(n.length===0)return;const o=t.points,a=t.indices,h=n.length/2,c=o.length/2;let l=c;for(o.push(n[0],n[1]),e=1;e<h;e++)o.push(n[e*2],n[e*2+1]),a.push(l,l+1),l++;r&&a.push(l,c)}function Io(i,t){i.lineStyle.native?ym(i,t):_m(i,t)}class Po{static curveTo(t,e,s,n,r,o){const a=o[o.length-2],c=o[o.length-1]-e,l=a-t,f=n-e,d=s-t,u=Math.abs(c*d-l*f);if(u<1e-8||r===0)return(o[o.length-2]!==t||o[o.length-1]!==e)&&o.push(t,e),null;const p=c*c+l*l,m=f*f+d*d,g=c*f+l*d,_=r*Math.sqrt(p)/u,A=r*Math.sqrt(m)/u,y=_*g/p,v=A*g/m,x=_*d+A*l,b=_*f+A*c,w=l*(A+y),E=c*(A+y),S=d*(_+v),C=f*(_+v),T=Math.atan2(E-b,w-x),I=Math.atan2(C-b,S-x);return{cx:x+t,cy:b+e,radius:r,startAngle:T,endAngle:I,anticlockwise:l*f>d*c}}static arc(t,e,s,n,r,o,a,h,c){const l=a-o,f=Hi._segmentsCount(Math.abs(l)*r,Math.ceil(Math.abs(l)/Ss)*40),d=l/(f*2),u=d*2,p=Math.cos(d),m=Math.sin(d),g=f-1,_=g%1/g;for(let A=0;A<=g;++A){const y=A+_*A,v=d+o+u*y,x=Math.cos(v),b=-Math.sin(v);c.push((p*x+m*b)*r+s,(p*-b+m*x)*r+n)}}}class Cr{static curveLength(t,e,s,n,r,o,a,h){let l=0,f=0,d=0,u=0,p=0,m=0,g=0,_=0,A=0,y=0,v=0,x=t,b=e;for(let w=1;w<=10;++w)f=w/10,d=f*f,u=d*f,p=1-f,m=p*p,g=m*p,_=g*t+3*m*f*s+3*p*d*r+u*a,A=g*e+3*m*f*n+3*p*d*o+u*h,y=x-_,v=b-A,x=_,b=A,l+=Math.sqrt(y*y+v*v);return l}static curveTo(t,e,s,n,r,o,a){const h=a[a.length-2],c=a[a.length-1];a.length-=2;const l=Hi._segmentsCount(Cr.curveLength(h,c,t,e,s,n,r,o));let f=0,d=0,u=0,p=0,m=0;a.push(h,c);for(let g=1,_=0;g<=l;++g)_=g/l,f=1-_,d=f*f,u=d*f,p=_*_,m=p*_,a.push(u*h+3*d*_*t+3*f*p*s+m*r,u*c+3*d*_*e+3*f*p*n+m*o)}}class Ir{static curveLength(t,e,s,n,r,o){const a=t-2*s+r,h=e-2*n+o,c=2*s-2*t,l=2*n-2*e,f=4*(a*a+h*h),d=4*(a*c+h*l),u=c*c+l*l,p=2*Math.sqrt(f+d+u),m=Math.sqrt(f),g=2*f*m,_=2*Math.sqrt(u),A=d/m;return(g*p+m*d*(p-_)+(4*u*f-d*d)*Math.log((2*m+A+p)/(A+_)))/(4*g)}static curveTo(t,e,s,n,r){const o=r[r.length-2],a=r[r.length-1],h=Hi._segmentsCount(Ir.curveLength(o,a,t,e,s,n));let c=0,l=0;for(let f=1;f<=h;++f){const d=f/h;c=o+(t-o)*d,l=a+(e-a)*d,r.push(c+(t+(s-t)*d-c)*d,l+(e+(n-e)*d-l)*d)}}}class xm{constructor(){this.reset()}begin(t,e,s){this.reset(),this.style=t,this.start=e,this.attribStart=s}end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}const An={[St.POLY]:ph,[St.CIRC]:Ds,[St.ELIP]:Ds,[St.RECT]:gm,[St.RREC]:vm},Ro=[],ps=[];class Fs{constructor(t,e=null,s=null,n=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=s,this.fillStyle=e,this.matrix=n,this.type=t.type}clone(){return new Fs(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const Ye=new G,mh=class extends nh{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new Ps,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let i=0;i<this.drawCalls.length;i++)this.drawCalls[i].texArray.clear(),ps.push(this.drawCalls[i]);this.drawCalls.length=0;for(let i=0;i<this.batches.length;i++){const t=this.batches[i];t.reset(),Ro.push(t)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(i,t=null,e=null,s=null){const n=new Fs(i,t,e,s);return this.graphicsData.push(n),this.dirty++,this}drawHole(i,t=null){if(!this.graphicsData.length)return null;const e=new Fs(i,null,null,t),s=this.graphicsData[this.graphicsData.length-1];return e.lineStyle=s.lineStyle,s.holes.push(e),this.dirty++,this}destroy(){super.destroy();for(let i=0;i<this.graphicsData.length;++i)this.graphicsData[i].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(i){const t=this.graphicsData;for(let e=0;e<t.length;++e){const s=t[e];if(!!s.fillStyle.visible&&s.shape&&(s.matrix?s.matrix.applyInverse(i,Ye):Ye.copyFrom(i),s.shape.contains(Ye.x,Ye.y))){let n=!1;if(s.holes){for(let r=0;r<s.holes.length;r++)if(s.holes[r].shape.contains(Ye.x,Ye.y)){n=!0;break}}if(!n)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;const i=this.uvs,t=this.graphicsData;let e=null,s=null;this.batches.length>0&&(e=this.batches[this.batches.length-1],s=e.style);for(let a=this.shapeIndex;a<t.length;a++){this.shapeIndex++;const h=t[a],c=h.fillStyle,l=h.lineStyle;An[h.type].build(h),h.matrix&&this.transformPoints(h.points,h.matrix),(c.visible||l.visible)&&this.processHoles(h.holes);for(let d=0;d<2;d++){const u=d===0?c:l;if(!u.visible)continue;const p=u.texture.baseTexture,m=this.indices.length,g=this.points.length/2;p.wrapMode=_e.REPEAT,d===0?this.processFill(h):this.processLine(h);const _=this.points.length/2-g;_!==0&&(e&&!this._compareStyles(s,u)&&(e.end(m,g),e=null),e||(e=Ro.pop()||new xm,e.begin(u,m,g),this.batches.push(e),s=u),this.addUvs(this.points,i,u.texture,g,_,u.matrix))}}const n=this.indices.length,r=this.points.length/2;if(e&&e.end(n,r),this.batches.length===0){this.batchable=!0;return}const o=r>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&o===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=o?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(i,t){return!(!i||!t||i.texture.baseTexture!==t.texture.baseTexture||i.color+i.alpha!==t.color+t.alpha||!!i.native!=!!t.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let i=0,t=this.graphicsData.length;i<t;i++){const e=this.graphicsData[i],s=e.fillStyle,n=e.lineStyle;if(s&&!s.texture.baseTexture.valid||n&&!n.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const i=this.batches;for(let t=0,e=i.length;t<e;t++){const s=i[t];for(let n=0;n<s.size;n++){const r=s.start+n;this.indicesUint16[r]=this.indicesUint16[r]-s.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;const i=this.batches;for(let t=0;t<i.length;t++)if(i[t].style.native)return!1;return this.points.length<mh.BATCHABLE_SIZE*2}buildDrawCalls(){let i=++J._globalBatch;for(let l=0;l<this.drawCalls.length;l++)this.drawCalls[l].texArray.clear(),ps.push(this.drawCalls[l]);this.drawCalls.length=0;const t=this.colors,e=this.textureIds;let s=ps.pop();s||(s=new Yn,s.texArray=new Kn),s.texArray.count=0,s.start=0,s.size=0,s.type=qt.TRIANGLES;let n=0,r=null,o=0,a=!1,h=qt.TRIANGLES,c=0;this.drawCalls.push(s);for(let l=0;l<this.batches.length;l++){const f=this.batches[l],d=8,u=f.style,p=u.texture.baseTexture;a!==!!u.native&&(a=!!u.native,h=a?qt.LINES:qt.TRIANGLES,r=null,n=d,i++),r!==p&&(r=p,p._batchEnabled!==i&&(n===d&&(i++,n=0,s.size>0&&(s=ps.pop(),s||(s=new Yn,s.texArray=new Kn),this.drawCalls.push(s)),s.start=c,s.size=0,s.texArray.count=0,s.type=h),p.touched=1,p._batchEnabled=i,p._batchLocation=n,p.wrapMode=_e.REPEAT,s.texArray.elements[s.texArray.count++]=p,n++)),s.size+=f.size,c+=f.size,o=p._batchLocation,this.addColors(t,u.color,u.alpha,f.attribSize,f.attribStart),this.addTextureIds(e,o,f.attribSize,f.attribStart)}J._globalBatch=i,this.packAttributes()}packAttributes(){const i=this.points,t=this.uvs,e=this.colors,s=this.textureIds,n=new ArrayBuffer(i.length*3*4),r=new Float32Array(n),o=new Uint32Array(n);let a=0;for(let h=0;h<i.length/2;h++)r[a++]=i[h*2],r[a++]=i[h*2+1],r[a++]=t[h*2],r[a++]=t[h*2+1],o[a++]=e[h],r[a++]=s[h];this._buffer.update(n),this._indexBuffer.update(this.indicesUint16)}processFill(i){i.holes.length?ph.triangulate(i,this):An[i.type].triangulate(i,this)}processLine(i){Io(i,this);for(let t=0;t<i.holes.length;t++)Io(i.holes[t],this)}processHoles(i){for(let t=0;t<i.length;t++){const e=i[t];An[e.type].build(e),e.matrix&&this.transformPoints(e.points,e.matrix)}}calculateBounds(){const i=this._bounds;i.clear(),i.addVertexData(this.points,0,this.points.length),i.pad(this.boundsPadding,this.boundsPadding)}transformPoints(i,t){for(let e=0;e<i.length/2;e++){const s=i[e*2],n=i[e*2+1];i[e*2]=t.a*s+t.c*n+t.tx,i[e*2+1]=t.b*s+t.d*n+t.ty}}addColors(i,t,e,s,n=0){const r=(t>>16)+(t&65280)+((t&255)<<16),o=wr(r,e);i.length=Math.max(i.length,n+s);for(let a=0;a<s;a++)i[n+a]=o}addTextureIds(i,t,e,s=0){i.length=Math.max(i.length,s+e);for(let n=0;n<e;n++)i[s+n]=t}addUvs(i,t,e,s,n,r=null){let o=0;const a=t.length,h=e.frame;for(;o<n;){let l=i[(s+o)*2],f=i[(s+o)*2+1];if(r){const d=r.a*l+r.c*f+r.tx;f=r.b*l+r.d*f+r.ty,l=d}o++,t.push(l/h.width,f/h.height)}const c=e.baseTexture;(h.width<c.width||h.height<c.height)&&this.adjustUvs(t,e,a,n)}adjustUvs(i,t,e,s){const n=t.baseTexture,r=1e-6,o=e+s*2,a=t.frame,h=a.width/n.width,c=a.height/n.height;let l=a.x/a.width,f=a.y/a.height,d=Math.floor(i[e]+r),u=Math.floor(i[e+1]+r);for(let p=e+2;p<o;p+=2)d=Math.min(d,Math.floor(i[p]+r)),u=Math.min(u,Math.floor(i[p+1]+r));l-=d,f-=u;for(let p=e;p<o;p+=2)i[p]=(i[p]+l)*h,i[p+1]=(i[p+1]+f)*c}};let gh=mh;gh.BATCHABLE_SIZE=100;class Pr extends qs{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=Oe.BUTT,this.join=ge.MITER,this.miterLimit=10}clone(){const t=new Pr;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1}}const wm=new Float32Array(3),En={},ws=class extends ct{constructor(i=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new qs,this._lineStyle=new Pr,this._matrix=null,this._holeMode=!1,this.state=pe.for2d(),this._geometry=i||new gh,this._geometry.refCount++,this._transformID=-1,this.tint=16777215,this.blendMode=$.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new ws(this._geometry)}set blendMode(i){this.state.blendMode=i}get blendMode(){return this.state.blendMode}get tint(){return this._tint}set tint(i){this._tint=i}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(i=null,t=0,e=1,s=.5,n=!1){return typeof i=="number"&&(i={width:i,color:t,alpha:e,alignment:s,native:n}),this.lineTextureStyle(i)}lineTextureStyle(i){i=Object.assign({width:0,texture:H.WHITE,color:i!=null&&i.texture?16777215:0,alpha:1,matrix:null,alignment:.5,native:!1,cap:Oe.BUTT,join:ge.MITER,miterLimit:10},i),this.currentPath&&this.startPoly();const t=i.width>0&&i.alpha>0;return t?(i.matrix&&(i.matrix=i.matrix.clone(),i.matrix.invert()),Object.assign(this._lineStyle,{visible:t},i)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const i=this.currentPath.points,t=this.currentPath.points.length;t>2&&(this.drawShape(this.currentPath),this.currentPath=new oi,this.currentPath.closeStroke=!1,this.currentPath.points.push(i[t-2],i[t-1]))}else this.currentPath=new oi,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(i,t){return this.startPoly(),this.currentPath.points[0]=i,this.currentPath.points[1]=t,this}lineTo(i,t){this.currentPath||this.moveTo(0,0);const e=this.currentPath.points,s=e[e.length-2],n=e[e.length-1];return(s!==i||n!==t)&&e.push(i,t),this}_initCurve(i=0,t=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[i,t]):this.moveTo(i,t)}quadraticCurveTo(i,t,e,s){this._initCurve();const n=this.currentPath.points;return n.length===0&&this.moveTo(0,0),Ir.curveTo(i,t,e,s,n),this}bezierCurveTo(i,t,e,s,n,r){return this._initCurve(),Cr.curveTo(i,t,e,s,n,r,this.currentPath.points),this}arcTo(i,t,e,s,n){this._initCurve(i,t);const r=this.currentPath.points,o=Po.curveTo(i,t,e,s,n,r);if(o){const{cx:a,cy:h,radius:c,startAngle:l,endAngle:f,anticlockwise:d}=o;this.arc(a,h,c,l,f,d)}return this}arc(i,t,e,s,n,r=!1){if(s===n)return this;if(!r&&n<=s?n+=Ss:r&&s<=n&&(s+=Ss),n-s===0)return this;const a=i+Math.cos(s)*e,h=t+Math.sin(s)*e,c=this._geometry.closePointEps;let l=this.currentPath?this.currentPath.points:null;if(l){const f=Math.abs(l[l.length-2]-a),d=Math.abs(l[l.length-1]-h);f<c&&d<c||l.push(a,h)}else this.moveTo(a,h),l=this.currentPath.points;return Po.arc(a,h,i,t,e,s,n,r,l),this}beginFill(i=0,t=1){return this.beginTextureFill({texture:H.WHITE,color:i,alpha:t})}beginTextureFill(i){i=Object.assign({texture:H.WHITE,color:16777215,alpha:1,matrix:null},i),this.currentPath&&this.startPoly();const t=i.alpha>0;return t?(i.matrix&&(i.matrix=i.matrix.clone(),i.matrix.invert()),Object.assign(this._fillStyle,{visible:t},i)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(i,t,e,s){return this.drawShape(new q(i,t,e,s))}drawRoundedRect(i,t,e,s,n){return this.drawShape(new _r(i,t,e,s,n))}drawCircle(i,t,e){return this.drawShape(new gr(i,t,e))}drawEllipse(i,t,e,s){return this.drawShape(new vr(i,t,e,s))}drawPolygon(...i){let t,e=!0;const s=i[0];s.points?(e=s.closeStroke,t=s.points):Array.isArray(i[0])?t=i[0]:t=i;const n=new oi(t);return n.closeStroke=e,this.drawShape(n),this}drawShape(i){return this._holeMode?this._geometry.drawHole(i,this._matrix):this._geometry.drawShape(i,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const i=this._geometry.graphicsData;return i.length===1&&i[0].shape.type===St.RECT&&!i[0].matrix&&!i[0].holes.length&&!(i[0].lineStyle.visible&&i[0].lineStyle.width)}_render(i){this.finishPoly();const t=this._geometry;t.updateBatches(),t.batchable?(this.batchDirty!==t.batchDirty&&this._populateBatches(),this._renderBatched(i)):(i.batch.flush(),this._renderDirect(i))}_populateBatches(){const i=this._geometry,t=this.blendMode,e=i.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=i.batchDirty,this.batches.length=e,this.vertexData=new Float32Array(i.points);for(let s=0;s<e;s++){const n=i.batches[s],r=n.style.color,o=new Float32Array(this.vertexData.buffer,n.attribStart*4*2,n.attribSize*2),a=new Float32Array(i.uvsFloat32.buffer,n.attribStart*4*2,n.attribSize*2),h=new Uint16Array(i.indicesUint16.buffer,n.start*2,n.size),c={vertexData:o,blendMode:t,indices:h,uvs:a,_batchRGB:Oi(r),_tintRGB:r,_texture:n.style.texture,alpha:n.style.alpha,worldAlpha:1};this.batches[s]=c}}_renderBatched(i){if(!!this.batches.length){i.batch.setObjectRenderer(i.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let t=0,e=this.batches.length;t<e;t++){const s=this.batches[t];s.worldAlpha=this.worldAlpha*s.alpha,i.plugins[this.pluginName].render(s)}}}_renderDirect(i){const t=this._resolveDirectShader(i),e=this._geometry,s=this.tint,n=this.worldAlpha,r=t.uniforms,o=e.drawCalls;r.translationMatrix=this.transform.worldTransform,r.tint[0]=(s>>16&255)/255*n,r.tint[1]=(s>>8&255)/255*n,r.tint[2]=(s&255)/255*n,r.tint[3]=n,i.shader.bind(t),i.geometry.bind(e,t),i.state.set(this.state);for(let a=0,h=o.length;a<h;a++)this._renderDrawCallDirect(i,e.drawCalls[a])}_renderDrawCallDirect(i,t){const{texArray:e,type:s,size:n,start:r}=t,o=e.count;for(let a=0;a<o;a++)i.texture.bind(e.elements[a],a);i.geometry.draw(s,n,r)}_resolveDirectShader(i){let t=this.shader;const e=this.pluginName;if(!t){if(!En[e]){const{MAX_TEXTURES:s}=i.plugins[e],n=new Int32Array(s);for(let a=0;a<s;a++)n[a]=a;const r={tint:new Float32Array([1,1,1,1]),translationMatrix:new gt,default:Xt.from({uSamplers:n},!0)},o=i.plugins[e]._shader.program;En[e]=new ee(o,r)}t=En[e]}return t}_calculateBounds(){this.finishPoly();const i=this._geometry;if(!i.graphicsData.length)return;const{minX:t,minY:e,maxX:s,maxY:n}=i.bounds;this._bounds.addFrame(this.transform,t,e,s,n)}containsPoint(i){return this.worldTransform.applyInverse(i,ws._TEMP_POINT),this._geometry.containsPoint(ws._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this.tint;const i=Oi(this.tint,wm);for(let t=0;t<this.batches.length;t++){const e=this.batches[t],s=e._batchRGB,n=i[0]*s[0]*255,r=i[1]*s[1]*255,o=i[2]*s[2]*255,a=(n<<16)+(r<<8)+(o|0);e._tintRGB=(a>>16)+(a&65280)+((a&255)<<16)}}}calculateVertices(){const i=this.transform._worldID;if(this._transformID===i)return;this._transformID=i;const t=this.transform.worldTransform,e=t.a,s=t.b,n=t.c,r=t.d,o=t.tx,a=t.ty,h=this._geometry.points,c=this.vertexData;let l=0;for(let f=0;f<h.length;f+=2){const d=h[f],u=h[f+1];c[l++]=e*d+n*u+o,c[l++]=r*u+s*d+a}}closePath(){const i=this.currentPath;return i&&(i.closeStroke=!0,this.finishPoly()),this}setMatrix(i){return this._matrix=i,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(i){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(i)}};let Dt=ws;Dt._TEMP_POINT=new G;class bm{constructor(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const e=this.uvBuffer.data;(!this.data||this.data.length!==e.length)&&(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}}const Tn=new G,Mo=new oi,vh=class extends ct{constructor(i,t,e,s=qt.TRIANGLES){super(),this.geometry=i,this.shader=t,this.state=e||pe.for2d(),this.drawMode=s,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=O.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(i){this._geometry!==i&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=i,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(i){this.shader=i}get material(){return this.shader}set blendMode(i){this.state.blendMode=i}get blendMode(){return this.state.blendMode}set roundPixels(i){this._roundPixels!==i&&(this._transformID=-1),this._roundPixels=i}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(i){this.shader.tint=i}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(i){this.shader.texture=i}_render(i){const t=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===qt.TRIANGLES&&t.length<vh.BATCHABLE_SIZE*2?this._renderToBatch(i):this._renderDefault(i)}_renderDefault(i){const t=this.shader;t.alpha=this.worldAlpha,t.update&&t.update(),i.batch.flush(),t.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),i.shader.bind(t),i.state.set(this.state),i.geometry.bind(this.geometry,t),i.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(i){const t=this.geometry,e=this.shader;e.uvMatrix&&(e.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=t.indexBuffer.data,this._tintRGB=e._tintRGB,this._texture=e.texture;const s=this.material.pluginName;i.batch.setObjectRenderer(i.plugins[s]),i.plugins[s].render(this)}calculateVertices(){const t=this.geometry.buffers[0],e=t.data,s=t._updateID;if(s===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));const n=this.transform.worldTransform,r=n.a,o=n.b,a=n.c,h=n.d,c=n.tx,l=n.ty,f=this.vertexData;for(let d=0;d<f.length/2;d++){const u=e[d*2],p=e[d*2+1];f[d*2]=r*u+a*p+c,f[d*2+1]=o*u+h*p+l}if(this._roundPixels){const d=O.RESOLUTION;for(let u=0;u<f.length;++u)f[u]=Math.round(f[u]*d)/d}this.vertexDirty=s}calculateUvs(){const i=this.geometry.buffers[1],t=this.shader;t.uvMatrix.isSimple?this.uvs=i.data:(this.batchUvs||(this.batchUvs=new bm(i,t.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(i){if(!this.getBounds().contains(i.x,i.y))return!1;this.worldTransform.applyInverse(i,Tn);const t=this.geometry.getBuffer("aVertexPosition").data,e=Mo.points,s=this.geometry.getIndex().data,n=s.length,r=this.drawMode===4?3:1;for(let o=0;o+2<n;o+=r){const a=s[o]*2,h=s[o+1]*2,c=s[o+2]*2;if(e[0]=t[a],e[1]=t[a+1],e[2]=t[h],e[3]=t[h+1],e[4]=t[c],e[5]=t[c+1],Mo.contains(Tn.x,Tn.y))return!0}return!1}destroy(i){super.destroy(i),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};let tr=vh;tr.BATCHABLE_SIZE=100;var Am=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,Em=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;class Bo extends ee{constructor(t,e){const s={uSampler:t,alpha:1,uTextureMatrix:gt.IDENTITY,uColor:new Float32Array([1,1,1,1])};e=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},e),e.uniforms&&Object.assign(s,e.uniforms),super(e.program||de.from(Em,Am),s),this._colorDirty=!1,this.uvMatrix=new Ar(t),this.batchable=e.program===void 0,this.pluginName=e.pluginName,this.tint=e.tint,this.alpha=e.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this._tint&&(this._tint=t,this._tintRGB=(t>>16)+(t&65280)+((t&255)<<16),this._colorDirty=!0)}get tint(){return this._tint}update(){if(this._colorDirty){this._colorDirty=!1;const t=this.texture.baseTexture;wa(this._tint,this._alpha,this.uniforms.uColor,t.alphaMode)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class Tm extends Ae{constructor(t,e,s){super();const n=new _t(t),r=new _t(e,!0),o=new _t(s,!0,!0);this.addAttribute("aVertexPosition",n,2,!1,Z.FLOAT).addAttribute("aTextureCoord",r,2,!1,Z.FLOAT).addIndex(o),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}class Do{constructor(t,e,s){this.geometry=new Ae,this.indexBuffer=null,this.size=s,this.dynamicProperties=[],this.staticProperties=[];for(let n=0;n<t.length;++n){let r=t[n];r={attributeName:r.attributeName,size:r.size,uploadFunction:r.uploadFunction,type:r.type||Z.FLOAT,offset:r.offset},e[n]?this.dynamicProperties.push(r):this.staticProperties.push(r)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let e=0;this.indexBuffer=new _t(Vd(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let o=0;o<this.dynamicProperties.length;++o){const a=this.dynamicProperties[o];a.offset=e,e+=a.size,this.dynamicStride+=a.size}const s=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(s),this.dynamicDataUint32=new Uint32Array(s),this.dynamicBuffer=new _t(this.dynamicData,!1,!1);let n=0;this.staticStride=0;for(let o=0;o<this.staticProperties.length;++o){const a=this.staticProperties[o];a.offset=n,n+=a.size,this.staticStride+=a.size}const r=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(r),this.staticDataUint32=new Uint32Array(r),this.staticBuffer=new _t(this.staticData,!0,!1);for(let o=0;o<this.dynamicProperties.length;++o){const a=this.dynamicProperties[o];t.addAttribute(a.attributeName,this.dynamicBuffer,0,a.type===Z.UNSIGNED_BYTE,a.type,this.dynamicStride*4,a.offset*4)}for(let o=0;o<this.staticProperties.length;++o){const a=this.staticProperties[o];t.addAttribute(a.attributeName,this.staticBuffer,0,a.type===Z.UNSIGNED_BYTE,a.type,this.staticStride*4,a.offset*4)}}uploadDynamic(t,e,s){for(let n=0;n<this.dynamicProperties.length;n++){const r=this.dynamicProperties[n];r.uploadFunction(t,e,s,r.type===Z.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,r.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,e,s){for(let n=0;n<this.staticProperties.length;n++){const r=this.staticProperties[n];r.uploadFunction(t,e,s,r.type===Z.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,r.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var Sm=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,Cm=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;class _h extends Zs{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new gt,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:Z.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=ee.from(Cm,Sm,{}),this.state=pe.for2d()}render(t){const e=t.children,s=t._maxSize,n=t._batchSize,r=this.renderer;let o=e.length;if(o===0)return;o>s&&!t.autoResize&&(o=s);let a=t._buffers;a||(a=t._buffers=this.generateBuffers(t));const h=e[0]._texture.baseTexture,c=h.alphaMode>0;this.state.blendMode=xa(t.blendMode,c),r.state.set(this.state);const l=r.gl,f=t.worldTransform.copyTo(this.tempMatrix);f.prepend(r.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=f.toArray(!0),this.shader.uniforms.uColor=zd(t.tintRgb,t.worldAlpha,this.shader.uniforms.uColor,c),this.shader.uniforms.uSampler=h,this.renderer.shader.bind(this.shader);let d=!1;for(let u=0,p=0;u<o;u+=n,p+=1){let m=o-u;m>n&&(m=n),p>=a.length&&a.push(this._generateOneMoreBuffer(t));const g=a[p];g.uploadDynamic(e,u,m);const _=t._bufferUpdateIDs[p]||0;d=d||g._updateID<_,d&&(g._updateID=t._updateID,g.uploadStatic(e,u,m)),r.geometry.bind(g.geometry),l.drawElements(l.TRIANGLES,m*6,l.UNSIGNED_SHORT,0)}}generateBuffers(t){const e=[],s=t._maxSize,n=t._batchSize,r=t._properties;for(let o=0;o<s;o+=n)e.push(new Do(this.properties,r,n));return e}_generateOneMoreBuffer(t){const e=t._batchSize,s=t._properties;return new Do(this.properties,s,e)}uploadVertices(t,e,s,n,r,o){let a=0,h=0,c=0,l=0;for(let f=0;f<s;++f){const d=t[e+f],u=d._texture,p=d.scale.x,m=d.scale.y,g=u.trim,_=u.orig;g?(h=g.x-d.anchor.x*_.width,a=h+g.width,l=g.y-d.anchor.y*_.height,c=l+g.height):(a=_.width*(1-d.anchor.x),h=_.width*-d.anchor.x,c=_.height*(1-d.anchor.y),l=_.height*-d.anchor.y),n[o]=h*p,n[o+1]=l*m,n[o+r]=a*p,n[o+r+1]=l*m,n[o+r*2]=a*p,n[o+r*2+1]=c*m,n[o+r*3]=h*p,n[o+r*3+1]=c*m,o+=r*4}}uploadPosition(t,e,s,n,r,o){for(let a=0;a<s;a++){const h=t[e+a].position;n[o]=h.x,n[o+1]=h.y,n[o+r]=h.x,n[o+r+1]=h.y,n[o+r*2]=h.x,n[o+r*2+1]=h.y,n[o+r*3]=h.x,n[o+r*3+1]=h.y,o+=r*4}}uploadRotation(t,e,s,n,r,o){for(let a=0;a<s;a++){const h=t[e+a].rotation;n[o]=h,n[o+r]=h,n[o+r*2]=h,n[o+r*3]=h,o+=r*4}}uploadUvs(t,e,s,n,r,o){for(let a=0;a<s;++a){const h=t[e+a]._texture._uvs;h?(n[o]=h.x0,n[o+1]=h.y0,n[o+r]=h.x1,n[o+r+1]=h.y1,n[o+r*2]=h.x2,n[o+r*2+1]=h.y2,n[o+r*3]=h.x3,n[o+r*3+1]=h.y3,o+=r*4):(n[o]=0,n[o+1]=0,n[o+r]=0,n[o+r+1]=0,n[o+r*2]=0,n[o+r*2+1]=0,n[o+r*3]=0,n[o+r*3+1]=0,o+=r*4)}}uploadTint(t,e,s,n,r,o){for(let a=0;a<s;++a){const h=t[e+a],c=h._texture.baseTexture.alphaMode>0,l=h.alpha,f=l<1&&c?wr(h._tintRGB,l):h._tintRGB+(l*255<<24);n[o]=f,n[o+r]=f,n[o+r*2]=f,n[o+r*3]=f,o+=r*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}_h.extension={name:"particle",type:z.RendererPlugin};Y.add(_h);O.UPLOADS_PER_FRAME=4;var Js=(i=>(i[i.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",i[i.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",i))(Js||{});const Sn={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Js.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100,leading:0},Im=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];class Ee{constructor(t){this.styleID=0,this.reset(),In(this,t,t)}clone(){const t={};return In(t,this,Sn),new Ee(t)}reset(){In(this,Sn,Sn)}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(t){const e=Cn(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}get fill(){return this._fill}set fill(t){const e=Cn(t);this._fill!==e&&(this._fill=e,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(t){Pm(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.styleID++)}get stroke(){return this._stroke}set stroke(t){const e=Cn(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}toFontString(){const t=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize;let e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(let s=e.length-1;s>=0;s--){let n=e[s].trim();!/([\"\'])[^\'\"]+\1/.test(n)&&!Im.includes(n)&&(n=`"${n}"`),e[s]=n}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${e.join(",")}`}}function Fo(i){return typeof i=="number"?_a(i):(typeof i=="string"&&i.startsWith("0x")&&(i=i.replace("0x","#")),i)}function Cn(i){if(Array.isArray(i)){for(let t=0;t<i.length;++t)i[t]=Fo(i[t]);return i}else return Fo(i)}function Pm(i,t){if(!Array.isArray(i)||!Array.isArray(t)||i.length!==t.length)return!1;for(let e=0;e<i.length;++e)if(i[e]!==t[e])return!1;return!0}function In(i,t,e){for(const s in e)Array.isArray(t[s])?i[s]=t[s].slice():i[s]=t[s]}const ms={willReadFrequently:!0};class X{constructor(t,e,s,n,r,o,a,h,c){this.text=t,this.style=e,this.width=s,this.height=n,this.lines=r,this.lineWidths=o,this.lineHeight=a,this.maxLineWidth=h,this.fontProperties=c}static measureText(t,e,s,n=X._canvas){s=s==null?e.wordWrap:s;const r=e.toFontString(),o=X.measureFont(r);o.fontSize===0&&(o.fontSize=e.fontSize,o.ascent=e.fontSize);const a=n.getContext("2d",ms);a.font=r;const c=(s?X.wordWrap(t,e,n):t).split(/(?:\r\n|\r|\n)/),l=new Array(c.length);let f=0;for(let m=0;m<c.length;m++){const g=a.measureText(c[m]).width+(c[m].length-1)*e.letterSpacing;l[m]=g,f=Math.max(f,g)}let d=f+e.strokeThickness;e.dropShadow&&(d+=e.dropShadowDistance);const u=e.lineHeight||o.fontSize+e.strokeThickness;let p=Math.max(u,o.fontSize+e.strokeThickness)+(c.length-1)*(u+e.leading);return e.dropShadow&&(p+=e.dropShadowDistance),new X(t,e,d,p,c,l,u+e.leading,f,o)}static wordWrap(t,e,s=X._canvas){const n=s.getContext("2d",ms);let r=0,o="",a="";const h=Object.create(null),{letterSpacing:c,whiteSpace:l}=e,f=X.collapseSpaces(l),d=X.collapseNewlines(l);let u=!f;const p=e.wordWrapWidth+c,m=X.tokenize(t);for(let g=0;g<m.length;g++){let _=m[g];if(X.isNewline(_)){if(!d){a+=X.addLine(o),u=!f,o="",r=0;continue}_=" "}if(f){const y=X.isBreakingSpace(_),v=X.isBreakingSpace(o[o.length-1]);if(y&&v)continue}const A=X.getFromCache(_,c,h,n);if(A>p)if(o!==""&&(a+=X.addLine(o),o="",r=0),X.canBreakWords(_,e.breakWords)){const y=X.wordWrapSplit(_);for(let v=0;v<y.length;v++){let x=y[v],b=1;for(;y[v+b];){const E=y[v+b],S=x[x.length-1];if(X.canBreakChars(S,E,_,v,e.breakWords))break}v+=x.length-1;const w=X.getFromCache(x,c,h,n);w+r>p&&(a+=X.addLine(o),u=!1,o="",r=0),o+=x,r+=w}}else{o.length>0&&(a+=X.addLine(o),o="",r=0);const y=g===m.length-1;a+=X.addLine(_,!y),u=!1,o="",r=0}else A+r>p&&(u=!1,a+=X.addLine(o),o="",r=0),(o.length>0||!X.isBreakingSpace(_)||u)&&(o+=_,r+=A)}return a+=X.addLine(o,!1),a}static addLine(t,e=!0){return t=X.trimRight(t),t=e?`${t}
`:t,t}static getFromCache(t,e,s,n){let r=s[t];if(typeof r!="number"){const o=t.length*e;r=n.measureText(t).width+o,s[t]=r}return r}static collapseSpaces(t){return t==="normal"||t==="pre-line"}static collapseNewlines(t){return t==="normal"}static trimRight(t){if(typeof t!="string")return"";for(let e=t.length-1;e>=0;e--){const s=t[e];if(!X.isBreakingSpace(s))break;t=t.slice(0,-1)}return t}static isNewline(t){return typeof t!="string"?!1:X._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return typeof t!="string"?!1:X._breakingSpaces.includes(t.charCodeAt(0))}static tokenize(t){const e=[];let s="";if(typeof t!="string")return e;for(let n=0;n<t.length;n++){const r=t[n],o=t[n+1];if(X.isBreakingSpace(r,o)||X.isNewline(r)){s!==""&&(e.push(s),s=""),e.push(r);continue}s+=r}return s!==""&&e.push(s),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,s,n,r){return!0}static wordWrapSplit(t){return t.split("")}static measureFont(t){if(X._fonts[t])return X._fonts[t];const e={ascent:0,descent:0,fontSize:0},s=X._canvas,n=X._context;n.font=t;const r=X.METRICS_STRING+X.BASELINE_SYMBOL,o=Math.ceil(n.measureText(r).width);let a=Math.ceil(n.measureText(X.BASELINE_SYMBOL).width);const h=Math.ceil(X.HEIGHT_MULTIPLIER*a);a=a*X.BASELINE_MULTIPLIER|0,s.width=o,s.height=h,n.fillStyle="#f00",n.fillRect(0,0,o,h),n.font=t,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText(r,0,a);const c=n.getImageData(0,0,o,h).data,l=c.length,f=o*4;let d=0,u=0,p=!1;for(d=0;d<a;++d){for(let m=0;m<f;m+=4)if(c[u+m]!==255){p=!0;break}if(!p)u+=f;else break}for(e.ascent=a-d,u=l-f,p=!1,d=h;d>a;--d){for(let m=0;m<f;m+=4)if(c[u+m]!==255){p=!0;break}if(!p)u-=f;else break}return e.descent=d-a,e.fontSize=e.ascent+e.descent,X._fonts[t]=e,e}static clearMetrics(t=""){t?delete X._fonts[t]:X._fonts={}}static get _canvas(){if(!X.__canvas){let t;try{const e=new OffscreenCanvas(0,0),s=e.getContext("2d",ms);if(s!=null&&s.measureText)return X.__canvas=e,e;t=O.ADAPTER.createCanvas()}catch{t=O.ADAPTER.createCanvas()}t.width=t.height=10,X.__canvas=t}return X.__canvas}static get _context(){return X.__context||(X.__context=X._canvas.getContext("2d",ms)),X.__context}}X._fonts={};X.METRICS_STRING="|\xC9q\xC5";X.BASELINE_SYMBOL="M";X.BASELINE_MULTIPLIER=1.4;X.HEIGHT_MULTIPLIER=2;X._newlines=[10,13];X._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];const Rm={texture:!0,children:!1,baseTexture:!0},yh=class extends ut{constructor(i,t,e){let s=!1;e||(e=O.ADAPTER.createCanvas(),s=!0),e.width=3,e.height=3;const n=H.from(e);n.orig=new q,n.trim=new q,super(n),this._ownCanvas=s,this.canvas=e,this.context=e.getContext("2d",{willReadFrequently:!0}),this._resolution=O.RESOLUTION,this._autoResolution=!0,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=i,this.style=t,this.localStyleID=-1}updateText(i){const t=this._style;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&i)return;this._font=this._style.toFontString();const e=this.context,s=X.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),n=s.width,r=s.height,o=s.lines,a=s.lineHeight,h=s.lineWidths,c=s.maxLineWidth,l=s.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,n)+t.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,r)+t.padding*2)*this._resolution),e.scale(this._resolution,this._resolution),e.clearRect(0,0,this.canvas.width,this.canvas.height),e.font=this._font,e.lineWidth=t.strokeThickness,e.textBaseline=t.textBaseline,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit;let f,d;const u=t.dropShadow?2:1;for(let p=0;p<u;++p){const m=t.dropShadow&&p===0,g=m?Math.ceil(Math.max(1,r)+t.padding*2):0,_=g*this._resolution;if(m){e.fillStyle="black",e.strokeStyle="black";const y=t.dropShadowColor,v=Oi(typeof y=="number"?y:xr(y)),x=t.dropShadowBlur*this._resolution,b=t.dropShadowDistance*this._resolution;e.shadowColor=`rgba(${v[0]*255},${v[1]*255},${v[2]*255},${t.dropShadowAlpha})`,e.shadowBlur=x,e.shadowOffsetX=Math.cos(t.dropShadowAngle)*b,e.shadowOffsetY=Math.sin(t.dropShadowAngle)*b+_}else e.fillStyle=this._generateFillStyle(t,o,s),e.strokeStyle=t.stroke,e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;let A=(a-l.fontSize)/2;a-l.fontSize<0&&(A=0);for(let y=0;y<o.length;y++)f=t.strokeThickness/2,d=t.strokeThickness/2+y*a+l.ascent+A,t.align==="right"?f+=c-h[y]:t.align==="center"&&(f+=(c-h[y])/2),t.stroke&&t.strokeThickness&&this.drawLetterSpacing(o[y],f+t.padding,d+t.padding-g,!0),t.fill&&this.drawLetterSpacing(o[y],f+t.padding,d+t.padding-g)}this.updateTexture()}drawLetterSpacing(i,t,e,s=!1){const r=this._style.letterSpacing,o=yh.experimentalLetterSpacing&&("letterSpacing"in CanvasRenderingContext2D.prototype||"textLetterSpacing"in CanvasRenderingContext2D.prototype);if(r===0||o){o&&(this.context.letterSpacing=r,this.context.textLetterSpacing=r),s?this.context.strokeText(i,t,e):this.context.fillText(i,t,e);return}let a=t;const h=Array.from?Array.from(i):i.split("");let c=this.context.measureText(i).width,l=0;for(let f=0;f<h.length;++f){const d=h[f];s?this.context.strokeText(d,a,e):this.context.fillText(d,a,e);let u="";for(let p=f+1;p<h.length;++p)u+=h[p];l=this.context.measureText(u).width,a+=c-l+r,c=l}}updateTexture(){const i=this.canvas;if(this._style.trim){const r=Wd(i);r.data&&(i.width=r.width,i.height=r.height,this.context.putImageData(r.data,0,0))}const t=this._texture,e=this._style,s=e.trim?0:e.padding,n=t.baseTexture;t.trim.width=t._frame.width=i.width/this._resolution,t.trim.height=t._frame.height=i.height/this._resolution,t.trim.x=-s,t.trim.y=-s,t.orig.width=t._frame.width-s*2,t.orig.height=t._frame.height-s*2,this._onTextureUpdate(),n.setRealSize(i.width,i.height,this._resolution),t.updateUvs(),this.dirty=!1}_render(i){this._autoResolution&&this._resolution!==i.resolution&&(this._resolution=i.resolution,this.dirty=!0),this.updateText(!0),super._render(i)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(i,t){return this.updateText(!0),this._textureID===-1&&(i=!1),super.getBounds(i,t)}getLocalBounds(i){return this.updateText(!0),super.getLocalBounds.call(this,i)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(i,t,e){const s=i.fill;if(Array.isArray(s)){if(s.length===1)return s[0]}else return s;let n;const r=i.dropShadow?i.dropShadowDistance:0,o=i.padding||0,a=this.canvas.width/this._resolution-r-o*2,h=this.canvas.height/this._resolution-r-o*2,c=s.slice(),l=i.fillGradientStops.slice();if(!l.length){const f=c.length+1;for(let d=1;d<f;++d)l.push(d/f)}if(c.unshift(s[0]),l.unshift(0),c.push(s[s.length-1]),l.push(1),i.fillGradientType===Js.LINEAR_VERTICAL){n=this.context.createLinearGradient(a/2,o,a/2,h+o);const f=e.fontProperties.fontSize+i.strokeThickness;for(let d=0;d<t.length;d++){const u=e.lineHeight*(d-1)+f,p=e.lineHeight*d;let m=p;d>0&&u>p&&(m=(p+u)/2);const g=p+f,_=e.lineHeight*(d+1);let A=g;d+1<t.length&&_<g&&(A=(g+_)/2);const y=(A-m)/h;for(let v=0;v<c.length;v++){let x=0;typeof l[v]=="number"?x=l[v]:x=v/c.length;let b=Math.min(1,Math.max(0,m/h+x*y));b=Number(b.toFixed(5)),n.addColorStop(b,c[v])}}}else{n=this.context.createLinearGradient(o,h/2,a+o,h/2);const f=c.length+1;let d=1;for(let u=0;u<c.length;u++){let p;typeof l[u]=="number"?p=l[u]:p=d/f,n.addColorStop(p,c[u]),d++}}return n}destroy(i){typeof i=="boolean"&&(i={children:i}),i=Object.assign({},Rm,i),super.destroy(i),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(i){this.updateText(!0);const t=ti(this.scale.x)||1;this.scale.x=t*i/this._texture.orig.width,this._width=i}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(i){this.updateText(!0);const t=ti(this.scale.y)||1;this.scale.y=t*i/this._texture.orig.height,this._height=i}get style(){return this._style}set style(i){i=i||{},i instanceof Ee?this._style=i:this._style=new Ee(i),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(i){i=String(i==null?"":i),this._text!==i&&(this._text=i,this.dirty=!0)}get resolution(){return this._resolution}set resolution(i){this._autoResolution=!1,this._resolution!==i&&(this._resolution=i,this.dirty=!0)}};let Lt=yh;Lt.experimentalLetterSpacing=!1;class Mm{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function Bm(i,t){var s;let e=!1;if((s=i==null?void 0:i._textures)!=null&&s.length){for(let n=0;n<i._textures.length;n++)if(i._textures[n]instanceof H){const r=i._textures[n].baseTexture;t.includes(r)||(t.push(r),e=!0)}}return e}function Dm(i,t){if(i.baseTexture instanceof J){const e=i.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function Fm(i,t){if(i._texture&&i._texture instanceof H){const e=i._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function Lm(i,t){return t instanceof Lt?(t.updateText(!0),!0):!1}function km(i,t){if(t instanceof Ee){const e=t.toFontString();return X.measureFont(e),!0}return!1}function Om(i,t){if(i instanceof Lt){t.includes(i.style)||t.push(i.style),t.includes(i)||t.push(i);const e=i._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function Um(i,t){return i instanceof Ee?(t.includes(i)||t.push(i),!0):!1}class Nm{constructor(t){this.limiter=new Mm(O.UPLOADS_PER_FRAME),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{!this.queue||this.prepareItems()},this.registerFindHook(Om),this.registerFindHook(Um),this.registerFindHook(Bm),this.registerFindHook(Dm),this.registerFindHook(Fm),this.registerUploadHook(Lm),this.registerUploadHook(km)}upload(t){return new Promise(e=>{t&&this.add(t),this.queue.length?(this.completes.push(e),this.ticking||(this.ticking=!0,st.system.addOnce(this.tick,this,ye.UTILITY))):e()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const t=this.queue[0];let e=!1;if(t&&!t._destroyed){for(let s=0,n=this.uploadHooks.length;s<n;s++)if(this.uploadHooks[s](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}}e||this.queue.shift()}if(this.queue.length)st.system.addOnce(this.tick,this,ye.UTILITY);else{this.ticking=!1;const t=this.completes.slice(0);this.completes.length=0;for(let e=0,s=t.length;e<s;e++)t[e]()}}registerFindHook(t){return t&&this.addHooks.push(t),this}registerUploadHook(t){return t&&this.uploadHooks.push(t),this}add(t){for(let e=0,s=this.addHooks.length;e<s&&!this.addHooks[e](t,this.queue);e++);if(t instanceof ct)for(let e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this}destroy(){this.ticking&&st.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}}function xh(i,t){return t instanceof J?(t._glTextures[i.CONTEXT_UID]||i.texture.bind(t),!0):!1}function Gm(i,t){if(!(t instanceof Dt))return!1;const{geometry:e}=t;t.finishPoly(),e.updateBatches();const{batches:s}=e;for(let n=0;n<s.length;n++){const{texture:r}=s[n].style;r&&xh(i,r.baseTexture)}return e.batchable||i.geometry.bind(e,t._resolveDirectShader(i)),!0}function Hm(i,t){return i instanceof Dt?(t.push(i),!0):!1}class wh extends Nm{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(Hm),this.registerUploadHook(xh),this.registerUploadHook(Gm)}}wh.extension={name:"prepare",type:z.RendererSystem};Y.add(wh);const Ei=class{constructor(i,t,e=null){this.linkedSheets=[],this._texture=i instanceof H?i:null,this.baseTexture=i instanceof J?i:this._texture.baseTexture,this.textures={},this.animations={},this.data=t;const s=this.baseTexture.resource;this.resolution=this._updateResolution(e||(s?s.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(i=null){const{scale:t}=this.data.meta;let e=xe(i,null);return e===null&&(e=parseFloat(t!=null?t:"1")),e!==1&&this.baseTexture.setResolution(e),e}parse(){return new Promise(i=>{this._callback=i,this._batchIndex=0,this._frameKeys.length<=Ei.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(i){let t=i;const e=Ei.BATCH_SIZE;for(;t-i<e&&t<this._frameKeys.length;){const s=this._frameKeys[t],n=this._frames[s],r=n.frame;if(r){let o=null,a=null;const h=n.trimmed!==!1&&n.sourceSize?n.sourceSize:n.frame,c=new q(0,0,Math.floor(h.w)/this.resolution,Math.floor(h.h)/this.resolution);n.rotated?o=new q(Math.floor(r.x)/this.resolution,Math.floor(r.y)/this.resolution,Math.floor(r.h)/this.resolution,Math.floor(r.w)/this.resolution):o=new q(Math.floor(r.x)/this.resolution,Math.floor(r.y)/this.resolution,Math.floor(r.w)/this.resolution,Math.floor(r.h)/this.resolution),n.trimmed!==!1&&n.spriteSourceSize&&(a=new q(Math.floor(n.spriteSourceSize.x)/this.resolution,Math.floor(n.spriteSourceSize.y)/this.resolution,Math.floor(r.w)/this.resolution,Math.floor(r.h)/this.resolution)),this.textures[s]=new H(this.baseTexture,o,c,a,n.rotated?2:0,n.anchor),H.addToCache(this.textures[s],s)}t++}}_processAnimations(){const i=this.data.animations||{};for(const t in i){this.animations[t]=[];for(let e=0;e<i[t].length;e++){const s=i[t][e];this.animations[t].push(this.textures[s])}}}_parseComplete(){const i=this._callback;this._callback=null,this._batchIndex=0,i.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*Ei.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*Ei.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(i=!1){var t;for(const e in this.textures)this.textures[e].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,i&&((t=this._texture)==null||t.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};let er=Ei;er.BATCH_SIZE=1e3;const zm=["jpg","png","jpeg","avif","webp"];function bh(i,t,e){const s={};if(i.forEach(n=>{s[n]=t}),Object.keys(t.textures).forEach(n=>{s[n]=t.textures[n]}),!e){const n=yt.dirname(i[0]);t.linkedSheets.forEach((r,o)=>{const a=bh([`${n}/${t.data.meta.related_multi_packs[o]}`],r,!0);Object.assign(s,a)})}return s}const Vm={extension:z.Asset,cache:{test:i=>i instanceof er,getCacheableAssets:(i,t)=>bh(i,t,!1)},resolver:{test:i=>{const e=i.split("?")[0].split("."),s=e.pop(),n=e.pop();return s==="json"&&zm.includes(n)},parse:i=>{var e,s;const t=i.split(".");return{resolution:parseFloat((s=(e=O.RETINA_PREFIX.exec(i))==null?void 0:e[1])!=null?s:"1"),format:t[t.length-2],src:i}}},loader:{extension:{type:z.LoadParser,priority:jt.Normal},async testParse(i,t){return yt.extname(t.src).includes(".json")&&!!i.frames},async parse(i,t,e){var c,l;let s=yt.dirname(t.src);s&&s.lastIndexOf("/")!==s.length-1&&(s+="/");const n=s+i.meta.image,o=(await e.load([n]))[n],a=new er(o.baseTexture,i,t.src);await a.parse();const h=(c=i==null?void 0:i.meta)==null?void 0:c.related_multi_packs;if(Array.isArray(h)){const f=[];for(const u of h){if(typeof u!="string")continue;const p=s+u;(l=t.data)!=null&&l.ignoreMultiPack||f.push(e.load({src:p,data:{ignoreMultiPack:!0}}))}const d=await Promise.all(f);a.linkedSheets=d,d.forEach(u=>{u.linkedSheets=[a].concat(a.linkedSheets.filter(p=>p!==u))})}return a},unload(i){i.destroy(!0)}}};Y.add(Vm);class Ls extends ut{constructor(t,e=!0){super(t[0]instanceof H?t[0]:t[0].texture),this._textures=null,this._durations=null,this._autoUpdate=e,this._isConnectedToTicker=!1,this.animationSpeed=1,this.loop=!0,this.updateAnchor=!1,this.onComplete=null,this.onFrameChange=null,this.onLoop=null,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=t}stop(){!this._playing||(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(st.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(st.shared.add(this.update,this,ye.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(t){this.stop(),this.currentFrame=t}gotoAndPlay(t){this.currentFrame=t,this.play()}update(t){if(!this._playing)return;const e=this.animationSpeed*t,s=this.currentFrame;if(this._durations!==null){let n=this._currentTime%1*this._durations[this.currentFrame];for(n+=e/60*1e3;n<0;)this._currentTime--,n+=this._durations[this.currentFrame];const r=Math.sign(this.animationSpeed*t);for(this._currentTime=Math.floor(this._currentTime);n>=this._durations[this.currentFrame];)n-=this._durations[this.currentFrame]*r,this._currentTime+=r;this._currentTime+=n/this._durations[this.currentFrame]}else this._currentTime+=e;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):s!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<s?this.onLoop():this.animationSpeed<0&&this.currentFrame>s&&this.onLoop()),this.updateTexture())}updateTexture(){const t=this.currentFrame;this._previousFrame!==t&&(this._previousFrame=t,this._texture=this._textures[t],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(t){this.stop(),super.destroy(t),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(t){const e=[];for(let s=0;s<t.length;++s)e.push(H.from(t[s]));return new Ls(e)}static fromImages(t){const e=[];for(let s=0;s<t.length;++s)e.push(H.from(t[s]));return new Ls(e)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(t){if(t[0]instanceof H)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(let e=0;e<t.length;e++)this._textures.push(t[e].texture),this._durations.push(t[e].time)}this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()}get currentFrame(){let t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t}set currentFrame(t){if(t<0||t>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${t}, expected to be between 0 and totalFrames ${this.totalFrames}.`);const e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(st.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(st.shared.add(this.update,this),this._isConnectedToTicker=!0))}}const _i=new G;class zi extends ut{constructor(t,e=100,s=100){super(t),this.tileTransform=new Xs,this._width=e,this._height=s,this.uvMatrix=this.texture.uvMatrix||new Ar(t),this.pluginName="tilingSprite",this.uvRespectAnchor=!1}get clampMargin(){return this.uvMatrix.clampMargin}set clampMargin(t){this.uvMatrix.clampMargin=t,this.uvMatrix.update(!0)}get tileScale(){return this.tileTransform.scale}set tileScale(t){this.tileTransform.scale.copyFrom(t)}get tilePosition(){return this.tileTransform.position}set tilePosition(t){this.tileTransform.position.copyFrom(t)}_onTextureUpdate(){this.uvMatrix&&(this.uvMatrix.texture=this._texture),this._cachedTint=16777215}_render(t){const e=this._texture;!e||!e.valid||(this.tileTransform.updateLocalTransform(),this.uvMatrix.update(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this))}_calculateBounds(){const t=this._width*-this._anchor._x,e=this._height*-this._anchor._y,s=this._width*(1-this._anchor._x),n=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,t,e,s,n)}getLocalBounds(t){return this.children.length===0?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new q),t=this._localBoundsRect),this._bounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,_i);const e=this._width,s=this._height,n=-e*this.anchor._x;if(_i.x>=n&&_i.x<n+e){const r=-s*this.anchor._y;if(_i.y>=r&&_i.y<r+s)return!0}return!1}destroy(t){super.destroy(t),this.tileTransform=null,this.uvMatrix=null}static from(t,e){const s=t instanceof H?t:H.from(t,e);return new zi(s,e.width,e.height)}get width(){return this._width}set width(t){this._width=t}get height(){return this._height}set height(t){this._height=t}}var Xm=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`,Lo=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,Wm=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,jm=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,Ym=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`;const gs=new gt;class Ah extends Zs{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new Ra,this.state=pe.for2d()}contextChange(){const t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=ee.from(Lo,Xm,e),this.shader=t.context.webGLVersion>1?ee.from(jm,Ym,e):ee.from(Lo,Wm,e)}render(t){const e=this.renderer,s=this.quad;let n=s.vertices;n[0]=n[6]=t._width*-t.anchor.x,n[1]=n[3]=t._height*-t.anchor.y,n[2]=n[4]=t._width*(1-t.anchor.x),n[5]=n[7]=t._height*(1-t.anchor.y);const r=t.uvRespectAnchor?t.anchor.x:0,o=t.uvRespectAnchor?t.anchor.y:0;n=s.uvs,n[0]=n[6]=-r,n[1]=n[3]=-o,n[2]=n[4]=1-r,n[5]=n[7]=1-o,s.invalidate();const a=t._texture,h=a.baseTexture,c=h.alphaMode>0,l=t.tileTransform.localTransform,f=t.uvMatrix;let d=h.isPowerOfTwo&&a.frame.width===h.width&&a.frame.height===h.height;d&&(h._glTextures[e.CONTEXT_UID]?d=h.wrapMode!==_e.CLAMP:h.wrapMode===_e.CLAMP&&(h.wrapMode=_e.REPEAT));const u=d?this.simpleShader:this.shader,p=a.width,m=a.height,g=t._width,_=t._height;gs.set(l.a*p/g,l.b*p/_,l.c*m/g,l.d*m/_,l.tx/g,l.ty/_),gs.invert(),d?gs.prepend(f.mapCoord):(u.uniforms.uMapCoord=f.mapCoord.toArray(!0),u.uniforms.uClampFrame=f.uClampFrame,u.uniforms.uClampOffset=f.uClampOffset),u.uniforms.uTransform=gs.toArray(!0),u.uniforms.uColor=wa(t.tint,t.worldAlpha,u.uniforms.uColor,c),u.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),u.uniforms.uSampler=a,e.shader.bind(u),e.geometry.bind(s),this.state.blendMode=xa(t.blendMode,c),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}Ah.extension={name:"tilingSprite",type:z.RendererPlugin};Y.add(Ah);class ks{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class bs{static test(t){return typeof t=="string"&&t.startsWith("info face=")}static parse(t){const e=t.match(/^[a-z]+\s+.+$/gm),s={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const r in e){const o=e[r].match(/^[a-z]+/gm)[0],a=e[r].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),h={};for(const c in a){const l=a[c].split("="),f=l[0],d=l[1].replace(/"/gm,""),u=parseFloat(d),p=isNaN(u)?d:u;h[f]=p}s[o].push(h)}const n=new ks;return s.info.forEach(r=>n.info.push({face:r.face,size:parseInt(r.size,10)})),s.common.forEach(r=>n.common.push({lineHeight:parseInt(r.lineHeight,10)})),s.page.forEach(r=>n.page.push({id:parseInt(r.id,10),file:r.file})),s.char.forEach(r=>n.char.push({id:parseInt(r.id,10),page:parseInt(r.page,10),x:parseInt(r.x,10),y:parseInt(r.y,10),width:parseInt(r.width,10),height:parseInt(r.height,10),xoffset:parseInt(r.xoffset,10),yoffset:parseInt(r.yoffset,10),xadvance:parseInt(r.xadvance,10)})),s.kerning.forEach(r=>n.kerning.push({first:parseInt(r.first,10),second:parseInt(r.second,10),amount:parseInt(r.amount,10)})),s.distanceField.forEach(r=>n.distanceField.push({distanceRange:parseInt(r.distanceRange,10),fieldType:r.fieldType})),n}}class ir{static test(t){return t instanceof XMLDocument&&t.getElementsByTagName("page").length&&t.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(t){const e=new ks,s=t.getElementsByTagName("info"),n=t.getElementsByTagName("common"),r=t.getElementsByTagName("page"),o=t.getElementsByTagName("char"),a=t.getElementsByTagName("kerning"),h=t.getElementsByTagName("distanceField");for(let c=0;c<s.length;c++)e.info.push({face:s[c].getAttribute("face"),size:parseInt(s[c].getAttribute("size"),10)});for(let c=0;c<n.length;c++)e.common.push({lineHeight:parseInt(n[c].getAttribute("lineHeight"),10)});for(let c=0;c<r.length;c++)e.page.push({id:parseInt(r[c].getAttribute("id"),10)||0,file:r[c].getAttribute("file")});for(let c=0;c<o.length;c++){const l=o[c];e.char.push({id:parseInt(l.getAttribute("id"),10),page:parseInt(l.getAttribute("page"),10)||0,x:parseInt(l.getAttribute("x"),10),y:parseInt(l.getAttribute("y"),10),width:parseInt(l.getAttribute("width"),10),height:parseInt(l.getAttribute("height"),10),xoffset:parseInt(l.getAttribute("xoffset"),10),yoffset:parseInt(l.getAttribute("yoffset"),10),xadvance:parseInt(l.getAttribute("xadvance"),10)})}for(let c=0;c<a.length;c++)e.kerning.push({first:parseInt(a[c].getAttribute("first"),10),second:parseInt(a[c].getAttribute("second"),10),amount:parseInt(a[c].getAttribute("amount"),10)});for(let c=0;c<h.length;c++)e.distanceField.push({fieldType:h[c].getAttribute("fieldType"),distanceRange:parseInt(h[c].getAttribute("distanceRange"),10)});return e}}class sr{static test(t){if(typeof t=="string"&&t.includes("<font>")){const e=new globalThis.DOMParser().parseFromString(t,"text/xml");return ir.test(e)}return!1}static parse(t){const e=new globalThis.DOMParser().parseFromString(t,"text/xml");return ir.parse(e)}}const Pn=[bs,ir,sr];function Km(i){for(let t=0;t<Pn.length;t++)if(Pn[t].test(i))return Pn[t];return null}function Zm(i,t,e,s,n,r){const o=e.fill;if(Array.isArray(o)){if(o.length===1)return o[0]}else return o;let a;const h=e.dropShadow?e.dropShadowDistance:0,c=e.padding||0,l=i.width/s-h-c*2,f=i.height/s-h-c*2,d=o.slice(),u=e.fillGradientStops.slice();if(!u.length){const p=d.length+1;for(let m=1;m<p;++m)u.push(m/p)}if(d.unshift(o[0]),u.unshift(0),d.push(o[o.length-1]),u.push(1),e.fillGradientType===Js.LINEAR_VERTICAL){a=t.createLinearGradient(l/2,c,l/2,f+c);let p=0;const g=(r.fontProperties.fontSize+e.strokeThickness)/f;for(let _=0;_<n.length;_++){const A=r.lineHeight*_;for(let y=0;y<d.length;y++){let v=0;typeof u[y]=="number"?v=u[y]:v=y/d.length;const x=A/f+v*g;let b=Math.max(p,x);b=Math.min(b,1),a.addColorStop(b,d[y]),p=b}}}else{a=t.createLinearGradient(c,f/2,l+c,f/2);const p=d.length+1;let m=1;for(let g=0;g<d.length;g++){let _;typeof u[g]=="number"?_=u[g]:_=m/p,a.addColorStop(_,d[g]),m++}}return a}function Qm(i,t,e,s,n,r,o){const a=e.text,h=e.fontProperties;t.translate(s,n),t.scale(r,r);const c=o.strokeThickness/2,l=-(o.strokeThickness/2);if(t.font=o.toFontString(),t.lineWidth=o.strokeThickness,t.textBaseline=o.textBaseline,t.lineJoin=o.lineJoin,t.miterLimit=o.miterLimit,t.fillStyle=Zm(i,t,o,r,[a],e),t.strokeStyle=o.stroke,o.dropShadow){const f=o.dropShadowColor,d=Oi(typeof f=="number"?f:xr(f)),u=o.dropShadowBlur*r,p=o.dropShadowDistance*r;t.shadowColor=`rgba(${d[0]*255},${d[1]*255},${d[2]*255},${o.dropShadowAlpha})`,t.shadowBlur=u,t.shadowOffsetX=Math.cos(o.dropShadowAngle)*p,t.shadowOffsetY=Math.sin(o.dropShadowAngle)*p}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;o.stroke&&o.strokeThickness&&t.strokeText(a,c,l+e.lineHeight-h.descent),o.fill&&t.fillText(a,c,l+e.lineHeight-h.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle="rgba(0, 0, 0, 0)"}function Eh(i){return Array.from?Array.from(i):i.split("")}function $m(i){typeof i=="string"&&(i=[i]);const t=[];for(let e=0,s=i.length;e<s;e++){const n=i[e];if(Array.isArray(n)){if(n.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${n.length}.`);const r=n[0].charCodeAt(0),o=n[1].charCodeAt(0);if(o<r)throw new Error("[BitmapFont]: Invalid character range.");for(let a=r,h=o;a<=h;a++)t.push(String.fromCharCode(a))}else t.push(...Eh(n))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}function As(i){return i.codePointAt?i.codePointAt(0):i.charCodeAt(0)}const Nt=class{constructor(i,t,e){var c,l;const[s]=i.info,[n]=i.common,[r]=i.page,[o]=i.distanceField,a=xe(r.file),h={};this._ownsTextures=e,this.font=s.face,this.size=s.size,this.lineHeight=n.lineHeight/a,this.chars={},this.pageTextures=h;for(let f=0;f<i.page.length;f++){const{id:d,file:u}=i.page[f];h[d]=t instanceof Array?t[f]:t[u],(o==null?void 0:o.fieldType)&&o.fieldType!=="none"&&(h[d].baseTexture.alphaMode=Wt.NO_PREMULTIPLIED_ALPHA,h[d].baseTexture.mipmap=se.OFF)}for(let f=0;f<i.char.length;f++){const{id:d,page:u}=i.char[f];let{x:p,y:m,width:g,height:_,xoffset:A,yoffset:y,xadvance:v}=i.char[f];p/=a,m/=a,g/=a,_/=a,A/=a,y/=a,v/=a;const x=new q(p+h[u].frame.x/a,m+h[u].frame.y/a,g,_);this.chars[d]={xOffset:A,yOffset:y,xAdvance:v,kerning:{},texture:new H(h[u].baseTexture,x),page:u}}for(let f=0;f<i.kerning.length;f++){let{first:d,second:u,amount:p}=i.kerning[f];d/=a,u/=a,p/=a,this.chars[u]&&(this.chars[u].kerning[d]=p)}this.distanceFieldRange=o==null?void 0:o.distanceRange,this.distanceFieldType=(l=(c=o==null?void 0:o.fieldType)==null?void 0:c.toLowerCase())!=null?l:"none"}destroy(){for(const i in this.chars)this.chars[i].texture.destroy(),this.chars[i].texture=null;for(const i in this.pageTextures)this._ownsTextures&&this.pageTextures[i].destroy(!0),this.pageTextures[i]=null;this.chars=null,this.pageTextures=null}static install(i,t,e){let s;if(i instanceof ks)s=i;else{const r=Km(i);if(!r)throw new Error("Unrecognized data format for font.");s=r.parse(i)}t instanceof H&&(t=[t]);const n=new Nt(s,t,e);return Nt.available[n.font]=n,n}static uninstall(i){const t=Nt.available[i];if(!t)throw new Error(`No font found named '${i}'`);t.destroy(),delete Nt.available[i]}static from(i,t,e){if(!i)throw new Error("[BitmapFont] Property `name` is required.");const{chars:s,padding:n,resolution:r,textureWidth:o,textureHeight:a,...h}=Object.assign({},Nt.defaultOptions,e),c=$m(s),l=t instanceof Ee?t:new Ee(t),f=o,d=new ks;d.info[0]={face:l.fontFamily,size:l.fontSize},d.common[0]={lineHeight:l.fontSize};let u=0,p=0,m,g,_,A=0;const y=[];for(let x=0;x<c.length;x++){m||(m=O.ADAPTER.createCanvas(),m.width=o,m.height=a,g=m.getContext("2d"),_=new J(m,{resolution:r,...h}),y.push(new H(_)),d.page.push({id:y.length-1,file:""}));const b=c[x],w=X.measureText(b,l,!1,m),E=w.width,S=Math.ceil(w.height),C=Math.ceil((l.fontStyle==="italic"?2:1)*E);if(p>=a-S*r){if(p===0)throw new Error(`[BitmapFont] textureHeight ${a}px is too small (fontFamily: '${l.fontFamily}', fontSize: ${l.fontSize}px, char: '${b}')`);--x,m=null,g=null,_=null,p=0,u=0,A=0;continue}if(A=Math.max(S+w.fontProperties.descent,A),C*r+u>=f){if(u===0)throw new Error(`[BitmapFont] textureWidth ${o}px is too small (fontFamily: '${l.fontFamily}', fontSize: ${l.fontSize}px, char: '${b}')`);--x,p+=A*r,p=Math.ceil(p),u=0,A=0;continue}Qm(m,g,w,u,p,r,l);const T=As(w.text);d.char.push({id:T,page:y.length-1,x:u/r,y:p/r,width:C,height:S,xoffset:0,yoffset:0,xadvance:Math.ceil(E-(l.dropShadow?l.dropShadowDistance:0)-(l.stroke?l.strokeThickness:0))}),u+=(C+2*n)*r,u=Math.ceil(u)}for(let x=0,b=c.length;x<b;x++){const w=c[x];for(let E=0;E<b;E++){const S=c[E],C=g.measureText(w).width,T=g.measureText(S).width,P=g.measureText(w+S).width-(C+T);P&&d.kerning.push({first:As(w),second:As(S),amount:P})}}const v=new Nt(d,y,!0);return Nt.available[i]!==void 0&&Nt.uninstall(i),Nt.available[i]=v,v}};let Rt=Nt;Rt.ALPHA=[["a","z"],["A","Z"]," "];Rt.NUMERIC=[["0","9"]];Rt.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "];Rt.ASCII=[[" ","~"]];Rt.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:Nt.ALPHANUMERIC};Rt.available={};var qm=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, uColor.a * alpha);\r
\r
}\r
`,Jm=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;const ko=[],Oo=[],Uo=[],Th=class extends ct{constructor(i,t={}){super(),this._tint=16777215;const{align:e,tint:s,maxWidth:n,letterSpacing:r,fontName:o,fontSize:a}=Object.assign({},Th.styleDefaults,t);if(!Rt.available[o])throw new Error(`Missing BitmapFont "${o}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=e,this._tint=s,this._font=void 0,this._fontName=o,this._fontSize=a,this.text=i,this._maxWidth=n,this._maxLineHeight=0,this._letterSpacing=r,this._anchor=new Ct(()=>{this.dirty=!0},this,0,0),this._roundPixels=O.ROUND_PIXELS,this.dirty=!0,this._resolution=O.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){var C;const i=Rt.available[this._fontName],t=this.fontSize,e=t/i.size,s=new G,n=[],r=[],o=[],a=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",h=Eh(a),c=this._maxWidth*i.size/t,l=i.distanceFieldType==="none"?ko:Oo;let f=null,d=0,u=0,p=0,m=-1,g=0,_=0,A=0,y=0;for(let T=0;T<h.length;T++){const I=h[T],P=As(I);if(/(?:\s)/.test(I)&&(m=T,g=d,y++),I==="\r"||I===`
`){r.push(d),o.push(-1),u=Math.max(u,d),++p,++_,s.x=0,s.y+=i.lineHeight,f=null,y=0;continue}const R=i.chars[P];if(!R)continue;f&&R.kerning[f]&&(s.x+=R.kerning[f]);const L=Uo.pop()||{texture:H.EMPTY,line:0,charCode:0,prevSpaces:0,position:new G};L.texture=R.texture,L.line=p,L.charCode=P,L.position.x=s.x+R.xOffset+this._letterSpacing/2,L.position.y=s.y+R.yOffset,L.prevSpaces=y,n.push(L),d=L.position.x+Math.max(R.xAdvance-R.xOffset,R.texture.orig.width),s.x+=R.xAdvance+this._letterSpacing,A=Math.max(A,R.yOffset+R.texture.height),f=P,m!==-1&&c>0&&s.x>c&&(++_,li(n,1+m-_,1+T-m),T=m,m=-1,r.push(g),o.push(n.length>0?n[n.length-1].prevSpaces:0),u=Math.max(u,g),p++,s.x=0,s.y+=i.lineHeight,f=null,y=0)}const v=h[h.length-1];v!=="\r"&&v!==`
`&&(/(?:\s)/.test(v)&&(d=g),r.push(d),u=Math.max(u,d),o.push(-1));const x=[];for(let T=0;T<=p;T++){let I=0;this._align==="right"?I=u-r[T]:this._align==="center"?I=(u-r[T])/2:this._align==="justify"&&(I=o[T]<0?0:(u-r[T])/o[T]),x.push(I)}const b=n.length,w={},E=[],S=this._activePagesMeshData;l.push(...S);for(let T=0;T<b;T++){const I=n[T].texture,P=I.baseTexture.uid;if(!w[P]){let R=l.pop();if(!R){const k=new Tm;let F,W;i.distanceFieldType==="none"?(F=new Bo(H.EMPTY),W=$.NORMAL):(F=new Bo(H.EMPTY,{program:de.from(Jm,qm),uniforms:{uFWidth:0}}),W=$.NORMAL_NPM);const j=new tr(k,F);j.blendMode=W,R={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:j,vertices:null,uvs:null,indices:null}}R.index=0,R.indexCount=0,R.vertexCount=0,R.uvsCount=0,R.total=0;const{_textureCache:L}=this;L[P]=L[P]||new H(I.baseTexture),R.mesh.texture=L[P],R.mesh.tint=this._tint,E.push(R),w[P]=R}w[P].total++}for(let T=0;T<S.length;T++)E.includes(S[T])||this.removeChild(S[T].mesh);for(let T=0;T<E.length;T++)E[T].mesh.parent!==this&&this.addChild(E[T].mesh);this._activePagesMeshData=E;for(const T in w){const I=w[T],P=I.total;if(!(((C=I.indices)==null?void 0:C.length)>6*P)||I.vertices.length<tr.BATCHABLE_SIZE*2)I.vertices=new Float32Array(4*2*P),I.uvs=new Float32Array(4*2*P),I.indices=new Uint16Array(6*P);else{const R=I.total,L=I.vertices;for(let k=R*4*2;k<L.length;k++)L[k]=0}I.mesh.size=6*P}for(let T=0;T<b;T++){const I=n[T];let P=I.position.x+x[I.line]*(this._align==="justify"?I.prevSpaces:1);this._roundPixels&&(P=Math.round(P));const R=P*e,L=I.position.y*e,k=I.texture,F=w[k.baseTexture.uid],W=k.frame,j=k._uvs,B=F.index++;F.indices[B*6+0]=0+B*4,F.indices[B*6+1]=1+B*4,F.indices[B*6+2]=2+B*4,F.indices[B*6+3]=0+B*4,F.indices[B*6+4]=2+B*4,F.indices[B*6+5]=3+B*4,F.vertices[B*8+0]=R,F.vertices[B*8+1]=L,F.vertices[B*8+2]=R+W.width*e,F.vertices[B*8+3]=L,F.vertices[B*8+4]=R+W.width*e,F.vertices[B*8+5]=L+W.height*e,F.vertices[B*8+6]=R,F.vertices[B*8+7]=L+W.height*e,F.uvs[B*8+0]=j.x0,F.uvs[B*8+1]=j.y0,F.uvs[B*8+2]=j.x1,F.uvs[B*8+3]=j.y1,F.uvs[B*8+4]=j.x2,F.uvs[B*8+5]=j.y2,F.uvs[B*8+6]=j.x3,F.uvs[B*8+7]=j.y3}this._textWidth=u*e,this._textHeight=(s.y+i.lineHeight)*e;for(const T in w){const I=w[T];if(this.anchor.x!==0||this.anchor.y!==0){let k=0;const F=this._textWidth*this.anchor.x,W=this._textHeight*this.anchor.y;for(let j=0;j<I.total;j++)I.vertices[k++]-=F,I.vertices[k++]-=W,I.vertices[k++]-=F,I.vertices[k++]-=W,I.vertices[k++]-=F,I.vertices[k++]-=W,I.vertices[k++]-=F,I.vertices[k++]-=W}this._maxLineHeight=A*e;const P=I.mesh.geometry.getBuffer("aVertexPosition"),R=I.mesh.geometry.getBuffer("aTextureCoord"),L=I.mesh.geometry.getIndex();P.data=I.vertices,R.data=I.uvs,L.data=I.indices,P.update(),R.update(),L.update()}for(let T=0;T<n.length;T++)Uo.push(n[T]);this._font=i,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(i){this._autoResolution&&this._resolution!==i.resolution&&(this._resolution=i.resolution,this.dirty=!0);const{distanceFieldRange:t,distanceFieldType:e,size:s}=Rt.available[this._fontName];if(e!=="none"){const{a:n,b:r,c:o,d:a}=this.worldTransform,h=Math.sqrt(n*n+r*r),c=Math.sqrt(o*o+a*a),l=(Math.abs(h)+Math.abs(c))/2,f=this.fontSize/s,d=i._view.resolution;for(const u of this._activePagesMeshData)u.mesh.shader.uniforms.uFWidth=l*t*f*d}super._render(i)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const i=Rt.available[this._fontName];if(!i)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==i&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tint}set tint(i){if(this._tint!==i){this._tint=i;for(let t=0;t<this._activePagesMeshData.length;t++)this._activePagesMeshData[t].mesh.tint=i}}get align(){return this._align}set align(i){this._align!==i&&(this._align=i,this.dirty=!0)}get fontName(){return this._fontName}set fontName(i){if(!Rt.available[i])throw new Error(`Missing BitmapFont "${i}"`);this._fontName!==i&&(this._fontName=i,this.dirty=!0)}get fontSize(){var i;return(i=this._fontSize)!=null?i:Rt.available[this._fontName].size}set fontSize(i){this._fontSize!==i&&(this._fontSize=i,this.dirty=!0)}get anchor(){return this._anchor}set anchor(i){typeof i=="number"?this._anchor.set(i):this._anchor.copyFrom(i)}get text(){return this._text}set text(i){i=String(i==null?"":i),this._text!==i&&(this._text=i,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(i){this._maxWidth!==i&&(this._maxWidth=i,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(i){this._letterSpacing!==i&&(this._letterSpacing=i,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(i){i!==this._roundPixels&&(this._roundPixels=i,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(i){this._autoResolution=!1,this._resolution!==i&&(this._resolution=i,this.dirty=!0)}destroy(i){const{_textureCache:t}=this,s=Rt.available[this._fontName].distanceFieldType==="none"?ko:Oo;s.push(...this._activePagesMeshData);for(const n of this._activePagesMeshData)this.removeChild(n.mesh);this._activePagesMeshData=[],s.filter(n=>t[n.mesh.texture.baseTexture.uid]).forEach(n=>{n.mesh.texture=H.EMPTY});for(const n in t)t[n].destroy(),delete t[n];this._font=null,this._textureCache=null,super.destroy(i)}};let tg=Th;tg.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const eg=[".xml",".fnt"],ig={extension:{type:z.LoadParser,priority:jt.Normal},test(i){return eg.includes(yt.extname(i))},async testParse(i){return bs.test(i)||sr.test(i)},async parse(i,t,e){const s=bs.test(i)?bs.parse(i):sr.parse(i),{src:n}=t,{page:r}=s,o=[];for(let c=0;c<r.length;++c){const l=r[c].file,f=yt.join(yt.dirname(n),l);o.push(f)}const a=await e.load(o),h=o.map(c=>a[c]);return Rt.install(s,h,!0)},async load(i,t){return(await O.ADAPTER.fetch(i)).text()},unload(i){i.destroy()}};Y.add(ig);q.prototype.containsRect=function(i){return i.x>=this.x&&i.y>=this.y&&i.right<=this.right&&i.bottom<=this.bottom};G.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};Ct.prototype.length=G.prototype.length;G.prototype.add=function(i){return new G(this.x+i.x,this.y+i.y)};Ct.prototype.add=G.prototype.add;G.prototype.sub=function(i){return new G(this.x-i.x,this.y-i.y)};Ct.prototype.sub=G.prototype.sub;G.prototype.scale=function(i){this.x*=i,this.y*=i};Ct.prototype.scale=G.prototype.scale;G.prototype.normalize=function(i=1){let t=this.length();return t!=0&&this.scale(i/t),t};Ct.prototype.normalize=G.prototype.normalize;G.prototype.distanceTo=function(i){let t=this.x-i.x,e=this.y-i.y;return Math.sqrt(t*t+e*e)};Ct.prototype.distanceTo=G.prototype.distanceTo;function Sh(i,t){let e=Math.cos(t),s=Math.sin(t);return i.set(i.x*e-i.y*s,i.y*e+i.x*s),i}G.prototype.rotate=function(i){return Sh(this,i)};Ct.prototype.rotate=function(i){return Sh(this,i)};G.prototype.dot=function(i){return this.x*i.x+this.y*i.y};Ct.prototype.dot=G.prototype.dot;G.prototype.det=function(i){return this.x*i.y-i.x*this.y};Ct.prototype.det=G.prototype.det;var Pi={Linear:{None:function(i){return i}},Quadratic:{In:function(i){return i*i},Out:function(i){return i*(2-i)},InOut:function(i){return(i*=2)<1?.5*i*i:-.5*(--i*(i-2)-1)}},Cubic:{In:function(i){return i*i*i},Out:function(i){return--i*i*i+1},InOut:function(i){return(i*=2)<1?.5*i*i*i:.5*((i-=2)*i*i+2)}},Quartic:{In:function(i){return i*i*i*i},Out:function(i){return 1- --i*i*i*i},InOut:function(i){return(i*=2)<1?.5*i*i*i*i:-.5*((i-=2)*i*i*i-2)}},Quintic:{In:function(i){return i*i*i*i*i},Out:function(i){return--i*i*i*i*i+1},InOut:function(i){return(i*=2)<1?.5*i*i*i*i*i:.5*((i-=2)*i*i*i*i+2)}},Sinusoidal:{In:function(i){return 1-Math.cos(i*Math.PI/2)},Out:function(i){return Math.sin(i*Math.PI/2)},InOut:function(i){return .5*(1-Math.cos(Math.PI*i))}},Exponential:{In:function(i){return i===0?0:Math.pow(1024,i-1)},Out:function(i){return i===1?1:1-Math.pow(2,-10*i)},InOut:function(i){return i===0?0:i===1?1:(i*=2)<1?.5*Math.pow(1024,i-1):.5*(-Math.pow(2,-10*(i-1))+2)}},Circular:{In:function(i){return 1-Math.sqrt(1-i*i)},Out:function(i){return Math.sqrt(1- --i*i)},InOut:function(i){return(i*=2)<1?-.5*(Math.sqrt(1-i*i)-1):.5*(Math.sqrt(1-(i-=2)*i)+1)}},Elastic:{In:function(i){return i===0?0:i===1?1:-Math.pow(2,10*(i-1))*Math.sin((i-1.1)*5*Math.PI)},Out:function(i){return i===0?0:i===1?1:Math.pow(2,-10*i)*Math.sin((i-.1)*5*Math.PI)+1},InOut:function(i){return i===0?0:i===1?1:(i*=2,i<1?-.5*Math.pow(2,10*(i-1))*Math.sin((i-1.1)*5*Math.PI):.5*Math.pow(2,-10*(i-1))*Math.sin((i-1.1)*5*Math.PI)+1)}},Back:{In:function(i){var t=1.70158;return i*i*((t+1)*i-t)},Out:function(i){var t=1.70158;return--i*i*((t+1)*i+t)+1},InOut:function(i){var t=2.5949095;return(i*=2)<1?.5*(i*i*((t+1)*i-t)):.5*((i-=2)*i*((t+1)*i+t)+2)}},Bounce:{In:function(i){return 1-Pi.Bounce.Out(1-i)},Out:function(i){return i<1/2.75?7.5625*i*i:i<2/2.75?7.5625*(i-=1.5/2.75)*i+.75:i<2.5/2.75?7.5625*(i-=2.25/2.75)*i+.9375:7.5625*(i-=2.625/2.75)*i+.984375},InOut:function(i){return i<.5?Pi.Bounce.In(i*2)*.5:Pi.Bounce.Out(i*2-1)*.5+.5}}},Ti;typeof self>"u"&&typeof process<"u"&&process.hrtime?Ti=function(){var i=process.hrtime();return i[0]*1e3+i[1]/1e6}:typeof self<"u"&&self.performance!==void 0&&self.performance.now!==void 0?Ti=self.performance.now.bind(self.performance):Date.now!==void 0?Ti=Date.now:Ti=function(){return new Date().getTime()};var Ze=Ti,sg=function(){function i(){this._tweens={},this._tweensAddedDuringUpdate={}}return i.prototype.getAll=function(){var t=this;return Object.keys(this._tweens).map(function(e){return t._tweens[e]})},i.prototype.removeAll=function(){this._tweens={}},i.prototype.add=function(t){this._tweens[t.getId()]=t,this._tweensAddedDuringUpdate[t.getId()]=t},i.prototype.remove=function(t){delete this._tweens[t.getId()],delete this._tweensAddedDuringUpdate[t.getId()]},i.prototype.update=function(t,e){t===void 0&&(t=Ze()),e===void 0&&(e=!1);var s=Object.keys(this._tweens);if(s.length===0)return!1;for(;s.length>0;){this._tweensAddedDuringUpdate={};for(var n=0;n<s.length;n++){var r=this._tweens[s[n]],o=!e;r&&r.update(t,o)===!1&&!e&&delete this._tweens[s[n]]}s=Object.keys(this._tweensAddedDuringUpdate)}return!0},i}(),Si={Linear:function(i,t){var e=i.length-1,s=e*t,n=Math.floor(s),r=Si.Utils.Linear;return t<0?r(i[0],i[1],s):t>1?r(i[e],i[e-1],e-s):r(i[n],i[n+1>e?e:n+1],s-n)},Bezier:function(i,t){for(var e=0,s=i.length-1,n=Math.pow,r=Si.Utils.Bernstein,o=0;o<=s;o++)e+=n(1-t,s-o)*n(t,o)*i[o]*r(s,o);return e},CatmullRom:function(i,t){var e=i.length-1,s=e*t,n=Math.floor(s),r=Si.Utils.CatmullRom;return i[0]===i[e]?(t<0&&(n=Math.floor(s=e*(1+t))),r(i[(n-1+e)%e],i[n],i[(n+1)%e],i[(n+2)%e],s-n)):t<0?i[0]-(r(i[0],i[0],i[1],i[1],-s)-i[0]):t>1?i[e]-(r(i[e],i[e],i[e-1],i[e-1],s-e)-i[e]):r(i[n?n-1:0],i[n],i[e<n+1?e:n+1],i[e<n+2?e:n+2],s-n)},Utils:{Linear:function(i,t,e){return(t-i)*e+i},Bernstein:function(i,t){var e=Si.Utils.Factorial;return e(i)/e(t)/e(i-t)},Factorial:function(){var i=[1];return function(t){var e=1;if(i[t])return i[t];for(var s=t;s>1;s--)e*=s;return i[t]=e,e}}(),CatmullRom:function(i,t,e,s,n){var r=(e-i)*.5,o=(s-t)*.5,a=n*n,h=n*a;return(2*t-2*e+r+o)*h+(-3*t+3*e-2*r-o)*a+r*n+t}}},Ch=function(){function i(){}return i.nextId=function(){return i._nextId++},i._nextId=0,i}(),Ih=new sg,ng=function(){function i(t,e){e===void 0&&(e=Ih),this._object=t,this._group=e,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=Pi.Linear.None,this._interpolationFunction=Si.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._id=Ch.nextId(),this._isChainStopped=!1,this._goToEnd=!1}return i.prototype.getId=function(){return this._id},i.prototype.isPlaying=function(){return this._isPlaying},i.prototype.isPaused=function(){return this._isPaused},i.prototype.to=function(t,e){return this._valuesEnd=Object.create(t),e!==void 0&&(this._duration=e),this},i.prototype.duration=function(t){return this._duration=t,this},i.prototype.start=function(t){if(this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var e in this._valuesStartRepeat)this._swapEndStartRepeatValues(e),this._valuesStart[e]=this._valuesStartRepeat[e]}return this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=t!==void 0?typeof t=="string"?Ze()+parseFloat(t):t:Ze(),this._startTime+=this._delayTime,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat),this},i.prototype._setupProperties=function(t,e,s,n){for(var r in s){var o=t[r],a=Array.isArray(o),h=a?"array":typeof o,c=!a&&Array.isArray(s[r]);if(!(h==="undefined"||h==="function")){if(c){var l=s[r];if(l.length===0)continue;l=l.map(this._handleRelativeValue.bind(this,o)),s[r]=[o].concat(l)}if((h==="object"||a)&&o&&!c){e[r]=a?[]:{};for(var f in o)e[r][f]=o[f];n[r]=a?[]:{},this._setupProperties(o,e[r],s[r],n[r])}else typeof e[r]>"u"&&(e[r]=o),a||(e[r]*=1),c?n[r]=s[r].slice().reverse():n[r]=e[r]||0}}},i.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},i.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},i.prototype.pause=function(t){return t===void 0&&(t=Ze()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=t,this._group&&this._group.remove(this),this)},i.prototype.resume=function(t){return t===void 0&&(t=Ze()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=t-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this)},i.prototype.stopChainedTweens=function(){for(var t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].stop();return this},i.prototype.group=function(t){return this._group=t,this},i.prototype.delay=function(t){return this._delayTime=t,this},i.prototype.repeat=function(t){return this._initialRepeat=t,this._repeat=t,this},i.prototype.repeatDelay=function(t){return this._repeatDelayTime=t,this},i.prototype.yoyo=function(t){return this._yoyo=t,this},i.prototype.easing=function(t){return this._easingFunction=t,this},i.prototype.interpolation=function(t){return this._interpolationFunction=t,this},i.prototype.chain=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._chainedTweens=t,this},i.prototype.onStart=function(t){return this._onStartCallback=t,this},i.prototype.onUpdate=function(t){return this._onUpdateCallback=t,this},i.prototype.onRepeat=function(t){return this._onRepeatCallback=t,this},i.prototype.onComplete=function(t){return this._onCompleteCallback=t,this},i.prototype.onStop=function(t){return this._onStopCallback=t,this},i.prototype.update=function(t,e){if(t===void 0&&(t=Ze()),e===void 0&&(e=!0),this._isPaused)return!0;var s,n,r=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(t>r)return!1;e&&this.start(t)}if(this._goToEnd=!1,t<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),n=(t-this._startTime)/this._duration,n=this._duration===0||n>1?1:n;var o=this._easingFunction(n);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,o),this._onUpdateCallback&&this._onUpdateCallback(this._object,n),n===1)if(this._repeat>0){isFinite(this._repeat)&&this._repeat--;for(s in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[s]=="string"&&(this._valuesStartRepeat[s]=this._valuesStartRepeat[s]+parseFloat(this._valuesEnd[s])),this._yoyo&&this._swapEndStartRepeatValues(s),this._valuesStart[s]=this._valuesStartRepeat[s];return this._yoyo&&(this._reversed=!this._reversed),this._repeatDelayTime!==void 0?this._startTime=t+this._repeatDelayTime:this._startTime=t+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var a=0,h=this._chainedTweens.length;a<h;a++)this._chainedTweens[a].start(this._startTime+this._duration);return this._isPlaying=!1,!1}return!0},i.prototype._updateProperties=function(t,e,s,n){for(var r in s)if(e[r]!==void 0){var o=e[r]||0,a=s[r],h=Array.isArray(t[r]),c=Array.isArray(a),l=!h&&c;l?t[r]=this._interpolationFunction(a,n):typeof a=="object"&&a?this._updateProperties(t[r],o,a,n):(a=this._handleRelativeValue(o,a),typeof a=="number"&&(t[r]=o+(a-o)*n))}},i.prototype._handleRelativeValue=function(t,e){return typeof e!="string"?e:e.charAt(0)==="+"||e.charAt(0)==="-"?t+parseFloat(e):parseFloat(e)},i.prototype._swapEndStartRepeatValues=function(t){var e=this._valuesStartRepeat[t],s=this._valuesEnd[t];typeof s=="string"?this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(s):this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=e},i}();Ch.nextId;var ne=Ih;ne.getAll.bind(ne);ne.removeAll.bind(ne);ne.add.bind(ne);ne.remove.bind(ne);var rg=ne.update.bind(ne);class ui{static addUniqueItem(t,e){return t.includes(e)?!1:(t.push(e),!0)}static removeItem(t,e){let s=t.indexOf(e);return s==-1?!1:(t.splice(s,1),!0)}static getRandomItem(t,e){if(!t.length)throw new Error("\u7121\u6CD5\u5F9E\u7A7A\u9663\u5217\u53D6\u5143\u7D20");let s=Math.random()*t.length,n=Math.floor(s),r=t[n];return e&&t.splice(n,1),r}static sortNumeric(t,e){e?t.sort((s,n)=>n-s):t.sort((s,n)=>s-n)}static sortNumericOn(t,e,s){return s?t.sort((n,r)=>r[e]-n[e]):t.sort((n,r)=>n[e]-r[e]),t}static swapAt(t,e,s){let n=t[e];t[e]=t[s],t[s]=n}}class og{constructor(t,e,s){this.endTime=t,this.resolve=e,this.reject=s}cancel(){this.reject("Wait canceled")}}class ag{constructor(t){N(this,"waits",[]);N(this,"now",0);this.ticker=t,t.add(this.update,this)}destroy(){this.ticker.remove(this.update,this)}update(t){for(this.now+=t;this.waits.length;){let e=this.waits[0];if(e.endTime>this.now)break;this.waits.shift(),e.resolve()}rg(performance.now())}add(t){return new Promise((e,s)=>{let n=new og(this.now+t,e,s);this.waits.push(n),ui.sortNumericOn(this.waits,"endTime")})}}const nr=new G;function hg(i){let t=i.stage;t.interactive=!0,t.hitArea=new q(-1e4,-1e4,2e4,2e4),t.on("pointermove",e=>{nr.copyFrom(e.global)}),t.on("pointerdown",e=>{nr.copyFrom(e.global)})}var ht={exports:{}};/*!
 * matter-js 0.18.0 by @liabru
 * http://brm.io/matter-js/
 * License MIT
 * 
 * The MIT License (MIT)
 * 
 * Copyright (c) Liam Brummitt and contributors.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */(function(i,t){(function(s,n){i.exports=n()})(ai,function(){return function(e){var s={};function n(r){if(s[r])return s[r].exports;var o=s[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=s,n.d=function(r,o,a){n.o(r,o)||Object.defineProperty(r,o,{enumerable:!0,get:a})},n.r=function(r){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},n.t=function(r,o){if(o&1&&(r=n(r)),o&8||o&4&&typeof r=="object"&&r&&r.__esModule)return r;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:r}),o&2&&typeof r!="string")for(var h in r)n.d(a,h,function(c){return r[c]}.bind(null,h));return a},n.n=function(r){var o=r&&r.__esModule?function(){return r.default}:function(){return r};return n.d(o,"a",o),o},n.o=function(r,o){return Object.prototype.hasOwnProperty.call(r,o)},n.p="",n(n.s=21)}([function(e,s){var n={};e.exports=n,function(){n._nextId=0,n._seed=0,n._nowStartTime=+new Date,n._warnedOnce={},n._decomp=null,n.extend=function(o,a){var h,c;typeof a=="boolean"?(h=2,c=a):(h=1,c=!0);for(var l=h;l<arguments.length;l++){var f=arguments[l];if(f)for(var d in f)c&&f[d]&&f[d].constructor===Object&&(!o[d]||o[d].constructor===Object)?(o[d]=o[d]||{},n.extend(o[d],c,f[d])):o[d]=f[d]}return o},n.clone=function(o,a){return n.extend({},a,o)},n.keys=function(o){if(Object.keys)return Object.keys(o);var a=[];for(var h in o)a.push(h);return a},n.values=function(o){var a=[];if(Object.keys){for(var h=Object.keys(o),c=0;c<h.length;c++)a.push(o[h[c]]);return a}for(var l in o)a.push(o[l]);return a},n.get=function(o,a,h,c){a=a.split(".").slice(h,c);for(var l=0;l<a.length;l+=1)o=o[a[l]];return o},n.set=function(o,a,h,c,l){var f=a.split(".").slice(c,l);return n.get(o,a,0,-1)[f[f.length-1]]=h,h},n.shuffle=function(o){for(var a=o.length-1;a>0;a--){var h=Math.floor(n.random()*(a+1)),c=o[a];o[a]=o[h],o[h]=c}return o},n.choose=function(o){return o[Math.floor(n.random()*o.length)]},n.isElement=function(o){return typeof HTMLElement<"u"?o instanceof HTMLElement:!!(o&&o.nodeType&&o.nodeName)},n.isArray=function(o){return Object.prototype.toString.call(o)==="[object Array]"},n.isFunction=function(o){return typeof o=="function"},n.isPlainObject=function(o){return typeof o=="object"&&o.constructor===Object},n.isString=function(o){return toString.call(o)==="[object String]"},n.clamp=function(o,a,h){return o<a?a:o>h?h:o},n.sign=function(o){return o<0?-1:1},n.now=function(){if(typeof window<"u"&&window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return Date.now?Date.now():new Date-n._nowStartTime},n.random=function(o,a){return o=typeof o<"u"?o:0,a=typeof a<"u"?a:1,o+r()*(a-o)};var r=function(){return n._seed=(n._seed*9301+49297)%233280,n._seed/233280};n.colorToNumber=function(o){return o=o.replace("#",""),o.length==3&&(o=o.charAt(0)+o.charAt(0)+o.charAt(1)+o.charAt(1)+o.charAt(2)+o.charAt(2)),parseInt(o,16)},n.logLevel=1,n.log=function(){console&&n.logLevel>0&&n.logLevel<=3&&console.log.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},n.info=function(){console&&n.logLevel>0&&n.logLevel<=2&&console.info.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},n.warn=function(){console&&n.logLevel>0&&n.logLevel<=3&&console.warn.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},n.warnOnce=function(){var o=Array.prototype.slice.call(arguments).join(" ");n._warnedOnce[o]||(n.warn(o),n._warnedOnce[o]=!0)},n.deprecated=function(o,a,h){o[a]=n.chain(function(){n.warnOnce("\u{1F505} deprecated \u{1F505}",h)},o[a])},n.nextId=function(){return n._nextId++},n.indexOf=function(o,a){if(o.indexOf)return o.indexOf(a);for(var h=0;h<o.length;h++)if(o[h]===a)return h;return-1},n.map=function(o,a){if(o.map)return o.map(a);for(var h=[],c=0;c<o.length;c+=1)h.push(a(o[c]));return h},n.topologicalSort=function(o){var a=[],h=[],c=[];for(var l in o)!h[l]&&!c[l]&&n._topologicalSort(l,h,c,o,a);return a},n._topologicalSort=function(o,a,h,c,l){var f=c[o]||[];h[o]=!0;for(var d=0;d<f.length;d+=1){var u=f[d];h[u]||a[u]||n._topologicalSort(u,a,h,c,l)}h[o]=!1,a[o]=!0,l.push(o)},n.chain=function(){for(var o=[],a=0;a<arguments.length;a+=1){var h=arguments[a];h._chained?o.push.apply(o,h._chained):o.push(h)}var c=function(){for(var l,f=new Array(arguments.length),d=0,u=arguments.length;d<u;d++)f[d]=arguments[d];for(d=0;d<o.length;d+=1){var p=o[d].apply(l,f);typeof p<"u"&&(l=p)}return l};return c._chained=o,c},n.chainPathBefore=function(o,a,h){return n.set(o,a,n.chain(h,n.get(o,a)))},n.chainPathAfter=function(o,a,h){return n.set(o,a,n.chain(n.get(o,a),h))},n.setDecomp=function(o){n._decomp=o},n.getDecomp=function(){var o=n._decomp;try{!o&&typeof window<"u"&&(o=window.decomp),!o&&typeof ai<"u"&&(o=ai.decomp)}catch{o=null}return o}}()},function(e,s){var n={};e.exports=n,function(){n.create=function(r){var o={min:{x:0,y:0},max:{x:0,y:0}};return r&&n.update(o,r),o},n.update=function(r,o,a){r.min.x=1/0,r.max.x=-1/0,r.min.y=1/0,r.max.y=-1/0;for(var h=0;h<o.length;h++){var c=o[h];c.x>r.max.x&&(r.max.x=c.x),c.x<r.min.x&&(r.min.x=c.x),c.y>r.max.y&&(r.max.y=c.y),c.y<r.min.y&&(r.min.y=c.y)}a&&(a.x>0?r.max.x+=a.x:r.min.x+=a.x,a.y>0?r.max.y+=a.y:r.min.y+=a.y)},n.contains=function(r,o){return o.x>=r.min.x&&o.x<=r.max.x&&o.y>=r.min.y&&o.y<=r.max.y},n.overlaps=function(r,o){return r.min.x<=o.max.x&&r.max.x>=o.min.x&&r.max.y>=o.min.y&&r.min.y<=o.max.y},n.translate=function(r,o){r.min.x+=o.x,r.max.x+=o.x,r.min.y+=o.y,r.max.y+=o.y},n.shift=function(r,o){var a=r.max.x-r.min.x,h=r.max.y-r.min.y;r.min.x=o.x,r.max.x=o.x+a,r.min.y=o.y,r.max.y=o.y+h}}()},function(e,s){var n={};e.exports=n,function(){n.create=function(r,o){return{x:r||0,y:o||0}},n.clone=function(r){return{x:r.x,y:r.y}},n.magnitude=function(r){return Math.sqrt(r.x*r.x+r.y*r.y)},n.magnitudeSquared=function(r){return r.x*r.x+r.y*r.y},n.rotate=function(r,o,a){var h=Math.cos(o),c=Math.sin(o);a||(a={});var l=r.x*h-r.y*c;return a.y=r.x*c+r.y*h,a.x=l,a},n.rotateAbout=function(r,o,a,h){var c=Math.cos(o),l=Math.sin(o);h||(h={});var f=a.x+((r.x-a.x)*c-(r.y-a.y)*l);return h.y=a.y+((r.x-a.x)*l+(r.y-a.y)*c),h.x=f,h},n.normalise=function(r){var o=n.magnitude(r);return o===0?{x:0,y:0}:{x:r.x/o,y:r.y/o}},n.dot=function(r,o){return r.x*o.x+r.y*o.y},n.cross=function(r,o){return r.x*o.y-r.y*o.x},n.cross3=function(r,o,a){return(o.x-r.x)*(a.y-r.y)-(o.y-r.y)*(a.x-r.x)},n.add=function(r,o,a){return a||(a={}),a.x=r.x+o.x,a.y=r.y+o.y,a},n.sub=function(r,o,a){return a||(a={}),a.x=r.x-o.x,a.y=r.y-o.y,a},n.mult=function(r,o){return{x:r.x*o,y:r.y*o}},n.div=function(r,o){return{x:r.x/o,y:r.y/o}},n.perp=function(r,o){return o=o===!0?-1:1,{x:o*-r.y,y:o*r.x}},n.neg=function(r){return{x:-r.x,y:-r.y}},n.angle=function(r,o){return Math.atan2(o.y-r.y,o.x-r.x)},n._temp=[n.create(),n.create(),n.create(),n.create(),n.create(),n.create()]}()},function(e,s,n){var r={};e.exports=r;var o=n(2),a=n(0);(function(){r.create=function(h,c){for(var l=[],f=0;f<h.length;f++){var d=h[f],u={x:d.x,y:d.y,index:f,body:c,isInternal:!1};l.push(u)}return l},r.fromPath=function(h,c){var l=/L?\s*([-\d.e]+)[\s,]*([-\d.e]+)*/ig,f=[];return h.replace(l,function(d,u,p){f.push({x:parseFloat(u),y:parseFloat(p)})}),r.create(f,c)},r.centre=function(h){for(var c=r.area(h,!0),l={x:0,y:0},f,d,u,p=0;p<h.length;p++)u=(p+1)%h.length,f=o.cross(h[p],h[u]),d=o.mult(o.add(h[p],h[u]),f),l=o.add(l,d);return o.div(l,6*c)},r.mean=function(h){for(var c={x:0,y:0},l=0;l<h.length;l++)c.x+=h[l].x,c.y+=h[l].y;return o.div(c,h.length)},r.area=function(h,c){for(var l=0,f=h.length-1,d=0;d<h.length;d++)l+=(h[f].x-h[d].x)*(h[f].y+h[d].y),f=d;return c?l/2:Math.abs(l)/2},r.inertia=function(h,c){for(var l=0,f=0,d=h,u,p,m=0;m<d.length;m++)p=(m+1)%d.length,u=Math.abs(o.cross(d[p],d[m])),l+=u*(o.dot(d[p],d[p])+o.dot(d[p],d[m])+o.dot(d[m],d[m])),f+=u;return c/6*(l/f)},r.translate=function(h,c,l){l=typeof l<"u"?l:1;var f=h.length,d=c.x*l,u=c.y*l,p;for(p=0;p<f;p++)h[p].x+=d,h[p].y+=u;return h},r.rotate=function(h,c,l){if(c!==0){var f=Math.cos(c),d=Math.sin(c),u=l.x,p=l.y,m=h.length,g,_,A,y;for(y=0;y<m;y++)g=h[y],_=g.x-u,A=g.y-p,g.x=u+(_*f-A*d),g.y=p+(_*d+A*f);return h}},r.contains=function(h,c){for(var l=c.x,f=c.y,d=h.length,u=h[d-1],p,m=0;m<d;m++){if(p=h[m],(l-u.x)*(p.y-u.y)+(f-u.y)*(u.x-p.x)>0)return!1;u=p}return!0},r.scale=function(h,c,l,f){if(c===1&&l===1)return h;f=f||r.centre(h);for(var d,u,p=0;p<h.length;p++)d=h[p],u=o.sub(d,f),h[p].x=f.x+u.x*c,h[p].y=f.y+u.y*l;return h},r.chamfer=function(h,c,l,f,d){typeof c=="number"?c=[c]:c=c||[8],l=typeof l<"u"?l:-1,f=f||2,d=d||14;for(var u=[],p=0;p<h.length;p++){var m=h[p-1>=0?p-1:h.length-1],g=h[p],_=h[(p+1)%h.length],A=c[p<c.length?p:c.length-1];if(A===0){u.push(g);continue}var y=o.normalise({x:g.y-m.y,y:m.x-g.x}),v=o.normalise({x:_.y-g.y,y:g.x-_.x}),x=Math.sqrt(2*Math.pow(A,2)),b=o.mult(a.clone(y),A),w=o.normalise(o.mult(o.add(y,v),.5)),E=o.sub(g,o.mult(w,x)),S=l;l===-1&&(S=Math.pow(A,.32)*1.75),S=a.clamp(S,f,d),S%2===1&&(S+=1);for(var C=Math.acos(o.dot(y,v)),T=C/S,I=0;I<S;I++)u.push(o.add(o.rotate(b,T*I),E))}return u},r.clockwiseSort=function(h){var c=r.mean(h);return h.sort(function(l,f){return o.angle(c,l)-o.angle(c,f)}),h},r.isConvex=function(h){var c=0,l=h.length,f,d,u,p;if(l<3)return null;for(f=0;f<l;f++)if(d=(f+1)%l,u=(f+2)%l,p=(h[d].x-h[f].x)*(h[u].y-h[d].y),p-=(h[d].y-h[f].y)*(h[u].x-h[d].x),p<0?c|=1:p>0&&(c|=2),c===3)return!1;return c!==0?!0:null},r.hull=function(h){var c=[],l=[],f,d;for(h=h.slice(0),h.sort(function(u,p){var m=u.x-p.x;return m!==0?m:u.y-p.y}),d=0;d<h.length;d+=1){for(f=h[d];l.length>=2&&o.cross3(l[l.length-2],l[l.length-1],f)<=0;)l.pop();l.push(f)}for(d=h.length-1;d>=0;d-=1){for(f=h[d];c.length>=2&&o.cross3(c[c.length-2],c[c.length-1],f)<=0;)c.pop();c.push(f)}return c.pop(),l.pop(),c.concat(l)}})()},function(e,s,n){var r={};e.exports=r;var o=n(0);(function(){r.on=function(a,h,c){for(var l=h.split(" "),f,d=0;d<l.length;d++)f=l[d],a.events=a.events||{},a.events[f]=a.events[f]||[],a.events[f].push(c);return c},r.off=function(a,h,c){if(!h){a.events={};return}typeof h=="function"&&(c=h,h=o.keys(a.events).join(" "));for(var l=h.split(" "),f=0;f<l.length;f++){var d=a.events[l[f]],u=[];if(c&&d)for(var p=0;p<d.length;p++)d[p]!==c&&u.push(d[p]);a.events[l[f]]=u}},r.trigger=function(a,h,c){var l,f,d,u,p=a.events;if(p&&o.keys(p).length>0){c||(c={}),l=h.split(" ");for(var m=0;m<l.length;m++)if(f=l[m],d=p[f],d){u=o.clone(c,!1),u.name=f,u.source=a;for(var g=0;g<d.length;g++)d[g].apply(a,[u])}}}})()},function(e,s,n){var r={};e.exports=r;var o=n(4),a=n(0),h=n(1),c=n(6);(function(){r.create=function(l){return a.extend({id:a.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite",plugin:{},cache:{allBodies:null,allConstraints:null,allComposites:null}},l)},r.setModified=function(l,f,d,u){if(l.isModified=f,f&&l.cache&&(l.cache.allBodies=null,l.cache.allConstraints=null,l.cache.allComposites=null),d&&l.parent&&r.setModified(l.parent,f,d,u),u)for(var p=0;p<l.composites.length;p++){var m=l.composites[p];r.setModified(m,f,d,u)}},r.add=function(l,f){var d=[].concat(f);o.trigger(l,"beforeAdd",{object:f});for(var u=0;u<d.length;u++){var p=d[u];switch(p.type){case"body":if(p.parent!==p){a.warn("Composite.add: skipped adding a compound body part (you must add its parent instead)");break}r.addBody(l,p);break;case"constraint":r.addConstraint(l,p);break;case"composite":r.addComposite(l,p);break;case"mouseConstraint":r.addConstraint(l,p.constraint);break}}return o.trigger(l,"afterAdd",{object:f}),l},r.remove=function(l,f,d){var u=[].concat(f);o.trigger(l,"beforeRemove",{object:f});for(var p=0;p<u.length;p++){var m=u[p];switch(m.type){case"body":r.removeBody(l,m,d);break;case"constraint":r.removeConstraint(l,m,d);break;case"composite":r.removeComposite(l,m,d);break;case"mouseConstraint":r.removeConstraint(l,m.constraint);break}}return o.trigger(l,"afterRemove",{object:f}),l},r.addComposite=function(l,f){return l.composites.push(f),f.parent=l,r.setModified(l,!0,!0,!1),l},r.removeComposite=function(l,f,d){var u=a.indexOf(l.composites,f);if(u!==-1&&r.removeCompositeAt(l,u),d)for(var p=0;p<l.composites.length;p++)r.removeComposite(l.composites[p],f,!0);return l},r.removeCompositeAt=function(l,f){return l.composites.splice(f,1),r.setModified(l,!0,!0,!1),l},r.addBody=function(l,f){return l.bodies.push(f),r.setModified(l,!0,!0,!1),l},r.removeBody=function(l,f,d){var u=a.indexOf(l.bodies,f);if(u!==-1&&r.removeBodyAt(l,u),d)for(var p=0;p<l.composites.length;p++)r.removeBody(l.composites[p],f,!0);return l},r.removeBodyAt=function(l,f){return l.bodies.splice(f,1),r.setModified(l,!0,!0,!1),l},r.addConstraint=function(l,f){return l.constraints.push(f),r.setModified(l,!0,!0,!1),l},r.removeConstraint=function(l,f,d){var u=a.indexOf(l.constraints,f);if(u!==-1&&r.removeConstraintAt(l,u),d)for(var p=0;p<l.composites.length;p++)r.removeConstraint(l.composites[p],f,!0);return l},r.removeConstraintAt=function(l,f){return l.constraints.splice(f,1),r.setModified(l,!0,!0,!1),l},r.clear=function(l,f,d){if(d)for(var u=0;u<l.composites.length;u++)r.clear(l.composites[u],f,!0);return f?l.bodies=l.bodies.filter(function(p){return p.isStatic}):l.bodies.length=0,l.constraints.length=0,l.composites.length=0,r.setModified(l,!0,!0,!1),l},r.allBodies=function(l){if(l.cache&&l.cache.allBodies)return l.cache.allBodies;for(var f=[].concat(l.bodies),d=0;d<l.composites.length;d++)f=f.concat(r.allBodies(l.composites[d]));return l.cache&&(l.cache.allBodies=f),f},r.allConstraints=function(l){if(l.cache&&l.cache.allConstraints)return l.cache.allConstraints;for(var f=[].concat(l.constraints),d=0;d<l.composites.length;d++)f=f.concat(r.allConstraints(l.composites[d]));return l.cache&&(l.cache.allConstraints=f),f},r.allComposites=function(l){if(l.cache&&l.cache.allComposites)return l.cache.allComposites;for(var f=[].concat(l.composites),d=0;d<l.composites.length;d++)f=f.concat(r.allComposites(l.composites[d]));return l.cache&&(l.cache.allComposites=f),f},r.get=function(l,f,d){var u,p;switch(d){case"body":u=r.allBodies(l);break;case"constraint":u=r.allConstraints(l);break;case"composite":u=r.allComposites(l).concat(l);break}return u?(p=u.filter(function(m){return m.id.toString()===f.toString()}),p.length===0?null:p[0]):null},r.move=function(l,f,d){return r.remove(l,f),r.add(d,f),l},r.rebase=function(l){for(var f=r.allBodies(l).concat(r.allConstraints(l)).concat(r.allComposites(l)),d=0;d<f.length;d++)f[d].id=a.nextId();return l},r.translate=function(l,f,d){for(var u=d?r.allBodies(l):l.bodies,p=0;p<u.length;p++)c.translate(u[p],f);return l},r.rotate=function(l,f,d,u){for(var p=Math.cos(f),m=Math.sin(f),g=u?r.allBodies(l):l.bodies,_=0;_<g.length;_++){var A=g[_],y=A.position.x-d.x,v=A.position.y-d.y;c.setPosition(A,{x:d.x+(y*p-v*m),y:d.y+(y*m+v*p)}),c.rotate(A,f)}return l},r.scale=function(l,f,d,u,p){for(var m=p?r.allBodies(l):l.bodies,g=0;g<m.length;g++){var _=m[g],A=_.position.x-u.x,y=_.position.y-u.y;c.setPosition(_,{x:u.x+A*f,y:u.y+y*d}),c.scale(_,f,d)}return l},r.bounds=function(l){for(var f=r.allBodies(l),d=[],u=0;u<f.length;u+=1){var p=f[u];d.push(p.bounds.min,p.bounds.max)}return h.create(d)}})()},function(e,s,n){var r={};e.exports=r;var o=n(3),a=n(2),h=n(7);n(16);var c=n(0),l=n(1),f=n(11);(function(){r._inertiaScale=4,r._nextCollidingGroupId=1,r._nextNonCollidingGroupId=-1,r._nextCategory=1,r.create=function(u){var p={id:c.nextId(),type:"body",label:"Body",parts:[],plugin:{},angle:0,vertices:o.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,strokeStyle:null,fillStyle:null,lineWidth:null,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0}},events:null,bounds:null,chamfer:null,circleRadius:0,positionPrev:null,anglePrev:0,parent:null,axes:null,area:0,mass:0,inertia:0,_original:null},m=c.extend(p,u);return d(m,u),m},r.nextGroup=function(u){return u?r._nextNonCollidingGroupId--:r._nextCollidingGroupId++},r.nextCategory=function(){return r._nextCategory=r._nextCategory<<1,r._nextCategory};var d=function(u,p){p=p||{},r.set(u,{bounds:u.bounds||l.create(u.vertices),positionPrev:u.positionPrev||a.clone(u.position),anglePrev:u.anglePrev||u.angle,vertices:u.vertices,parts:u.parts||[u],isStatic:u.isStatic,isSleeping:u.isSleeping,parent:u.parent||u}),o.rotate(u.vertices,u.angle,u.position),f.rotate(u.axes,u.angle),l.update(u.bounds,u.vertices,u.velocity),r.set(u,{axes:p.axes||u.axes,area:p.area||u.area,mass:p.mass||u.mass,inertia:p.inertia||u.inertia});var m=u.isStatic?"#14151f":c.choose(["#f19648","#f5d259","#f55a3c","#063e7b","#ececd1"]),g=u.isStatic?"#555":"#ccc",_=u.isStatic&&u.render.fillStyle===null?1:0;u.render.fillStyle=u.render.fillStyle||m,u.render.strokeStyle=u.render.strokeStyle||g,u.render.lineWidth=u.render.lineWidth||_,u.render.sprite.xOffset+=-(u.bounds.min.x-u.position.x)/(u.bounds.max.x-u.bounds.min.x),u.render.sprite.yOffset+=-(u.bounds.min.y-u.position.y)/(u.bounds.max.y-u.bounds.min.y)};r.set=function(u,p,m){var g;typeof p=="string"&&(g=p,p={},p[g]=m);for(g in p)if(!!Object.prototype.hasOwnProperty.call(p,g))switch(m=p[g],g){case"isStatic":r.setStatic(u,m);break;case"isSleeping":h.set(u,m);break;case"mass":r.setMass(u,m);break;case"density":r.setDensity(u,m);break;case"inertia":r.setInertia(u,m);break;case"vertices":r.setVertices(u,m);break;case"position":r.setPosition(u,m);break;case"angle":r.setAngle(u,m);break;case"velocity":r.setVelocity(u,m);break;case"angularVelocity":r.setAngularVelocity(u,m);break;case"parts":r.setParts(u,m);break;case"centre":r.setCentre(u,m);break;default:u[g]=m}},r.setStatic=function(u,p){for(var m=0;m<u.parts.length;m++){var g=u.parts[m];g.isStatic=p,p?(g._original={restitution:g.restitution,friction:g.friction,mass:g.mass,inertia:g.inertia,density:g.density,inverseMass:g.inverseMass,inverseInertia:g.inverseInertia},g.restitution=0,g.friction=1,g.mass=g.inertia=g.density=1/0,g.inverseMass=g.inverseInertia=0,g.positionPrev.x=g.position.x,g.positionPrev.y=g.position.y,g.anglePrev=g.angle,g.angularVelocity=0,g.speed=0,g.angularSpeed=0,g.motion=0):g._original&&(g.restitution=g._original.restitution,g.friction=g._original.friction,g.mass=g._original.mass,g.inertia=g._original.inertia,g.density=g._original.density,g.inverseMass=g._original.inverseMass,g.inverseInertia=g._original.inverseInertia,g._original=null)}},r.setMass=function(u,p){var m=u.inertia/(u.mass/6);u.inertia=m*(p/6),u.inverseInertia=1/u.inertia,u.mass=p,u.inverseMass=1/u.mass,u.density=u.mass/u.area},r.setDensity=function(u,p){r.setMass(u,p*u.area),u.density=p},r.setInertia=function(u,p){u.inertia=p,u.inverseInertia=1/u.inertia},r.setVertices=function(u,p){p[0].body===u?u.vertices=p:u.vertices=o.create(p,u),u.axes=f.fromVertices(u.vertices),u.area=o.area(u.vertices),r.setMass(u,u.density*u.area);var m=o.centre(u.vertices);o.translate(u.vertices,m,-1),r.setInertia(u,r._inertiaScale*o.inertia(u.vertices,u.mass)),o.translate(u.vertices,u.position),l.update(u.bounds,u.vertices,u.velocity)},r.setParts=function(u,p,m){var g;for(p=p.slice(0),u.parts.length=0,u.parts.push(u),u.parent=u,g=0;g<p.length;g++){var _=p[g];_!==u&&(_.parent=u,u.parts.push(_))}if(u.parts.length!==1){if(m=typeof m<"u"?m:!0,m){var A=[];for(g=0;g<p.length;g++)A=A.concat(p[g].vertices);o.clockwiseSort(A);var y=o.hull(A),v=o.centre(y);r.setVertices(u,y),o.translate(u.vertices,v)}var x=r._totalProperties(u);u.area=x.area,u.parent=u,u.position.x=x.centre.x,u.position.y=x.centre.y,u.positionPrev.x=x.centre.x,u.positionPrev.y=x.centre.y,r.setMass(u,x.mass),r.setInertia(u,x.inertia),r.setPosition(u,x.centre)}},r.setCentre=function(u,p,m){m?(u.positionPrev.x+=p.x,u.positionPrev.y+=p.y,u.position.x+=p.x,u.position.y+=p.y):(u.positionPrev.x=p.x-(u.position.x-u.positionPrev.x),u.positionPrev.y=p.y-(u.position.y-u.positionPrev.y),u.position.x=p.x,u.position.y=p.y)},r.setPosition=function(u,p){var m=a.sub(p,u.position);u.positionPrev.x+=m.x,u.positionPrev.y+=m.y;for(var g=0;g<u.parts.length;g++){var _=u.parts[g];_.position.x+=m.x,_.position.y+=m.y,o.translate(_.vertices,m),l.update(_.bounds,_.vertices,u.velocity)}},r.setAngle=function(u,p){var m=p-u.angle;u.anglePrev+=m;for(var g=0;g<u.parts.length;g++){var _=u.parts[g];_.angle+=m,o.rotate(_.vertices,m,u.position),f.rotate(_.axes,m),l.update(_.bounds,_.vertices,u.velocity),g>0&&a.rotateAbout(_.position,m,u.position,_.position)}},r.setVelocity=function(u,p){u.positionPrev.x=u.position.x-p.x,u.positionPrev.y=u.position.y-p.y,u.velocity.x=p.x,u.velocity.y=p.y,u.speed=a.magnitude(u.velocity)},r.setAngularVelocity=function(u,p){u.anglePrev=u.angle-p,u.angularVelocity=p,u.angularSpeed=Math.abs(u.angularVelocity)},r.translate=function(u,p){r.setPosition(u,a.add(u.position,p))},r.rotate=function(u,p,m){if(!m)r.setAngle(u,u.angle+p);else{var g=Math.cos(p),_=Math.sin(p),A=u.position.x-m.x,y=u.position.y-m.y;r.setPosition(u,{x:m.x+(A*g-y*_),y:m.y+(A*_+y*g)}),r.setAngle(u,u.angle+p)}},r.scale=function(u,p,m,g){var _=0,A=0;g=g||u.position;for(var y=0;y<u.parts.length;y++){var v=u.parts[y];o.scale(v.vertices,p,m,g),v.axes=f.fromVertices(v.vertices),v.area=o.area(v.vertices),r.setMass(v,u.density*v.area),o.translate(v.vertices,{x:-v.position.x,y:-v.position.y}),r.setInertia(v,r._inertiaScale*o.inertia(v.vertices,v.mass)),o.translate(v.vertices,{x:v.position.x,y:v.position.y}),y>0&&(_+=v.area,A+=v.inertia),v.position.x=g.x+(v.position.x-g.x)*p,v.position.y=g.y+(v.position.y-g.y)*m,l.update(v.bounds,v.vertices,u.velocity)}u.parts.length>1&&(u.area=_,u.isStatic||(r.setMass(u,u.density*_),r.setInertia(u,A))),u.circleRadius&&(p===m?u.circleRadius*=p:u.circleRadius=null)},r.update=function(u,p,m,g){var _=Math.pow(p*m*u.timeScale,2),A=1-u.frictionAir*m*u.timeScale,y=u.position.x-u.positionPrev.x,v=u.position.y-u.positionPrev.y;u.velocity.x=y*A*g+u.force.x/u.mass*_,u.velocity.y=v*A*g+u.force.y/u.mass*_,u.positionPrev.x=u.position.x,u.positionPrev.y=u.position.y,u.position.x+=u.velocity.x,u.position.y+=u.velocity.y,u.angularVelocity=(u.angle-u.anglePrev)*A*g+u.torque/u.inertia*_,u.anglePrev=u.angle,u.angle+=u.angularVelocity,u.speed=a.magnitude(u.velocity),u.angularSpeed=Math.abs(u.angularVelocity);for(var x=0;x<u.parts.length;x++){var b=u.parts[x];o.translate(b.vertices,u.velocity),x>0&&(b.position.x+=u.velocity.x,b.position.y+=u.velocity.y),u.angularVelocity!==0&&(o.rotate(b.vertices,u.angularVelocity,u.position),f.rotate(b.axes,u.angularVelocity),x>0&&a.rotateAbout(b.position,u.angularVelocity,u.position,b.position)),l.update(b.bounds,b.vertices,u.velocity)}},r.applyForce=function(u,p,m){u.force.x+=m.x,u.force.y+=m.y;var g={x:p.x-u.position.x,y:p.y-u.position.y};u.torque+=g.x*m.y-g.y*m.x},r._totalProperties=function(u){for(var p={mass:0,area:0,inertia:0,centre:{x:0,y:0}},m=u.parts.length===1?0:1;m<u.parts.length;m++){var g=u.parts[m],_=g.mass!==1/0?g.mass:1;p.mass+=_,p.area+=g.area,p.inertia+=g.inertia,p.centre=a.add(p.centre,a.mult(g.position,_))}return p.centre=a.div(p.centre,p.mass),p}})()},function(e,s,n){var r={};e.exports=r;var o=n(4);(function(){r._motionWakeThreshold=.18,r._motionSleepThreshold=.08,r._minBias=.9,r.update=function(a,h){for(var c=h*h*h,l=0;l<a.length;l++){var f=a[l],d=f.speed*f.speed+f.angularSpeed*f.angularSpeed;if(f.force.x!==0||f.force.y!==0){r.set(f,!1);continue}var u=Math.min(f.motion,d),p=Math.max(f.motion,d);f.motion=r._minBias*u+(1-r._minBias)*p,f.sleepThreshold>0&&f.motion<r._motionSleepThreshold*c?(f.sleepCounter+=1,f.sleepCounter>=f.sleepThreshold&&r.set(f,!0)):f.sleepCounter>0&&(f.sleepCounter-=1)}},r.afterCollisions=function(a,h){for(var c=h*h*h,l=0;l<a.length;l++){var f=a[l];if(!!f.isActive){var d=f.collision,u=d.bodyA.parent,p=d.bodyB.parent;if(!(u.isSleeping&&p.isSleeping||u.isStatic||p.isStatic)&&(u.isSleeping||p.isSleeping)){var m=u.isSleeping&&!u.isStatic?u:p,g=m===u?p:u;!m.isStatic&&g.motion>r._motionWakeThreshold*c&&r.set(m,!1)}}}},r.set=function(a,h){var c=a.isSleeping;h?(a.isSleeping=!0,a.sleepCounter=a.sleepThreshold,a.positionImpulse.x=0,a.positionImpulse.y=0,a.positionPrev.x=a.position.x,a.positionPrev.y=a.position.y,a.anglePrev=a.angle,a.speed=0,a.angularSpeed=0,a.motion=0,c||o.trigger(a,"sleepStart")):(a.isSleeping=!1,a.sleepCounter=0,c&&o.trigger(a,"sleepEnd"))}})()},function(e,s,n){var r={};e.exports=r;var o=n(3),a=n(9);(function(){var h=[],c={overlap:0,axis:null},l={overlap:0,axis:null};r.create=function(f,d){return{pair:null,collided:!1,bodyA:f,bodyB:d,parentA:f.parent,parentB:d.parent,depth:0,normal:{x:0,y:0},tangent:{x:0,y:0},penetration:{x:0,y:0},supports:[]}},r.collides=function(f,d,u){if(r._overlapAxes(c,f.vertices,d.vertices,f.axes),c.overlap<=0||(r._overlapAxes(l,d.vertices,f.vertices,d.axes),l.overlap<=0))return null;var p=u&&u.table[a.id(f,d)],m;p?m=p.collision:(m=r.create(f,d),m.collided=!0,m.bodyA=f.id<d.id?f:d,m.bodyB=f.id<d.id?d:f,m.parentA=m.bodyA.parent,m.parentB=m.bodyB.parent),f=m.bodyA,d=m.bodyB;var g;c.overlap<l.overlap?g=c:g=l;var _=m.normal,A=m.supports,y=g.axis,v=y.x,x=y.y;v*(d.position.x-f.position.x)+x*(d.position.y-f.position.y)<0?(_.x=v,_.y=x):(_.x=-v,_.y=-x),m.tangent.x=-_.y,m.tangent.y=_.x,m.depth=g.overlap,m.penetration.x=_.x*m.depth,m.penetration.y=_.y*m.depth;var b=r._findSupports(f,d,_,1),w=0;if(o.contains(f.vertices,b[0])&&(A[w++]=b[0]),o.contains(f.vertices,b[1])&&(A[w++]=b[1]),w<2){var E=r._findSupports(d,f,_,-1);o.contains(d.vertices,E[0])&&(A[w++]=E[0]),w<2&&o.contains(d.vertices,E[1])&&(A[w++]=E[1])}return w===0&&(A[w++]=b[0]),A.length=w,m},r._overlapAxes=function(f,d,u,p){var m=d.length,g=u.length,_=d[0].x,A=d[0].y,y=u[0].x,v=u[0].y,x=p.length,b=Number.MAX_VALUE,w=0,E,S,C,T,I,P;for(I=0;I<x;I++){var R=p[I],L=R.x,k=R.y,F=_*L+A*k,W=y*L+v*k,j=F,B=W;for(P=1;P<m;P+=1)T=d[P].x*L+d[P].y*k,T>j?j=T:T<F&&(F=T);for(P=1;P<g;P+=1)T=u[P].x*L+u[P].y*k,T>B?B=T:T<W&&(W=T);if(S=j-W,C=B-F,E=S<C?S:C,E<b&&(b=E,w=I,E<=0))break}f.axis=p[w],f.overlap=b},r._projectToAxis=function(f,d,u){for(var p=d[0].x*u.x+d[0].y*u.y,m=p,g=1;g<d.length;g+=1){var _=d[g].x*u.x+d[g].y*u.y;_>m?m=_:_<p&&(p=_)}f.min=p,f.max=m},r._findSupports=function(f,d,u,p){var m=d.vertices,g=m.length,_=f.position.x,A=f.position.y,y=u.x*p,v=u.y*p,x=Number.MAX_VALUE,b,w,E,S,C;for(C=0;C<g;C+=1)w=m[C],S=y*(_-w.x)+v*(A-w.y),S<x&&(x=S,b=w);return E=m[(g+b.index-1)%g],x=y*(_-E.x)+v*(A-E.y),w=m[(b.index+1)%g],y*(_-w.x)+v*(A-w.y)<x?(h[0]=b,h[1]=w,h):(h[0]=b,h[1]=E,h)}})()},function(e,s,n){var r={};e.exports=r;var o=n(17);(function(){r.create=function(a,h){var c=a.bodyA,l=a.bodyB,f={id:r.id(c,l),bodyA:c,bodyB:l,collision:a,contacts:[],activeContacts:[],separation:0,isActive:!0,confirmedActive:!0,isSensor:c.isSensor||l.isSensor,timeCreated:h,timeUpdated:h,inverseMass:0,friction:0,frictionStatic:0,restitution:0,slop:0};return r.update(f,a,h),f},r.update=function(a,h,c){var l=a.contacts,f=h.supports,d=a.activeContacts,u=h.parentA,p=h.parentB,m=u.vertices.length;a.isActive=!0,a.timeUpdated=c,a.collision=h,a.separation=h.depth,a.inverseMass=u.inverseMass+p.inverseMass,a.friction=u.friction<p.friction?u.friction:p.friction,a.frictionStatic=u.frictionStatic>p.frictionStatic?u.frictionStatic:p.frictionStatic,a.restitution=u.restitution>p.restitution?u.restitution:p.restitution,a.slop=u.slop>p.slop?u.slop:p.slop,h.pair=a,d.length=0;for(var g=0;g<f.length;g++){var _=f[g],A=_.body===u?_.index:m+_.index,y=l[A];y?d.push(y):d.push(l[A]=o.create(_))}},r.setActive=function(a,h,c){h?(a.isActive=!0,a.timeUpdated=c):(a.isActive=!1,a.activeContacts.length=0)},r.id=function(a,h){return a.id<h.id?"A"+a.id+"B"+h.id:"A"+h.id+"B"+a.id}})()},function(e,s,n){var r={};e.exports=r;var o=n(3),a=n(2),h=n(7),c=n(1),l=n(11),f=n(0);(function(){r._warming=.4,r._torqueDampen=1,r._minLength=1e-6,r.create=function(d){var u=d;u.bodyA&&!u.pointA&&(u.pointA={x:0,y:0}),u.bodyB&&!u.pointB&&(u.pointB={x:0,y:0});var p=u.bodyA?a.add(u.bodyA.position,u.pointA):u.pointA,m=u.bodyB?a.add(u.bodyB.position,u.pointB):u.pointB,g=a.magnitude(a.sub(p,m));u.length=typeof u.length<"u"?u.length:g,u.id=u.id||f.nextId(),u.label=u.label||"Constraint",u.type="constraint",u.stiffness=u.stiffness||(u.length>0?1:.7),u.damping=u.damping||0,u.angularStiffness=u.angularStiffness||0,u.angleA=u.bodyA?u.bodyA.angle:u.angleA,u.angleB=u.bodyB?u.bodyB.angle:u.angleB,u.plugin={};var _={visible:!0,lineWidth:2,strokeStyle:"#ffffff",type:"line",anchors:!0};return u.length===0&&u.stiffness>.1?(_.type="pin",_.anchors=!1):u.stiffness<.9&&(_.type="spring"),u.render=f.extend(_,u.render),u},r.preSolveAll=function(d){for(var u=0;u<d.length;u+=1){var p=d[u],m=p.constraintImpulse;p.isStatic||m.x===0&&m.y===0&&m.angle===0||(p.position.x+=m.x,p.position.y+=m.y,p.angle+=m.angle)}},r.solveAll=function(d,u){for(var p=0;p<d.length;p+=1){var m=d[p],g=!m.bodyA||m.bodyA&&m.bodyA.isStatic,_=!m.bodyB||m.bodyB&&m.bodyB.isStatic;(g||_)&&r.solve(d[p],u)}for(p=0;p<d.length;p+=1)m=d[p],g=!m.bodyA||m.bodyA&&m.bodyA.isStatic,_=!m.bodyB||m.bodyB&&m.bodyB.isStatic,!g&&!_&&r.solve(d[p],u)},r.solve=function(d,u){var p=d.bodyA,m=d.bodyB,g=d.pointA,_=d.pointB;if(!(!p&&!m)){p&&!p.isStatic&&(a.rotate(g,p.angle-d.angleA,g),d.angleA=p.angle),m&&!m.isStatic&&(a.rotate(_,m.angle-d.angleB,_),d.angleB=m.angle);var A=g,y=_;if(p&&(A=a.add(p.position,g)),m&&(y=a.add(m.position,_)),!(!A||!y)){var v=a.sub(A,y),x=a.magnitude(v);x<r._minLength&&(x=r._minLength);var b=(x-d.length)/x,w=d.stiffness<1?d.stiffness*u:d.stiffness,E=a.mult(v,b*w),S=(p?p.inverseMass:0)+(m?m.inverseMass:0),C=(p?p.inverseInertia:0)+(m?m.inverseInertia:0),T=S+C,I,P,R,L,k;if(d.damping){var F=a.create();R=a.div(v,x),k=a.sub(m&&a.sub(m.position,m.positionPrev)||F,p&&a.sub(p.position,p.positionPrev)||F),L=a.dot(R,k)}p&&!p.isStatic&&(P=p.inverseMass/S,p.constraintImpulse.x-=E.x*P,p.constraintImpulse.y-=E.y*P,p.position.x-=E.x*P,p.position.y-=E.y*P,d.damping&&(p.positionPrev.x-=d.damping*R.x*L*P,p.positionPrev.y-=d.damping*R.y*L*P),I=a.cross(g,E)/T*r._torqueDampen*p.inverseInertia*(1-d.angularStiffness),p.constraintImpulse.angle-=I,p.angle-=I),m&&!m.isStatic&&(P=m.inverseMass/S,m.constraintImpulse.x+=E.x*P,m.constraintImpulse.y+=E.y*P,m.position.x+=E.x*P,m.position.y+=E.y*P,d.damping&&(m.positionPrev.x+=d.damping*R.x*L*P,m.positionPrev.y+=d.damping*R.y*L*P),I=a.cross(_,E)/T*r._torqueDampen*m.inverseInertia*(1-d.angularStiffness),m.constraintImpulse.angle+=I,m.angle+=I)}}},r.postSolveAll=function(d){for(var u=0;u<d.length;u++){var p=d[u],m=p.constraintImpulse;if(!(p.isStatic||m.x===0&&m.y===0&&m.angle===0)){h.set(p,!1);for(var g=0;g<p.parts.length;g++){var _=p.parts[g];o.translate(_.vertices,m),g>0&&(_.position.x+=m.x,_.position.y+=m.y),m.angle!==0&&(o.rotate(_.vertices,m.angle,p.position),l.rotate(_.axes,m.angle),g>0&&a.rotateAbout(_.position,m.angle,p.position,_.position)),c.update(_.bounds,_.vertices,p.velocity)}m.angle*=r._warming,m.x*=r._warming,m.y*=r._warming}}},r.pointAWorld=function(d){return{x:(d.bodyA?d.bodyA.position.x:0)+d.pointA.x,y:(d.bodyA?d.bodyA.position.y:0)+d.pointA.y}},r.pointBWorld=function(d){return{x:(d.bodyB?d.bodyB.position.x:0)+d.pointB.x,y:(d.bodyB?d.bodyB.position.y:0)+d.pointB.y}}})()},function(e,s,n){var r={};e.exports=r;var o=n(2),a=n(0);(function(){r.fromVertices=function(h){for(var c={},l=0;l<h.length;l++){var f=(l+1)%h.length,d=o.normalise({x:h[f].y-h[l].y,y:h[l].x-h[f].x}),u=d.y===0?1/0:d.x/d.y;u=u.toFixed(3).toString(),c[u]=d}return a.values(c)},r.rotate=function(h,c){if(c!==0)for(var l=Math.cos(c),f=Math.sin(c),d=0;d<h.length;d++){var u=h[d],p;p=u.x*l-u.y*f,u.y=u.x*f+u.y*l,u.x=p}}})()},function(e,s,n){var r={};e.exports=r;var o=n(3),a=n(0),h=n(6),c=n(1),l=n(2);(function(){r.rectangle=function(f,d,u,p,m){m=m||{};var g={label:"Rectangle Body",position:{x:f,y:d},vertices:o.fromPath("L 0 0 L "+u+" 0 L "+u+" "+p+" L 0 "+p)};if(m.chamfer){var _=m.chamfer;g.vertices=o.chamfer(g.vertices,_.radius,_.quality,_.qualityMin,_.qualityMax),delete m.chamfer}return h.create(a.extend({},g,m))},r.trapezoid=function(f,d,u,p,m,g){g=g||{},m*=.5;var _=(1-m*2)*u,A=u*m,y=A+_,v=y+A,x;m<.5?x="L 0 0 L "+A+" "+-p+" L "+y+" "+-p+" L "+v+" 0":x="L 0 0 L "+y+" "+-p+" L "+v+" 0";var b={label:"Trapezoid Body",position:{x:f,y:d},vertices:o.fromPath(x)};if(g.chamfer){var w=g.chamfer;b.vertices=o.chamfer(b.vertices,w.radius,w.quality,w.qualityMin,w.qualityMax),delete g.chamfer}return h.create(a.extend({},b,g))},r.circle=function(f,d,u,p,m){p=p||{};var g={label:"Circle Body",circleRadius:u};m=m||25;var _=Math.ceil(Math.max(10,Math.min(m,u)));return _%2===1&&(_+=1),r.polygon(f,d,_,u,a.extend({},g,p))},r.polygon=function(f,d,u,p,m){if(m=m||{},u<3)return r.circle(f,d,p,m);for(var g=2*Math.PI/u,_="",A=g*.5,y=0;y<u;y+=1){var v=A+y*g,x=Math.cos(v)*p,b=Math.sin(v)*p;_+="L "+x.toFixed(3)+" "+b.toFixed(3)+" "}var w={label:"Polygon Body",position:{x:f,y:d},vertices:o.fromPath(_)};if(m.chamfer){var E=m.chamfer;w.vertices=o.chamfer(w.vertices,E.radius,E.quality,E.qualityMin,E.qualityMax),delete m.chamfer}return h.create(a.extend({},w,m))},r.fromVertices=function(f,d,u,p,m,g,_,A){var y=a.getDecomp(),v,x,b,w,E,S,C,T,I,P,R;for(v=Boolean(y&&y.quickDecomp),p=p||{},b=[],m=typeof m<"u"?m:!1,g=typeof g<"u"?g:.01,_=typeof _<"u"?_:10,A=typeof A<"u"?A:.01,a.isArray(u[0])||(u=[u]),P=0;P<u.length;P+=1)if(S=u[P],w=o.isConvex(S),E=!w,E&&!v&&a.warnOnce("Bodies.fromVertices: Install the 'poly-decomp' library and use Common.setDecomp or provide 'decomp' as a global to decompose concave vertices."),w||!v)w?S=o.clockwiseSort(S):S=o.hull(S),b.push({position:{x:f,y:d},vertices:S});else{var L=S.map(function(it){return[it.x,it.y]});y.makeCCW(L),g!==!1&&y.removeCollinearPoints(L,g),A!==!1&&y.removeDuplicatePoints&&y.removeDuplicatePoints(L,A);var k=y.quickDecomp(L);for(C=0;C<k.length;C++){var F=k[C],W=F.map(function(it){return{x:it[0],y:it[1]}});_>0&&o.area(W)<_||b.push({position:o.centre(W),vertices:W})}}for(C=0;C<b.length;C++)b[C]=h.create(a.extend(b[C],p));if(m){var j=5;for(C=0;C<b.length;C++){var B=b[C];for(T=C+1;T<b.length;T++){var V=b[T];if(c.overlaps(B.bounds,V.bounds)){var K=B.vertices,Q=V.vertices;for(I=0;I<B.vertices.length;I++)for(R=0;R<V.vertices.length;R++){var tt=l.magnitudeSquared(l.sub(K[(I+1)%K.length],Q[R])),nt=l.magnitudeSquared(l.sub(K[I],Q[(R+1)%Q.length]));tt<j&&nt<j&&(K[I].isInternal=!0,Q[R].isInternal=!0)}}}}}return b.length>1?(x=h.create(a.extend({parts:b.slice(0)},p)),h.setPosition(x,{x:f,y:d}),x):b[0]}})()},function(e,s,n){var r={};e.exports=r;var o=n(0);(function(){r.create=function(a){var h={};return a||o.log("Mouse.create: element was undefined, defaulting to document.body","warn"),h.element=a||document.body,h.absolute={x:0,y:0},h.position={x:0,y:0},h.mousedownPosition={x:0,y:0},h.mouseupPosition={x:0,y:0},h.offset={x:0,y:0},h.scale={x:1,y:1},h.wheelDelta=0,h.button=-1,h.pixelRatio=parseInt(h.element.getAttribute("data-pixel-ratio"),10)||1,h.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},h.mousemove=function(c){var l=r._getRelativeMousePosition(c,h.element,h.pixelRatio),f=c.changedTouches;f&&(h.button=0,c.preventDefault()),h.absolute.x=l.x,h.absolute.y=l.y,h.position.x=h.absolute.x*h.scale.x+h.offset.x,h.position.y=h.absolute.y*h.scale.y+h.offset.y,h.sourceEvents.mousemove=c},h.mousedown=function(c){var l=r._getRelativeMousePosition(c,h.element,h.pixelRatio),f=c.changedTouches;f?(h.button=0,c.preventDefault()):h.button=c.button,h.absolute.x=l.x,h.absolute.y=l.y,h.position.x=h.absolute.x*h.scale.x+h.offset.x,h.position.y=h.absolute.y*h.scale.y+h.offset.y,h.mousedownPosition.x=h.position.x,h.mousedownPosition.y=h.position.y,h.sourceEvents.mousedown=c},h.mouseup=function(c){var l=r._getRelativeMousePosition(c,h.element,h.pixelRatio),f=c.changedTouches;f&&c.preventDefault(),h.button=-1,h.absolute.x=l.x,h.absolute.y=l.y,h.position.x=h.absolute.x*h.scale.x+h.offset.x,h.position.y=h.absolute.y*h.scale.y+h.offset.y,h.mouseupPosition.x=h.position.x,h.mouseupPosition.y=h.position.y,h.sourceEvents.mouseup=c},h.mousewheel=function(c){h.wheelDelta=Math.max(-1,Math.min(1,c.wheelDelta||-c.detail)),c.preventDefault()},r.setElement(h,h.element),h},r.setElement=function(a,h){a.element=h,h.addEventListener("mousemove",a.mousemove),h.addEventListener("mousedown",a.mousedown),h.addEventListener("mouseup",a.mouseup),h.addEventListener("mousewheel",a.mousewheel),h.addEventListener("DOMMouseScroll",a.mousewheel),h.addEventListener("touchmove",a.mousemove),h.addEventListener("touchstart",a.mousedown),h.addEventListener("touchend",a.mouseup)},r.clearSourceEvents=function(a){a.sourceEvents.mousemove=null,a.sourceEvents.mousedown=null,a.sourceEvents.mouseup=null,a.sourceEvents.mousewheel=null,a.wheelDelta=0},r.setOffset=function(a,h){a.offset.x=h.x,a.offset.y=h.y,a.position.x=a.absolute.x*a.scale.x+a.offset.x,a.position.y=a.absolute.y*a.scale.y+a.offset.y},r.setScale=function(a,h){a.scale.x=h.x,a.scale.y=h.y,a.position.x=a.absolute.x*a.scale.x+a.offset.x,a.position.y=a.absolute.y*a.scale.y+a.offset.y},r._getRelativeMousePosition=function(a,h,c){var l=h.getBoundingClientRect(),f=document.documentElement||document.body.parentNode||document.body,d=window.pageXOffset!==void 0?window.pageXOffset:f.scrollLeft,u=window.pageYOffset!==void 0?window.pageYOffset:f.scrollTop,p=a.changedTouches,m,g;return p?(m=p[0].pageX-l.left-d,g=p[0].pageY-l.top-u):(m=a.pageX-l.left-d,g=a.pageY-l.top-u),{x:m/(h.clientWidth/(h.width||h.clientWidth)*c),y:g/(h.clientHeight/(h.height||h.clientHeight)*c)}}})()},function(e,s,n){var r={};e.exports=r;var o=n(0),a=n(8);(function(){r.create=function(h){var c={bodies:[],pairs:null};return o.extend(c,h)},r.setBodies=function(h,c){h.bodies=c.slice(0)},r.clear=function(h){h.bodies=[]},r.collisions=function(h){var c=[],l=h.pairs,f=h.bodies,d=f.length,u=r.canCollide,p=a.collides,m,g;for(f.sort(r._compareBoundsX),m=0;m<d;m++){var _=f[m],A=_.bounds,y=_.bounds.max.x,v=_.bounds.max.y,x=_.bounds.min.y,b=_.isStatic||_.isSleeping,w=_.parts.length,E=w===1;for(g=m+1;g<d;g++){var S=f[g],C=S.bounds;if(C.min.x>y)break;if(!(v<C.min.y||x>C.max.y)&&!(b&&(S.isStatic||S.isSleeping))&&!!u(_.collisionFilter,S.collisionFilter)){var T=S.parts.length;if(E&&T===1){var I=p(_,S,l);I&&c.push(I)}else for(var P=w>1?1:0,R=T>1?1:0,L=P;L<w;L++)for(var k=_.parts[L],A=k.bounds,F=R;F<T;F++){var W=S.parts[F],C=W.bounds;if(!(A.min.x>C.max.x||A.max.x<C.min.x||A.max.y<C.min.y||A.min.y>C.max.y)){var I=p(k,W,l);I&&c.push(I)}}}}}return c},r.canCollide=function(h,c){return h.group===c.group&&h.group!==0?h.group>0:(h.mask&c.category)!==0&&(c.mask&h.category)!==0},r._compareBoundsX=function(h,c){return h.bounds.min.x-c.bounds.min.x}})()},function(e,s,n){var r={};e.exports=r;var o=n(0);(function(){r._registry={},r.register=function(a){if(r.isPlugin(a)||o.warn("Plugin.register:",r.toString(a),"does not implement all required fields."),a.name in r._registry){var h=r._registry[a.name],c=r.versionParse(a.version).number,l=r.versionParse(h.version).number;c>l?(o.warn("Plugin.register:",r.toString(h),"was upgraded to",r.toString(a)),r._registry[a.name]=a):c<l?o.warn("Plugin.register:",r.toString(h),"can not be downgraded to",r.toString(a)):a!==h&&o.warn("Plugin.register:",r.toString(a),"is already registered to different plugin object")}else r._registry[a.name]=a;return a},r.resolve=function(a){return r._registry[r.dependencyParse(a).name]},r.toString=function(a){return typeof a=="string"?a:(a.name||"anonymous")+"@"+(a.version||a.range||"0.0.0")},r.isPlugin=function(a){return a&&a.name&&a.version&&a.install},r.isUsed=function(a,h){return a.used.indexOf(h)>-1},r.isFor=function(a,h){var c=a.for&&r.dependencyParse(a.for);return!a.for||h.name===c.name&&r.versionSatisfies(h.version,c.range)},r.use=function(a,h){if(a.uses=(a.uses||[]).concat(h||[]),a.uses.length===0){o.warn("Plugin.use:",r.toString(a),"does not specify any dependencies to install.");return}for(var c=r.dependencies(a),l=o.topologicalSort(c),f=[],d=0;d<l.length;d+=1)if(l[d]!==a.name){var u=r.resolve(l[d]);if(!u){f.push("\u274C "+l[d]);continue}r.isUsed(a,u.name)||(r.isFor(u,a)||(o.warn("Plugin.use:",r.toString(u),"is for",u.for,"but installed on",r.toString(a)+"."),u._warned=!0),u.install?u.install(a):(o.warn("Plugin.use:",r.toString(u),"does not specify an install function."),u._warned=!0),u._warned?(f.push("\u{1F536} "+r.toString(u)),delete u._warned):f.push("\u2705 "+r.toString(u)),a.used.push(u.name))}f.length>0&&o.info(f.join("  "))},r.dependencies=function(a,h){var c=r.dependencyParse(a),l=c.name;if(h=h||{},!(l in h)){a=r.resolve(a)||a,h[l]=o.map(a.uses||[],function(d){r.isPlugin(d)&&r.register(d);var u=r.dependencyParse(d),p=r.resolve(d);return p&&!r.versionSatisfies(p.version,u.range)?(o.warn("Plugin.dependencies:",r.toString(p),"does not satisfy",r.toString(u),"used by",r.toString(c)+"."),p._warned=!0,a._warned=!0):p||(o.warn("Plugin.dependencies:",r.toString(d),"used by",r.toString(c),"could not be resolved."),a._warned=!0),u.name});for(var f=0;f<h[l].length;f+=1)r.dependencies(h[l][f],h);return h}},r.dependencyParse=function(a){if(o.isString(a)){var h=/^[\w-]+(@(\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-+]+)?))?$/;return h.test(a)||o.warn("Plugin.dependencyParse:",a,"is not a valid dependency string."),{name:a.split("@")[0],range:a.split("@")[1]||"*"}}return{name:a.name,range:a.range||a.version}},r.versionParse=function(a){var h=/^(\*)|(\^|~|>=|>)?\s*((\d+)\.(\d+)\.(\d+))(-[0-9A-Za-z-+]+)?$/;h.test(a)||o.warn("Plugin.versionParse:",a,"is not a valid version or range.");var c=h.exec(a),l=Number(c[4]),f=Number(c[5]),d=Number(c[6]);return{isRange:Boolean(c[1]||c[2]),version:c[3],range:a,operator:c[1]||c[2]||"",major:l,minor:f,patch:d,parts:[l,f,d],prerelease:c[7],number:l*1e8+f*1e4+d}},r.versionSatisfies=function(a,h){h=h||"*";var c=r.versionParse(h),l=r.versionParse(a);if(c.isRange){if(c.operator==="*"||a==="*")return!0;if(c.operator===">")return l.number>c.number;if(c.operator===">=")return l.number>=c.number;if(c.operator==="~")return l.major===c.major&&l.minor===c.minor&&l.patch>=c.patch;if(c.operator==="^")return c.major>0?l.major===c.major&&l.number>=c.number:c.minor>0?l.minor===c.minor&&l.patch>=c.patch:l.patch===c.patch}return a===h||a==="*"}})()},function(e,s,n){var r={};e.exports=r;var o=n(0),a=n(5),h=n(1),c=n(4),l=n(2),f=n(13);(function(){var d,u;typeof window<"u"&&(d=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(v){window.setTimeout(function(){v(o.now())},1e3/60)},u=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),r._goodFps=30,r._goodDelta=1e3/60,r.create=function(v){var x={controller:r,engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,timing:{historySize:60,delta:0,deltaHistory:[],lastTime:0,lastTimestamp:0,lastElapsed:0,timestampElapsed:0,timestampElapsedHistory:[],engineDeltaHistory:[],engineElapsedHistory:[],elapsedHistory:[]},options:{width:800,height:600,pixelRatio:1,background:"#14151f",wireframeBackground:"#14151f",hasBounds:!!v.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showStats:!1,showPerformance:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},b=o.extend(x,v);return b.canvas&&(b.canvas.width=b.options.width||b.canvas.width,b.canvas.height=b.options.height||b.canvas.height),b.mouse=v.mouse,b.engine=v.engine,b.canvas=b.canvas||g(b.options.width,b.options.height),b.context=b.canvas.getContext("2d"),b.textures={},b.bounds=b.bounds||{min:{x:0,y:0},max:{x:b.canvas.width,y:b.canvas.height}},b.options.showBroadphase=!1,b.options.pixelRatio!==1&&r.setPixelRatio(b,b.options.pixelRatio),o.isElement(b.element)?b.element.appendChild(b.canvas):b.canvas.parentNode||o.log("Render.create: options.element was undefined, render.canvas was created but not appended","warn"),b},r.run=function(v){(function x(b){v.frameRequestId=d(x),p(v,b),r.world(v,b),(v.options.showStats||v.options.showDebug)&&r.stats(v,v.context,b),(v.options.showPerformance||v.options.showDebug)&&r.performance(v,v.context,b)})()},r.stop=function(v){u(v.frameRequestId)},r.setPixelRatio=function(v,x){var b=v.options,w=v.canvas;x==="auto"&&(x=_(w)),b.pixelRatio=x,w.setAttribute("data-pixel-ratio",x),w.width=b.width*x,w.height=b.height*x,w.style.width=b.width+"px",w.style.height=b.height+"px"},r.lookAt=function(v,x,b,w){w=typeof w<"u"?w:!0,x=o.isArray(x)?x:[x],b=b||{x:0,y:0};for(var E={min:{x:1/0,y:1/0},max:{x:-1/0,y:-1/0}},S=0;S<x.length;S+=1){var C=x[S],T=C.bounds?C.bounds.min:C.min||C.position||C,I=C.bounds?C.bounds.max:C.max||C.position||C;T&&I&&(T.x<E.min.x&&(E.min.x=T.x),I.x>E.max.x&&(E.max.x=I.x),T.y<E.min.y&&(E.min.y=T.y),I.y>E.max.y&&(E.max.y=I.y))}var P=E.max.x-E.min.x+2*b.x,R=E.max.y-E.min.y+2*b.y,L=v.canvas.height,k=v.canvas.width,F=k/L,W=P/R,j=1,B=1;W>F?B=W/F:j=F/W,v.options.hasBounds=!0,v.bounds.min.x=E.min.x,v.bounds.max.x=E.min.x+P*j,v.bounds.min.y=E.min.y,v.bounds.max.y=E.min.y+R*B,w&&(v.bounds.min.x+=P*.5-P*j*.5,v.bounds.max.x+=P*.5-P*j*.5,v.bounds.min.y+=R*.5-R*B*.5,v.bounds.max.y+=R*.5-R*B*.5),v.bounds.min.x-=b.x,v.bounds.max.x-=b.x,v.bounds.min.y-=b.y,v.bounds.max.y-=b.y,v.mouse&&(f.setScale(v.mouse,{x:(v.bounds.max.x-v.bounds.min.x)/v.canvas.width,y:(v.bounds.max.y-v.bounds.min.y)/v.canvas.height}),f.setOffset(v.mouse,v.bounds.min))},r.startViewTransform=function(v){var x=v.bounds.max.x-v.bounds.min.x,b=v.bounds.max.y-v.bounds.min.y,w=x/v.options.width,E=b/v.options.height;v.context.setTransform(v.options.pixelRatio/w,0,0,v.options.pixelRatio/E,0,0),v.context.translate(-v.bounds.min.x,-v.bounds.min.y)},r.endViewTransform=function(v){v.context.setTransform(v.options.pixelRatio,0,0,v.options.pixelRatio,0,0)},r.world=function(v,x){var b=o.now(),w=v.engine,E=w.world,S=v.canvas,C=v.context,T=v.options,I=v.timing,P=a.allBodies(E),R=a.allConstraints(E),L=T.wireframes?T.wireframeBackground:T.background,k=[],F=[],W,j={timestamp:w.timing.timestamp};if(c.trigger(v,"beforeRender",j),v.currentBackground!==L&&y(v,L),C.globalCompositeOperation="source-in",C.fillStyle="transparent",C.fillRect(0,0,S.width,S.height),C.globalCompositeOperation="source-over",T.hasBounds){for(W=0;W<P.length;W++){var B=P[W];h.overlaps(B.bounds,v.bounds)&&k.push(B)}for(W=0;W<R.length;W++){var V=R[W],K=V.bodyA,Q=V.bodyB,tt=V.pointA,nt=V.pointB;K&&(tt=l.add(K.position,V.pointA)),Q&&(nt=l.add(Q.position,V.pointB)),!(!tt||!nt)&&(h.contains(v.bounds,tt)||h.contains(v.bounds,nt))&&F.push(V)}r.startViewTransform(v),v.mouse&&(f.setScale(v.mouse,{x:(v.bounds.max.x-v.bounds.min.x)/v.options.width,y:(v.bounds.max.y-v.bounds.min.y)/v.options.height}),f.setOffset(v.mouse,v.bounds.min))}else F=R,k=P,v.options.pixelRatio!==1&&v.context.setTransform(v.options.pixelRatio,0,0,v.options.pixelRatio,0,0);!T.wireframes||w.enableSleeping&&T.showSleeping?r.bodies(v,k,C):(T.showConvexHulls&&r.bodyConvexHulls(v,k,C),r.bodyWireframes(v,k,C)),T.showBounds&&r.bodyBounds(v,k,C),(T.showAxes||T.showAngleIndicator)&&r.bodyAxes(v,k,C),T.showPositions&&r.bodyPositions(v,k,C),T.showVelocity&&r.bodyVelocity(v,k,C),T.showIds&&r.bodyIds(v,k,C),T.showSeparations&&r.separations(v,w.pairs.list,C),T.showCollisions&&r.collisions(v,w.pairs.list,C),T.showVertexNumbers&&r.vertexNumbers(v,k,C),T.showMousePosition&&r.mousePosition(v,v.mouse,C),r.constraints(F,C),T.hasBounds&&r.endViewTransform(v),c.trigger(v,"afterRender",j),I.lastElapsed=o.now()-b},r.stats=function(v,x,b){for(var w=v.engine,E=w.world,S=a.allBodies(E),C=0,T=55,I=44,P=0,R=0,L=0;L<S.length;L+=1)C+=S[L].parts.length;var k={Part:C,Body:S.length,Cons:a.allConstraints(E).length,Comp:a.allComposites(E).length,Pair:w.pairs.list.length};x.fillStyle="#0e0f19",x.fillRect(P,R,T*5.5,I),x.font="12px Arial",x.textBaseline="top",x.textAlign="right";for(var F in k){var W=k[F];x.fillStyle="#aaa",x.fillText(F,P+T,R+8),x.fillStyle="#eee",x.fillText(W,P+T,R+26),P+=T}},r.performance=function(v,x){var b=v.engine,w=v.timing,E=w.deltaHistory,S=w.elapsedHistory,C=w.timestampElapsedHistory,T=w.engineDeltaHistory,I=w.engineElapsedHistory,P=b.timing.lastDelta,R=m(E),L=m(S),k=m(T),F=m(I),W=m(C),j=W/R||0,B=1e3/R||0,V=4,K=12,Q=60,tt=34,nt=10,it=69;x.fillStyle="#0e0f19",x.fillRect(0,50,K*4+Q*5+22,tt),r.status(x,nt,it,Q,V,E.length,Math.round(B)+" fps",B/r._goodFps,function(rt){return E[rt]/R-1}),r.status(x,nt+K+Q,it,Q,V,T.length,P.toFixed(2)+" dt",r._goodDelta/P,function(rt){return T[rt]/k-1}),r.status(x,nt+(K+Q)*2,it,Q,V,I.length,F.toFixed(2)+" ut",1-F/r._goodFps,function(rt){return I[rt]/F-1}),r.status(x,nt+(K+Q)*3,it,Q,V,S.length,L.toFixed(2)+" rt",1-L/r._goodFps,function(rt){return S[rt]/L-1}),r.status(x,nt+(K+Q)*4,it,Q,V,C.length,j.toFixed(2)+" x",j*j*j,function(rt){return(C[rt]/E[rt]/j||0)-1})},r.status=function(v,x,b,w,E,S,C,T,I){v.strokeStyle="#888",v.fillStyle="#444",v.lineWidth=1,v.fillRect(x,b+7,w,1),v.beginPath(),v.moveTo(x,b+7-E*o.clamp(.4*I(0),-2,2));for(var P=0;P<w;P+=1)v.lineTo(x+P,b+7-(P<S?E*o.clamp(.4*I(P),-2,2):0));v.stroke(),v.fillStyle="hsl("+o.clamp(25+95*T,0,120)+",100%,60%)",v.fillRect(x,b-7,4,4),v.font="12px Arial",v.textBaseline="middle",v.textAlign="right",v.fillStyle="#eee",v.fillText(C,x+w,b-5)},r.constraints=function(v,x){for(var b=x,w=0;w<v.length;w++){var E=v[w];if(!(!E.render.visible||!E.pointA||!E.pointB)){var S=E.bodyA,C=E.bodyB,T,I;if(S?T=l.add(S.position,E.pointA):T=E.pointA,E.render.type==="pin")b.beginPath(),b.arc(T.x,T.y,3,0,2*Math.PI),b.closePath();else{if(C?I=l.add(C.position,E.pointB):I=E.pointB,b.beginPath(),b.moveTo(T.x,T.y),E.render.type==="spring")for(var P=l.sub(I,T),R=l.perp(l.normalise(P)),L=Math.ceil(o.clamp(E.length/5,12,20)),k,F=1;F<L;F+=1)k=F%2===0?1:-1,b.lineTo(T.x+P.x*(F/L)+R.x*k*4,T.y+P.y*(F/L)+R.y*k*4);b.lineTo(I.x,I.y)}E.render.lineWidth&&(b.lineWidth=E.render.lineWidth,b.strokeStyle=E.render.strokeStyle,b.stroke()),E.render.anchors&&(b.fillStyle=E.render.strokeStyle,b.beginPath(),b.arc(T.x,T.y,3,0,2*Math.PI),b.arc(I.x,I.y,3,0,2*Math.PI),b.closePath(),b.fill())}}},r.bodies=function(v,x,b){var w=b;v.engine;var E=v.options,S=E.showInternalEdges||!E.wireframes,C,T,I,P;for(I=0;I<x.length;I++)if(C=x[I],!!C.render.visible){for(P=C.parts.length>1?1:0;P<C.parts.length;P++)if(T=C.parts[P],!!T.render.visible){if(E.showSleeping&&C.isSleeping?w.globalAlpha=.5*T.render.opacity:T.render.opacity!==1&&(w.globalAlpha=T.render.opacity),T.render.sprite&&T.render.sprite.texture&&!E.wireframes){var R=T.render.sprite,L=A(v,R.texture);w.translate(T.position.x,T.position.y),w.rotate(T.angle),w.drawImage(L,L.width*-R.xOffset*R.xScale,L.height*-R.yOffset*R.yScale,L.width*R.xScale,L.height*R.yScale),w.rotate(-T.angle),w.translate(-T.position.x,-T.position.y)}else{if(T.circleRadius)w.beginPath(),w.arc(T.position.x,T.position.y,T.circleRadius,0,2*Math.PI);else{w.beginPath(),w.moveTo(T.vertices[0].x,T.vertices[0].y);for(var k=1;k<T.vertices.length;k++)!T.vertices[k-1].isInternal||S?w.lineTo(T.vertices[k].x,T.vertices[k].y):w.moveTo(T.vertices[k].x,T.vertices[k].y),T.vertices[k].isInternal&&!S&&w.moveTo(T.vertices[(k+1)%T.vertices.length].x,T.vertices[(k+1)%T.vertices.length].y);w.lineTo(T.vertices[0].x,T.vertices[0].y),w.closePath()}E.wireframes?(w.lineWidth=1,w.strokeStyle="#bbb",w.stroke()):(w.fillStyle=T.render.fillStyle,T.render.lineWidth&&(w.lineWidth=T.render.lineWidth,w.strokeStyle=T.render.strokeStyle,w.stroke()),w.fill())}w.globalAlpha=1}}},r.bodyWireframes=function(v,x,b){var w=b,E=v.options.showInternalEdges,S,C,T,I,P;for(w.beginPath(),T=0;T<x.length;T++)if(S=x[T],!!S.render.visible)for(P=S.parts.length>1?1:0;P<S.parts.length;P++){for(C=S.parts[P],w.moveTo(C.vertices[0].x,C.vertices[0].y),I=1;I<C.vertices.length;I++)!C.vertices[I-1].isInternal||E?w.lineTo(C.vertices[I].x,C.vertices[I].y):w.moveTo(C.vertices[I].x,C.vertices[I].y),C.vertices[I].isInternal&&!E&&w.moveTo(C.vertices[(I+1)%C.vertices.length].x,C.vertices[(I+1)%C.vertices.length].y);w.lineTo(C.vertices[0].x,C.vertices[0].y)}w.lineWidth=1,w.strokeStyle="#bbb",w.stroke()},r.bodyConvexHulls=function(v,x,b){var w=b,E,S,C;for(w.beginPath(),S=0;S<x.length;S++)if(E=x[S],!(!E.render.visible||E.parts.length===1)){for(w.moveTo(E.vertices[0].x,E.vertices[0].y),C=1;C<E.vertices.length;C++)w.lineTo(E.vertices[C].x,E.vertices[C].y);w.lineTo(E.vertices[0].x,E.vertices[0].y)}w.lineWidth=1,w.strokeStyle="rgba(255,255,255,0.2)",w.stroke()},r.vertexNumbers=function(v,x,b){var w=b,E,S,C;for(E=0;E<x.length;E++){var T=x[E].parts;for(C=T.length>1?1:0;C<T.length;C++){var I=T[C];for(S=0;S<I.vertices.length;S++)w.fillStyle="rgba(255,255,255,0.2)",w.fillText(E+"_"+S,I.position.x+(I.vertices[S].x-I.position.x)*.8,I.position.y+(I.vertices[S].y-I.position.y)*.8)}}},r.mousePosition=function(v,x,b){var w=b;w.fillStyle="rgba(255,255,255,0.8)",w.fillText(x.position.x+"  "+x.position.y,x.position.x+5,x.position.y-5)},r.bodyBounds=function(v,x,b){var w=b;v.engine;var E=v.options;w.beginPath();for(var S=0;S<x.length;S++){var C=x[S];if(C.render.visible)for(var T=x[S].parts,I=T.length>1?1:0;I<T.length;I++){var P=T[I];w.rect(P.bounds.min.x,P.bounds.min.y,P.bounds.max.x-P.bounds.min.x,P.bounds.max.y-P.bounds.min.y)}}E.wireframes?w.strokeStyle="rgba(255,255,255,0.08)":w.strokeStyle="rgba(0,0,0,0.1)",w.lineWidth=1,w.stroke()},r.bodyAxes=function(v,x,b){var w=b;v.engine;var E=v.options,S,C,T,I;for(w.beginPath(),C=0;C<x.length;C++){var P=x[C],R=P.parts;if(!!P.render.visible)if(E.showAxes)for(T=R.length>1?1:0;T<R.length;T++)for(S=R[T],I=0;I<S.axes.length;I++){var L=S.axes[I];w.moveTo(S.position.x,S.position.y),w.lineTo(S.position.x+L.x*20,S.position.y+L.y*20)}else for(T=R.length>1?1:0;T<R.length;T++)for(S=R[T],I=0;I<S.axes.length;I++)w.moveTo(S.position.x,S.position.y),w.lineTo((S.vertices[0].x+S.vertices[S.vertices.length-1].x)/2,(S.vertices[0].y+S.vertices[S.vertices.length-1].y)/2)}E.wireframes?(w.strokeStyle="indianred",w.lineWidth=1):(w.strokeStyle="rgba(255, 255, 255, 0.4)",w.globalCompositeOperation="overlay",w.lineWidth=2),w.stroke(),w.globalCompositeOperation="source-over"},r.bodyPositions=function(v,x,b){var w=b;v.engine;var E=v.options,S,C,T,I;for(w.beginPath(),T=0;T<x.length;T++)if(S=x[T],!!S.render.visible)for(I=0;I<S.parts.length;I++)C=S.parts[I],w.arc(C.position.x,C.position.y,3,0,2*Math.PI,!1),w.closePath();for(E.wireframes?w.fillStyle="indianred":w.fillStyle="rgba(0,0,0,0.5)",w.fill(),w.beginPath(),T=0;T<x.length;T++)S=x[T],S.render.visible&&(w.arc(S.positionPrev.x,S.positionPrev.y,2,0,2*Math.PI,!1),w.closePath());w.fillStyle="rgba(255,165,0,0.8)",w.fill()},r.bodyVelocity=function(v,x,b){var w=b;w.beginPath();for(var E=0;E<x.length;E++){var S=x[E];!S.render.visible||(w.moveTo(S.position.x,S.position.y),w.lineTo(S.position.x+(S.position.x-S.positionPrev.x)*2,S.position.y+(S.position.y-S.positionPrev.y)*2))}w.lineWidth=3,w.strokeStyle="cornflowerblue",w.stroke()},r.bodyIds=function(v,x,b){var w=b,E,S;for(E=0;E<x.length;E++)if(!!x[E].render.visible){var C=x[E].parts;for(S=C.length>1?1:0;S<C.length;S++){var T=C[S];w.font="12px Arial",w.fillStyle="rgba(255,255,255,0.5)",w.fillText(T.id,T.position.x+10,T.position.y-10)}}},r.collisions=function(v,x,b){var w=b,E=v.options,S,C,T,I;for(w.beginPath(),T=0;T<x.length;T++)if(S=x[T],!!S.isActive)for(C=S.collision,I=0;I<S.activeContacts.length;I++){var P=S.activeContacts[I],R=P.vertex;w.rect(R.x-1.5,R.y-1.5,3.5,3.5)}for(E.wireframes?w.fillStyle="rgba(255,255,255,0.7)":w.fillStyle="orange",w.fill(),w.beginPath(),T=0;T<x.length;T++)if(S=x[T],!!S.isActive&&(C=S.collision,S.activeContacts.length>0)){var L=S.activeContacts[0].vertex.x,k=S.activeContacts[0].vertex.y;S.activeContacts.length===2&&(L=(S.activeContacts[0].vertex.x+S.activeContacts[1].vertex.x)/2,k=(S.activeContacts[0].vertex.y+S.activeContacts[1].vertex.y)/2),C.bodyB===C.supports[0].body||C.bodyA.isStatic===!0?w.moveTo(L-C.normal.x*8,k-C.normal.y*8):w.moveTo(L+C.normal.x*8,k+C.normal.y*8),w.lineTo(L,k)}E.wireframes?w.strokeStyle="rgba(255,165,0,0.7)":w.strokeStyle="orange",w.lineWidth=1,w.stroke()},r.separations=function(v,x,b){var w=b,E=v.options,S,C,T,I,P;for(w.beginPath(),P=0;P<x.length;P++)if(S=x[P],!!S.isActive){C=S.collision,T=C.bodyA,I=C.bodyB;var R=1;!I.isStatic&&!T.isStatic&&(R=.5),I.isStatic&&(R=0),w.moveTo(I.position.x,I.position.y),w.lineTo(I.position.x-C.penetration.x*R,I.position.y-C.penetration.y*R),R=1,!I.isStatic&&!T.isStatic&&(R=.5),T.isStatic&&(R=0),w.moveTo(T.position.x,T.position.y),w.lineTo(T.position.x+C.penetration.x*R,T.position.y+C.penetration.y*R)}E.wireframes?w.strokeStyle="rgba(255,165,0,0.5)":w.strokeStyle="orange",w.stroke()},r.inspector=function(v,x){v.engine;var b=v.selected,w=v.render,E=w.options,S;if(E.hasBounds){var C=w.bounds.max.x-w.bounds.min.x,T=w.bounds.max.y-w.bounds.min.y,I=C/w.options.width,P=T/w.options.height;x.scale(1/I,1/P),x.translate(-w.bounds.min.x,-w.bounds.min.y)}for(var R=0;R<b.length;R++){var L=b[R].data;switch(x.translate(.5,.5),x.lineWidth=1,x.strokeStyle="rgba(255,165,0,0.9)",x.setLineDash([1,2]),L.type){case"body":S=L.bounds,x.beginPath(),x.rect(Math.floor(S.min.x-3),Math.floor(S.min.y-3),Math.floor(S.max.x-S.min.x+6),Math.floor(S.max.y-S.min.y+6)),x.closePath(),x.stroke();break;case"constraint":var k=L.pointA;L.bodyA&&(k=L.pointB),x.beginPath(),x.arc(k.x,k.y,10,0,2*Math.PI),x.closePath(),x.stroke();break}x.setLineDash([]),x.translate(-.5,-.5)}v.selectStart!==null&&(x.translate(.5,.5),x.lineWidth=1,x.strokeStyle="rgba(255,165,0,0.6)",x.fillStyle="rgba(255,165,0,0.1)",S=v.selectBounds,x.beginPath(),x.rect(Math.floor(S.min.x),Math.floor(S.min.y),Math.floor(S.max.x-S.min.x),Math.floor(S.max.y-S.min.y)),x.closePath(),x.stroke(),x.fill(),x.translate(-.5,-.5)),E.hasBounds&&x.setTransform(1,0,0,1,0,0)};var p=function(v,x){var b=v.engine,w=v.timing,E=w.historySize,S=b.timing.timestamp;w.delta=x-w.lastTime||r._goodDelta,w.lastTime=x,w.timestampElapsed=S-w.lastTimestamp||0,w.lastTimestamp=S,w.deltaHistory.unshift(w.delta),w.deltaHistory.length=Math.min(w.deltaHistory.length,E),w.engineDeltaHistory.unshift(b.timing.lastDelta),w.engineDeltaHistory.length=Math.min(w.engineDeltaHistory.length,E),w.timestampElapsedHistory.unshift(w.timestampElapsed),w.timestampElapsedHistory.length=Math.min(w.timestampElapsedHistory.length,E),w.engineElapsedHistory.unshift(b.timing.lastElapsed),w.engineElapsedHistory.length=Math.min(w.engineElapsedHistory.length,E),w.elapsedHistory.unshift(w.lastElapsed),w.elapsedHistory.length=Math.min(w.elapsedHistory.length,E)},m=function(v){for(var x=0,b=0;b<v.length;b+=1)x+=v[b];return x/v.length||0},g=function(v,x){var b=document.createElement("canvas");return b.width=v,b.height=x,b.oncontextmenu=function(){return!1},b.onselectstart=function(){return!1},b},_=function(v){var x=v.getContext("2d"),b=window.devicePixelRatio||1,w=x.webkitBackingStorePixelRatio||x.mozBackingStorePixelRatio||x.msBackingStorePixelRatio||x.oBackingStorePixelRatio||x.backingStorePixelRatio||1;return b/w},A=function(v,x){var b=v.textures[x];return b||(b=v.textures[x]=new Image,b.src=x,b)},y=function(v,x){var b=x;/(jpg|gif|png)$/.test(x)&&(b="url("+x+")"),v.canvas.style.background=b,v.canvas.style.backgroundSize="contain",v.currentBackground=x}})()},function(e,s){var n={};e.exports=n,function(){n.create=function(r){return{vertex:r,normalImpulse:0,tangentImpulse:0}}}()},function(e,s,n){var r={};e.exports=r;var o=n(7),a=n(19),h=n(14),c=n(20),l=n(4),f=n(5),d=n(10),u=n(0),p=n(6);(function(){r.create=function(m){m=m||{};var g={positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],plugin:{},gravity:{x:0,y:1,scale:.001},timing:{timestamp:0,timeScale:1,lastDelta:0,lastElapsed:0}},_=u.extend(g,m);return _.world=m.world||f.create({label:"World"}),_.pairs=m.pairs||c.create(),_.detector=m.detector||h.create(),_.grid={buckets:[]},_.world.gravity=_.gravity,_.broadphase=_.grid,_.metrics={},_},r.update=function(m,g,_){var A=u.now();g=g||1e3/60,_=_||1;var y=m.world,v=m.detector,x=m.pairs,b=m.timing,w=b.timestamp,E;b.timestamp+=g*b.timeScale,b.lastDelta=g*b.timeScale;var S={timestamp:b.timestamp};l.trigger(m,"beforeUpdate",S);var C=f.allBodies(y),T=f.allConstraints(y);for(y.isModified&&h.setBodies(v,C),y.isModified&&f.setModified(y,!1,!1,!0),m.enableSleeping&&o.update(C,b.timeScale),r._bodiesApplyGravity(C,m.gravity),r._bodiesUpdate(C,g,b.timeScale,_,y.bounds),d.preSolveAll(C),E=0;E<m.constraintIterations;E++)d.solveAll(T,b.timeScale);d.postSolveAll(C),v.pairs=m.pairs;var I=h.collisions(v);for(c.update(x,I,w),m.enableSleeping&&o.afterCollisions(x.list,b.timeScale),x.collisionStart.length>0&&l.trigger(m,"collisionStart",{pairs:x.collisionStart}),a.preSolvePosition(x.list),E=0;E<m.positionIterations;E++)a.solvePosition(x.list,b.timeScale);for(a.postSolvePosition(C),d.preSolveAll(C),E=0;E<m.constraintIterations;E++)d.solveAll(T,b.timeScale);for(d.postSolveAll(C),a.preSolveVelocity(x.list),E=0;E<m.velocityIterations;E++)a.solveVelocity(x.list,b.timeScale);return x.collisionActive.length>0&&l.trigger(m,"collisionActive",{pairs:x.collisionActive}),x.collisionEnd.length>0&&l.trigger(m,"collisionEnd",{pairs:x.collisionEnd}),r._bodiesClearForces(C),l.trigger(m,"afterUpdate",S),m.timing.lastElapsed=u.now()-A,m},r.merge=function(m,g){if(u.extend(m,g),g.world){m.world=g.world,r.clear(m);for(var _=f.allBodies(m.world),A=0;A<_.length;A++){var y=_[A];o.set(y,!1),y.id=u.nextId()}}},r.clear=function(m){c.clear(m.pairs),h.clear(m.detector)},r._bodiesClearForces=function(m){for(var g=0;g<m.length;g++){var _=m[g];_.force.x=0,_.force.y=0,_.torque=0}},r._bodiesApplyGravity=function(m,g){var _=typeof g.scale<"u"?g.scale:.001;if(!(g.x===0&&g.y===0||_===0))for(var A=0;A<m.length;A++){var y=m[A];y.isStatic||y.isSleeping||(y.force.y+=y.mass*g.y*_,y.force.x+=y.mass*g.x*_)}},r._bodiesUpdate=function(m,g,_,A,y){for(var v=0;v<m.length;v++){var x=m[v];x.isStatic||x.isSleeping||p.update(x,g,_,A)}}})()},function(e,s,n){var r={};e.exports=r;var o=n(3),a=n(1);(function(){r._restingThresh=4,r._restingThreshTangent=6,r._positionDampen=.9,r._positionWarming=.8,r._frictionNormalMultiplier=5,r.preSolvePosition=function(h){var c,l,f,d=h.length;for(c=0;c<d;c++)l=h[c],l.isActive&&(f=l.activeContacts.length,l.collision.parentA.totalContacts+=f,l.collision.parentB.totalContacts+=f)},r.solvePosition=function(h,c){var l,f,d,u,p,m,g,_,A=r._positionDampen,y=h.length;for(l=0;l<y;l++)f=h[l],!(!f.isActive||f.isSensor)&&(d=f.collision,u=d.parentA,p=d.parentB,m=d.normal,f.separation=m.x*(p.positionImpulse.x+d.penetration.x-u.positionImpulse.x)+m.y*(p.positionImpulse.y+d.penetration.y-u.positionImpulse.y));for(l=0;l<y;l++)f=h[l],!(!f.isActive||f.isSensor)&&(d=f.collision,u=d.parentA,p=d.parentB,m=d.normal,_=(f.separation-f.slop)*c,(u.isStatic||p.isStatic)&&(_*=2),u.isStatic||u.isSleeping||(g=A/u.totalContacts,u.positionImpulse.x+=m.x*_*g,u.positionImpulse.y+=m.y*_*g),p.isStatic||p.isSleeping||(g=A/p.totalContacts,p.positionImpulse.x-=m.x*_*g,p.positionImpulse.y-=m.y*_*g))},r.postSolvePosition=function(h){for(var c=r._positionWarming,l=h.length,f=o.translate,d=a.update,u=0;u<l;u++){var p=h[u],m=p.positionImpulse,g=m.x,_=m.y,A=p.velocity;if(p.totalContacts=0,g!==0||_!==0){for(var y=0;y<p.parts.length;y++){var v=p.parts[y];f(v.vertices,m),d(v.bounds,v.vertices,A),v.position.x+=g,v.position.y+=_}p.positionPrev.x+=g,p.positionPrev.y+=_,g*A.x+_*A.y<0?(m.x=0,m.y=0):(m.x*=c,m.y*=c)}}},r.preSolveVelocity=function(h){var c=h.length,l,f;for(l=0;l<c;l++){var d=h[l];if(!(!d.isActive||d.isSensor)){var u=d.activeContacts,p=u.length,m=d.collision,g=m.parentA,_=m.parentB,A=m.normal,y=m.tangent;for(f=0;f<p;f++){var v=u[f],x=v.vertex,b=v.normalImpulse,w=v.tangentImpulse;if(b!==0||w!==0){var E=A.x*b+y.x*w,S=A.y*b+y.y*w;g.isStatic||g.isSleeping||(g.positionPrev.x+=E*g.inverseMass,g.positionPrev.y+=S*g.inverseMass,g.anglePrev+=g.inverseInertia*((x.x-g.position.x)*S-(x.y-g.position.y)*E)),_.isStatic||_.isSleeping||(_.positionPrev.x-=E*_.inverseMass,_.positionPrev.y-=S*_.inverseMass,_.anglePrev-=_.inverseInertia*((x.x-_.position.x)*S-(x.y-_.position.y)*E))}}}}},r.solveVelocity=function(h,c){var l=c*c,f=r._restingThresh*l,d=r._frictionNormalMultiplier,u=r._restingThreshTangent*l,p=Number.MAX_VALUE,m=h.length,g,_,A,y;for(A=0;A<m;A++){var v=h[A];if(!(!v.isActive||v.isSensor)){var x=v.collision,b=x.parentA,w=x.parentB,E=b.velocity,S=w.velocity,C=x.normal.x,T=x.normal.y,I=x.tangent.x,P=x.tangent.y,R=v.activeContacts,L=R.length,k=1/L,F=b.inverseMass+w.inverseMass,W=v.friction*v.frictionStatic*d*l;for(E.x=b.position.x-b.positionPrev.x,E.y=b.position.y-b.positionPrev.y,S.x=w.position.x-w.positionPrev.x,S.y=w.position.y-w.positionPrev.y,b.angularVelocity=b.angle-b.anglePrev,w.angularVelocity=w.angle-w.anglePrev,y=0;y<L;y++){var j=R[y],B=j.vertex,V=B.x-b.position.x,K=B.y-b.position.y,Q=B.x-w.position.x,tt=B.y-w.position.y,nt=E.x-K*b.angularVelocity,it=E.y+V*b.angularVelocity,rt=S.x-tt*w.angularVelocity,At=S.y+Q*w.angularVelocity,Tt=nt-rt,xt=it-At,ot=C*Tt+T*xt,at=I*Tt+P*xt,mt=v.separation+ot,Pt=Math.min(mt,1);Pt=mt<0?0:Pt;var Mt=Pt*W;at>Mt||-at>Mt?(_=at>0?at:-at,g=v.friction*(at>0?1:-1)*l,g<-_?g=-_:g>_&&(g=_)):(g=at,_=p);var me=V*T-K*C,sn=Q*T-tt*C,Fr=k/(F+b.inverseInertia*me*me+w.inverseInertia*sn*sn),Zi=(1+v.restitution)*ot*Fr;if(g*=Fr,ot*ot>f&&ot<0)j.normalImpulse=0;else{var nl=j.normalImpulse;j.normalImpulse+=Zi,j.normalImpulse=Math.min(j.normalImpulse,0),Zi=j.normalImpulse-nl}if(at*at>u)j.tangentImpulse=0;else{var rl=j.tangentImpulse;j.tangentImpulse+=g,j.tangentImpulse<-_&&(j.tangentImpulse=-_),j.tangentImpulse>_&&(j.tangentImpulse=_),g=j.tangentImpulse-rl}var Qi=C*Zi+I*g,$i=T*Zi+P*g;b.isStatic||b.isSleeping||(b.positionPrev.x+=Qi*b.inverseMass,b.positionPrev.y+=$i*b.inverseMass,b.anglePrev+=(V*$i-K*Qi)*b.inverseInertia),w.isStatic||w.isSleeping||(w.positionPrev.x-=Qi*w.inverseMass,w.positionPrev.y-=$i*w.inverseMass,w.anglePrev-=(Q*$i-tt*Qi)*w.inverseInertia)}}}}})()},function(e,s,n){var r={};e.exports=r;var o=n(9),a=n(0);(function(){r.create=function(h){return a.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},h)},r.update=function(h,c,l){var f=h.list,d=f.length,u=h.table,p=c.length,m=h.collisionStart,g=h.collisionEnd,_=h.collisionActive,A,y,v,x;for(m.length=0,g.length=0,_.length=0,x=0;x<d;x++)f[x].confirmedActive=!1;for(x=0;x<p;x++)A=c[x],v=A.pair,v?(v.isActive?_.push(v):m.push(v),o.update(v,A,l),v.confirmedActive=!0):(v=o.create(A,l),u[v.id]=v,m.push(v),f.push(v));var b=[];for(d=f.length,x=0;x<d;x++)v=f[x],v.confirmedActive||(o.setActive(v,!1,l),g.push(v),!v.collision.bodyA.isSleeping&&!v.collision.bodyB.isSleeping&&b.push(x));for(x=0;x<b.length;x++)y=b[x]-x,v=f[y],f.splice(y,1),delete u[v.id]},r.clear=function(h){return h.table={},h.list.length=0,h.collisionStart.length=0,h.collisionActive.length=0,h.collisionEnd.length=0,h}})()},function(e,s,n){var r=e.exports=n(22);r.Axes=n(11),r.Bodies=n(12),r.Body=n(6),r.Bounds=n(1),r.Collision=n(8),r.Common=n(0),r.Composite=n(5),r.Composites=n(23),r.Constraint=n(10),r.Contact=n(17),r.Detector=n(14),r.Engine=n(18),r.Events=n(4),r.Grid=n(24),r.Mouse=n(13),r.MouseConstraint=n(25),r.Pair=n(9),r.Pairs=n(20),r.Plugin=n(15),r.Query=n(26),r.Render=n(16),r.Resolver=n(19),r.Runner=n(27),r.SAT=n(28),r.Sleeping=n(7),r.Svg=n(29),r.Vector=n(2),r.Vertices=n(3),r.World=n(30),r.Engine.run=r.Runner.run,r.Common.deprecated(r.Engine,"run","Engine.run \u27A4 use Matter.Runner.run(engine) instead")},function(e,s,n){var r={};e.exports=r;var o=n(15),a=n(0);(function(){r.name="matter-js",r.version="0.18.0",r.uses=[],r.used=[],r.use=function(){o.use(r,Array.prototype.slice.call(arguments))},r.before=function(h,c){return h=h.replace(/^Matter./,""),a.chainPathBefore(r,h,c)},r.after=function(h,c){return h=h.replace(/^Matter./,""),a.chainPathAfter(r,h,c)}})()},function(e,s,n){var r={};e.exports=r;var o=n(5),a=n(10),h=n(0),c=n(6),l=n(12),f=h.deprecated;(function(){r.stack=function(d,u,p,m,g,_,A){for(var y=o.create({label:"Stack"}),v=d,x=u,b,w=0,E=0;E<m;E++){for(var S=0,C=0;C<p;C++){var T=A(v,x,C,E,b,w);if(T){var I=T.bounds.max.y-T.bounds.min.y,P=T.bounds.max.x-T.bounds.min.x;I>S&&(S=I),c.translate(T,{x:P*.5,y:I*.5}),v=T.bounds.max.x+g,o.addBody(y,T),b=T,w+=1}else v+=g}x+=S+_,v=d}return y},r.chain=function(d,u,p,m,g,_){for(var A=d.bodies,y=1;y<A.length;y++){var v=A[y-1],x=A[y],b=v.bounds.max.y-v.bounds.min.y,w=v.bounds.max.x-v.bounds.min.x,E=x.bounds.max.y-x.bounds.min.y,S=x.bounds.max.x-x.bounds.min.x,C={bodyA:v,pointA:{x:w*u,y:b*p},bodyB:x,pointB:{x:S*m,y:E*g}},T=h.extend(C,_);o.addConstraint(d,a.create(T))}return d.label+=" Chain",d},r.mesh=function(d,u,p,m,g){var _=d.bodies,A,y,v,x,b;for(A=0;A<p;A++){for(y=1;y<u;y++)v=_[y-1+A*u],x=_[y+A*u],o.addConstraint(d,a.create(h.extend({bodyA:v,bodyB:x},g)));if(A>0)for(y=0;y<u;y++)v=_[y+(A-1)*u],x=_[y+A*u],o.addConstraint(d,a.create(h.extend({bodyA:v,bodyB:x},g))),m&&y>0&&(b=_[y-1+(A-1)*u],o.addConstraint(d,a.create(h.extend({bodyA:b,bodyB:x},g)))),m&&y<u-1&&(b=_[y+1+(A-1)*u],o.addConstraint(d,a.create(h.extend({bodyA:b,bodyB:x},g))))}return d.label+=" Mesh",d},r.pyramid=function(d,u,p,m,g,_,A){return r.stack(d,u,p,m,g,_,function(y,v,x,b,w,E){var S=Math.min(m,Math.ceil(p/2)),C=w?w.bounds.max.x-w.bounds.min.x:0;if(!(b>S)){b=S-b;var T=b,I=p-1-b;if(!(x<T||x>I)){E===1&&c.translate(w,{x:(x+(p%2===1?1:-1))*C,y:0});var P=w?x*C:0;return A(d+P+x*g,v,x,b,w,E)}}})},r.newtonsCradle=function(d,u,p,m,g){for(var _=o.create({label:"Newtons Cradle"}),A=0;A<p;A++){var y=1.9,v=l.circle(d+A*(m*y),u+g,m,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),x=a.create({pointA:{x:d+A*(m*y),y:u},bodyB:v});o.addBody(_,v),o.addConstraint(_,x)}return _},f(r,"newtonsCradle","Composites.newtonsCradle \u27A4 moved to newtonsCradle example"),r.car=function(d,u,p,m,g){var _=c.nextGroup(!0),A=20,y=-p*.5+A,v=p*.5-A,x=0,b=o.create({label:"Car"}),w=l.rectangle(d,u,p,m,{collisionFilter:{group:_},chamfer:{radius:m*.5},density:2e-4}),E=l.circle(d+y,u+x,g,{collisionFilter:{group:_},friction:.8}),S=l.circle(d+v,u+x,g,{collisionFilter:{group:_},friction:.8}),C=a.create({bodyB:w,pointB:{x:y,y:x},bodyA:E,stiffness:1,length:0}),T=a.create({bodyB:w,pointB:{x:v,y:x},bodyA:S,stiffness:1,length:0});return o.addBody(b,w),o.addBody(b,E),o.addBody(b,S),o.addConstraint(b,C),o.addConstraint(b,T),b},f(r,"car","Composites.car \u27A4 moved to car example"),r.softBody=function(d,u,p,m,g,_,A,y,v,x){v=h.extend({inertia:1/0},v),x=h.extend({stiffness:.2,render:{type:"line",anchors:!1}},x);var b=r.stack(d,u,p,m,g,_,function(w,E){return l.circle(w,E,y,v)});return r.mesh(b,p,m,A,x),b.label="Soft Body",b},f(r,"softBody","Composites.softBody \u27A4 moved to softBody and cloth examples")})()},function(e,s,n){var r={};e.exports=r;var o=n(9),a=n(0),h=a.deprecated;(function(){r.create=function(c){var l={buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48};return a.extend(l,c)},r.update=function(c,l,f,d){var u,p,m,g=f.world,_=c.buckets,A,y,v=!1;for(u=0;u<l.length;u++){var x=l[u];if(!(x.isSleeping&&!d)&&!(g.bounds&&(x.bounds.max.x<g.bounds.min.x||x.bounds.min.x>g.bounds.max.x||x.bounds.max.y<g.bounds.min.y||x.bounds.min.y>g.bounds.max.y))){var b=r._getRegion(c,x);if(!x.region||b.id!==x.region.id||d){(!x.region||d)&&(x.region=b);var w=r._regionUnion(b,x.region);for(p=w.startCol;p<=w.endCol;p++)for(m=w.startRow;m<=w.endRow;m++){y=r._getBucketId(p,m),A=_[y];var E=p>=b.startCol&&p<=b.endCol&&m>=b.startRow&&m<=b.endRow,S=p>=x.region.startCol&&p<=x.region.endCol&&m>=x.region.startRow&&m<=x.region.endRow;!E&&S&&S&&A&&r._bucketRemoveBody(c,A,x),(x.region===b||E&&!S||d)&&(A||(A=r._createBucket(_,y)),r._bucketAddBody(c,A,x))}x.region=b,v=!0}}}v&&(c.pairsList=r._createActivePairsList(c))},h(r,"update","Grid.update \u27A4 replaced by Matter.Detector"),r.clear=function(c){c.buckets={},c.pairs={},c.pairsList=[]},h(r,"clear","Grid.clear \u27A4 replaced by Matter.Detector"),r._regionUnion=function(c,l){var f=Math.min(c.startCol,l.startCol),d=Math.max(c.endCol,l.endCol),u=Math.min(c.startRow,l.startRow),p=Math.max(c.endRow,l.endRow);return r._createRegion(f,d,u,p)},r._getRegion=function(c,l){var f=l.bounds,d=Math.floor(f.min.x/c.bucketWidth),u=Math.floor(f.max.x/c.bucketWidth),p=Math.floor(f.min.y/c.bucketHeight),m=Math.floor(f.max.y/c.bucketHeight);return r._createRegion(d,u,p,m)},r._createRegion=function(c,l,f,d){return{id:c+","+l+","+f+","+d,startCol:c,endCol:l,startRow:f,endRow:d}},r._getBucketId=function(c,l){return"C"+c+"R"+l},r._createBucket=function(c,l){var f=c[l]=[];return f},r._bucketAddBody=function(c,l,f){var d=c.pairs,u=o.id,p=l.length,m;for(m=0;m<p;m++){var g=l[m];if(!(f.id===g.id||f.isStatic&&g.isStatic)){var _=u(f,g),A=d[_];A?A[2]+=1:d[_]=[f,g,1]}}l.push(f)},r._bucketRemoveBody=function(c,l,f){var d=c.pairs,u=o.id,p;l.splice(a.indexOf(l,f),1);var m=l.length;for(p=0;p<m;p++){var g=d[u(f,l[p])];g&&(g[2]-=1)}},r._createActivePairsList=function(c){var l,f=c.pairs,d=a.keys(f),u=d.length,p=[],m;for(m=0;m<u;m++)l=f[d[m]],l[2]>0?p.push(l):delete f[d[m]];return p}})()},function(e,s,n){var r={};e.exports=r;var o=n(3),a=n(7),h=n(13),c=n(4),l=n(14),f=n(10),d=n(5),u=n(0),p=n(1);(function(){r.create=function(m,g){var _=(m?m.mouse:null)||(g?g.mouse:null);_||(m&&m.render&&m.render.canvas?_=h.create(m.render.canvas):g&&g.element?_=h.create(g.element):(_=h.create(),u.warn("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected")));var A=f.create({label:"Mouse Constraint",pointA:_.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),y={type:"mouseConstraint",mouse:_,element:null,body:null,constraint:A,collisionFilter:{category:1,mask:4294967295,group:0}},v=u.extend(y,g);return c.on(m,"beforeUpdate",function(){var x=d.allBodies(m.world);r.update(v,x),r._triggerEvents(v)}),v},r.update=function(m,g){var _=m.mouse,A=m.constraint,y=m.body;if(_.button===0){if(A.bodyB)a.set(A.bodyB,!1),A.pointA=_.position;else for(var v=0;v<g.length;v++)if(y=g[v],p.contains(y.bounds,_.position)&&l.canCollide(y.collisionFilter,m.collisionFilter))for(var x=y.parts.length>1?1:0;x<y.parts.length;x++){var b=y.parts[x];if(o.contains(b.vertices,_.position)){A.pointA=_.position,A.bodyB=m.body=y,A.pointB={x:_.position.x-y.position.x,y:_.position.y-y.position.y},A.angleB=y.angle,a.set(y,!1),c.trigger(m,"startdrag",{mouse:_,body:y});break}}}else A.bodyB=m.body=null,A.pointB=null,y&&c.trigger(m,"enddrag",{mouse:_,body:y})},r._triggerEvents=function(m){var g=m.mouse,_=g.sourceEvents;_.mousemove&&c.trigger(m,"mousemove",{mouse:g}),_.mousedown&&c.trigger(m,"mousedown",{mouse:g}),_.mouseup&&c.trigger(m,"mouseup",{mouse:g}),h.clearSourceEvents(g)}})()},function(e,s,n){var r={};e.exports=r;var o=n(2),a=n(8),h=n(1),c=n(12),l=n(3);(function(){r.collides=function(f,d){for(var u=[],p=d.length,m=f.bounds,g=a.collides,_=h.overlaps,A=0;A<p;A++){var y=d[A],v=y.parts.length,x=v===1?0:1;if(_(y.bounds,m))for(var b=x;b<v;b++){var w=y.parts[b];if(_(w.bounds,m)){var E=g(w,f);if(E){u.push(E);break}}}}return u},r.ray=function(f,d,u,p){p=p||1e-100;for(var m=o.angle(d,u),g=o.magnitude(o.sub(d,u)),_=(u.x+d.x)*.5,A=(u.y+d.y)*.5,y=c.rectangle(_,A,g,p,{angle:m}),v=r.collides(y,f),x=0;x<v.length;x+=1){var b=v[x];b.body=b.bodyB=b.bodyA}return v},r.region=function(f,d,u){for(var p=[],m=0;m<f.length;m++){var g=f[m],_=h.overlaps(g.bounds,d);(_&&!u||!_&&u)&&p.push(g)}return p},r.point=function(f,d){for(var u=[],p=0;p<f.length;p++){var m=f[p];if(h.contains(m.bounds,d))for(var g=m.parts.length===1?0:1;g<m.parts.length;g++){var _=m.parts[g];if(h.contains(_.bounds,d)&&l.contains(_.vertices,d)){u.push(m);break}}}return u}})()},function(e,s,n){var r={};e.exports=r;var o=n(4),a=n(18),h=n(0);(function(){var c,l;if(typeof window<"u"&&(c=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame,l=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),!c){var f;c=function(d){f=setTimeout(function(){d(h.now())},1e3/60)},l=function(){clearTimeout(f)}}r.create=function(d){var u={fps:60,correction:1,deltaSampleSize:60,counterTimestamp:0,frameCounter:0,deltaHistory:[],timePrev:null,timeScalePrev:1,frameRequestId:null,isFixed:!1,enabled:!0},p=h.extend(u,d);return p.delta=p.delta||1e3/p.fps,p.deltaMin=p.deltaMin||1e3/p.fps,p.deltaMax=p.deltaMax||1e3/(p.fps*.5),p.fps=1e3/p.delta,p},r.run=function(d,u){return typeof d.positionIterations<"u"&&(u=d,d=r.create()),function p(m){d.frameRequestId=c(p),m&&d.enabled&&r.tick(d,u,m)}(),d},r.tick=function(d,u,p){var m=u.timing,g=1,_,A={timestamp:m.timestamp};o.trigger(d,"beforeTick",A),d.isFixed?_=d.delta:(_=p-d.timePrev||d.delta,d.timePrev=p,d.deltaHistory.push(_),d.deltaHistory=d.deltaHistory.slice(-d.deltaSampleSize),_=Math.min.apply(null,d.deltaHistory),_=_<d.deltaMin?d.deltaMin:_,_=_>d.deltaMax?d.deltaMax:_,g=_/d.delta,d.delta=_),d.timeScalePrev!==0&&(g*=m.timeScale/d.timeScalePrev),m.timeScale===0&&(g=0),d.timeScalePrev=m.timeScale,d.correction=g,d.frameCounter+=1,p-d.counterTimestamp>=1e3&&(d.fps=d.frameCounter*((p-d.counterTimestamp)/1e3),d.counterTimestamp=p,d.frameCounter=0),o.trigger(d,"tick",A),o.trigger(d,"beforeUpdate",A),a.update(u,_,g),o.trigger(d,"afterUpdate",A),o.trigger(d,"afterTick",A)},r.stop=function(d){l(d.frameRequestId)},r.start=function(d,u){r.run(d,u)}})()},function(e,s,n){var r={};e.exports=r;var o=n(8),a=n(0),h=a.deprecated;(function(){r.collides=function(c,l){return o.collides(c,l)},h(r,"collides","SAT.collides \u27A4 replaced by Collision.collides")})()},function(e,s,n){var r={};e.exports=r,n(1);var o=n(0);(function(){r.pathToVertices=function(a,h){typeof window<"u"&&!("SVGPathSeg"in window)&&o.warn("Svg.pathToVertices: SVGPathSeg not defined, a polyfill is required.");var c,l,f,d,u,p,m,g,_,A,y=[],v,x,b=0,w=0,E=0;h=h||15;var S=function(T,I,P){var R=P%2===1&&P>1;if(!_||T!=_.x||I!=_.y){_&&R?(v=_.x,x=_.y):(v=0,x=0);var L={x:v+T,y:x+I};(R||!_)&&(_=L),y.push(L),w=v+T,E=x+I}},C=function(T){var I=T.pathSegTypeAsLetter.toUpperCase();if(I!=="Z"){switch(I){case"M":case"L":case"T":case"C":case"S":case"Q":w=T.x,E=T.y;break;case"H":w=T.x;break;case"V":E=T.y;break}S(w,E,T.pathSegType)}};for(r._svgPathToAbsolute(a),f=a.getTotalLength(),p=[],c=0;c<a.pathSegList.numberOfItems;c+=1)p.push(a.pathSegList.getItem(c));for(m=p.concat();b<f;){if(A=a.getPathSegAtLength(b),u=p[A],u!=g){for(;m.length&&m[0]!=u;)C(m.shift());g=u}switch(u.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":d=a.getPointAtLength(b),S(d.x,d.y,0);break}b+=h}for(c=0,l=m.length;c<l;++c)C(m[c]);return y},r._svgPathToAbsolute=function(a){for(var h,c,l,f,d,u,p=a.pathSegList,m=0,g=0,_=p.numberOfItems,A=0;A<_;++A){var y=p.getItem(A),v=y.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(v))"x"in y&&(m=y.x),"y"in y&&(g=y.y);else switch("x1"in y&&(l=m+y.x1),"x2"in y&&(d=m+y.x2),"y1"in y&&(f=g+y.y1),"y2"in y&&(u=g+y.y2),"x"in y&&(m+=y.x),"y"in y&&(g+=y.y),v){case"m":p.replaceItem(a.createSVGPathSegMovetoAbs(m,g),A);break;case"l":p.replaceItem(a.createSVGPathSegLinetoAbs(m,g),A);break;case"h":p.replaceItem(a.createSVGPathSegLinetoHorizontalAbs(m),A);break;case"v":p.replaceItem(a.createSVGPathSegLinetoVerticalAbs(g),A);break;case"c":p.replaceItem(a.createSVGPathSegCurvetoCubicAbs(m,g,l,f,d,u),A);break;case"s":p.replaceItem(a.createSVGPathSegCurvetoCubicSmoothAbs(m,g,d,u),A);break;case"q":p.replaceItem(a.createSVGPathSegCurvetoQuadraticAbs(m,g,l,f),A);break;case"t":p.replaceItem(a.createSVGPathSegCurvetoQuadraticSmoothAbs(m,g),A);break;case"a":p.replaceItem(a.createSVGPathSegArcAbs(m,g,y.r1,y.r2,y.angle,y.largeArcFlag,y.sweepFlag),A);break;case"z":case"Z":m=h,g=c;break}(v=="M"||v=="m")&&(h=m,c=g)}}})()},function(e,s,n){var r={};e.exports=r;var o=n(5);n(0),function(){r.create=o.create,r.add=o.add,r.remove=o.remove,r.clear=o.clear,r.addComposite=o.addComposite,r.addBody=o.addBody,r.addConstraint=o.addConstraint}()}])})})(ht);const lg=""+new URL("castle-gamebg.fef006e9.png",import.meta.url).href,cg=""+new URL("slingshot.e4a15587.png",import.meta.url).href,ug="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAACACAYAAAC7gW9qAAAPXUlEQVR4nO2ba4xdV3XHf2vv87jve+fOw2OPx44dPxI7mBgiCGohTaoWCLSNVNpUBRWpUj+0FZUo6hdKK1VCqvqtqtpSgWgRagoI2pRCRCDQBEGANDFNnJCYENvxM573677OY+/dD3fGnrHH9jyunbQ9v9HSfLj37LP3/+y99lrr7Av/z5GyL1jAORAgTh1aCZF13S8smgUc9AlUHNhQOGMBJeAp8LQgCADlSh+e1oC72K5I9x695OTYxKbb8K72gbv0f6vAzw2Ww3dtHSwf2DlY3DG7EMVPvnjhbx38g5JN9+F1ZVUBbPfpH+7L+x8+vKvyq+9+x/5db943Qr2cI5/zwTk+9+jzn/qbfz1ywFj3MU+R3Nxu944rBEhgqOyrj7/3zVs+/Mt3bqlt7w/JF3IM1vKI9unEKVopfv+Bt5ILvI/85UM/UtbyETQ9nuA3Bx1qwdFdn4l199y+vfzQH96/54F3H96SK+Q07dgy32jRaDQplMporUmNJU4Mb7t9G3Gcvu1HL4/FoZbviXTXQxjmUUpdvMmSD+g1s83WptvQoe46wTh1v/WWkdLnP3L/nl27Rso02ymp6T5UpRRxHBN12pQrVZRWOOew1nH3HSMcPzP9zhfPzh7Le/Ii/C8UIDbuwbt3VD7/vr0DpXYjQeU9/NDDLXPbSimiKCKJYyrVKgCpcfie4i37hvV3f3zqnZPz0aOlQm4iDHPIkvvnDS6AEu4+tK30hffvHyhZoNMxtBsx5VqI56kVW5dSik67jXOWcrmCc47UWPqrBUYHS+Xv/Pep2wX1xTAMDVwa9BtagFre+8oHDm7ZU/QVkXEoJSSRpdNMqdZziBK4TIRGYwGtPUrlMkpAKeGOW4c4P7mw64WTs8N9heAO4HYHLwPxG1oAJW5hqpW8bWctX817GuO6InQ6KWlsqPblVlzgACVCGjWplAoYFfDMsTG++NiLnD83w3Do3jJasL9Y0u5X5hO5K0WeUDD/RhVASr7QTNzBPfXc5z5wcMtdlZymnVpwYI1laKTElu1ljLEoEQJPEBHOTnV44WyHl063aM/MUPMMlZzG9xTWgcIxnwg/a/o/jK08oBXjb8RIUIeeIDAx2U6/fmau86bRau7WSuhhnUOJ0JyPCUNNXy0kMY5j59p848gkjx0Z49iJCdoL82wva+oFH4tgXXeWWIS8hpLH6Gyi9hnHwwJm88O+RO+2QQdK0Zhrm0d/Ntl662hfbvdAwQccvlZMzyUcm4x55Mgk3z86xsTEHL5LKAQKTysMQinQVzRugYLnyCl323SqjIMnerkSeiKAr8B0ZzxaaDVj+80zc+1De/vzt6Zonp+I+dHZBi+cmCJqNMlrQ+iprnOk69wS68hpRejJFeGgdVD0HMDbZxP1tKc4LtK9brM20+iBDxipV3CL03Yp84uNvX+w6D8cKAlanTaBGPzFATuufIbWQcFXjJb9xe9cdpNFoV5e8F+YTeUeLUxvuufA8Qs98AFbalUCz7tovueRC/y/9tL2fjGRhMqhRS0OfPUJLAKxcfhKKPhq1aRACRQ9NzQVa4zj29AVajPWiyWgnHPYK+20J4iW7hNfi/MWgamOIbFu1T3fOChox9ac+QPreOtFPTdjPUCt1rJDHk2uXipYlaViymTLXLVvxsFQaMpFz/257dkQNodafXLxZCL+sdXW+7XQCmYjw0Js0atc6gBPYDhn3i+O96huBzZsvWDVdgQ3aUQ/lIq3xgWwkvFmetWlYB3UfasKmj82Ds+5biq+EesF1xLyszHBmfXOAiUQW8dYM131Sgf4AvXAvsvBz7/ePkDXS8VVPxBoWNGRwr7Pw6zrjkqgYxxahFLQDY0vb1yL09Oxjp3j60o2Nv5exAHXW0r/1JHcfxqujPKu27DARDtd1R84B3ntKGr3S0B13Y33kGsKILi2Qz7Wkdy6AxehO9DXFhI6qWV59VikW4wMlNtpobbROKAXXNeZCu7ZVLw/iSVw63WISiB1cK6REhuLL91NtpUKr7b98blU/YUWOSvSzTDXa73gqj5gJfJsKl5FY9+h1+0PHKm1zEaWyGlahIx34KcTC19B+KhWylln2YjNNdsbHvgSa4p2BOcc8vG25EfEuQc90lVzgkt03wilTkicQimPci6kXgnY2xcSxxEnxqbfs9CI97WUennTo9gEa5wBsJjLfysR/07PpXsVFpCLccLSgFMLqXigAyqFArv6ixzaWuTQYI4dJY3nLEP1AqkXlF6+0JDQk29stPOR2bwnkFuHB9d1gUMGFfaLBdu6T2NwyiMyglKaYs6nL+8zVPAYyCsqvuAJWNctOHihMLJjC4cO7+f8dJPf+eR/LHTi6O2+Vi9tpPNzkd3IZStY8wxYQqDlUI+k4tcjvBPzsQvvHq3U7xopc3t/yO6ax2BeUfAFHWhy5YDaYIHBbUUGthQpln1Sa9g2UGJyPgp//MpEEHrytY10vhczYN0CdJE2yNesqC+Pzc5MbC95v37HUIHEWlILSeqoDOQZ3VOl2penWPa6lReEJElYmJ9nYW6OwZLPky+O70uN/ZoSGV9vL15PAVAISZoQRZ3jY43kvr0DhdGcpy9GfWliqfbl0Fowxl2M3UUEpRSpMVRyMDUfhS+db0roySPr7cXrKgDAQquBtTZtJXbaF/Xg3oECxjoQIU0szjrKfeEViYu1llq9Tv/AAIOVgO+9cGFvnNivKiWT6+lFTwToL5fWHYAopYiTmFariRJBKV6ZbCX37B8o3lLwu7NABDrtlGI5JMzpFSI453DOMTA8wr7dI7x6bjr37Klpl1/njtATAbAJ7aizTmsTxTFucQtUIraR2OmcVg/u6S9KNxUWrAWTdpfC8q6KCEkcY62jUqsyVMvzraeO77HWPSwiaw67eyKAJxZrN2DOrghHBY5Pt9N7bh8q3JJf9AVKCZ12Sq7oky94K2aBiBB12uTCIreM9HPi7FTh6KmZVs6Tb99UAYLVSjdr5LLExLZSO1/09G/uquclXfKGDpLYdN8zrkiIBGMMxhjq/f30l3M89l8nbjXGfUkpmV/L/XsiQM5TG0pErvAL3dGdmO2k9x4YKu0IFt8sixLiyBDkNIWSj1sWu3RfuXfQfsi+W4Z56cRY+aVzc9M5T753swRQvSjOLpmvJJ5uJZ96caLhAn0pdxSB6Qst0nT1Mtnk+BjGGD5w320ESn7XOjew6ZGtER2uv9ZxTRy80kzs+w8OlYa1dEUQEeLYEgSKYilccfCi+1mMKM2+W7Zy9JXzfcdfa5wKPHn6evfqyQzYdAuX4Ym0L8xHf//KVIvl/kUEpsfbpIm5YhYopZgYH0OwPHjfAbTI71nrCr3u22roUHdD1F6ZiGCcOxtZ92sHh4r9yyPAJLIEOY9ieaUvEBHSNMVYOLBnlKd+cmbo7FTraKi7Z46uRk+coL90SqyHppQ0Z9tJbWctd1+9EGCWTfk0NlTq+StmgYjQabcZHhogF/jy2JFTfYGWh65Vl++NAD1fBF1i404qkQ/eNlgomsWn3Q2ALGFOU6qEV8wCaw1parjt1lF+cPTULWOz7cd9Laeudo83tADA/HxkRvb1F+4uLR64gO4MiTspnif4gUb7cjGQEFG0Wi22bukHlDxx9Jwfejx8tRJcTwQI9eZjgNVMi9BK7GuFQH1oTz0fLgVGIoJJLHPTEQuzESDkCx5KCc51E6U4Sjm4b5THnzm5fbYZf93Tsup78N4I4ElPDitcxcYX4vTwgaHSQV+pZXGBIKqbMS7MRnTaKaVygPYVgtBud9g2VKeVkv/BSxdm8p48fuME2EQofD1EhEZsZ+p5/0M7qrlL4fGyzxGIWimNhZhSNcTzNc5a0iRh/65tfOfpkzubUfJ5reSKEvDrngusBeM4007tLxwcKu5UcsmlW+vIl33CnE8SG5LEELVTqn05lFK02222D9eZbiS1I8cnT+Q8OXJ52z3KBjf+dnYtJmDnOynba7kHhoort0RBsWNPFeeg3UyJI4OIUK4GGOswacru0WG++dTxqrPuCyKy4pRZbwS4cbsAAKIgcZxyzj1wYKg4sNTn7pZoCEKPrTsrxB1Dp5UStVNK1ZAw9Gi1OoxuqXF+Jhr5yemZJwJPXl3edk8EKPgKreSGmRJBK+nMdtK+3f2Fe2s5/9IscGBTR6U/R6kSsDDXIWobPF9RqgZ4nk/ga/rrFfXYM6dtnNqvOtc91WZs97XbpgXw1Y1dAktjjVJ3xlfyob0DhYKxF6cBaWooFAMK5YA0sjTnI0QpqrWAIAjo6x9iuJbn+ZOTw6cmGv+SOhqp683g4SY4wSUEmZ3vmN23DRbuyi+rG1rrUFpRreeIY8P8TIRSQrU/Dzhq9X76amWwtlzO6Sc/+N47j73z0Cj33LmT7z57etP90v7NEkCgEdupWt777d19eT+2lw7epamh3l8gaifMzUR4vqI20BUg8AOCfIld22rce3in2T9S+vd9W0vutpEKn37khU33a31HwTaJVjx19ELj8cPbKvd7IljnkMXj+QvzEa2FBBZnhpJugDY1NYHn+wRBwNzszG9Mjo9/xjn3RK/65N3Mn715Wux4I/70K5PN+w8Nl+ksLmRRwvj55mKtQPB8jfK6OYJJDefPngYEa63v+f4ngO8DaS/6tOo5wRtlqpvbfue5C42nl58iE4GonWAXt7XluUE3t+jWLbXWAPcCD/Ri8LB4UvRmmq+k8epM57Pn5jtcnh9At5RerobXOgOjgE8A63utfbXGrOue3buZFhv35edeaxxfqkUtYY0jX/LJl/ylH29ejTcDf9QTARw3/08ppn862frMeDMm0N1QdKmE3r+lgCxO/+vQk2VwgwPh1dEC85H552cvLJxevguLQBDotR4B2/zpCECtpcZ3I0wrzj13ofGPE60EXylEwBhLqxEja3ssPYkFe/piZD2mBWY75u9+eHr2pKfl4t4/O9XGJBZ1nQDNObeR9/qrCHADymFrtcCTyecuND7508kmeU8jSmg3Us6enCeNDdpT6EVxVg7ezllr/7QXAujgxpbErmlKILHu+bNz0Z5d9dybioHGLcYE87MRZvGQhfb0ChGcc38mIp/5t6de27QANzUUXrUDStKxZvLRZ84vbH3v3v4hs5gcJbHltbMLJgj0z3Yf6P8r7WnrLhVWN58FZWRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGT8n+J/AMDGzTzRScLQAAAAAElFTkSuQmCC",Ph=""+new URL("missile-launch.2ced09a9.mp3",import.meta.url).href;let Rh;function dg(i){return Rh=i,i}function Vi(){return Rh}let fg=0;const rr=class extends re{constructor(i){super(),this.id=fg++,this.init(i)}set(i,t){if(this[i]===void 0)throw new Error(`Property with name ${i} does not exist.`);switch(i){case"speed":this.speed=t;break;case"volume":this.volume=t;break;case"paused":this.paused=t;break;case"loop":this.loop=t;break;case"muted":this.muted=t;break}return this}get progress(){const{currentTime:i}=this._source;return i/this._duration}get paused(){return this._paused}set paused(i){this._paused=i,this.refreshPaused()}_onPlay(){this._playing=!0}_onPause(){this._playing=!1}init(i){this._playing=!1,this._duration=i.source.duration;const t=this._source=i.source.cloneNode(!1);t.src=i.parent.url,t.onplay=this._onPlay.bind(this),t.onpause=this._onPause.bind(this),i.context.on("refresh",this.refresh,this),i.context.on("refreshPaused",this.refreshPaused,this),this._media=i}_internalStop(){this._source&&this._playing&&(this._source.onended=null,this._source.pause())}stop(){this._internalStop(),this._source&&this.emit("stop")}get speed(){return this._speed}set speed(i){this._speed=i,this.refresh()}get volume(){return this._volume}set volume(i){this._volume=i,this.refresh()}get loop(){return this._loop}set loop(i){this._loop=i,this.refresh()}get muted(){return this._muted}set muted(i){this._muted=i,this.refresh()}get filters(){return console.warn("HTML Audio does not support filters"),null}set filters(i){console.warn("HTML Audio does not support filters")}refresh(){const i=this._media.context,t=this._media.parent;this._source.loop=this._loop||t.loop;const e=i.volume*(i.muted?0:1),s=t.volume*(t.muted?0:1),n=this._volume*(this._muted?0:1);this._source.volume=n*e*s,this._source.playbackRate=this._speed*i.speed*t.speed}refreshPaused(){const i=this._media.context,t=this._media.parent,e=this._paused||t.paused||i.paused;e!==this._pausedReal&&(this._pausedReal=e,e?(this._internalStop(),this.emit("paused")):(this.emit("resumed"),this.play({start:this._source.currentTime,end:this._end,volume:this._volume,speed:this._speed,loop:this._loop})),this.emit("pause",e))}play(i){const{start:t,end:e,speed:s,loop:n,volume:r,muted:o}=i;e&&console.assert(e>t,"End time is before start time"),this._speed=s,this._volume=r,this._loop=!!n,this._muted=o,this.refresh(),this.loop&&e!==null&&(console.warn('Looping not support when specifying an "end" time'),this.loop=!1),this._start=t,this._end=e||this._duration,this._start=Math.max(0,this._start-rr.PADDING),this._end=Math.min(this._end+rr.PADDING,this._duration),this._source.onloadedmetadata=()=>{this._source&&(this._source.currentTime=t,this._source.onloadedmetadata=null,this.emit("progress",t,this._duration),st.shared.add(this._onUpdate,this))},this._source.onended=this._onComplete.bind(this),this._source.play(),this.emit("start")}_onUpdate(){this.emit("progress",this.progress,this._duration),this._source.currentTime>=this._end&&!this._source.loop&&this._onComplete()}_onComplete(){st.shared.remove(this._onUpdate,this),this._internalStop(),this.emit("progress",1,this._duration),this.emit("end",this)}destroy(){st.shared.remove(this._onUpdate,this),this.removeAllListeners();const i=this._source;i&&(i.onended=null,i.onplay=null,i.onpause=null,this._internalStop()),this._source=null,this._speed=1,this._volume=1,this._loop=!1,this._end=null,this._start=0,this._duration=0,this._playing=!1,this._pausedReal=!1,this._paused=!1,this._muted=!1,this._media&&(this._media.context.off("refresh",this.refresh,this),this._media.context.off("refreshPaused",this.refreshPaused,this),this._media=null)}toString(){return`[HTMLAudioInstance id=${this.id}]`}};let Mh=rr;Mh.PADDING=.1;class pg extends re{init(t){this.parent=t,this._source=t.options.source||new Audio,t.url&&(this._source.src=t.url)}create(){return new Mh(this)}get isPlayable(){return!!this._source&&this._source.readyState===4}get duration(){return this._source.duration}get context(){return this.parent.context}get filters(){return null}set filters(t){console.warn("HTML Audio does not support filters")}destroy(){this.removeAllListeners(),this.parent=null,this._source&&(this._source.src="",this._source.load(),this._source=null)}get source(){return this._source}load(t){const e=this._source,s=this.parent;if(e.readyState===4){s.isLoaded=!0;const h=s.autoPlayStart();t&&setTimeout(()=>{t(null,s,h)},0);return}if(!s.url){t(new Error("sound.url or sound.source must be set"));return}e.src=s.url;const n=()=>{a(),s.isLoaded=!0;const h=s.autoPlayStart();t&&t(null,s,h)},r=()=>{a(),t&&t(new Error("Sound loading has been aborted"))},o=()=>{a();const h=`Failed to load audio element (code: ${e.error.code})`;t?t(new Error(h)):console.error(h)},a=()=>{e.removeEventListener("canplaythrough",n),e.removeEventListener("load",n),e.removeEventListener("abort",r),e.removeEventListener("error",o)};e.addEventListener("canplaythrough",n,!1),e.addEventListener("load",n,!1),e.addEventListener("abort",r,!1),e.addEventListener("error",o,!1),e.load()}}class mg{constructor(t,e){this.parent=t,Object.assign(this,e),this.duration=this.end-this.start,console.assert(this.duration>0,"End time must be after start time")}play(t){return this.parent.play({complete:t,speed:this.speed||this.parent.speed,end:this.end,start:this.start,loop:this.loop})}destroy(){this.parent=null}}class or{static setParamValue(t,e){if(t.setValueAtTime){const s=Vi().context;t.setValueAtTime(e,s.audioContext.currentTime)}else t.value=e;return e}}let gg=0;class vg extends re{constructor(t){super(),this.id=gg++,this._media=null,this._paused=!1,this._muted=!1,this._elapsed=0,this.init(t)}set(t,e){if(this[t]===void 0)throw new Error(`Property with name ${t} does not exist.`);switch(t){case"speed":this.speed=e;break;case"volume":this.volume=e;break;case"muted":this.muted=e;break;case"loop":this.loop=e;break;case"paused":this.paused=e;break}return this}stop(){this._source&&(this._internalStop(),this.emit("stop"))}get speed(){return this._speed}set speed(t){this._speed=t,this.refresh(),this._update(!0)}get volume(){return this._volume}set volume(t){this._volume=t,this.refresh()}get muted(){return this._muted}set muted(t){this._muted=t,this.refresh()}get loop(){return this._loop}set loop(t){this._loop=t,this.refresh()}get filters(){return this._filters}set filters(t){var e;this._filters&&((e=this._filters)==null||e.filter(s=>s).forEach(s=>s.disconnect()),this._filters=null,this._source.connect(this._gain)),this._filters=t!=null&&t.length?t.slice(0):null,this.refresh()}refresh(){if(!this._source)return;const t=this._media.context,e=this._media.parent;this._source.loop=this._loop||e.loop;const s=t.volume*(t.muted?0:1),n=e.volume*(e.muted?0:1),r=this._volume*(this._muted?0:1);or.setParamValue(this._gain.gain,r*n*s),or.setParamValue(this._source.playbackRate,this._speed*e.speed*t.speed),this.applyFilters()}applyFilters(){var t;if((t=this._filters)!=null&&t.length){this._source.disconnect();let e=this._source;this._filters.forEach(s=>{e.connect(s.destination),e=s}),e.connect(this._gain)}}refreshPaused(){const t=this._media.context,e=this._media.parent,s=this._paused||e.paused||t.paused;s!==this._pausedReal&&(this._pausedReal=s,s?(this._internalStop(),this.emit("paused")):(this.emit("resumed"),this.play({start:this._elapsed%this._duration,end:this._end,speed:this._speed,loop:this._loop,volume:this._volume})),this.emit("pause",s))}play(t){const{start:e,end:s,speed:n,loop:r,volume:o,muted:a,filters:h}=t;s&&console.assert(s>e,"End time is before start time"),this._paused=!1;const{source:c,gain:l}=this._media.nodes.cloneBufferSource();this._source=c,this._gain=l,this._speed=n,this._volume=o,this._loop=!!r,this._muted=a,this._filters=h,this.refresh();const f=this._source.buffer.duration;this._duration=f,this._end=s,this._lastUpdate=this._now(),this._elapsed=e,this._source.onended=this._onComplete.bind(this),this._loop?(this._source.loopEnd=s,this._source.loopStart=e,this._source.start(0,e)):s?this._source.start(0,e,s-e):this._source.start(0,e),this.emit("start"),this._update(!0),this.enableTicker(!0)}enableTicker(t){st.shared.remove(this._updateListener,this),t&&st.shared.add(this._updateListener,this)}get progress(){return this._progress}get paused(){return this._paused}set paused(t){this._paused=t,this.refreshPaused()}destroy(){var t;this.removeAllListeners(),this._internalStop(),this._gain&&(this._gain.disconnect(),this._gain=null),this._media&&(this._media.context.events.off("refresh",this.refresh,this),this._media.context.events.off("refreshPaused",this.refreshPaused,this),this._media=null),(t=this._filters)==null||t.forEach(e=>e.disconnect()),this._filters=null,this._end=null,this._speed=1,this._volume=1,this._loop=!1,this._elapsed=0,this._duration=0,this._paused=!1,this._muted=!1,this._pausedReal=!1}toString(){return`[WebAudioInstance id=${this.id}]`}_now(){return this._media.context.audioContext.currentTime}_updateListener(){this._update()}_update(t=!1){if(this._source){const e=this._now(),s=e-this._lastUpdate;if(s>0||t){const n=this._source.playbackRate.value;this._elapsed+=s*n,this._lastUpdate=e;const r=this._duration;let o;if(this._source.loopStart){const a=this._source.loopEnd-this._source.loopStart;o=(this._source.loopStart+this._elapsed%a)/r}else o=this._elapsed%r/r;this._progress=o,this.emit("progress",this._progress,r)}}}init(t){this._media=t,t.context.events.on("refresh",this.refresh,this),t.context.events.on("refreshPaused",this.refreshPaused,this)}_internalStop(){if(this._source){this.enableTicker(!1),this._source.onended=null,this._source.stop(0),this._source.disconnect();try{this._source.buffer=null}catch(t){console.warn("Failed to set AudioBufferSourceNode.buffer to null:",t)}this._source=null}}_onComplete(){if(this._source){this.enableTicker(!1),this._source.onended=null,this._source.disconnect();try{this._source.buffer=null}catch(t){console.warn("Failed to set AudioBufferSourceNode.buffer to null:",t)}}this._source=null,this._progress=1,this.emit("progress",1,this._duration),this.emit("end",this)}}class Bh{constructor(t,e){this._output=e,this._input=t}get destination(){return this._input}get filters(){return this._filters}set filters(t){if(this._filters&&(this._filters.forEach(e=>{e&&e.disconnect()}),this._filters=null,this._input.connect(this._output)),t&&t.length){this._filters=t.slice(0),this._input.disconnect();let e=null;t.forEach(s=>{e===null?this._input.connect(s.destination):e.connect(s.destination),e=s}),e.connect(this._output)}}destroy(){this.filters=null,this._input=null,this._output=null}}const Dh=class extends Bh{constructor(i){const t=i.audioContext,e=t.createBufferSource(),s=t.createGain(),n=t.createAnalyser();e.connect(n),n.connect(s),s.connect(i.destination),super(n,s),this.context=i,this.bufferSource=e,this.gain=s,this.analyser=n}get script(){return this._script||(this._script=this.context.audioContext.createScriptProcessor(Dh.BUFFER_SIZE),this._script.connect(this.context.destination)),this._script}destroy(){super.destroy(),this.bufferSource.disconnect(),this._script&&this._script.disconnect(),this.gain.disconnect(),this.analyser.disconnect(),this.bufferSource=null,this._script=null,this.gain=null,this.analyser=null,this.context=null}cloneBufferSource(){const i=this.bufferSource,t=this.context.audioContext.createBufferSource();t.buffer=i.buffer,or.setParamValue(t.playbackRate,i.playbackRate.value),t.loop=i.loop;const e=this.context.audioContext.createGain();return t.connect(e),e.connect(this.destination),{source:t,gain:e}}get bufferSize(){return this.script.bufferSize}};let Fh=Dh;Fh.BUFFER_SIZE=0;class _g{init(t){this.parent=t,this._nodes=new Fh(this.context),this._source=this._nodes.bufferSource,this.source=t.options.source}destroy(){this.parent=null,this._nodes.destroy(),this._nodes=null;try{this._source.buffer=null}catch(t){console.warn("Failed to set AudioBufferSourceNode.buffer to null:",t)}this._source=null,this.source=null}create(){return new vg(this)}get context(){return this.parent.context}get isPlayable(){return!!this._source&&!!this._source.buffer}get filters(){return this._nodes.filters}set filters(t){this._nodes.filters=t}get duration(){return console.assert(this.isPlayable,"Sound not yet playable, no duration"),this._source.buffer.duration}get buffer(){return this._source.buffer}set buffer(t){this._source.buffer=t}get nodes(){return this._nodes}load(t){this.source?this._decode(this.source,t):this.parent.url?this._loadUrl(t):t?t(new Error("sound.url or sound.source must be set")):console.error("sound.url or sound.source must be set")}async _loadUrl(t){const e=this.parent.url,s=await O.ADAPTER.fetch(e);this._decode(await s.arrayBuffer(),t)}_decode(t,e){const s=(n,r)=>{if(n)e&&e(n);else{this.parent.isLoaded=!0,this.buffer=r;const o=this.parent.autoPlayStart();e&&e(null,this.parent,o)}};t instanceof AudioBuffer?s(null,t):this.parent.context.decode(t,s)}}var yg=Object.defineProperty,No=Object.getOwnPropertySymbols,xg=Object.prototype.hasOwnProperty,wg=Object.prototype.propertyIsEnumerable,Go=(i,t,e)=>t in i?yg(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,Ho=(i,t)=>{for(var e in t||(t={}))xg.call(t,e)&&Go(i,e,t[e]);if(No)for(var e of No(t))wg.call(t,e)&&Go(i,e,t[e]);return i};const Qe=class{static from(i){let t={};typeof i=="string"?t.url=i:i instanceof ArrayBuffer||i instanceof AudioBuffer||i instanceof HTMLAudioElement?t.source=i:t=i,t=Ho({autoPlay:!1,singleInstance:!1,url:null,source:null,preload:!1,volume:1,speed:1,complete:null,loaded:null,loop:!1},t),Object.freeze(t);const e=Vi().useLegacy?new pg:new _g;return new Qe(e,t)}constructor(i,t){this.media=i,this.options=t,this._instances=[],this._sprites={},this.media.init(this);const e=t.complete;this._autoPlayOptions=e?{complete:e}:null,this.isLoaded=!1,this.isPlaying=!1,this.autoPlay=t.autoPlay,this.singleInstance=t.singleInstance,this.preload=t.preload||this.autoPlay,this.url=t.url,this.speed=t.speed,this.volume=t.volume,this.loop=t.loop,t.sprites&&this.addSprites(t.sprites),this.preload&&this._preload(t.loaded)}get context(){return Vi().context}pause(){return this.isPlaying=!1,this.paused=!0,this}resume(){return this.isPlaying=this._instances.length>0,this.paused=!1,this}get paused(){return this._paused}set paused(i){this._paused=i,this.refreshPaused()}get speed(){return this._speed}set speed(i){this._speed=i,this.refresh()}get filters(){return this.media.filters}set filters(i){this.media.filters=i}addSprites(i,t){if(typeof i=="object"){const s={};for(const n in i)s[n]=this.addSprites(n,i[n]);return s}console.assert(!this._sprites[i],`Alias ${i} is already taken`);const e=new mg(this,t);return this._sprites[i]=e,e}destroy(){this._removeInstances(),this.removeSprites(),this.media.destroy(),this.media=null,this._sprites=null,this._instances=null}removeSprites(i){if(i){const t=this._sprites[i];t!==void 0&&(t.destroy(),delete this._sprites[i])}else for(const t in this._sprites)this.removeSprites(t);return this}get isPlayable(){return this.isLoaded&&this.media&&this.media.isPlayable}stop(){if(!this.isPlayable)return this.autoPlay=!1,this._autoPlayOptions=null,this;this.isPlaying=!1;for(let i=this._instances.length-1;i>=0;i--)this._instances[i].stop();return this}play(i,t){let e;if(typeof i=="string"?e={sprite:i,loop:this.loop,complete:t}:typeof i=="function"?(e={},e.complete=i):e=i,e=Ho({complete:null,loaded:null,sprite:null,end:null,start:0,volume:1,speed:1,muted:!1,loop:!1},e||{}),e.sprite){const n=e.sprite;console.assert(!!this._sprites[n],`Alias ${n} is not available`);const r=this._sprites[n];e.start=r.start+(e.start||0),e.end=r.end,e.speed=r.speed||1,e.loop=r.loop||e.loop,delete e.sprite}if(e.offset&&(e.start=e.offset),!this.isLoaded)return new Promise((n,r)=>{this.autoPlay=!0,this._autoPlayOptions=e,this._preload((o,a,h)=>{o?r(o):(e.loaded&&e.loaded(o,a,h),n(h))})});(this.singleInstance||e.singleInstance)&&this._removeInstances();const s=this._createInstance();return this._instances.push(s),this.isPlaying=!0,s.once("end",()=>{e.complete&&e.complete(this),this._onComplete(s)}),s.once("stop",()=>{this._onComplete(s)}),s.play(e),s}refresh(){const i=this._instances.length;for(let t=0;t<i;t++)this._instances[t].refresh()}refreshPaused(){const i=this._instances.length;for(let t=0;t<i;t++)this._instances[t].refreshPaused()}get volume(){return this._volume}set volume(i){this._volume=i,this.refresh()}get muted(){return this._muted}set muted(i){this._muted=i,this.refresh()}get loop(){return this._loop}set loop(i){this._loop=i,this.refresh()}_preload(i){this.media.load(i)}get instances(){return this._instances}get sprites(){return this._sprites}get duration(){return this.media.duration}autoPlayStart(){let i;return this.autoPlay&&(i=this.play(this._autoPlayOptions)),i}_removeInstances(){for(let i=this._instances.length-1;i>=0;i--)this._poolInstance(this._instances[i]);this._instances.length=0}_onComplete(i){if(this._instances){const t=this._instances.indexOf(i);t>-1&&this._instances.splice(t,1),this.isPlaying=this._instances.length>0}this._poolInstance(i)}_createInstance(){if(Qe._pool.length>0){const i=Qe._pool.pop();return i.init(this.media),i}return this.media.create()}_poolInstance(i){i.destroy(),Qe._pool.indexOf(i)<0&&Qe._pool.push(i)}};let Xi=Qe;Xi._pool=[];class bg extends re{constructor(){super(...arguments),this.speed=1,this.muted=!1,this.volume=1,this.paused=!1}refresh(){this.emit("refresh")}refreshPaused(){this.emit("refreshPaused")}get filters(){return console.warn("HTML Audio does not support filters"),null}set filters(t){console.warn("HTML Audio does not support filters")}get audioContext(){return console.warn("HTML Audio does not support audioContext"),null}toggleMute(){return this.muted=!this.muted,this.refresh(),this.muted}togglePause(){return this.paused=!this.paused,this.refreshPaused(),this.paused}destroy(){this.removeAllListeners()}}class Wi extends Bh{constructor(){const t=window,e=new Wi.AudioContext,s=e.createDynamicsCompressor(),n=e.createAnalyser();n.connect(s),s.connect(e.destination),super(n,s),this._ctx=e,this._offlineCtx=new Wi.OfflineAudioContext(1,2,t.OfflineAudioContext?Math.max(8e3,Math.min(96e3,e.sampleRate)):44100),this._unlocked=!1,this.compressor=s,this.analyser=n,this.events=new re,this.volume=1,this.speed=1,this.muted=!1,this.paused=!1,e.state!=="running"&&(this._unlock(),this._unlock=this._unlock.bind(this),document.addEventListener("mousedown",this._unlock,!0),document.addEventListener("touchstart",this._unlock,!0),document.addEventListener("touchend",this._unlock,!0))}_unlock(){this._unlocked||(this.playEmptySound(),this._ctx.state==="running"&&(document.removeEventListener("mousedown",this._unlock,!0),document.removeEventListener("touchend",this._unlock,!0),document.removeEventListener("touchstart",this._unlock,!0),this._unlocked=!0))}playEmptySound(){const t=this._ctx.createBufferSource();t.buffer=this._ctx.createBuffer(1,1,22050),t.connect(this._ctx.destination),t.start(0,0,0),t.context.state==="suspended"&&t.context.resume()}static get AudioContext(){const t=window;return t.AudioContext||t.webkitAudioContext||null}static get OfflineAudioContext(){const t=window;return t.OfflineAudioContext||t.webkitOfflineAudioContext||null}destroy(){super.destroy();const t=this._ctx;typeof t.close<"u"&&t.close(),this.events.removeAllListeners(),this.analyser.disconnect(),this.compressor.disconnect(),this.analyser=null,this.compressor=null,this.events=null,this._offlineCtx=null,this._ctx=null}get audioContext(){return this._ctx}get offlineContext(){return this._offlineCtx}set paused(t){t&&this._ctx.state==="running"?this._ctx.suspend():!t&&this._ctx.state==="suspended"&&this._ctx.resume(),this._paused=t}get paused(){return this._paused}refresh(){this.events.emit("refresh")}refreshPaused(){this.events.emit("refreshPaused")}toggleMute(){return this.muted=!this.muted,this.refresh(),this.muted}togglePause(){return this.paused=!this.paused,this.refreshPaused(),this._paused}decode(t,e){const s=r=>{e(new Error((r==null?void 0:r.message)||"Unable to decode file"))},n=this._offlineCtx.decodeAudioData(t,r=>{e(null,r)},s);n&&n.catch(s)}}var Ag=Object.defineProperty,zo=Object.getOwnPropertySymbols,Eg=Object.prototype.hasOwnProperty,Tg=Object.prototype.propertyIsEnumerable,Vo=(i,t,e)=>t in i?Ag(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,Xo=(i,t)=>{for(var e in t||(t={}))Eg.call(t,e)&&Vo(i,e,t[e]);if(zo)for(var e of zo(t))Tg.call(t,e)&&Vo(i,e,t[e]);return i};class Sg{constructor(){this.init()}init(){return this.supported&&(this._webAudioContext=new Wi),this._htmlAudioContext=new bg,this._sounds={},this.useLegacy=!this.supported,this}get context(){return this._context}get filtersAll(){return this.useLegacy?[]:this._context.filters}set filtersAll(t){this.useLegacy||(this._context.filters=t)}get supported(){return Wi.AudioContext!==null}add(t,e){if(typeof t=="object"){const r={};for(const o in t){const a=this._getOptions(t[o],e);r[o]=this.add(o,a)}return r}if(console.assert(!this._sounds[t],`Sound with alias ${t} already exists.`),e instanceof Xi)return this._sounds[t]=e,e;const s=this._getOptions(e),n=Xi.from(s);return this._sounds[t]=n,n}_getOptions(t,e){let s;return typeof t=="string"?s={url:t}:t instanceof ArrayBuffer||t instanceof AudioBuffer||t instanceof HTMLAudioElement?s={source:t}:s=t,s=Xo(Xo({},s),e||{}),s}get useLegacy(){return this._useLegacy}set useLegacy(t){this._useLegacy=t,this._context=!t&&this.supported?this._webAudioContext:this._htmlAudioContext}remove(t){return this.exists(t,!0),this._sounds[t].destroy(),delete this._sounds[t],this}get volumeAll(){return this._context.volume}set volumeAll(t){this._context.volume=t,this._context.refresh()}get speedAll(){return this._context.speed}set speedAll(t){this._context.speed=t,this._context.refresh()}togglePauseAll(){return this._context.togglePause()}pauseAll(){return this._context.paused=!0,this._context.refreshPaused(),this}resumeAll(){return this._context.paused=!1,this._context.refreshPaused(),this}toggleMuteAll(){return this._context.toggleMute()}muteAll(){return this._context.muted=!0,this._context.refresh(),this}unmuteAll(){return this._context.muted=!1,this._context.refresh(),this}removeAll(){for(const t in this._sounds)this._sounds[t].destroy(),delete this._sounds[t];return this}stopAll(){for(const t in this._sounds)this._sounds[t].stop();return this}exists(t,e=!1){const s=!!this._sounds[t];return e&&console.assert(s,`No sound matching alias '${t}'.`),s}find(t){return this.exists(t,!0),this._sounds[t]}play(t,e){return this.find(t).play(e)}stop(t){return this.find(t).stop()}pause(t){return this.find(t).pause()}resume(t){return this.find(t).resume()}volume(t,e){const s=this.find(t);return e!==void 0&&(s.volume=e),s.volume}speed(t,e){const s=this.find(t);return e!==void 0&&(s.speed=e),s.speed}duration(t){return this.find(t).duration}close(){return this.removeAll(),this._sounds=null,this._webAudioContext&&(this._webAudioContext.destroy(),this._webAudioContext=null),this._htmlAudioContext&&(this._htmlAudioContext.destroy(),this._htmlAudioContext=null),this._context=null,this}}var Cg=Object.defineProperty,Wo=Object.getOwnPropertySymbols,Ig=Object.prototype.hasOwnProperty,Pg=Object.prototype.propertyIsEnumerable,jo=(i,t,e)=>t in i?Cg(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,Rg=(i,t)=>{for(var e in t||(t={}))Ig.call(t,e)&&jo(i,e,t[e]);if(Wo)for(var e of Wo(t))Pg.call(t,e)&&jo(i,e,t[e]);return i};const Lh=["mp3","ogg","oga","opus","mpeg","wav","m4a","aiff","wma","mid","caf"],ar={};function Mg(i){const t=Rg({m4a:"audio/mp4",oga:"audio/ogg",opus:'audio/ogg; codecs="opus"',caf:'audio/x-caf; codecs="opus"'},i||{}),e=document.createElement("audio"),s={},n=/^no$/;Lh.forEach(r=>{const o=e.canPlayType(`audio/${r}`).replace(n,""),a=t[r]?e.canPlayType(t[r]).replace(n,""):"";s[r]=!!o||!!a}),Object.assign(ar,s)}Mg();var Bg=Object.defineProperty,Dg=Object.defineProperties,Fg=Object.getOwnPropertyDescriptors,Yo=Object.getOwnPropertySymbols,Lg=Object.prototype.hasOwnProperty,kg=Object.prototype.propertyIsEnumerable,Ko=(i,t,e)=>t in i?Bg(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,Og=(i,t)=>{for(var e in t||(t={}))Lg.call(t,e)&&Ko(i,e,t[e]);if(Yo)for(var e of Yo(t))kg.call(t,e)&&Ko(i,e,t[e]);return i},Ug=(i,t)=>Dg(i,Fg(t));const Zo=i=>{var t,e;const s=i.src;return(e=(t=i==null?void 0:i.alias)==null?void 0:t[0])!=null?e:yt.basename(s,yt.extname(s))},Ng={extension:z.Asset,detection:{test:async()=>!0,add:async i=>[...i,...Lh.filter(t=>ar[t])],remove:async i=>i.filter(t=>i.includes(t))},loader:{extension:{type:[z.LoadParser],priority:jt.High},test(i){const t=yt.extname(i).slice(1);return!!ar[t]},async load(i,t){const e=await new Promise((s,n)=>Xi.from(Ug(Og({},t.data),{url:i,preload:!0,loaded(r,o){var a,h;r?n(r):s(o),(h=(a=t.data)==null?void 0:a.loaded)==null||h.call(a,r,o)}})));return Vi().add(Zo(t),e),e},async unload(i,t){Vi().remove(Zo(t))}}};Y.add(Ng);dg(new Sg);const Qo={};async function ie(i,t){let e=Qo[i];return e||(Qo[i]=e=Xi.from(i)),await e.play(t)}class Gg{constructor(t,e){N(this,"bandSprites",[]);N(this,"shootData");N(this,"onMouseEndDrag",async()=>{if(this.shootData){const t=this.shootData.rock;t.collisionFilter.category=1,this.shootData.releaseStart=ht.exports.Vector.clone(t.position),ie(Ph),await this.waitRockBackToAPoint(),ht.exports.Composite.remove(this.game.engine.world,this.shootData.elastic),this.shootData=void 0,await this.game.waitWorldPeace(),this.loadRock()}});this.game=t,this.data=e,this.createSprites(e),this.loadRock();let s=this.createMouseConstraint();ht.exports.Composite.add(t.engine.world,s),ht.exports.Events.on(s,"enddrag",this.onMouseEndDrag)}async waitRockBackToAPoint(){if(this.shootData&&this.shootData.releaseStart){let t=this.shootData.releaseStart,e=this.shootData.rock,s=this.shootData.elastic,n=ht.exports.Vector.sub(e.position,t),r=ht.exports.Vector.sub(s.pointA,t);ht.exports.Vector.magnitude(n)<ht.exports.Vector.magnitude(r)&&(await It(1),await this.waitRockBackToAPoint())}}loadRock(){const t=this.data;let e=this.createRock(t),s=this.createElastic(t,e);ht.exports.Composite.add(this.game.engine.world,s),this.shootData={rock:e,elastic:s}}createSprites(t){let e=ut.from(cg);e.zIndex=0,e.position.set(t.x-35,t.y-15),this.game.addChild(e);let s=ut.from(ug);s.zIndex=10,s.position.copyFrom(e.position),this.game.addChild(s)}createRock(t){return this.game.createMatterObject({type:"rock",x:t.x,y:t.y+1,circle:{radius:15}}).body}createElastic(t,e){return ht.exports.Constraint.create({pointA:{x:t.x,y:t.y},bodyB:e,stiffness:t.stiffness})}createMouseConstraint(){let t=this.game.app.view,e=ht.exports.Mouse.create(t),s=this.game.gameApp.app.stage;return e.offset.x=-s.x/s.scale.x,e.offset.y=-s.y/s.scale.y,e.scale.x=1/s.scale.x,e.scale.y=1/s.scale.y,ht.exports.MouseConstraint.create(this.game.engine,{mouse:e,collisionFilter:{mask:2}})}}class Hg{constructor(t,e,s){N(this,"render");N(this,"align",t=>{const e=this.render.canvas.style,s=this.stage;if(e.left=s.x+"px",e.top=s.y+"px",e.transform=`scale(${s.scale.x})`,t){const n=this.render.canvas;n.width=t.width,n.height=t.height}});this.engine=t,this.stage=e,this.render=this.createRender(s),this.initRenderView(this.render),this.align(),ht.exports.Render.run(this.render)}destroy(){ht.exports.Render.stop(this.render),this.render.canvas.remove()}createRender(t){return ht.exports.Render.create({engine:this.engine,element:document.body,options:{width:t.width,height:t.height,wireframeBackground:"transparent",wireframes:!1,background:"transparent"}})}initRenderView(t){const e=t.canvas.style;e.position="absolute",e.transformOrigin="0 0",e.pointerEvents="none"}}const zg={ground:{isStatic:!0,friction:1,render:{fillStyle:"transparent",strokeStyle:"#000000",lineWidth:3}},brick:{density:.1,friction:.5,render:{fillStyle:"transparent",strokeStyle:"#FFFF00",lineWidth:3}},boss:{density:.1,friction:.5,render:{fillStyle:"transparent",strokeStyle:"#ff0000",lineWidth:3}},rock:{density:.1,friction:.5,render:{fillStyle:"transparent",strokeStyle:"#ffFFFF",lineWidth:3},collisionFilter:{category:3}}},Vg=""+new URL("castle-ground.5791c539.png",import.meta.url).href,Xg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFQAAAArCAYAAADmH6/VAAAPgklEQVRoge1bS28kR3L+IjOrHxxyKFKPGe8YXg28gAwBArzWyRcD3qtPvvrgi3+XT/4LPvi0gE8LHwQYuwdL3gUkyJJWryGH7G6yqzIzwofMyIoq1mi9C8GQAScwIFldmRn5xRfP7CF8z+OM6PL1EJ7Pn1903U9Wzp0vzXnUdT/+rjW3q9WPMnM/pPTiD5HpEOMnifnePhuYb3Y5fwEAL1L6eCdy9YesPR+09PAt556feH954v2bZyH8CQC8tt3+OQF+u1o923TdUwA4Pz19//sQ4oc0bvb7DwDg0PcfDyldZeb9bd9/BAAv+v5XCRg+j/FXERiW5hMAPPX+J++en//DW48f/+xsu33Xe3/6v3eE/5tjf3//0c3h8MGvr6//8cO+/7k+JwD4u+fPf/n40aP3/icLPX3jAo4Im3WHi4vHAE1J/vpblwghzGbJuB0Bm+0GpxenkJQAyRA4EFH9eFzvtaeXCOtVE1RAuL854LC/G4UHRhmk7MMp48WX1jvQg/dEGC+vXqK/H3A89sg5AyDc3O6RM2OICTeHiZd45fiXDz/86Scp/TsAhA1wasH8ozcv8OxHb+HNJ5e4eHKJ0AWcXjzG5nQL8n56EABEbro6EdCeESC5HQBEIBBEGJwiJLPFeVzZUX23nh8EeA8C8OjyMR5dPp4ChKIIgRRQifDkT/94opwmF2dwzhDJ7dPdi1scbvcPziYAwBm7l3ukmHC3v8fNyx2++OJrfP3yAKkKfPvs7G8/ub4ugD7tund0gZ/91V/gp3/9vlmQGmDkxq2YCcOQytkhiDGDWSBEhWkACK4cQgTCCczS1pDMyHGAcMZm0xX8VQnkAAgcUNZzhZsggR3ee6zWDlKkHEGdsbwI6ZtyWRjCRXYhByKHsFmBbs37Te4C+ulrpyAiXDx5Hc8AnL92gvWnN/jss8/AInjj0aO/xPU1ACA88v6prvP2n709AZIqkMMxYXcbcXefMfSMnBnkXDt0kWH203wGEUjOTd6cElKMADOEjmVOXW8EwbW12jn1sLrHggzMjHVwcJ0qiLDZFhfEiRFcAoSx2nh4HxA6gXNmZwWzrici1R05oyaH1WqFRycn2B0Ok+AcTiqgjgjnb17UNUdWfvPVHa5f9MUE68beOQhR84xWoLapU4U4SEoQ55qJ6GiMdjO3MQOzAQmAvJ8AP7GK+ntMDMkFCEeEoR/AzIh9D4lxOsd75Bhx3O0RQkDXOQQn6AKhW3uEMFqpAs5S5m42G+wOB3QhXJ4RXe5ErsLa+0sAOD1Zg4JvvgoADruI66uhHcaZQ4zrT7xf+0xBdgCycyAROBFk5jFEVZ+s77W5dk3DSL8AvKu+VgCICEQEzNze5zqn+E2ZKNEZRQ19xhAFuJMW3EQEPjhs1h1Wa8JmHbDZBHCVbbvdNlGehPDOLsZfhHXXvVkAPWlmrpo4HIqvUdNCZRlZDVcg1EQII4N1HQKAlMAiIGWpAVwqaAqOzmvz67tzRSrwQgQSgTCProWoHLzuyTkDzBOGiypDZZpZUHEhwN0x4b4n3CBBRLDfZQiAVde1d8+67jli/EUIzp0CwHazKikMV9Y4IPVpsoEFcw4kMDLImhRQ2ZEzcmWOFVgBt0qaRG/jW8W8N7cIruy3SnAVpFzBxILPJaLy2VSwcR0jS2O0q1bsHIL3SDnjJISnABC6CujJyaaYSzyq6Njv7xCHCqL3cNW3NS1Xk5uzyLKHc4akhGEYpswmWva9JuDou5b9lpVNKcwQ5sawebBClZVqSkVmveITpfntJba2tdSqjGxd1xVAu+4ZAATn3BYAQvDFZIQBKV4i9gkplxQGOY/sqIsrKKotMs9gAM0pTQ5jWd3AtOAqICMcE6tofzsHYQaLFPOuilYXYpU0CVxGcSAq8hHBAWDzfClmOADB+/ZMixgtx4OvgHarbqJlYSClYgpMBFeDidQNXD10WgCY9RDelwhfGdDYLFIYXUG2ozHT+DdV2hzMIhw3k225qwHQZhYTt2IGp9G1WWa34Gn8vQbJxtAK6KoG99B5f15/KbUGlTRBWKbmZQ7jgUnapAcS5yC5OGw4V4KAmr/1j/ZQ5ncNZvbgjmgMWpWRymAGGjsnLggm61BAZIze1q1IzsgxTtI3X9duIup6CmwIbf1QM5Wu6wqgytDVKkxMTCsfBVF/zn0TEQHzyDk3r9mwgOhQQGhhnmWkzYG5sp9mSlI2U7WGFnQW3Eo/DCCTKi7+nK3vjXyuAroKoQBKRCsA6FarCQgso4mICHxlSvN/C2kPsJBD1p8TszEgaspjk/kl8577Rq7u6btSOO8cckolF57JoGsNfT9VunFL7W+V1xKs/gs1dQpq6eNCaB0dqT+9mnwNMk0rC3nmhFXWvA14jJmDV9+o0bk+t2DOqzJUMJtvns1r4DqHXAOW/q1A2rJyOB7HNSroVqHz0aJ93curyStDDZ5jDV8oMB6sTpqbta115zkkGfNqTMToPtQ3Up2vwW4OZFMkM1LOJaqbBL51wLwfMwlTHeWUABH4GpmtrP1+3+aozJPMQGt6jIx2RHDeN7Jp7k1EfgNsQ/B+C1S2GBCyLJv2on+baZPGTYoCzHuTuVVgVahVnIKdc2m3KYhaXqoinQgyUQmAzoFqIARzSfS5tA0zczk8jbnm3eHwsCWp5yVqJayV34IIoDEUADqibXBA8aHrYA7b4trkgBMQyy/jsxmLlwQhjDU3zE91IQRAmJFqRGZmcErlYK+oZqQqBkABnMb8tKVl9V0GICmBnMOw3zf/CrUWIlC1zBbsMAZjHVkBNdYAAGui01lrnVpzt8SJsfp5UNXMAo71TxPQZ4dXk4V5T4WXlIrfMyDOM4F5JfYgoGDMGOalrq4rIthdX5dy1biBVgGpO4PBwMhrh2XriXPnBlAHeNNpp1F4b7Q8YeWrgHxFtNb5zrTyWqUlghgjOMZ6HYF2yPpiU9I8lZn769bEUTAqW7VIuHv5sgWrsnVtaGsObawta0fL+9E9GN8+D15jUBrphNL/Mw78FQFnsdEALEbdycErS7REbWZrGEneT/aerD07hA2WGkTa+yLIBTUQEdLxiPu7uweKgFlj4vBqy49F4Gr57U3V11llEq0emLxtprYKZ4EJDzpFM6HssF0oZU9jpnEHqEEFFcwlJS3ltvNgaZXIWiERQZix3+0m67QTVfZ5/cz4XxEBMYOda9Fdg5c9aUe0DYKiwGhbdY7KVjppblLAoq+0B7NtNxWAUJnofelCVYE0XdE63qYyTeil5skrrEPs7xqpRbC7ugLn/DAn1f11n1kwawpihl7ksGYT6m+rCwkx5/22AuRMCjAXXocNCq8CUoGf+E9lhPeLrbGWpBOVZoxl/QxMDRg0P/DseQt+RNhfX5d7rLqn3kxMzFuZWX+fdLi02w+T39b3HBFyqSbnJo/F6D2e3k0PWjdzS1cZ+p5lWvVFzAzOGU6TbZFSl5tgtFQo2Chv19RDO19akL52vKjmprsXLzAcj5O+ZnMP9txm3cltgA1CIsgplcCprqQqwRNtG6CxT3WSmsuYOthDziNbq3wM6BbISXUlgjgM5QsOVTiEAE4JMcbiq3TNGZCTw5l9H8hjA40Idt9+i3g8jqy25m2AfFU/wAY47R/o/ZTuQYbZITPvAaAf+gKmCufdRHi7UXu2dNgFIIGSUA8xIg1DS8C9c0A1Q231QRslBpi5r7SupgVG23xxDjIMuPn669L8sOZtLXApmBoQrXWmWqmphSlplLV1bx9yznsAGI4RIgz9gkKp6Zd9E/DQBK1gtnQUZqQYi5lUFlpG6MUaM8OFUFzKrHRduipp+y50kHIFM8ZYAlxVYAs4QCt7mzevcydNGAWsyqm5qzbM2zx9H8ghVobGYYCwAK6AypzbARr9F1pwFmRteGhemZmRKytzzi16O+PDUs7gvq8SMTgEeN3XueIXRR74NDezDmXL8XDA/uoKqe47GWpB8yxi7rbsqPFBG9u09I4ZjaF9P0AkQzLBeWD3sgdXBz/vSU7Yas2xRnDOGXEYJqycuAj1SSkh9T14GErX3TlQjHD1QjCEMHaKvG/MnuS1dW8Rwf7qCse7uwLm8YhYg9xSMNN5DmidLgYevIOcW4BWV5Brgg/tfFlAlaEvbw5ATexvr3vc7ft2U2jTl7mf1GYEEbV0Ig1DKSGrX2y1tworgpQzYt8Dw1CuY3WP2pzIapo5l3sr74tyQ2jg6mVZ6nvsrq6QhgHDMCAOQ7mHh7lCAR5+p8CydAlM43ocCkszihWkYSh/16qvAdqn9A0A3OxKKyv2GV99edcOrumHA5Bq556qoPC+CFxTiVRZqU2IpfQHKHlcGgawuW2UWXQmohK81M1oHsgMqcDmlHC8vUV/PEKYEWOsrovbfnNmevtcwbRAzoKWfi4oUT7FiPv9HkP1z8k0YBLzPtzH+DkAHI49+t09vvhtX3ypYZTUvqSrVwrBe7D3pUysJj5UVqrjnpeW+lO/KJarQETUQFP2z310M0uR0qn3HulwwP72toDvymVbirGAafNn6+Odm/Zf50DOmCspgYHmj/u+x6G2/VqebQDNIkPYpfSpPvi3f/0lTs4uHlK/SIPVeg1Q7T5VM885gzXRNcIoCFQbIPoNjjgMyBosdE3dgsa+ZDPP2r9UsCVG3FxdlS9+GSXYLr4FSJne/F79rMWDehOgspMIUkqTOGGT+RacNA4YQI/MN2Gf0uf64D//49d48vQpzs7O4LvuQQ/wzgiiTjlVQIExabY5qUO96k0JUauhea08Y4g+myff8XjE8f5+8QsQLFKsozL0wfzZ+0s3ui0lewWYbAuPun40d/oHkavwdUq/yTnfe++3N7sdbrQbA2CzXiN4j67rsK63ogAQug6r9brkkMzwIWC9Xk++TbE+ORkv5piRK5j22nfiEgyQc5DjMBQgKxseVEnVtzqR9m07u/bctOdEaeBh6gqkujMFEwDgXOnb1upudzgAAJh5uGX+JhyB+29vb3/+5OLibzAbR80Pv+fRhYAuhPECDJjkd9vttmQNzMX8NNOYuyIae5c26V5818zRYTtn/TxnrWvpP8vEpdEPw+cZyG31t7vu/Sfr9fvn6/W7zrnt+cnJe45o5b0/Pd1u3/muxf5/AJ99880//fNXX/3970r8H4w3nHt2ar5G/sZq9Z6vX5Zwzm3P1+t3l+Ztuu7pdrV6tvTZD11px+PxU00vU8773fH4EQBE5pur+/sPftv3H3yZ82+AqaX9IMYGOLX/keK7xuMQftwRnfw+60eR/W1K//W73vt4GD74fdbV8d9fArlsxVLFzAAAAABJRU5ErkJggg==",Wg=""+new URL("castle-wood.907e5325.png",import.meta.url).href,jg=""+new URL("castle-boss.02ce55eb.png",import.meta.url).href,Yg=""+new URL("castle-rock.a840b0c2.png",import.meta.url).href,Kg=""+new URL("poof.ee09ba45.gif",import.meta.url).href;var Ne={},kh={},ce={};Object.defineProperty(ce,"__esModule",{value:!0}),ce.loop=ce.conditional=ce.parse=void 0;var Zg=function i(t,e){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:s;if(Array.isArray(e))e.forEach(function(o){return i(t,o,s,n)});else if(typeof e=="function")e(t,s,n,i);else{var r=Object.keys(e)[0];Array.isArray(e[r])?(n[r]={},i(t,e[r],s,n[r])):n[r]=e[r](t,s,n,i)}return s};ce.parse=Zg;var Qg=function(i,t){return function(e,s,n,r){t(e,s,n)&&r(e,i,s,n)}};ce.conditional=Qg;var $g=function(i,t){return function(e,s,n,r){for(var o=[],a=e.pos;t(e,s,n);){var h={};if(r(e,i,s,h),e.pos===a)break;a=e.pos,o.push(h)}return o}};ce.loop=$g;var vt={};Object.defineProperty(vt,"__esModule",{value:!0}),vt.readBits=vt.readArray=vt.readUnsigned=vt.readString=vt.peekBytes=vt.readBytes=vt.peekByte=vt.readByte=vt.buildStream=void 0;var qg=function(i){return{data:i,pos:0}};vt.buildStream=qg;var Oh=function(){return function(i){return i.data[i.pos++]}};vt.readByte=Oh;var Jg=function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return function(t){return t.data[t.pos+i]}};vt.peekByte=Jg;var tn=function(i){return function(t){return t.data.subarray(t.pos,t.pos+=i)}};vt.readBytes=tn;var tv=function(i){return function(t){return t.data.subarray(t.pos,t.pos+i)}};vt.peekBytes=tv;var ev=function(i){return function(t){return Array.from(tn(i)(t)).map(function(e){return String.fromCharCode(e)}).join("")}};vt.readString=ev;var iv=function(i){return function(t){var e=tn(2)(t);return i?(e[1]<<8)+e[0]:(e[0]<<8)+e[1]}};vt.readUnsigned=iv;var sv=function(i,t){return function(e,s,n){for(var r=typeof t=="function"?t(e,s,n):t,o=tn(i),a=new Array(r),h=0;h<r;h++)a[h]=o(e);return a}};vt.readArray=sv;var nv=function(i,t,e){for(var s=0,n=0;n<e;n++)s+=i[t+n]&&Math.pow(2,e-n-1);return s},rv=function(i){return function(t){for(var e=Oh()(t),s=new Array(8),n=0;n<8;n++)s[7-n]=!!(e&1<<n);return Object.keys(i).reduce(function(r,o){var a=i[o];return a.length?r[o]=nv(s,a.index,a.length):r[o]=s[a.index],r},{})}};vt.readBits=rv,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var t=ce,e=vt,s={blocks:function(f){for(var d=0,u=[],p=f.data.length,m=0,g=(0,e.readByte)()(f);g!==d&&g;g=(0,e.readByte)()(f)){if(f.pos+g>=p){var _=p-f.pos;u.push((0,e.readBytes)(_)(f)),m+=_;break}u.push((0,e.readBytes)(g)(f)),m+=g}for(var A=new Uint8Array(m),y=0,v=0;v<u.length;v++)A.set(u[v],y),y+=u[v].length;return A}},n=(0,t.conditional)({gce:[{codes:(0,e.readBytes)(2)},{byteSize:(0,e.readByte)()},{extras:(0,e.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,e.readUnsigned)(!0)},{transparentColorIndex:(0,e.readByte)()},{terminator:(0,e.readByte)()}]},function(f){var d=(0,e.peekBytes)(2)(f);return d[0]===33&&d[1]===249}),r=(0,t.conditional)({image:[{code:(0,e.readByte)()},{descriptor:[{left:(0,e.readUnsigned)(!0)},{top:(0,e.readUnsigned)(!0)},{width:(0,e.readUnsigned)(!0)},{height:(0,e.readUnsigned)(!0)},{lct:(0,e.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,t.conditional)({lct:(0,e.readArray)(3,function(f,d,u){return Math.pow(2,u.descriptor.lct.size+1)})},function(f,d,u){return u.descriptor.lct.exists}),{data:[{minCodeSize:(0,e.readByte)()},s]}]},function(f){return(0,e.peekByte)()(f)===44}),o=(0,t.conditional)({text:[{codes:(0,e.readBytes)(2)},{blockSize:(0,e.readByte)()},{preData:function(f,d,u){return(0,e.readBytes)(u.text.blockSize)(f)}},s]},function(f){var d=(0,e.peekBytes)(2)(f);return d[0]===33&&d[1]===1}),a=(0,t.conditional)({application:[{codes:(0,e.readBytes)(2)},{blockSize:(0,e.readByte)()},{id:function(f,d,u){return(0,e.readString)(u.blockSize)(f)}},s]},function(f){var d=(0,e.peekBytes)(2)(f);return d[0]===33&&d[1]===255}),h=(0,t.conditional)({comment:[{codes:(0,e.readBytes)(2)},s]},function(f){var d=(0,e.peekBytes)(2)(f);return d[0]===33&&d[1]===254}),c=[{header:[{signature:(0,e.readString)(3)},{version:(0,e.readString)(3)}]},{lsd:[{width:(0,e.readUnsigned)(!0)},{height:(0,e.readUnsigned)(!0)},{gct:(0,e.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,e.readByte)()},{pixelAspectRatio:(0,e.readByte)()}]},(0,t.conditional)({gct:(0,e.readArray)(3,function(f,d){return Math.pow(2,d.lsd.gct.size+1)})},function(f,d){return d.lsd.gct.exists}),{frames:(0,t.loop)([n,a,h,r,o],function(f){var d=(0,e.peekByte)()(f);return d===33||d===44})}],l=c;i.default=l}(kh);var Os={};Object.defineProperty(Os,"__esModule",{value:!0}),Os.deinterlace=void 0;var ov=function(i,t){for(var e=new Array(i.length),s=i.length/t,n=function(l,f){var d=i.slice(f*t,(f+1)*t);e.splice.apply(e,[l*t,t].concat(d))},r=[0,4,2,1],o=[8,8,4,2],a=0,h=0;h<4;h++)for(var c=r[h];c<s;c+=o[h])n(c,a),a++;return e};Os.deinterlace=ov;var Us={};Object.defineProperty(Us,"__esModule",{value:!0}),Us.lzw=void 0;var av=function(i,t,e){var s=4096,n=-1,r=e,o,a,h,c,l,f,d,x,u,p,v,m,b,w,S,E,g=new Array(e),_=new Array(s),A=new Array(s),y=new Array(s+1);for(m=i,a=1<<m,l=a+1,o=a+2,d=n,c=m+1,h=(1<<c)-1,u=0;u<a;u++)_[u]=0,A[u]=u;var v,x,b,w,E,S;for(v=x=b=w=E=S=0,p=0;p<r;){if(w===0){if(x<c){v+=t[S]<<x,x+=8,S++;continue}if(u=v&h,v>>=c,x-=c,u>o||u==l)break;if(u==a){c=m+1,h=(1<<c)-1,o=a+2,d=n;continue}if(d==n){y[w++]=A[u],d=u,b=u;continue}for(f=u,u==o&&(y[w++]=b,u=d);u>a;)y[w++]=A[u],u=_[u];b=A[u]&255,y[w++]=b,o<s&&(_[o]=d,A[o]=b,o++,(o&h)===0&&o<s&&(c++,h+=o)),d=f}w--,g[E++]=y[w],p++}for(p=E;p<r;p++)g[p]=0;return g};Us.lzw=av,Object.defineProperty(Ne,"__esModule",{value:!0});var Uh=Ne.decompressFrames=Ne.decompressFrame=Nh=Ne.parseGIF=void 0,hv=fv(kh),lv=ce,cv=vt,uv=Os,dv=Us;function fv(i){return i&&i.__esModule?i:{default:i}}var pv=function(i){var t=new Uint8Array(i);return(0,lv.parse)((0,cv.buildStream)(t),hv.default)},Nh=Ne.parseGIF=pv,mv=function(i){for(var t=i.pixels.length,e=new Uint8ClampedArray(t*4),s=0;s<t;s++){var n=s*4,r=i.pixels[s],o=i.colorTable[r]||[0,0,0];e[n]=o[0],e[n+1]=o[1],e[n+2]=o[2],e[n+3]=r!==i.transparentIndex?255:0}return e},Gh=function(i,t,e){if(!i.image){console.warn("gif frame does not have associated image.");return}var s=i.image,n=s.descriptor.width*s.descriptor.height,r=(0,dv.lzw)(s.data.minCodeSize,s.data.blocks,n);s.descriptor.lct.interlaced&&(r=(0,uv.deinterlace)(r,s.descriptor.width));var o={pixels:r,dims:{top:i.image.descriptor.top,left:i.image.descriptor.left,width:i.image.descriptor.width,height:i.image.descriptor.height}};return s.descriptor.lct&&s.descriptor.lct.exists?o.colorTable=s.lct:o.colorTable=t,i.gce&&(o.delay=(i.gce.delay||10)*10,o.disposalType=i.gce.extras.disposal,i.gce.extras.transparentColorGiven&&(o.transparentIndex=i.gce.transparentColorIndex)),e&&(o.patch=mv(o)),o};Ne.decompressFrame=Gh;var gv=function(i,t){return i.frames.filter(function(e){return e.image}).map(function(e){return Gh(e,i.gct,t)})};Uh=Ne.decompressFrames=gv;var vv=Object.defineProperty,Ns=Object.getOwnPropertySymbols,Hh=Object.prototype.hasOwnProperty,zh=Object.prototype.propertyIsEnumerable,$o=(i,t,e)=>t in i?vv(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,_v=(i,t)=>{for(var e in t||(t={}))Hh.call(t,e)&&$o(i,e,t[e]);if(Ns)for(var e of Ns(t))zh.call(t,e)&&$o(i,e,t[e]);return i},yv=(i,t)=>{var e={};for(var s in i)Hh.call(i,s)&&t.indexOf(s)<0&&(e[s]=i[s]);if(i!=null&&Ns)for(var s of Ns(i))t.indexOf(s)<0&&zh.call(i,s)&&(e[s]=i[s]);return e};const Ci=class extends ut{constructor(i,t){super(H.EMPTY),this.animationSpeed=1,this.loop=!0,this.duration=0,this.autoPlay=!0,this.dirty=!1,this._currentFrame=0,this._autoUpdate=!1,this._isConnectedToTicker=!1,this._playing=!1,this._currentTime=0;const e=Object.assign({},Ci.defaultOptions,t),{scaleMode:s,width:n,height:r}=e,o=yv(e,["scaleMode","width","height"]),a=document.createElement("canvas"),h=a.getContext("2d");a.width=n,a.height=r,this.texture=H.from(a,{scaleMode:s}),this.duration=i[i.length-1].end,this._frames=i,this._context=h,this._playing=!1,this._currentTime=0,this._isConnectedToTicker=!1,Object.assign(this,o),this.currentFrame=0,o.autoPlay&&this.play()}static fromBuffer(i,t){if(!i||i.byteLength===0)throw new Error("Invalid buffer");const e=m=>{var g;let _=null;for(const A of m.frames)_=(g=A.gce)!=null?g:_,"image"in A&&!("gce"in A)&&(A.gce=_)},s=Nh(i);e(s);const n=Uh(s,!0),r=[],o=document.createElement("canvas"),a=o.getContext("2d",{willReadFrequently:!0}),h=document.createElement("canvas"),c=h.getContext("2d");o.width=s.lsd.width,o.height=s.lsd.height;let l=0;const{fps:f}=Object.assign({},Ci.defaultOptions,t),d=1e3/f;for(let m=0;m<n.length;m++){const{disposalType:g=2,delay:_=d,patch:A,dims:{width:y,height:v,left:x,top:b}}=n[m];h.width=y,h.height=v,c.clearRect(0,0,y,v);const w=c.createImageData(y,v);w.data.set(A),c.putImageData(w,0,0),a.drawImage(h,x,b);const E=a.getImageData(0,0,o.width,o.height);(g===2||g===3)&&a.clearRect(0,0,o.width,o.height),r.push({start:l,end:l+_,imageData:E}),l+=_}o.width=o.height=0,h.width=h.height=0;const{width:u,height:p}=s.lsd;return new Ci(r,_v({width:u,height:p},t))}stop(){!this._playing||(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(st.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(st.shared.add(this.update,this,ye.HIGH),this._isConnectedToTicker=!0),!this.loop&&this.currentFrame===this._frames.length-1&&(this._currentTime=0))}get progress(){return this._currentTime/this.duration}get playing(){return this._playing}update(i){var t,e;if(!this._playing)return;const s=this.animationSpeed*i/O.TARGET_FPMS,n=this._currentTime+s,r=n%this.duration,o=this._frames.findIndex(a=>a.start<=r&&a.end>r);n>=this.duration?this.loop?(this._currentTime=r,this.updateFrameIndex(o),(t=this.onLoop)==null||t.call(this)):(this._currentTime=this.duration,this.updateFrameIndex(this._frames.length-1),(e=this.onComplete)==null||e.call(this),this.stop()):(this._currentTime=r,this.updateFrameIndex(o))}updateFrame(){if(!this.dirty)return;const{imageData:i}=this._frames[this._currentFrame];this._context.putImageData(i,0,0),this._context.fillStyle="transparent",this._context.fillRect(0,0,0,1),this.texture.update(),this.dirty=!1}_render(i){this.updateFrame(),super._render(i)}_renderCanvas(i){this.updateFrame(),super._renderCanvas(i)}get autoUpdate(){return this._autoUpdate}set autoUpdate(i){i!==this._autoUpdate&&(this._autoUpdate=i,!this._autoUpdate&&this._isConnectedToTicker?(st.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(st.shared.add(this.update,this),this._isConnectedToTicker=!0))}get currentFrame(){return this._currentFrame}set currentFrame(i){this.updateFrameIndex(i),this._currentTime=this._frames[i].start}updateFrameIndex(i){var t;if(i<0||i>=this._frames.length)throw new Error(`Frame index out of range, expecting 0 to ${this.totalFrames}, got ${i}`);this._currentFrame!==i&&(this._currentFrame=i,this.dirty=!0,(t=this.onFrameChange)==null||t.call(this,i))}get totalFrames(){return this._frames.length}destroy(){this.stop(),super.destroy(!0);const i=null;this._context=i,this._frames=i,this.onComplete=i,this.onFrameChange=i,this.onLoop=i}clone(){return new Ci([...this._frames],{autoUpdate:this._autoUpdate,loop:this.loop,autoPlay:this.autoPlay,scaleMode:this.texture.baseTexture.scaleMode,animationSpeed:this.animationSpeed,width:this._context.canvas.width,height:this._context.canvas.height,onComplete:this.onComplete,onFrameChange:this.onFrameChange,onLoop:this.onLoop})}};let Rr=Ci;Rr.defaultOptions={scaleMode:Jt.LINEAR,fps:30,loop:!0,animationSpeed:1,autoPlay:!0,autoUpdate:!0,onComplete:null,onFrameChange:null,onLoop:null};const xv={extension:z.Asset,detection:{test:async()=>!0,add:async i=>[...i,"gif"],remove:async i=>i.filter(t=>t!=="gif")},loader:{test:i=>yt.extname(i)===".gif",load:async(i,t)=>{const e=await(await O.ADAPTER.fetch(i)).arrayBuffer();return Rr.fromBuffer(e,t==null?void 0:t.data)},unload:async i=>{i.destroy()}}};Y.add(xv);async function Vh(i,t){if(i instanceof ArrayBuffer){let e=Rr.fromBuffer(i);return Promise.resolve(e)}else return await Ai.load({src:i,data:t})}class wv extends ct{constructor(e,s){super();N(this,"type");N(this,"body");N(this,"sprite");N(this,"update",()=>{this.position.copyFrom(this.body.position),this.rotation=this.body.angle});this.game=e,this.data=s,this.type=s.type,this.body=this.createBody(s),ht.exports.Composite.add(e.engine.world,this.body),this.sprite=this.createSprite(s),this.addChild(this.sprite),e.addChild(this),ht.exports.Events.on(e.engine,"afterUpdate",this.update)}destroy(){super.destroy(),ht.exports.Composite.remove(this.game.engine.world,this.body),ht.exports.Events.off(this.game.engine,"afterUpdate",this.update),delete this.game.objects[this.body.id]}createBody(e){let s=zg[e.type];if(!s)throw new Error("BodyOptions not defined: "+e.type);let n=e.angleDeg||0;if(s.angle=n/180*Math.PI,e.circle)return ht.exports.Bodies.circle(e.x,e.y,e.circle.radius,s,24);if(e.rect)return ht.exports.Bodies.rectangle(e.x,e.y,e.rect.width,e.rect.height,s);throw new Error("Unknown body shape.")}createSprite(e){if(e.type=="ground"){const s=e.rect;let n=zi.from(Vg,{width:s.width,height:s.height});return n.pivot.set(n.width/2,n.height/2),n.width=s.width,n.height=s.height,this.zIndex=2,n}if(e.type=="brick"){const s=e.rect;let n=ut.from(Xg);return n.pivot.set(42,21),n.width=s.width,n.height=s.height,this.zIndex=5,n}if(e.type=="wood"){const s=e.rect;let n=ut.from(Wg);return n.pivot.set(42,21),n.width=s.width,n.height=s.height,this.zIndex=4,n}if(e.type=="boss"){const s=e.circle;let n=ut.from(jg);return n.pivot.set(36,48),n.scale.set(s.radius/32),this.zIndex=3,n}if(e.type=="rock"){const s=e.circle;let n=ut.from(Yg);return n.pivot.set(38,36),n.scale.set(s.radius/36),this.zIndex=6,n}return new ut}onCollisionActive(e,s){if(this.type=="boss"){let n=0;for(let r of s.activeContacts)n+=Math.abs(r.normalImpulse);n>50&&(this.destroy(),this.playPoofGif(this.body.position),this.game.gameover())}}async playPoofGif(e){let s=await Vh(Kg,{animationSpeed:2,loop:!1,autoPlay:!0,onComplete:()=>{s.destroy()}});s.pivot.set(s.width/2,s.height/2),s.scale.set(.6),s.position.copyFrom(e),s.zIndex=10,this.game.addChild(s)}}class bv extends ct{constructor(e,s){super();N(this,"engine",ht.exports.Engine.create({enableSleeping:!0}));N(this,"runner",ht.exports.Runner.create());N(this,"matterRender");N(this,"objects",{});this.gameApp=e,this.level=s,this.sortableChildren=!0,this.addBackground(),this.matterRender=new Hg(this.engine,this.gameApp.app.stage,et()),ze.on("resize",this.matterRender.align),this.loadAndStartLevel(s),this.setupCollisionListener()}destroy(){super.destroy(),ze.off("resize",this.matterRender.align),this.matterRender.destroy(),ht.exports.Runner.stop(this.runner)}get app(){return this.gameApp.app}addBackground(){var e=ut.from(lg);e.zIndex=0,this.addChild(e)}async loadAndStartLevel(e){let s=await this.loadLevel(e);this.buildLevel(s),this.start()}async loadLevel(e){let s="./",n=`castle-falls/level_${e}.json`;return n=s+n+"?time="+Date.now(),await(await fetch(n)).json()}buildLevel(e){for(let s of e.objects)this.createMatterObject(s);new Gg(this,e.slingshot)}createMatterObject(e){let s=new wv(this,e);return this.objects[s.body.id]=s,s}start(){ht.exports.Runner.run(this.runner,this.engine)}async waitWorldPeace(){this.engine.world.bodies.find(s=>!s.isSleeping)&&(await It(1),await this.waitWorldPeace())}setupCollisionListener(){ht.exports.Events.on(this.engine,"collisionActive",e=>{for(let s of e.pairs){const n=s.bodyA,r=s.bodyB,o=this.objects[n.id],a=this.objects[r.id];o.onCollisionActive(a,s),a.onCollisionActive(o,s)}})}async gameover(){this.gameApp.record.setLevelRecord(this.level,{cleared:!0});const e=et();let s=new Lt("The Castle has Fallen",{fontSize:32,fill:16777215,stroke:0,strokeThickness:5});s.pivot.set(s.width/2,s.height/2),s.position.set(e.width/2,e.height/2),s.zIndex=100,this.addChild(s),s.scale.set(.1);let n=new ng(s.scale).to({x:1,y:1},2e3).easing(Pi.Elastic.Out).start();await B0(n),await It(180),this.destroy(),this.gameApp.openLevelsUI()}}class Av{constructor(){N(this,"levelRecords",{});this.load()}load(){let t=localStorage.getItem("cfRecords");t?this.levelRecords=JSON.parse(t):this.levelRecords={}}save(){let t=JSON.stringify(this.levelRecords);localStorage.setItem("cfRecords",t)}setLevelRecord(t,e){this.levelRecords[t]=e,this.save()}isLevelCleared(t){let e=this.levelRecords[t];return e&&e.cleared}isLevelUnlocked(t){return t==1||this.isLevelCleared(t-1)}}const Ev=""+new URL("castle-bg.5ae2af85.jpg",import.meta.url).href;class Xh extends ct{constructor(t){super(),this.options=t,this.buildUI()}buildUI(){const t=this.options,e=t.backgroundColor,s=t.labelColor;let n=new Dt;n.beginFill(16777215),n.drawRoundedRect(0,0,t.width,t.height,t.cornerRadius),n.endFill(),n.tint=e.default,this.addChild(n);let r=new Lt(t.label,{fontSize:t.labelSize,fill:s.default});r.resolution=2,r.position.set((n.width-r.width)/2,(n.height-r.height)/2),this.addChild(r),this.interactive=!0,this.cursor="pointer",this.on("click",()=>{n.tint=e.hover,r.style.fill=s.hover,t.onClick()}),this.on("pointerover",()=>{n.tint=e.hover,r.style.fill=s.hover}),this.on("pointerout",()=>{n.tint=e.default,r.style.fill=s.default}),this.on("pointerdown",()=>{n.tint=e.active,r.style.fill=s.active}),this.on("touchend",o=>{this.emit("click",o)})}}class Tv extends ct{constructor(t){super(),this.gameApp=t;let e=ut.from(Ev);e.scale.set(.5),this.addChild(e);const s=3;for(let n=1;n<=s;n++){let r=this.createLevelButton(n);t.record.isLevelUnlocked(n)||(r.interactive=!1,r.alpha=.5)}}createLevelButton(t){let e=`\u7B2C${t}\u95DC`,s=new Xh({width:240,height:36,cornerRadius:8,backgroundColor:{default:3355443,hover:16777215,active:11141120},labelColor:{default:16777215,hover:3355443,active:16777215},label:e,labelSize:24,onClick:()=>{this.destroy(),this.gameApp.startGame(t)}});return this.addChild(s),s.x=50,s.y=40+(t-1)*50,s}}class Sv{constructor(t){N(this,"record",new Av);this.app=t,this.openLevelsUI()}openLevelsUI(){let t=new Tv(this);this.app.stage.addChild(t)}startGame(t){let e=new bv(this,t);this.app.stage.addChild(e)}}class qo{constructor(t){N(this,"position",new G);N(this,"width",0);N(this,"height",0);N(this,"focus");N(this,"gameRoot");N(this,"followFocusRate",.2);this.ticker=t,t.add(this.update,this)}destroy(){this.ticker.remove(this.update,this)}update(){const t=this.focus,e=this.position;if(t){const s=this.followFocusRate,n=1-s;this.position.set(t.x*s+e.x*n,t.y*s+e.y*n)}this.gameRoot&&(this.gameRoot.x=this.width/2-e.x,this.gameRoot.y=this.height/2-e.y)}}class Cv extends Ws.exports.EventEmitter{constructor(){super();N(this,"isKeyDownMap",{});N(this,"onKeyDown",e=>{this.emit("keydown",e),this.isKeyDown(e.code)||(this.isKeyDownMap[e.code]=!0,this.emit("pressed",e))});N(this,"onKeyUp",e=>{this.emit("keyup",e),this.isKeyDown(e.code)&&(this.isKeyDownMap[e.code]=!1,this.emit("released",e))});this.listenToEvents()}isKeyDown(e){return this.isKeyDownMap[e]}listenToEvents(){window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp)}async waitUserPressKey(e){return new Promise(s=>{let n=r=>{r.code==e&&(this.off("pressed",n),s())};this.on("pressed",n)})}async waitUserReleaseKey(e){return new Promise(s=>{let n=r=>{r.code==e&&(this.off("released",n),s())};this.on("released",n)})}}const ue=new Cv,ve={ESCAPE:"Escape",F1:"F1",F2:"F2",F3:"F3",F4:"F4",F5:"F5",F6:"F6",F7:"F7",F8:"F8",F9:"F9",F10:"F10",F11:"F11",F12:"F12",PRINT_SCREEN:"PrintScreen",SCROLL_LOCK:"ScrollLock",PAUSE:"Pause",BACK_QUOTE:"Backquote",_1:"Digit1",_2:"Digit2",_3:"Digit3",_4:"Digit4",_5:"Digit5",_6:"Digit6",_7:"Digit7",_8:"Digit8",_9:"Digit9",_0:"Digit0",MINUS:"Minus",EQUAL:"Equal",BACKSPACE:"Backspace",A:"KeyA",B:"KeyB",C:"KeyC",D:"KeyD",E:"KeyE",F:"KeyF",G:"KeyG",H:"KeyH",I:"KeyI",J:"KeyJ",K:"KeyK",L:"KeyL",M:"KeyM",N:"KeyN",O:"KeyO",P:"KeyP",Q:"KeyQ",R:"KeyR",S:"KeyS",T:"KeyT",U:"KeyU",V:"KeyV",W:"KeyW",X:"KeyX",Y:"KeyY",Z:"KeyZ",SPACE:"Space",TAB:"Tab",CAPS_LOCK:"CapsLock",SHIFT_L:"ShiftLeft",CTRL_L:"ControlLeft",META_L:"MetaLeft",ALT_L:"AltLeft",OPEN_BRACKET:"BracketLeft",CLOSE_BRACKET:"BracketRight",BACK_SLASH:"Backslash",SEMI_COLON:"Semicolon",SINGLE_QUOTE:"Quote",ENTER:"Enter",COMMA:"Comma",PERIOD:"Period",SLASH:"Slash",SHIFT_R:"ShiftRight",CTRL_R:"ControlRight",META_R:"MetaRight",ALT_R:"AltRight",INSERT:"Insert",DELETE:"Delete",HOME:"Home",END:"End",PAGE_UP:"PageUp",PAGE_DOWN:"PageDown",LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown",NUM_1:"Numpad1",NUM_2:"Numpad2",NUM_3:"Numpad3",NUM_4:"Numpad4",NUM_5:"Numpad5",NUM_6:"Numpad6",NUM_7:"Numpad7",NUM_8:"Numpad8",NUM_9:"Numpad9",NUM_0:"Numpad0",NUM_LOCK:"NumLock",NUM_DIVIDE:"NumpadDivide",NUM_MULTIPLY:"NumpadMultiply",NUM_SUBTRACT:"NumpadSubtract",NUM_ADD:"NumpadAdd",NUM_DECIMAL_POINT:"NumpadDecimal",NUM_ENTER:"NumpadEnter"};class en extends ct{constructor(e,s,n){super();N(this,"velocity",new G);N(this,"minLifespan",60);N(this,"hitRadius",0);this.game=e,this.position.set(s,n),e.spaceRoot.addChild(this),e.app.ticker.add(this.update,this),this.init()}init(){}destroy(){this.destroyed||super.destroy(),this.game.app.ticker.remove(this.update,this),ui.removeItem(this.game.objects,this)}update(e){this.x+=this.velocity.x*e,this.y+=this.velocity.y*e,this.minLifespan-=e,this.minLifespan<0&&!this.isInScreen()&&this.destroy()}isInScreen(){const e=this.game.app.screen;return this.getBounds().intersects(e)}hitTest(e){return this.position.distanceTo(e.position)<this.hitRadius+e.hitRadius}drawHitCircle(e=16711680){let s=new Dt;s.beginFill(e,.2),s.drawCircle(0,0,this.hitRadius),s.endFill(),this.addChild(s)}}const Iv=""+new URL("astroid.add95531.png",import.meta.url).href;class Jo extends en{constructor(){super(...arguments);N(this,"rotateSpeed",(Math.random()-.5)*.004)}get type(){return"astroid"}init(){let e=ut.from(Iv);e.pivot.set(130,120),this.addChild(e),e.rotation=Math.random()*Math.PI*2,e.scale.set(.3+Math.random()*.5),this.zIndex=2+Math.random(),this.velocity.x=Math.random()*.3,this.velocity.rotate(Math.random()*Math.PI*2),this.hitRadius=e.scale.x*110}update(e){this.rotation+=this.rotateSpeed*e,super.update(e)}}const Pv=""+new URL("starry-space.da69cea3.png",import.meta.url).href,Rv=""+new URL("stars.1f186857.png",import.meta.url).href;class Mv extends ct{constructor(e){super();N(this,"starrySprite");N(this,"starsSprite");this.game=e;let s=H.from(Pv);this.starrySprite=new zi(s,et().width,et().height),this.addChild(this.starrySprite),this.starrySprite.tileScale.set(.5),this.starsSprite=new zi(H.from(Rv),et().width,et().height),this.addChild(this.starsSprite),this.starsSprite.tileScale.set(.8),e.addChildAt(this,0),e.app.ticker.add(this.update,this),this.refreshSize(),ze.on("resize",this.refreshSize,this)}destroy(){super.destroy(),this.game.app.ticker.remove(this.update,this),ze.off("resize",this.refreshSize,this)}update(){let e=this.game.camera,s=.2;this.starrySprite.tilePosition.set(-e.position.x*s,-e.position.y*s),s=.25,this.starsSprite.tilePosition.set(-e.position.x*s,-e.position.y*s)}refreshSize(){this.position.x=Gt.x,this.position.y=Gt.y,this.starrySprite.width=Gt.width,this.starrySprite.height=Gt.height,this.starsSprite.width=Gt.width,this.starsSprite.height=Gt.height}}const Bv=""+new URL("space-fighter.5ab71f84.gif",import.meta.url).href,Dv=""+new URL("explosion-spritesheet.69efa797.png",import.meta.url).href,Fv=""+new URL("fighter-explode.f55e2e2f.mp3",import.meta.url).href,Lv=""+new URL("monster-explode.5bfc84fe.mp3",import.meta.url).href,kv=""+new URL("missile-explode.7014065f.mp3",import.meta.url).href;class hr extends ct{constructor(){super();N(this,"animation");this.zIndex=10,this.animation=new Ls(Ov()),this.animation.pivot.set(ii.width/2,ii.height/2),this.animation.loop=!1,this.addChild(this.animation)}playAndDestroy(e){e.game.spaceRoot.addChild(this),this.position.copyFrom(e.position),this.animation.scale.set(e.hitRadius/32),this.animation.play(),this.animation.onComplete=()=>this.destroy(),e.type=="fighter"?ie(Fv):e.type=="monster"?ie(Lv):ie(kv)}}const ii={width:128,height:124},Rn=[];function Ov(){if(Rn.length==0){let i=J.from(Dv);for(let t=0;t<48;t++){let e=t%8,s=Math.floor(t/8),n=new q(e*ii.width,s*ii.height,ii.width,ii.height),r=new H(i,n);Rn.push(r)}}return Rn}const Uv=""+new URL("missile.a47246ff.png",import.meta.url).href;class Nv extends en{get type(){return"missile"}init(){let t=ut.from(Uv);t.pivot.set(15,4),this.addChild(t),t.scale.set(.5),this.zIndex=3,this.hitRadius=5}setDirection(t){this.rotation=t,this.velocity.x=8,this.velocity.rotate(t)}hitTestSpaceObject(){return this.game.objects.find(t=>(t.type=="astroid"||t.type=="monster")&&t.hitTest(this))}update(t){let e=this.hitTestSpaceObject();if(e){e.type=="monster"?(new hr().playAndDestroy(e),e.destroy(),this.game.addScore(1)):new hr().playAndDestroy(this),this.destroy();return}super.update(t)}}class Gv extends en{constructor(){super(...arguments);N(this,"gif")}get type(){return"fighter"}init(){this.zIndex=4,this.loadFighterGIF(),this.hitRadius=16,this.game.app.stage.on("pointerdown",this.launchMissile,this)}destroy(){super.destroy(),this.game.app.stage.off("pointerdown",this.launchMissile,this)}async loadFighterGIF(){let e=await Vh(Bv,{animationSpeed:.5});this.gif=e,this.addChild(e),e.pivot.set(49,49),e.scale.set(.5)}update(e){if(this.hitTestSpaceObject()){new hr().playAndDestroy(this),this.destroy(),this.game.gameover();return}if(this.gif){let n=this.toLocal(nr);const r=Math.atan2(n.y,n.x);this.gif.rotation=r,this.velocity.set(2,0),this.velocity.rotate(r)}super.update(e)}hitTestSpaceObject(){return this.game.objects.find(e=>(e.type=="astroid"||e.type=="monster")&&e.hitTest(this))}launchMissile(){this.gif&&(new Nv(this.game,this.x,this.y).setDirection(this.gif.rotation),ie(Ph))}}const Hv=""+new URL("space-monster.a6980343.png",import.meta.url).href,zs=class{static normalizeDegree(t){for(;t>180;)t-=360;for(;t<=-180;)t+=360;return t}static normalizeRadians(t){for(;t>Math.PI;)t-=zs.TWO_PI;for(;t<=-Math.PI;)t+=zs.TWO_PI;return t}};let Es=zs;N(Es,"TWO_PI",Math.PI*2);class zv extends en{constructor(){super(...arguments);N(this,"followDuration",200)}get type(){return"monster"}init(){let e=ut.from(Hv);e.pivot.set(56,66),this.addChild(e),e.scale.set(.66),this.rotation=Math.random()*Math.PI*2,this.zIndex=2+Math.random(),this.velocity.x=2.1,this.velocity.rotate(this.rotation),this.hitRadius=20}update(e){let s=this.game.objects.find(n=>n.type=="fighter");if(s&&this.followDuration>0){this.followDuration-=e;let n=s.position.sub(this.position),o=Math.atan2(n.y,n.x)-this.rotation;o=Es.normalizeRadians(o);const a=.025;if(o>0){let h=Math.min(o,a*e);this.rotation+=h}else{let h=Math.max(o,-a*e);this.rotation+=h}this.velocity.set(2.1,0),this.velocity.rotate(this.rotation)}super.update(e)}}const Vv=""+new URL("yemingkenoshisaido.5a88373f.mp3",import.meta.url).href,Xv=""+new URL("music-notes.5d874665.png",import.meta.url).href;class Wv extends ct{constructor(e){super();N(this,"scoreText");N(this,"musicButton");N(this,"refreshMusicButton",()=>{});this.game=e,this.createScoreText(),this.createMusicButton(),this.updateTop(),ze.on("resize",this.updateTop,this)}destroy(){super.destroy(),ze.off("resize",this.updateTop,this)}updateTop(){this.y=Gt.y}async createScoreText(){await document.fonts.load("10px SpaceInvadersFont");let e=new Dt;e.beginFill(6710886,.5),e.drawRoundedRect(-50,0,100,28,14),e.endFill(),e.position.set(et().width/2,10),this.addChild(e),this.scoreText=new Lt("",{fontFamily:"SpaceInvadersFont",fontSize:24,fill:16777215}),this.scoreText.y=12,this.addChild(this.scoreText),this.setScore(this.game.score)}async createMusicButton(){let e=J.from(Xv),s=new H(e,new q(0,0,64,64)),n=new H(e,new q(64,0,64,64)),r=new ut;r.position.set(et().width-36,12),r.scale.set(.4),r.interactive=!0,r.cursor="pointer",this.addChild(r);let o=()=>{let a=this.game.music;a&&a.muted?r.texture=n:r.texture=s};this.refreshMusicButton=o,o(),r.on("click",()=>{let a=this.game.music;a&&(a.muted=!a.muted,o())}),r.on("touchend",a=>{r.emit("click",a)})}setScore(e){const s=this.scoreText;s&&(s.text=e.toLocaleString(),s.x=(et().width-s.width)/2)}}class jv extends ct{constructor(t){super(),this.game=t,this.drawBackground(480,240),this.drawGameoverText(20),this.drawScoreText(100),this.createRestartButton(160),t.addChild(this),this.position.set((et().width-this.width)/2,(et().height-this.height)/2)}drawBackground(t,e){let s=new Dt;s.beginFill(16777215,.5),s.drawRoundedRect(0,0,t,e,10),s.endFill(),this.addChild(s)}drawGameoverText(t){let e=new Lt("GAME OVER",{fontFamily:"SpaceInvadersFont",fontSize:64,fill:10027008});e.resolution=2,e.position.set((this.width-e.width)/2,t),this.addChild(e)}drawScoreText(t){let e=this.game.score.toLocaleString(),s=new Lt("SCORE "+e,{fontFamily:"SpaceInvadersFont",fontSize:32,fill:26112});s.resolution=2,s.position.set((this.width-s.width)/2,t),this.addChild(s)}createRestartButton(t){let e=new ct,s=new Dt;s.beginFill(16777215),s.drawRoundedRect(0,0,240,48,24),s.endFill(),s.tint=2635155,e.addChild(s);let n=new Lt("Restart",{fontFamily:"SpaceInvadersFont",fontSize:36,fill:16777215});n.resolution=2,n.position.set((s.width-n.width)/2,(s.height-n.height)/2),e.addChild(n),e.interactive=!0,e.cursor="pointer",e.position.set((this.width-e.width)/2,t),this.addChild(e),e.on("click",()=>{this.game.destroy(),new Ri(this.game.app)}),e.on("pointerover",()=>{s.tint=4149685}),e.on("pointerout",()=>{s.tint=2635155}),e.on("touchend",r=>{e.emit("click",r)})}}const Vs=class extends ct{constructor(e){super();N(this,"spaceRoot",new ct);N(this,"objects",[]);N(this,"camera");N(this,"score",0);N(this,"music");N(this,"ui");this.app=e,e.stage.addChild(this),this.addChild(this.spaceRoot),this.spaceRoot.sortableChildren=!0,this.createInitAstroids(4);let s=new Gv(this,320,240);this.objects.push(s),this.camera=new qo(e.ticker),this.camera.width=et().width,this.camera.height=et().height,this.camera.focus=s,this.camera.gameRoot=this.spaceRoot,this.newAstroidLoop(),new Mv(this),this.newMonsterLoop(),this.playMusic(),this.ui=new Wv(this),this.addChild(this.ui)}async playMusic(){this.music=await ie(Vv,{loop:!0,muted:Vs.musicMuted}),this.ui.refreshMusicButton()}destroy(){super.destroy(),this.camera.destroy(),this.music&&this.music.destroy()}createInitAstroids(e){let s=new G(et().width/2,et().height/2),n=0;for(;n++<e;){let r=new G(180+Math.random()*150);r.rotate(Math.random()*Math.PI*2);let o=new Jo(this,s.x+r.x,s.y+r.y);this.objects.push(o)}}randomPositionOnScreenEdge(e){const s=this.app.stage;let n=et().width+s.x*2,r=et().height+s.y*2,o=new q(this.camera.position.x-n/2,this.camera.position.y-r/2,n,r);o.pad(e);let a=new G(Math.random()<.5?o.x:o.right,Math.random()<.5?o.y:o.bottom);return Math.random()<.5?a.x=o.x+o.width*Math.random():a.y=o.y+o.height*Math.random(),a}async newAstroidLoop(){if(this.destroyed)return;let e=this.randomPositionOnScreenEdge(120),s=new Jo(this,e.x,e.y);s.minLifespan=120,this.objects.push(s),await It(12),this.newAstroidLoop()}async newMonsterLoop(){if(this.destroyed)return;let e=this.randomPositionOnScreenEdge(40),s=new zv(this,e.x,e.y);this.objects.push(s),await It(60),this.newMonsterLoop()}addScore(e){this.score+=e,this.ui.setScore(this.score)}gameover(){this.camera.focus=void 0,this.music&&(this.music.volume=.1,Vs.musicMuted=this.music.muted),new jv(this)}testCamera(){let e=new Dt;e.beginFill(16711680),e.drawCircle(0,0,10),e.endFill(),this.addChild(e),e.x=et().width/2,e.y=et().height/2;let s=new qo(this.app.ticker);s.width=et().width,s.height=et().height,s.focus=e,s.gameRoot=this,this.app.ticker.add(()=>{ue.isKeyDown(ve.LEFT)&&(e.x-=1),ue.isKeyDown(ve.RIGHT)&&(e.x+=1),ue.isKeyDown(ve.UP)&&(e.y-=1),ue.isKeyDown(ve.DOWN)&&(e.y+=1)})}};let Ri=Vs;N(Ri,"musicMuted",!1);const Wh="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPoAAAAiBAMAAACEr9lMAAAAAXNSR0IB2cksfwAAAAlwSFlzAAALEwAACxMBAJqcGAAAABJQTFRFAAAA/////0BA/v/+AAAA/yYgiuMzngAAAAZ0Uk5TAP//////enng/gAAAQpJREFUeJztlV0KwyAMx7Vl7xZ2gFK294En6PAAY9D7X2X1I37GdhsMZTYPNTGaX6h/lJAqjA7aWDjJchGsT/Yc9ArpPVcD5wh3wOo5YpYd8U/LI/GaortPAo5aKEnH2LZeBrLZbym6psX0zvQQnHa/8d+/pHfTSMy3ArqJ9+lnIcTsjaoaVROzKa895naEiTUlad2k7Lo8tTNWQl/5NxJ7/0i39hYdUdHnCU2+iLshG0/SeXDqWgayhd/TpfJbpufOPVWevWkYcttQ0J1LMhMninPKO+gl6Up38ML23GezdKTA8ppUM7COBCn7zsCdM9qINE73mdBHBXTHjX2ktf0duJWlb1jL9GL2Ao7iys+g4JaeAAAAAElFTkSuQmCC",Yv="data:audio/wav;base64,UklGRlUNAABXQVZFZm10IBAAAAABAAEAESsAABErAAABAAgAZGF0YTENAACAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQpJFvX1tkan6GbG17oJ52ZZC9bk+aynUQYNC7QWTAr10Aav2JEYzyZwGG/4YEbuZ2AZX/WQag/24APLH/URvPqis9yLMXaPVwC2bS2SdJ7XIdOa3/WwCR/4oKPqv8VACs9C4vz75KAI3/kxBBv9ceVOCjTgCA/3wAlf9mAIr5qT8Apv8+GMPlIU7go0YAkf9kAKH/XACj/18Ahva/TQB9/4IAWMbiXwB6/54rNdWyFWPWyDEnxtZLAIP/hgZo27MSaftoBGrkzC0zufdMALL0JzTH3FUAaf+2I2P+YAB2z/NUAIn/fACM/XkrE6L/kw88tP8+GsTeWwCH/2AAsv9MBrP/UACm/2wAbv9cAHrk1zkYtfxLAHb/hgGF1rxBAKP/XwCP/34iMMH/QRbQyTIf0ccqRr77OQu+3VcAjP+BG1jRyjYcuvteAJD/UgS+/zwTytwqN9S6I07dqRtf1b1LAJL/cQCp/1MAdvGkGWvK1E8Ahf+ZKj7YpAeU5Zo2ALn/QQnF6DYivfRQAHHu0iha1p8zAsXaOx/A/0YIqP96AHXrXAeC6rwQfOV5Lg+y/2gAjv9XAJz+gxlk1LdABqT/awhhs/9jAHnlmyxX1rU8I6//dw8yp/9iAKvxcQ5h7n8Tn/xbAKL7fhVm1Kw+D67/WgCj5akxDr3nTgCT/38feN2UJFbjfxSD18MmRs2yQgCn/2cFi9evSQCw/3oPaNWkRACz/0kWxfVBAK//WACn8nQnKcbyQwyr/2kAleCOHVjDxj8AwPFCCrT/WgCx+j8Yv+xVAIf3Yh2G3sUyNMjROhPE5jsUr/9nAJ7vUACU0c5HAMDqOBy9/1UAle2HMyau/1wAkdOWPwe9/z0RuP93FTS28D8AvvVWBH7lqT43w/Y3DcDzQQC1+3YqJrv/RAC6/4MtHbb/UwCU07tRALX/VAme8FsLtfljE3XlayF5184mV9WZLy/TsSB34YAYkexbH3nQ1z0Atf9VAqXkYxxc1cInbNOkQgC9/20qNcrjPhSz/2MUYcDbOwG+/1QXU7r/PgC/7EIAwfI7HNDUOB61/0EIxt0uH8zLKj/VsDUxwvs8Bqf2XBOFx9M8AKr8fiBo0ZUpUczAKkranzFJwfpOAKrrQw+x/FcffsPzRAC05kAInvKCKG2/30AAquSXLybI1T8AmPOnJ3zeaTYrvv85Dq/rjhxbwqsuF8nwRQeP75Eine5PKVa+/zsAv+pwKCvF+DkDwv9GEb/oUw1r0b42KdHZNBnN7zYUwPtxHSu+/TQAkeulIoXgdCFe1KUhY+ZtF7bpbiBq2pQegOhWD7/wYCpJyfwtBtDuNQCd94IpaL7zKgCw3owsBsn/OQCp2K8xENnLIEjVuS0z4rAkWcn6RQCx4zUVmPWVJ17I+jsAhtiSG5DgeS0u1vAfQOGdKFvNzisQ1P5LAKDsTiV219cjRNHELgLR8TwBrvlQJovV3SsAtvKGFGTNoTEF0f8sIt/bLBW7/0AZiOGoD4bMiyIk0tsyBtjtIjrR3jUAvOaMJEHjjilW2tMdUtqlJTPO7yID3NYpIcv/NgSs6GIZkdSJHF3RrSoX4M8bXtuzMgbG/2Eald5cImfU1Ccb0/xFAKDhWR6E26MlS9rDJyTkxCBU4pgZgtGXJzDkpyhF0fsmFtbgIwKq8WgaocyyKQDP+loXduBwIZDeiTM1zv43BLfWhC4F1f8qHqznpyAt1coRVuNxMVXV/B0g5b0oIL/+Uw2l3EkjbN7QIj/b1SMOw+uJKwDJ/y0in+WhHlPcoik2zfgmE7Hgqh8Z4sYfR9fsJgDO7TQf2NkiFtr5ShCc3j4c2PFEEY7cWRO/41EqVM//IwC0z50hM9+0Jiri5hc/3rwoCc3/Qi1r0fwaANXjVBKM1YQzGND/QSfV3igac9fyGxXg4TALm+V7L3fcqBd51IEuGcz/TR2qznwuGMr/PyXQ2y4Rpt9bI7PkRimH19YWFObAHFPWvx4g488eR+WpKD3H+EYTmc17Kk7dwRZo0akqBtf2OinL2i4RwN1JKYfjmi1LyvI7DK3JLSyV6KsoSNDmGwrXyyYt2eIeH9nSJBrK34YtIuPVIEHdwiQvxudzGF3FqiA25LMsOMbugCwn1eMXLNrULhSj3Gg9ZdT1KxpqyeweD9XaNy561ssYSdejJULgripFxutcKlTI4hsX1NFBJpfZYi280l49RtLyQS9Jy/cbJpHO2x4Qm+CYLHTLsSUcxuNSL5nHeyxn24IqqcV4NCm871Axtc5ELaPEpiMl47QpXN2qKWXTrC4ox981PIrathtqyYIxMbzqcy6Jy1gxrsR3NUHS0h8gwtZIM8bHMiun0E8yvM1VMYjBoCsh2dxPN2fOxyQx270pTNXGJCa32GM+WcrqLyinxl4ttsJaPEXW2ixN0rwhLYvVzSQy2b8qK7nXWkVkzNwiPdC6KSWozoA5cc2sKUTcozJTztcwKaLCfD5GvuBBO824KTTQxz0xkcpwPZPKji9pzJMtZM+cL1nOsCFqzXRAVcXaPjt8yLMhXM+JMW7Cqig726gvXc66JzSV1bglQtG/LSrKuDJJheC6I3C/li0qyc5GPqDCdjxpz6wuQ83DLEjOtSwxtchrQnTGriszpNh5M6+zWT1f0p41ZM26JzOpzndBWLfTOzzIsDs9dMu+KUvUsS47xcRBRKTDaTmotVdCbcm/KDPAwnhAUM3LMjbDtk9JY9K+MlPLwC04rrxWQcSwLk/QqTFEwcZkRlTKxyxBfc+1M1HIvi88rLhUQ7y5VEGQw2tJb8LOPD2VuG88p7FoRVDOwDpPx603U4zNrx0vtbhOU2bDzDZJa8a7L06QzYI8Xr3BQkFyxJg0h7aJOkTPxE5FmrZdSZ27aE1nts9FSMCqQD+msVpVabzMQ0vGq0BMaMbLQUl5vrErSJ3FpzJByqRCWJHSij9fuL5KRG+/uCpHyaw5UpXGri9Au7RHV8GfOFLDrT5SuLNLS5y4aEWUtWlKdMCyMkiot2FMi7KWM1zEmTdQw7dBV8OTQlmnv2hMbL+iNVK9skNPdcK9MEaWuXRFoaZrTlnEuTlWwKQ+Uqm2YEydqnlBcr11TmyrxXQ8c7R9R2G9tTxZw6I/TJW4eEaiqFBUm7hpUG6vuERTlrGYMUe7r2BPYbi1R1Sqq1ZUg8CnNE2nsm9LW7O5V1GNs3JTba28VVJwuqo3W8CjPE6dtW1UirmVPVOrtnVKWMGuQ1Z4v7Q0VaiuWlK0nFVVb8GkQWOtsGtHYLuiQWK4o0hauaVIU5yve0l0vYVQc7yfO1aFxZ0/bbadOlKdsnlLXJXCg0RXn7ZqTXmzh0prtKBBW6mpaE5js61JX7mgSlmAtqM5Xb6fRlavn1JikrqZP1O0plZYkKt5Umq4pEpdnatoVIG1lEBcisCmN1e4mEZdn7BpWJugclB8tXpSf7OWQlitq1del6uFRWq5g01njcWJSX+nhEZWo7FpWYarhUpquo9NaaymT1iOqnpQaZK+h0dfrpxJYn66n0FajbKLS2WtnEpinKh7S3Owj0VluZFLareVS2GgpGBgp5plUoymZGR3n7NcXoKwmz9WnaRoXIWvj0hmqpZVY6OlZFtwlbl1UIGib1eMpG9cjqOATnGwjUxiraJqW3KzlEppo6NkWZGZY2SIsX9Wcoq4iUVeo6BdY3qxnEhelqRtYIirg1Jpk69pW5eWaGBrkrh2WJCYbF93sZVIZnywpVRgiKWCUGyrl1JojaqFU2eWrIJRZKmdYmNxqZ9Va5aieFdwq5dNZ6mQXWaLsnxec4W1hk1mopldX3KmllBpkaNyWpKTZGWDq4pPa4CymE5fh6OCVnOnj1hsmp51WWyqmVlmmJRwY3Gtklptj6p5WWyPq4JSbKqLUGuCrZ5Van+pmVBllJptZIigeV51o5NdaZGgbmR3oJ1gZ3Wok1Fpi6WIVmeemmVpk5xzYnScmVtroZFdbXSTrmpqdoqoa1+JlXRgcqOUXWuFo4tTaaCTYG6ZkmlpdY2thVRxo4RWbX6llWFsf6aSUWySimdrmZBobYSkgmF0mJVmaoGkiVNpjaB9YG6Mp3lldJuRXmyHn4RYbIqlgl52oIlbbIqcgmFyoI9bcJaNZm2WkWhslo5tbH+jiFtuhqGEYHCUlW9lgpl9Y3GJqIhabI+Yc2p9mYpdepp/Y32ed2d0iqd6YXOVkWlsiJJxbXaFrIVdbYuWcWyGk4BhcJeTaXN+jplra3qUk2Vsgpl/ZXiUi2pxf6CLYW2ImHtpfpqKXm+LlXtpd5iPam6HknppdpmPbHF0kZFpb3yZh11yloZmdXyUlm1we5eKYHB8mI5pcH2ahWZ0fpqRbG9zjZZudHqFnnNvgA==";class jh{constructor(t,e,s,n){N(this,"sprite",new ut);this.game=t;let r=J.from(Wh),o=new q(50*n,0,50,34),a=new H(r,o);this.sprite.texture=a,t.app.stage.addChild(this.sprite),this.sprite.position.set(e,s),r.valid?this.adjustPivot():r.once("loaded",()=>{this.adjustPivot()})}destroy(){this.sprite.destroy()}adjustPivot(){this.sprite.pivot.set(this.sprite.width/2,this.sprite.height/2)}get x(){return this.sprite.x}set x(t){this.sprite.x=t}get y(){return this.sprite.y}set y(t){this.sprite.y=t}get width(){return this.sprite.width}get height(){return this.sprite.height}get destroyed(){return this.sprite.destroyed}onFlockMove(t,e){this.x+=t,this.y+=e}async hitAndDead(){ie(Yv,{volume:.2});const t=this.sprite.texture;t.frame=new q(200,0,50,34),await It(10),this.destroy()}}const Yh="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAAgAQMAAAB0JonRAAAAAXNSR0IB2cksfwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAZQTFRFmO0sAAAAbvI+CQAAAAJ0Uk5T/wDltzBKAAAAHklEQVR4nGP4////BxBmwM9g4KcC4wMDGOBlDDIAAD3+VrmiuYHhAAAAAElFTkSuQmCC",Kv=""+new URL("cannonballs.89bc629e.png",import.meta.url).href;class Kh{constructor(t,e,s){N(this,"sprite",new ut);this.game=t;let n=J.from(Kv),r=this.getSpriteTextureFrame(),o=new H(n,r);this.sprite.texture=o,this.sprite.pivot.set(r.width/2,r.height/2),t.app.stage.addChildAt(this.sprite,0),this.sprite.position.set(e,s),t.app.ticker.add(this.moveUpdate,this)}getSpriteTextureFrame(){return new q(1,0,4,14)}destroy(){this.sprite.destroy(),this.game.app.ticker.remove(this.moveUpdate,this)}get destroyed(){return this.sprite.destroyed}moveUpdate(t){let e=4;if(this.sprite.y-=t*e,this.sprite.y<-this.sprite.height)this.destroy();else{let s=this.hittestInvaders();if(s)this.game.hitAndRemoveInvader(s),this.destroy();else{let n=this.hittestShields();n&&(n.onHit(),this.destroy())}}}hittestInvaders(){let t=this.sprite.getBounds();return this.game.invaders.find(e=>e.sprite.getBounds().intersects(t))}hittestShields(){let t=this.sprite.getBounds();return this.game.shields.find(e=>e.getBounds().intersects(t))}}const Zv=""+new URL("cannonShoot.29f56726.wav",import.meta.url).href,Qv=""+new URL("cannonExplode.6e821509.wav",import.meta.url).href;class ta{constructor(t){N(this,"sprite",new ut);N(this,"moveSpeed",1);N(this,"shootCooldown",0);N(this,"dead",!1);this.game=t;let e=J.from(Yh),s=H.from(e);this.sprite.texture=s,t.app.stage.addChild(this.sprite);let n=et();this.sprite.position.set(n.width/2,n.height),e.valid?this.adjustPivot():e.once("loaded",()=>{this.adjustPivot()}),t.app.ticker.add(this.moveUpdate,this),t.app.ticker.add(this.shootUpdate,this)}destroy(){this.sprite.destroyed||this.sprite.destroy(),this.stop()}stop(){this.game.app.ticker.remove(this.moveUpdate,this),this.game.app.ticker.remove(this.shootUpdate,this),this.dead=!0}adjustPivot(){this.sprite.pivot.set(this.sprite.width/2,this.sprite.height)}moveUpdate(t){const e=this.sprite;let s=e.x,n=t*this.moveSpeed;ue.isKeyDown(ve.LEFT)&&(s-=n),ue.isKeyDown(ve.RIGHT)&&(s+=n);let r=e.width/2,o=et().width-e.width/2;s=Math.max(r,s),s=Math.min(o,s),e.x=s,this.hittestInvaders()&&this.game.hitPlayerCannon()}hittestInvaders(){let t=this.sprite.getBounds();return this.game.invaders.find(e=>e.sprite.getBounds().intersects(t))}shootUpdate(t){this.shootCooldown-=t,this.shootCooldown<=0&&ue.isKeyDown(ve.SPACE)&&(this.shootCooldown=60,this.createCannonball())}async createCannonball(){new Kh(this.game,this.sprite.x,this.sprite.y);let t=await ie(Zv);t.volume=.2}async hitAndDead(){this.stop(),ie(Qv,{volume:.2});const t=J.from(Wh),e=new q(200,0,50,34),s=new H(t,e);this.sprite.texture=s,this.sprite.pivot.set(e.width/2,e.height),this.sprite.tint=65280,await It(30),this.destroy()}}const $v="data:audio/wav;base64,UklGRvoDAABXQVZFZm10IBAAAAABAAEAESsAABErAAABAAgAZGF0YdYDAAB6aVg8KxQPCRQfMEFeaYCQp7jD2uDr8Pb8//z8/Pb28Ovg2s/Jw7iyp6GQi4V6dGljWFJHQTY8QUFNUl5eWF5SRzwwJRoDAAAAAAAAAAAAAAAAAAAAAAAAAAAAAw8aHzA8R01eb3qAi5ansr7Jz9rg6/D////////////////////////////////////////////////26+vl4NTUycPDuLKnoZyWlouFgHp0b2ljXl5SUk1NQUE8KxQAAAAAAAAAAAAAAAAPGis8TVJjaXR0gICAgICAenRvaWNpXlhSTUE8MCslHxoUDwkDAwAAAAMJGiUwMDAwKyUaDwkAAAAAAAAAAAAAAAAAAAAAAAAAAw8aJTA8R1hpdICLlqeyw8/a6/b////////////////////////////////////////////////////////////////////88PDr4NTPw8O4raehnJaLhYWAgHRvaWleWEcrDwAAAAAAAAAAAAAJGiU2R1JeaW90dHp6eoB6enR0b29jWFJNR0E2KysfFA8DAAAAAAAAAAAAAAMJDxQPFAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADDxorNkdYY296hZahrb7J1ODr9v////////////////////////////////////////////////////////////bw6+Da1M/JvriyraecnJaLgICAenRvaWNeXlhBKw8AAAAAAAAAAAMPHzBBUl5pdICFi5CWlpCWkIuLhYB0b2NeUlJNPDYwKyUaDw8JAwAAAAAAAw8aHysrJSUfFA8DAAAAAAAAAAAAAAAAAAAAAAAAAAAAAw8fKzBBTV5peoCQnKe4w8/a5fD8///////////////////////////////////////////////////////////89uvl4NrUz8nDuLKyrZyWlouAgIB6dG9jXlhYUk1HR0E8NjArMCslHxofGhoaGhQUDw8JDwkPCQ8JDw8PCQ8PDxQaFBoUGh8aHx8fHyUlKysrMDYwNjw2PDxBR0FHTUdNUlJYXlheY2NpY2lpb290dHqAgICAgICAhYCFi4uFi4uQlpCWnJaclpyhnKGcoaGhoaehp62nra2tp62tsq2yrbKtrbKtrbKtrbKtsq2tsq2yraenraetp6Ghp6GnoaGhp6GcoaGhnJacnJyclpycnJaQkJaQlpCWkIuQi5CQi5CLhYuLi4WLhYWFi4WFgIWAgICAgICAgIB0enR6dG90dG9vdG90b3Rvb3RvdG9vdG90b29v";class qv extends Kh{getSpriteTextureFrame(){return new q(6,0,6,14)}moveUpdate(t){const e=this.sprite;let s=2;if(e.y+=t*s,e.y>et().height+e.height)this.destroy();else{const n=this.game.cannon;n.dead||n.sprite.getBounds().intersects(e.getBounds())&&(this.game.hitPlayerCannon(),this.destroy())}if(!this.sprite.destroyed){let n=this.hittestShields();n&&(n.onHit(),this.destroy())}}}class Jv extends ct{constructor(){super();N(this,"score",0);N(this,"scoreText");N(this,"lives",3);N(this,"liveSprites",[]);N(this,"levelText");this.loadUI()}async loadUI(){await document.fonts.load("10px SpaceInvadersFont"),this.createText("SCORE","#FFFFFF",30,10),this.createText("LIVES","#FFFFFF",430,10),this.scoreText=this.createText(this.score.toLocaleString(),"#00FF00",110,10),this.setLives(this.lives)}createText(e,s,n,r){let o=new Lt(e,{fontFamily:'"SpaceInvadersFont"',fontSize:24,fill:s});return o.resolution=2,o.position.set(n,r),this.addChild(o),o}addScore(e){this.score+=e,this.scoreText&&(this.scoreText.text=this.score.toLocaleString())}getScore(){return this.score}setLives(e){for(this.lives=e;this.liveSprites.length>this.lives;){let n=this.liveSprites.pop();n==null||n.destroy()}let s=J.from(Yh);for(;this.liveSprites.length<this.lives;){let n=this.liveSprites.length,r=ut.from(s);r.position.set(510+n*42,11),r.scale.set(.6),this.addChild(r),this.liveSprites.push(r)}}getLives(){return this.lives}async showLevel(e){await document.fonts.load("10px SpaceInvadersFont");let s=this.levelText;s||(s=this.createText("","#FFFFFF",250,10),this.addChild(s),this.levelText=s),s.text="LEVEL "+e;let n=this.createText("LEVEL "+e,"#FFFFFF",0,200);n.style.fontSize=48,n.x=(et().width-n.width)/2,await It(120),n.text="START",n.x=(et().width-n.width)/2,await It(60),n.destroy()}}class t0 extends ct{constructor(t){super(),this.game=t,this.loadUI()}async loadUI(){this.createBackground(),this.createGameoverText(),await It(120),this.createRestartText(),await this.waitUserPressSpace(),this.destroy(),this.game.destroy(),new Zh(this.game.app)}createBackground(){let t=new Dt;t.beginFill(0,.8),t.drawRect(0,30,et().width,et().height-30),t.endFill(),this.addChild(t)}createGameoverText(){let t=new Lt("GAME OVER",{fontFamily:"SpaceInvadersFont",fontSize:48,fill:"#FF0000"});t.position.set((et().width-t.width)/2,et().height/2-t.height),this.addChild(t)}async createRestartText(){let t=new Lt("press SPACE to try again",{fontFamily:"SpaceInvadersFont",fontSize:24,fill:"#FFFFFF"});for(t.position.set((et().width-t.width)/2,et().height*.6),this.addChild(t);!t.destroyed;)t.visible=!t.visible,await It(60)}async waitUserPressSpace(){const t=ve.SPACE;await ue.waitUserPressKey(t),await ue.waitUserReleaseKey(t)}}class e0 extends Dt{constructor(t,e,s){super(),this.game=t,this.beginFill(65280),this.drawRect(-10,-10,20,20),this.endFill(),this.position.set(e,s)}onHit(){this.alpha-=.1,this.alpha<=.2&&(this.destroy(),ui.removeItem(this.game.shields,this))}}class i0 extends jh{constructor(e,s,n){super(e,s,n,3);N(this,"mode","idle");N(this,"posInFlock",new G);N(this,"velocity",new G);N(this,"rotateTime",0);N(this,"rotateSpeed",0);this.posInFlock.set(s,n),this.goIdle()}removeUpdateFunctions(){this.game.app.ticker.remove(this.attackUpdate,this),this.game.app.ticker.remove(this.backUpdate,this)}destroy(){super.destroy(),this.removeUpdateFunctions()}async goIdle(){this.removeUpdateFunctions(),this.mode="idle",await It(300),this.destroyed||this.goAttack()}goAttack(){this.removeUpdateFunctions(),this.mode="attack",this.game.app.ticker.add(this.attackUpdate,this),this.velocity.set(0,-.2),this.rotateTime=210,this.rotateSpeed=.02;const e=this.game.cannon;e&&!e.dead?e.sprite.x>this.x&&(this.rotateSpeed*=-1):Math.random()<.5&&(this.rotateSpeed*=-1)}attackUpdate(e){let s=this.velocity.length(),n=Math.min(4,s+.02*e);this.velocity.normalize(n),this.rotateTime>0&&(this.rotateTime-=e,this.velocity.rotate(this.rotateSpeed*e)),this.x+=this.velocity.x*e,this.y+=this.velocity.y*e,this.y>et().height+this.height&&this.goBack()}goBack(){this.removeUpdateFunctions(),this.mode="back",this.game.app.ticker.add(this.backUpdate,this),this.y=-this.height}backUpdate(e){const s=this.posInFlock;this.y=Math.min(s.y,this.y+1*e),this.x>s.x?this.x=Math.max(s.x,this.x-1*e):this.x=Math.min(s.x,this.x+1*e),s.equals(this.sprite.position)&&this.goIdle()}onFlockMove(e,s){this.posInFlock.x+=e,this.posInFlock.y+=s,this.mode=="idle"&&(this.x=this.posInFlock.x,this.y=this.posInFlock.y)}}class Zh{constructor(t){N(this,"cannon");N(this,"invaders",[]);N(this,"invadersMoveInterval",20);N(this,"invadersShootInterval",90);N(this,"destroyed",!1);N(this,"gameover",!1);N(this,"ui",new Jv);N(this,"level",1);N(this,"shields",[]);this.app=t,this.cannon=new ta(this),this.startLevel(1),this.moveInvadersLoop(10),this.invadersShootLoop(),t.stage.addChild(this.ui)}destroy(){this.cannon.destroy(),this.invaders.forEach(t=>{t.destroy()}),this.shields.forEach(t=>{t.destroy()}),this.ui.destroy(),this.destroyed=!0}createInvadersRow(t){let e=60;for(let s=0;s<t.amount;s++){let n=new jh(this,t.x+s*e,t.y,t.type);this.invaders.push(n)}}moveInvaders(t,e){for(let s of this.invaders)s.onFlockMove(t,e)}async moveInvadersLoop(t){if(this.destroyed||this.gameover)return;const e=this.invadersMoveInterval;await It(e),this.invaders.length&&(this.moveInvaders(t,0),this.invadersNeedToTurn(t)&&(this.invadersNeedToGoDown()&&(await It(e),this.moveInvaders(0,20)),t=-t),ie($v,{volume:.2})),this.moveInvadersLoop(t)}invadersNeedToTurn(t){if(t>0){let e=this.invaders.reduce((s,n)=>s.x>n.x?s:n);return e.x>et().width-e.width}else{let e=this.invaders.reduce((s,n)=>s.x<n.x?s:n);return e.x<e.width}}invadersNeedToGoDown(){let t=this.invaders.reduce((s,n)=>s.y>n.y?s:n),e=et().height-t.height;return t.y<e}async hitAndRemoveInvader(t){this.ui.addScore(10),ui.removeItem(this.invaders,t),await t.hitAndDead(),this.invaders.length||this.startLevel(this.level+1)}async invadersShootLoop(){if(this.destroyed||this.gameover)return;let t=this.invadersShootInterval;if(await It(t),this.invaders.length){let e=ui.getRandomItem(this.invaders);new qv(this,e.x,e.y)}this.invadersShootLoop()}async hitPlayerCannon(){await this.cannon.hitAndDead(),await It(60);const t=this.ui.getLives();if(t>0)this.cannon=new ta(this),this.ui.setLives(t-1);else{this.gameover=!0;let e=new t0(this);this.app.stage.addChild(e)}}createInvadersAll(t){this.createInvadersRow({type:0,x:40,y:240,amount:Math.min(10,5+t)}),this.createInvadersRow({type:1,x:70,y:200,amount:Math.min(10,4+t)}),this.createInvadersRow({type:2,x:100,y:160,amount:Math.min(10,3+t)});let e=new i0(this,220,120);this.invaders.push(e)}async startLevel(t){this.level=t,await this.ui.showLevel(t),this.resetShields(),this.createInvadersAll(t),this.invadersMoveInterval=Math.max(10,21-t),this.invadersShootInterval=Math.max(30,91-t)}resetShields(){this.shields.forEach(e=>e.destroy()),this.shields.length=0;let t=[new G(100,410),new G(120,400),new G(140,400),new G(160,410),new G(300,410),new G(320,400),new G(340,400),new G(360,410),new G(500,410),new G(520,400),new G(540,400),new G(560,410)];for(let e of t){let s=new e0(this,e.x,e.y);this.app.stage.addChild(s),this.shields.push(s)}}}class s0{constructor(t=1){this.seed=t,this.next()}next(){return this.seed==0&&(this.seed=123456789),this.seed=this.seed*16807%2147483647,this.seed/2147483647}nextBetween(t,e){return t+(e-t)*this.next()}nextInt(t){let e=(t+1)*this.next();return Math.floor(e)}nextIntBetween(t,e){let s=t+(e-t+1)*this.next();return Math.floor(s)}getRandomString(t,e){let s="abcdefghijklmnopqrstuvwxyz";e&&(s+="0123456789");let n=s.length,r="";for(;r.length<t;){let o=Math.floor(n*this.next());r+=s[o]}return r}randomizeArray(t){let e=t.length;for(let s=0;s<e;s++){let n=Math.floor(e*this.next());ui.swapAt(t,s,n)}}getArrayRandomItem(t,e){if(!t.length)throw new Error("\u7121\u6CD5\u5F9E\u7A7A\u9663\u5217\u53D6\u51FA\u5143\u7D20");let s=Math.floor(t.length*this.next()),n=t[s];return e&&t.splice(s,1),n}}class si{constructor(t,e){N(this,"rng");N(this,"children",[]);N(this,"graphics",new Dt);N(this,"drawnPercent",0);this.tree=t,this.options=e,this.rng=new s0(e.seed),t.app.stage.addChild(this.graphics)}destroy(){this.graphics.destroy(),this.children.forEach(t=>t.destroy())}getEndPosition(){const t=this.options,e=t.angle/180*Math.PI;let s=new G(t.length).rotate(e);return t.position.add(s)}createChildren(){const t=this.options,e=this.tree.options,s=this.rng;if(t.size>1)s.next()<e.branchRate?this.children=this.createTwoBranches():this.children=this.createOneBranch(),this.children.forEach(n=>n.createChildren());else{let n=this.createPetals();this.children=this.children.concat(n)}if(t.size<=e.leafBranchSize){let n=this.createLeaves();this.children=this.children.concat(n)}}createOneBranch(){const t=this.options,e=this.tree.options,s=this.rng;let n=t.angle+s.nextBetween(-20,20),r=t.size-1,o=(r+3)/(e.trunkSize+3)*80;return o*=s.nextBetween(.5,1),[new si(this.tree,{position:this.getEndPosition(),angle:n,size:r,length:o,seed:s.nextInt(999999),color:t.color})]}createTwoBranches(){const t=this.options,e=this.tree.options,s=this.rng;let n=[],r=t.angle+s.nextBetween(-20,20),o=s.nextBetween(30,90),a=[r-o/2,r+o/2],h=t.size-1,c=(h+3)/(e.trunkSize+3)*80;for(let l of a){let f=new si(this.tree,{position:this.getEndPosition(),angle:l,size:h,length:c*s.nextBetween(.5,1),seed:s.nextInt(999999),color:t.color});n.push(f)}return n}createPetals(){const t=this.options,e=this.tree.options,s=this.rng;let n=[],r=240,o=8,a=r/(o-1),h=t.angle-r/2;for(let c=0;c<o;c++){let l=new si(this.tree,{position:this.getEndPosition(),angle:h+c*a,size:4,length:10,seed:s.nextInt(999999),color:e.flowerColor});n.push(l)}return n}createLeaves(){const t=this.options,e=this.tree.options,s=this.rng;let n=[],r=6;const o=t.angle/180*Math.PI;let a=60;for(let h=0;h<t.length;h+=r){let c=new G(h).rotate(o),l=t.position.add(c),f=s.next()>.5,d=t.angle+(f?a:-a),u=new si(this.tree,{position:l,angle:d,size:3,length:5+t.size,seed:s.nextInt(999999),color:e.leafColor});n.push(u)}return n}draw(t){if(this.drawnPercent==t)return;const e=this.options,s=e.position;let n=this.getEndPosition().sub(s),r=new G(s.x+n.x*t,s.y+n.y*t);this.graphics.clear(),this.graphics.lineStyle({width:e.size,color:e.color}),this.graphics.moveTo(s.x,s.y),this.graphics.lineTo(r.x,r.y),this.drawnPercent=t}drawDeeply(t){const e=this.options,s=this.tree.options;let n=e.length/s.drawSpeed,r=Math.min(1,t/n);this.draw(r),t-=n,t>0&&this.children.forEach(o=>o.drawDeeply(t))}}function n0(i){if(!!i&&!(typeof window>"u")){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=i,document.head.appendChild(t),i}}function ni(i,t){var e=i.__state.conversionName.toString(),s=Math.round(i.r),n=Math.round(i.g),r=Math.round(i.b),o=i.a,a=Math.round(i.h),h=i.s.toFixed(1),c=i.v.toFixed(1);if(t||e==="THREE_CHAR_HEX"||e==="SIX_CHAR_HEX"){for(var l=i.hex.toString(16);l.length<6;)l="0"+l;return"#"+l}else{if(e==="CSS_RGB")return"rgb("+s+","+n+","+r+")";if(e==="CSS_RGBA")return"rgba("+s+","+n+","+r+","+o+")";if(e==="HEX")return"0x"+i.hex.toString(16);if(e==="RGB_ARRAY")return"["+s+","+n+","+r+"]";if(e==="RGBA_ARRAY")return"["+s+","+n+","+r+","+o+"]";if(e==="RGB_OBJ")return"{r:"+s+",g:"+n+",b:"+r+"}";if(e==="RGBA_OBJ")return"{r:"+s+",g:"+n+",b:"+r+",a:"+o+"}";if(e==="HSV_OBJ")return"{h:"+a+",s:"+h+",v:"+c+"}";if(e==="HSVA_OBJ")return"{h:"+a+",s:"+h+",v:"+c+",a:"+o+"}"}return"unknown format"}var ea=Array.prototype.forEach,yi=Array.prototype.slice,D={BREAK:{},extend:function(t){return this.each(yi.call(arguments,1),function(e){var s=this.isObject(e)?Object.keys(e):[];s.forEach(function(n){this.isUndefined(e[n])||(t[n]=e[n])}.bind(this))},this),t},defaults:function(t){return this.each(yi.call(arguments,1),function(e){var s=this.isObject(e)?Object.keys(e):[];s.forEach(function(n){this.isUndefined(t[n])&&(t[n]=e[n])}.bind(this))},this),t},compose:function(){var t=yi.call(arguments);return function(){for(var e=yi.call(arguments),s=t.length-1;s>=0;s--)e=[t[s].apply(this,e)];return e[0]}},each:function(t,e,s){if(!!t){if(ea&&t.forEach&&t.forEach===ea)t.forEach(e,s);else if(t.length===t.length+0){var n=void 0,r=void 0;for(n=0,r=t.length;n<r;n++)if(n in t&&e.call(s,t[n],n)===this.BREAK)return}else for(var o in t)if(e.call(s,t[o],o)===this.BREAK)return}},defer:function(t){setTimeout(t,0)},debounce:function(t,e,s){var n=void 0;return function(){var r=this,o=arguments;function a(){n=null,s||t.apply(r,o)}var h=s||!n;clearTimeout(n),n=setTimeout(a,e),h&&t.apply(r,o)}},toArray:function(t){return t.toArray?t.toArray():yi.call(t)},isUndefined:function(t){return t===void 0},isNull:function(t){return t===null},isNaN:function(i){function t(e){return i.apply(this,arguments)}return t.toString=function(){return i.toString()},t}(function(i){return isNaN(i)}),isArray:Array.isArray||function(i){return i.constructor===Array},isObject:function(t){return t===Object(t)},isNumber:function(t){return t===t+0},isString:function(t){return t===t+""},isBoolean:function(t){return t===!1||t===!0},isFunction:function(t){return t instanceof Function}},r0=[{litmus:D.isString,conversions:{THREE_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return e===null?!1:{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:ni},SIX_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9]{6})$/i);return e===null?!1:{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:ni},CSS_RGB:{read:function(t){var e=t.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return e===null?!1:{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:ni},CSS_RGBA:{read:function(t){var e=t.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return e===null?!1:{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:ni}}},{litmus:D.isNumber,conversions:{HEX:{read:function(t){return{space:"HEX",hex:t,conversionName:"HEX"}},write:function(t){return t.hex}}}},{litmus:D.isArray,conversions:{RGB_ARRAY:{read:function(t){return t.length!==3?!1:{space:"RGB",r:t[0],g:t[1],b:t[2]}},write:function(t){return[t.r,t.g,t.b]}},RGBA_ARRAY:{read:function(t){return t.length!==4?!1:{space:"RGB",r:t[0],g:t[1],b:t[2],a:t[3]}},write:function(t){return[t.r,t.g,t.b,t.a]}}}},{litmus:D.isObject,conversions:{RGBA_OBJ:{read:function(t){return D.isNumber(t.r)&&D.isNumber(t.g)&&D.isNumber(t.b)&&D.isNumber(t.a)?{space:"RGB",r:t.r,g:t.g,b:t.b,a:t.a}:!1},write:function(t){return{r:t.r,g:t.g,b:t.b,a:t.a}}},RGB_OBJ:{read:function(t){return D.isNumber(t.r)&&D.isNumber(t.g)&&D.isNumber(t.b)?{space:"RGB",r:t.r,g:t.g,b:t.b}:!1},write:function(t){return{r:t.r,g:t.g,b:t.b}}},HSVA_OBJ:{read:function(t){return D.isNumber(t.h)&&D.isNumber(t.s)&&D.isNumber(t.v)&&D.isNumber(t.a)?{space:"HSV",h:t.h,s:t.s,v:t.v,a:t.a}:!1},write:function(t){return{h:t.h,s:t.s,v:t.v,a:t.a}}},HSV_OBJ:{read:function(t){return D.isNumber(t.h)&&D.isNumber(t.s)&&D.isNumber(t.v)?{space:"HSV",h:t.h,s:t.s,v:t.v}:!1},write:function(t){return{h:t.h,s:t.s,v:t.v}}}}}],xi=void 0,vs=void 0,lr=function(){vs=!1;var t=arguments.length>1?D.toArray(arguments):arguments[0];return D.each(r0,function(e){if(e.litmus(t))return D.each(e.conversions,function(s,n){if(xi=s.read(t),vs===!1&&xi!==!1)return vs=xi,xi.conversionName=n,xi.conversion=s,D.BREAK}),D.BREAK}),vs},ia=void 0,Gs={hsv_to_rgb:function(t,e,s){var n=Math.floor(t/60)%6,r=t/60-Math.floor(t/60),o=s*(1-e),a=s*(1-r*e),h=s*(1-(1-r)*e),c=[[s,h,o],[a,s,o],[o,s,h],[o,a,s],[h,o,s],[s,o,a]][n];return{r:c[0]*255,g:c[1]*255,b:c[2]*255}},rgb_to_hsv:function(t,e,s){var n=Math.min(t,e,s),r=Math.max(t,e,s),o=r-n,a=void 0,h=void 0;if(r!==0)h=o/r;else return{h:NaN,s:0,v:0};return t===r?a=(e-s)/o:e===r?a=2+(s-t)/o:a=4+(t-e)/o,a/=6,a<0&&(a+=1),{h:a*360,s:h,v:r/255}},rgb_to_hex:function(t,e,s){var n=this.hex_with_component(0,2,t);return n=this.hex_with_component(n,1,e),n=this.hex_with_component(n,0,s),n},component_from_hex:function(t,e){return t>>e*8&255},hex_with_component:function(t,e,s){return s<<(ia=e*8)|t&~(255<<ia)}},o0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Yt=function(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")},Kt=function(){function i(t,e){for(var s=0;s<e.length;s++){var n=e[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,s){return e&&i(t.prototype,e),s&&i(t,s),t}}(),Te=function i(t,e,s){t===null&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===void 0){var r=Object.getPrototypeOf(t);return r===null?void 0:i(r,e,s)}else{if("value"in n)return n.value;var o=n.get;return o===void 0?void 0:o.call(s)}},Se=function(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)},Ce=function(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i},Et=function(){function i(){if(Yt(this,i),this.__state=lr.apply(this,arguments),this.__state===!1)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return Kt(i,[{key:"toString",value:function(){return ni(this)}},{key:"toHexString",value:function(){return ni(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),i}();function Mr(i,t,e){Object.defineProperty(i,t,{get:function(){return this.__state.space==="RGB"?this.__state[t]:(Et.recalculateRGB(this,t,e),this.__state[t])},set:function(n){this.__state.space!=="RGB"&&(Et.recalculateRGB(this,t,e),this.__state.space="RGB"),this.__state[t]=n}})}function Br(i,t){Object.defineProperty(i,t,{get:function(){return this.__state.space==="HSV"?this.__state[t]:(Et.recalculateHSV(this),this.__state[t])},set:function(s){this.__state.space!=="HSV"&&(Et.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=s}})}Et.recalculateRGB=function(i,t,e){if(i.__state.space==="HEX")i.__state[t]=Gs.component_from_hex(i.__state.hex,e);else if(i.__state.space==="HSV")D.extend(i.__state,Gs.hsv_to_rgb(i.__state.h,i.__state.s,i.__state.v));else throw new Error("Corrupted color state")};Et.recalculateHSV=function(i){var t=Gs.rgb_to_hsv(i.r,i.g,i.b);D.extend(i.__state,{s:t.s,v:t.v}),D.isNaN(t.h)?D.isUndefined(i.__state.h)&&(i.__state.h=0):i.__state.h=t.h};Et.COMPONENTS=["r","g","b","h","s","v","hex","a"];Mr(Et.prototype,"r",2);Mr(Et.prototype,"g",1);Mr(Et.prototype,"b",0);Br(Et.prototype,"h");Br(Et.prototype,"s");Br(Et.prototype,"v");Object.defineProperty(Et.prototype,"a",{get:function(){return this.__state.a},set:function(t){this.__state.a=t}});Object.defineProperty(Et.prototype,"hex",{get:function(){return this.__state.space!=="HEX"&&(this.__state.hex=Gs.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(t){this.__state.space="HEX",this.__state.hex=t}});var Xe=function(){function i(t,e){Yt(this,i),this.initialValue=t[e],this.domElement=document.createElement("div"),this.object=t,this.property=e,this.__onChange=void 0,this.__onFinishChange=void 0}return Kt(i,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),i}(),a0={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},Qh={};D.each(a0,function(i,t){D.each(i,function(e){Qh[e]=t})});var h0=/(\d+(\.\d+)?)px/;function Zt(i){if(i==="0"||D.isUndefined(i))return 0;var t=i.match(h0);return D.isNull(t)?0:parseFloat(t[1])}var M={makeSelectable:function(t,e){t===void 0||t.style===void 0||(t.onselectstart=e?function(){return!1}:function(){},t.style.MozUserSelect=e?"auto":"none",t.style.KhtmlUserSelect=e?"auto":"none",t.unselectable=e?"on":"off")},makeFullscreen:function(t,e,s){var n=s,r=e;D.isUndefined(r)&&(r=!0),D.isUndefined(n)&&(n=!0),t.style.position="absolute",r&&(t.style.left=0,t.style.right=0),n&&(t.style.top=0,t.style.bottom=0)},fakeEvent:function(t,e,s,n){var r=s||{},o=Qh[e];if(!o)throw new Error("Event type "+e+" not supported.");var a=document.createEvent(o);switch(o){case"MouseEvents":{var h=r.x||r.clientX||0,c=r.y||r.clientY||0;a.initMouseEvent(e,r.bubbles||!1,r.cancelable||!0,window,r.clickCount||1,0,0,h,c,!1,!1,!1,!1,0,null);break}case"KeyboardEvents":{var l=a.initKeyboardEvent||a.initKeyEvent;D.defaults(r,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),l(e,r.bubbles||!1,r.cancelable,window,r.ctrlKey,r.altKey,r.shiftKey,r.metaKey,r.keyCode,r.charCode);break}default:{a.initEvent(e,r.bubbles||!1,r.cancelable||!0);break}}D.defaults(a,n),t.dispatchEvent(a)},bind:function(t,e,s,n){var r=n||!1;return t.addEventListener?t.addEventListener(e,s,r):t.attachEvent&&t.attachEvent("on"+e,s),M},unbind:function(t,e,s,n){var r=n||!1;return t.removeEventListener?t.removeEventListener(e,s,r):t.detachEvent&&t.detachEvent("on"+e,s),M},addClass:function(t,e){if(t.className===void 0)t.className=e;else if(t.className!==e){var s=t.className.split(/ +/);s.indexOf(e)===-1&&(s.push(e),t.className=s.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return M},removeClass:function(t,e){if(e)if(t.className===e)t.removeAttribute("class");else{var s=t.className.split(/ +/),n=s.indexOf(e);n!==-1&&(s.splice(n,1),t.className=s.join(" "))}else t.className=void 0;return M},hasClass:function(t,e){return new RegExp("(?:^|\\s+)"+e+"(?:\\s+|$)").test(t.className)||!1},getWidth:function(t){var e=getComputedStyle(t);return Zt(e["border-left-width"])+Zt(e["border-right-width"])+Zt(e["padding-left"])+Zt(e["padding-right"])+Zt(e.width)},getHeight:function(t){var e=getComputedStyle(t);return Zt(e["border-top-width"])+Zt(e["border-bottom-width"])+Zt(e["padding-top"])+Zt(e["padding-bottom"])+Zt(e.height)},getOffset:function(t){var e=t,s={left:0,top:0};if(e.offsetParent)do s.left+=e.offsetLeft,s.top+=e.offsetTop,e=e.offsetParent;while(e);return s},isActive:function(t){return t===document.activeElement&&(t.type||t.href)}},$h=function(i){Se(t,i);function t(e,s){Yt(this,t);var n=Ce(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,s)),r=n;n.__prev=n.getValue(),n.__checkbox=document.createElement("input"),n.__checkbox.setAttribute("type","checkbox");function o(){r.setValue(!r.__prev)}return M.bind(n.__checkbox,"change",o,!1),n.domElement.appendChild(n.__checkbox),n.updateDisplay(),n}return Kt(t,[{key:"setValue",value:function(s){var n=Te(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,s);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),n}},{key:"updateDisplay",value:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),Te(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(Xe),l0=function(i){Se(t,i);function t(e,s,n){Yt(this,t);var r=Ce(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,s)),o=n,a=r;if(r.__select=document.createElement("select"),D.isArray(o)){var h={};D.each(o,function(c){h[c]=c}),o=h}return D.each(o,function(c,l){var f=document.createElement("option");f.innerHTML=l,f.setAttribute("value",c),a.__select.appendChild(f)}),r.updateDisplay(),M.bind(r.__select,"change",function(){var c=this.options[this.selectedIndex].value;a.setValue(c)}),r.domElement.appendChild(r.__select),r}return Kt(t,[{key:"setValue",value:function(s){var n=Te(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,s);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),n}},{key:"updateDisplay",value:function(){return M.isActive(this.__select)?this:(this.__select.value=this.getValue(),Te(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this))}}]),t}(Xe),c0=function(i){Se(t,i);function t(e,s){Yt(this,t);var n=Ce(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,s)),r=n;function o(){r.setValue(r.__input.value)}function a(){r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())}return n.__input=document.createElement("input"),n.__input.setAttribute("type","text"),M.bind(n.__input,"keyup",o),M.bind(n.__input,"change",o),M.bind(n.__input,"blur",a),M.bind(n.__input,"keydown",function(h){h.keyCode===13&&this.blur()}),n.updateDisplay(),n.domElement.appendChild(n.__input),n}return Kt(t,[{key:"updateDisplay",value:function(){return M.isActive(this.__input)||(this.__input.value=this.getValue()),Te(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(Xe);function sa(i){var t=i.toString();return t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0}var qh=function(i){Se(t,i);function t(e,s,n){Yt(this,t);var r=Ce(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,s)),o=n||{};return r.__min=o.min,r.__max=o.max,r.__step=o.step,D.isUndefined(r.__step)?r.initialValue===0?r.__impliedStep=1:r.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(r.initialValue))/Math.LN10))/10:r.__impliedStep=r.__step,r.__precision=sa(r.__impliedStep),r}return Kt(t,[{key:"setValue",value:function(s){var n=s;return this.__min!==void 0&&n<this.__min?n=this.__min:this.__max!==void 0&&n>this.__max&&(n=this.__max),this.__step!==void 0&&n%this.__step!==0&&(n=Math.round(n/this.__step)*this.__step),Te(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,n)}},{key:"min",value:function(s){return this.__min=s,this}},{key:"max",value:function(s){return this.__max=s,this}},{key:"step",value:function(s){return this.__step=s,this.__impliedStep=s,this.__precision=sa(s),this}}]),t}(Xe);function u0(i,t){var e=Math.pow(10,t);return Math.round(i*e)/e}var Hs=function(i){Se(t,i);function t(e,s,n){Yt(this,t);var r=Ce(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,s,n));r.__truncationSuspended=!1;var o=r,a=void 0;function h(){var p=parseFloat(o.__input.value);D.isNaN(p)||o.setValue(p)}function c(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}function l(){c()}function f(p){var m=a-p.clientY;o.setValue(o.getValue()+m*o.__impliedStep),a=p.clientY}function d(){M.unbind(window,"mousemove",f),M.unbind(window,"mouseup",d),c()}function u(p){M.bind(window,"mousemove",f),M.bind(window,"mouseup",d),a=p.clientY}return r.__input=document.createElement("input"),r.__input.setAttribute("type","text"),M.bind(r.__input,"change",h),M.bind(r.__input,"blur",l),M.bind(r.__input,"mousedown",u),M.bind(r.__input,"keydown",function(p){p.keyCode===13&&(o.__truncationSuspended=!0,this.blur(),o.__truncationSuspended=!1,c())}),r.updateDisplay(),r.domElement.appendChild(r.__input),r}return Kt(t,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():u0(this.getValue(),this.__precision),Te(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(qh);function na(i,t,e,s,n){return s+(n-s)*((i-t)/(e-t))}var cr=function(i){Se(t,i);function t(e,s,n,r,o){Yt(this,t);var a=Ce(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,s,{min:n,max:r,step:o})),h=a;a.__background=document.createElement("div"),a.__foreground=document.createElement("div"),M.bind(a.__background,"mousedown",c),M.bind(a.__background,"touchstart",d),M.addClass(a.__background,"slider"),M.addClass(a.__foreground,"slider-fg");function c(m){document.activeElement.blur(),M.bind(window,"mousemove",l),M.bind(window,"mouseup",f),l(m)}function l(m){m.preventDefault();var g=h.__background.getBoundingClientRect();return h.setValue(na(m.clientX,g.left,g.right,h.__min,h.__max)),!1}function f(){M.unbind(window,"mousemove",l),M.unbind(window,"mouseup",f),h.__onFinishChange&&h.__onFinishChange.call(h,h.getValue())}function d(m){m.touches.length===1&&(M.bind(window,"touchmove",u),M.bind(window,"touchend",p),u(m))}function u(m){var g=m.touches[0].clientX,_=h.__background.getBoundingClientRect();h.setValue(na(g,_.left,_.right,h.__min,h.__max))}function p(){M.unbind(window,"touchmove",u),M.unbind(window,"touchend",p),h.__onFinishChange&&h.__onFinishChange.call(h,h.getValue())}return a.updateDisplay(),a.__background.appendChild(a.__foreground),a.domElement.appendChild(a.__background),a}return Kt(t,[{key:"updateDisplay",value:function(){var s=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=s*100+"%",Te(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(qh),Jh=function(i){Se(t,i);function t(e,s,n){Yt(this,t);var r=Ce(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,s)),o=r;return r.__button=document.createElement("div"),r.__button.innerHTML=n===void 0?"Fire":n,M.bind(r.__button,"click",function(a){return a.preventDefault(),o.fire(),!1}),M.addClass(r.__button,"button"),r.domElement.appendChild(r.__button),r}return Kt(t,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),t}(Xe),ur=function(i){Se(t,i);function t(e,s){Yt(this,t);var n=Ce(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,s));n.__color=new Et(n.getValue()),n.__temp=new Et(0);var r=n;n.domElement=document.createElement("div"),M.makeSelectable(n.domElement,!1),n.__selector=document.createElement("div"),n.__selector.className="selector",n.__saturation_field=document.createElement("div"),n.__saturation_field.className="saturation-field",n.__field_knob=document.createElement("div"),n.__field_knob.className="field-knob",n.__field_knob_border="2px solid ",n.__hue_knob=document.createElement("div"),n.__hue_knob.className="hue-knob",n.__hue_field=document.createElement("div"),n.__hue_field.className="hue-field",n.__input=document.createElement("input"),n.__input.type="text",n.__input_textShadow="0 1px 1px ",M.bind(n.__input,"keydown",function(m){m.keyCode===13&&f.call(this)}),M.bind(n.__input,"blur",f),M.bind(n.__selector,"mousedown",function(){M.addClass(this,"drag").bind(window,"mouseup",function(){M.removeClass(r.__selector,"drag")})}),M.bind(n.__selector,"touchstart",function(){M.addClass(this,"drag").bind(window,"touchend",function(){M.removeClass(r.__selector,"drag")})});var o=document.createElement("div");D.extend(n.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),D.extend(n.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:n.__field_knob_border+(n.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),D.extend(n.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),D.extend(n.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),D.extend(o.style,{width:"100%",height:"100%",background:"none"}),ra(o,"top","rgba(0,0,0,0)","#000"),D.extend(n.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),f0(n.__hue_field),D.extend(n.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:n.__input_textShadow+"rgba(0,0,0,0.7)"}),M.bind(n.__saturation_field,"mousedown",a),M.bind(n.__saturation_field,"touchstart",a),M.bind(n.__field_knob,"mousedown",a),M.bind(n.__field_knob,"touchstart",a),M.bind(n.__hue_field,"mousedown",h),M.bind(n.__hue_field,"touchstart",h);function a(m){u(m),M.bind(window,"mousemove",u),M.bind(window,"touchmove",u),M.bind(window,"mouseup",c),M.bind(window,"touchend",c)}function h(m){p(m),M.bind(window,"mousemove",p),M.bind(window,"touchmove",p),M.bind(window,"mouseup",l),M.bind(window,"touchend",l)}function c(){M.unbind(window,"mousemove",u),M.unbind(window,"touchmove",u),M.unbind(window,"mouseup",c),M.unbind(window,"touchend",c),d()}function l(){M.unbind(window,"mousemove",p),M.unbind(window,"touchmove",p),M.unbind(window,"mouseup",l),M.unbind(window,"touchend",l),d()}function f(){var m=lr(this.value);m!==!1?(r.__color.__state=m,r.setValue(r.__color.toOriginal())):this.value=r.__color.toString()}function d(){r.__onFinishChange&&r.__onFinishChange.call(r,r.__color.toOriginal())}n.__saturation_field.appendChild(o),n.__selector.appendChild(n.__field_knob),n.__selector.appendChild(n.__saturation_field),n.__selector.appendChild(n.__hue_field),n.__hue_field.appendChild(n.__hue_knob),n.domElement.appendChild(n.__input),n.domElement.appendChild(n.__selector),n.updateDisplay();function u(m){m.type.indexOf("touch")===-1&&m.preventDefault();var g=r.__saturation_field.getBoundingClientRect(),_=m.touches&&m.touches[0]||m,A=_.clientX,y=_.clientY,v=(A-g.left)/(g.right-g.left),x=1-(y-g.top)/(g.bottom-g.top);return x>1?x=1:x<0&&(x=0),v>1?v=1:v<0&&(v=0),r.__color.v=x,r.__color.s=v,r.setValue(r.__color.toOriginal()),!1}function p(m){m.type.indexOf("touch")===-1&&m.preventDefault();var g=r.__hue_field.getBoundingClientRect(),_=m.touches&&m.touches[0]||m,A=_.clientY,y=1-(A-g.top)/(g.bottom-g.top);return y>1?y=1:y<0&&(y=0),r.__color.h=y*360,r.setValue(r.__color.toOriginal()),!1}return n}return Kt(t,[{key:"updateDisplay",value:function(){var s=lr(this.getValue());if(s!==!1){var n=!1;D.each(Et.COMPONENTS,function(a){if(!D.isUndefined(s[a])&&!D.isUndefined(this.__color.__state[a])&&s[a]!==this.__color.__state[a])return n=!0,{}},this),n&&D.extend(this.__color.__state,s)}D.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var r=this.__color.v<.5||this.__color.s>.5?255:0,o=255-r;D.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+r+","+r+","+r+")"}),this.__hue_knob.style.marginTop=(1-this.__color.h/360)*100+"px",this.__temp.s=1,this.__temp.v=1,ra(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),D.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+r+","+r+","+r+")",textShadow:this.__input_textShadow+"rgba("+o+","+o+","+o+",.7)"})}}]),t}(Xe),d0=["-moz-","-o-","-webkit-","-ms-",""];function ra(i,t,e,s){i.style.background="",D.each(d0,function(n){i.style.cssText+="background: "+n+"linear-gradient("+t+", "+e+" 0%, "+s+" 100%); "})}function f0(i){i.style.background="",i.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",i.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",i.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",i.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",i.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var p0={load:function(t,e){var s=e||document,n=s.createElement("link");n.type="text/css",n.rel="stylesheet",n.href=t,s.getElementsByTagName("head")[0].appendChild(n)},inject:function(t,e){var s=e||document,n=document.createElement("style");n.type="text/css",n.innerHTML=t;var r=s.getElementsByTagName("head")[0];try{r.appendChild(n)}catch{}}},m0=`<div id="dg-save" class="dg dialogue">

  Here's the new load parameter for your <code>GUI</code>'s constructor:

  <textarea id="dg-new-constructor"></textarea>

  <div id="dg-save-locally">

    <input id="dg-local-storage" type="checkbox"/> Automatically save
    values to <code>localStorage</code> on exit.

    <div id="dg-local-explain">The values saved to <code>localStorage</code> will
      override those passed to <code>dat.GUI</code>'s constructor. This makes it
      easier to work incrementally, but <code>localStorage</code> is fragile,
      and your friends may not see the same values you do.

    </div>

  </div>

</div>`,g0=function(t,e){var s=t[e];return D.isArray(arguments[2])||D.isObject(arguments[2])?new l0(t,e,arguments[2]):D.isNumber(s)?D.isNumber(arguments[2])&&D.isNumber(arguments[3])?D.isNumber(arguments[4])?new cr(t,e,arguments[2],arguments[3],arguments[4]):new cr(t,e,arguments[2],arguments[3]):D.isNumber(arguments[4])?new Hs(t,e,{min:arguments[2],max:arguments[3],step:arguments[4]}):new Hs(t,e,{min:arguments[2],max:arguments[3]}):D.isString(s)?new c0(t,e):D.isFunction(s)?new Jh(t,e,""):D.isBoolean(s)?new $h(t,e):null};function v0(i){setTimeout(i,1e3/60)}var _0=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||v0,y0=function(){function i(){Yt(this,i),this.backgroundElement=document.createElement("div"),D.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),M.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),D.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var t=this;M.bind(this.backgroundElement,"click",function(){t.hide()})}return Kt(i,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),D.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var e=this,s=function n(){e.domElement.style.display="none",e.backgroundElement.style.display="none",M.unbind(e.domElement,"webkitTransitionEnd",n),M.unbind(e.domElement,"transitionend",n),M.unbind(e.domElement,"oTransitionEnd",n)};M.bind(this.domElement,"webkitTransitionEnd",s),M.bind(this.domElement,"transitionend",s),M.bind(this.domElement,"oTransitionEnd",s),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-M.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-M.getHeight(this.domElement)/2+"px"}}]),i}(),x0=n0(`.dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}
`);p0.inject(x0);var oa="dg",aa=72,ha=20,ji="Default",Ii=function(){try{return!!window.localStorage}catch{return!1}}(),Mi=void 0,la=!0,$e=void 0,Mn=!1,tl=[],lt=function i(t){var e=this,s=t||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),M.addClass(this.domElement,oa),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],s=D.defaults(s,{closeOnTop:!1,autoPlace:!0,width:i.DEFAULT_WIDTH}),s=D.defaults(s,{resizable:s.autoPlace,hideable:s.autoPlace}),D.isUndefined(s.load)?s.load={preset:ji}:s.preset&&(s.load.preset=s.preset),D.isUndefined(s.parent)&&s.hideable&&tl.push(this),s.resizable=D.isUndefined(s.parent)&&s.resizable,s.autoPlace&&D.isUndefined(s.scrollable)&&(s.scrollable=!0);var n=Ii&&localStorage.getItem(qe(this,"isLocal"))==="true",r=void 0,o=void 0;if(Object.defineProperties(this,{parent:{get:function(){return s.parent}},scrollable:{get:function(){return s.scrollable}},autoPlace:{get:function(){return s.autoPlace}},closeOnTop:{get:function(){return s.closeOnTop}},preset:{get:function(){return e.parent?e.getRoot().preset:s.load.preset},set:function(d){e.parent?e.getRoot().preset=d:s.load.preset=d,E0(this),e.revert()}},width:{get:function(){return s.width},set:function(d){s.width=d,pr(e,d)}},name:{get:function(){return s.name},set:function(d){s.name=d,o&&(o.innerHTML=s.name)}},closed:{get:function(){return s.closed},set:function(d){s.closed=d,s.closed?M.addClass(e.__ul,i.CLASS_CLOSED):M.removeClass(e.__ul,i.CLASS_CLOSED),this.onResize(),e.__closeButton&&(e.__closeButton.innerHTML=d?i.TEXT_OPEN:i.TEXT_CLOSED)}},load:{get:function(){return s.load}},useLocalStorage:{get:function(){return n},set:function(d){Ii&&(n=d,d?M.bind(window,"unload",r):M.unbind(window,"unload",r),localStorage.setItem(qe(e,"isLocal"),d))}}}),D.isUndefined(s.parent)){if(this.closed=s.closed||!1,M.addClass(this.domElement,i.CLASS_MAIN),M.makeSelectable(this.domElement,!1),Ii&&n){e.useLocalStorage=!0;var a=localStorage.getItem(qe(this,"gui"));a&&(s.load=JSON.parse(a))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=i.TEXT_CLOSED,M.addClass(this.__closeButton,i.CLASS_CLOSE_BUTTON),s.closeOnTop?(M.addClass(this.__closeButton,i.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(M.addClass(this.__closeButton,i.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),M.bind(this.__closeButton,"click",function(){e.closed=!e.closed})}else{s.closed===void 0&&(s.closed=!0);var h=document.createTextNode(s.name);M.addClass(h,"controller-name"),o=Dr(e,h);var c=function(d){return d.preventDefault(),e.closed=!e.closed,!1};M.addClass(this.__ul,i.CLASS_CLOSED),M.addClass(o,"title"),M.bind(o,"click",c),s.closed||(this.closed=!1)}s.autoPlace&&(D.isUndefined(s.parent)&&(la&&($e=document.createElement("div"),M.addClass($e,oa),M.addClass($e,i.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild($e),la=!1),$e.appendChild(this.domElement),M.addClass(this.domElement,i.CLASS_AUTO_PLACE)),this.parent||pr(e,s.width)),this.__resizeHandler=function(){e.onResizeDebounced()},M.bind(window,"resize",this.__resizeHandler),M.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),M.bind(this.__ul,"transitionend",this.__resizeHandler),M.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),s.resizable&&A0(this),r=function(){Ii&&localStorage.getItem(qe(e,"isLocal"))==="true"&&localStorage.setItem(qe(e,"gui"),JSON.stringify(e.getSaveObject()))},this.saveToLocalStorageIfPossible=r;function l(){var f=e.getRoot();f.width+=1,D.defer(function(){f.width-=1})}s.parent||l()};lt.toggleHide=function(){Mn=!Mn,D.each(tl,function(i){i.domElement.style.display=Mn?"none":""})};lt.CLASS_AUTO_PLACE="a";lt.CLASS_AUTO_PLACE_CONTAINER="ac";lt.CLASS_MAIN="main";lt.CLASS_CONTROLLER_ROW="cr";lt.CLASS_TOO_TALL="taller-than-window";lt.CLASS_CLOSED="closed";lt.CLASS_CLOSE_BUTTON="close-button";lt.CLASS_CLOSE_TOP="close-top";lt.CLASS_CLOSE_BOTTOM="close-bottom";lt.CLASS_DRAG="drag";lt.DEFAULT_WIDTH=245;lt.TEXT_CLOSED="Close Controls";lt.TEXT_OPEN="Open Controls";lt._keydownHandler=function(i){document.activeElement.type!=="text"&&(i.which===aa||i.keyCode===aa)&&lt.toggleHide()};M.bind(window,"keydown",lt._keydownHandler,!1);D.extend(lt.prototype,{add:function(t,e){return Bi(this,t,e,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(t,e){return Bi(this,t,e,{color:!0})},remove:function(t){this.__ul.removeChild(t.__li),this.__controllers.splice(this.__controllers.indexOf(t),1);var e=this;D.defer(function(){e.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&$e.removeChild(this.domElement);var t=this;D.each(this.__folders,function(e){t.removeFolder(e)}),M.unbind(window,"keydown",lt._keydownHandler,!1),ca(this)},addFolder:function(t){if(this.__folders[t]!==void 0)throw new Error('You already have a folder in this GUI by the name "'+t+'"');var e={name:t,parent:this};e.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[t]&&(e.closed=this.load.folders[t].closed,e.load=this.load.folders[t]);var s=new lt(e);this.__folders[t]=s;var n=Dr(this,s.domElement);return M.addClass(n,"folder"),s},removeFolder:function(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],ca(t);var e=this;D.each(t.__folders,function(s){t.removeFolder(s)}),D.defer(function(){e.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var t=this.getRoot();if(t.scrollable){var e=M.getOffset(t.__ul).top,s=0;D.each(t.__ul.childNodes,function(n){t.autoPlace&&n===t.__save_row||(s+=M.getHeight(n))}),window.innerHeight-e-ha<s?(M.addClass(t.domElement,lt.CLASS_TOO_TALL),t.__ul.style.height=window.innerHeight-e-ha+"px"):(M.removeClass(t.domElement,lt.CLASS_TOO_TALL),t.__ul.style.height="auto")}t.__resize_handle&&D.defer(function(){t.__resize_handle.style.height=t.__ul.offsetHeight+"px"}),t.__closeButton&&(t.__closeButton.style.width=t.width+"px")},onResizeDebounced:D.debounce(function(){this.onResize()},50),remember:function(){if(D.isUndefined(Mi)&&(Mi=new y0,Mi.domElement.innerHTML=m0),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;D.each(Array.prototype.slice.call(arguments),function(e){t.__rememberedObjects.length===0&&b0(t),t.__rememberedObjects.indexOf(e)===-1&&t.__rememberedObjects.push(e)}),this.autoPlace&&pr(this,this.width)},getRoot:function(){for(var t=this;t.parent;)t=t.parent;return t},getSaveObject:function(){var t=this.load;return t.closed=this.closed,this.__rememberedObjects.length>0&&(t.preset=this.preset,t.remembered||(t.remembered={}),t.remembered[this.preset]=_s(this)),t.folders={},D.each(this.__folders,function(e,s){t.folders[s]=e.getSaveObject()}),t},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=_s(this),dr(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(t){this.load.remembered||(this.load.remembered={},this.load.remembered[ji]=_s(this,!0)),this.load.remembered[t]=_s(this),this.preset=t,fr(this,t,!0),this.saveToLocalStorageIfPossible()},revert:function(t){D.each(this.__controllers,function(e){this.getRoot().load.remembered?el(t||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())},this),D.each(this.__folders,function(e){e.revert(e)}),t||dr(this.getRoot(),!1)},listen:function(t){var e=this.__listening.length===0;this.__listening.push(t),e&&il(this.__listening)},updateDisplay:function(){D.each(this.__controllers,function(t){t.updateDisplay()}),D.each(this.__folders,function(t){t.updateDisplay()})}});function Dr(i,t,e){var s=document.createElement("li");return t&&s.appendChild(t),e?i.__ul.insertBefore(s,e):i.__ul.appendChild(s),i.onResize(),s}function ca(i){M.unbind(window,"resize",i.__resizeHandler),i.saveToLocalStorageIfPossible&&M.unbind(window,"unload",i.saveToLocalStorageIfPossible)}function dr(i,t){var e=i.__preset_select[i.__preset_select.selectedIndex];t?e.innerHTML=e.value+"*":e.innerHTML=e.value}function w0(i,t,e){if(e.__li=t,e.__gui=i,D.extend(e,{options:function(o){if(arguments.length>1){var a=e.__li.nextElementSibling;return e.remove(),Bi(i,e.object,e.property,{before:a,factoryArgs:[D.toArray(arguments)]})}if(D.isArray(o)||D.isObject(o)){var h=e.__li.nextElementSibling;return e.remove(),Bi(i,e.object,e.property,{before:h,factoryArgs:[o]})}},name:function(o){return e.__li.firstElementChild.firstElementChild.innerHTML=o,e},listen:function(){return e.__gui.listen(e),e},remove:function(){return e.__gui.remove(e),e}}),e instanceof cr){var s=new Hs(e.object,e.property,{min:e.__min,max:e.__max,step:e.__step});D.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(r){var o=e[r],a=s[r];e[r]=s[r]=function(){var h=Array.prototype.slice.call(arguments);return a.apply(s,h),o.apply(e,h)}}),M.addClass(t,"has-slider"),e.domElement.insertBefore(s.domElement,e.domElement.firstElementChild)}else if(e instanceof Hs){var n=function(o){if(D.isNumber(e.__min)&&D.isNumber(e.__max)){var a=e.__li.firstElementChild.firstElementChild.innerHTML,h=e.__gui.__listening.indexOf(e)>-1;e.remove();var c=Bi(i,e.object,e.property,{before:e.__li.nextElementSibling,factoryArgs:[e.__min,e.__max,e.__step]});return c.name(a),h&&c.listen(),c}return o};e.min=D.compose(n,e.min),e.max=D.compose(n,e.max)}else e instanceof $h?(M.bind(t,"click",function(){M.fakeEvent(e.__checkbox,"click")}),M.bind(e.__checkbox,"click",function(r){r.stopPropagation()})):e instanceof Jh?(M.bind(t,"click",function(){M.fakeEvent(e.__button,"click")}),M.bind(t,"mouseover",function(){M.addClass(e.__button,"hover")}),M.bind(t,"mouseout",function(){M.removeClass(e.__button,"hover")})):e instanceof ur&&(M.addClass(t,"color"),e.updateDisplay=D.compose(function(r){return t.style.borderLeftColor=e.__color.toString(),r},e.updateDisplay),e.updateDisplay());e.setValue=D.compose(function(r){return i.getRoot().__preset_select&&e.isModified()&&dr(i.getRoot(),!0),r},e.setValue)}function el(i,t){var e=i.getRoot(),s=e.__rememberedObjects.indexOf(t.object);if(s!==-1){var n=e.__rememberedObjectIndecesToControllers[s];if(n===void 0&&(n={},e.__rememberedObjectIndecesToControllers[s]=n),n[t.property]=t,e.load&&e.load.remembered){var r=e.load.remembered,o=void 0;if(r[i.preset])o=r[i.preset];else if(r[ji])o=r[ji];else return;if(o[s]&&o[s][t.property]!==void 0){var a=o[s][t.property];t.initialValue=a,t.setValue(a)}}}}function Bi(i,t,e,s){if(t[e]===void 0)throw new Error('Object "'+t+'" has no property "'+e+'"');var n=void 0;if(s.color)n=new ur(t,e);else{var r=[t,e].concat(s.factoryArgs);n=g0.apply(i,r)}s.before instanceof Xe&&(s.before=s.before.__li),el(i,n),M.addClass(n.domElement,"c");var o=document.createElement("span");M.addClass(o,"property-name"),o.innerHTML=n.property;var a=document.createElement("div");a.appendChild(o),a.appendChild(n.domElement);var h=Dr(i,a,s.before);return M.addClass(h,lt.CLASS_CONTROLLER_ROW),n instanceof ur?M.addClass(h,"color"):M.addClass(h,o0(n.getValue())),w0(i,h,n),i.__controllers.push(n),n}function qe(i,t){return document.location.href+"."+t}function fr(i,t,e){var s=document.createElement("option");s.innerHTML=t,s.value=t,i.__preset_select.appendChild(s),e&&(i.__preset_select.selectedIndex=i.__preset_select.length-1)}function ua(i,t){t.style.display=i.useLocalStorage?"block":"none"}function b0(i){var t=i.__save_row=document.createElement("li");M.addClass(i.domElement,"has-save"),i.__ul.insertBefore(t,i.__ul.firstChild),M.addClass(t,"save-row");var e=document.createElement("span");e.innerHTML="&nbsp;",M.addClass(e,"button gears");var s=document.createElement("span");s.innerHTML="Save",M.addClass(s,"button"),M.addClass(s,"save");var n=document.createElement("span");n.innerHTML="New",M.addClass(n,"button"),M.addClass(n,"save-as");var r=document.createElement("span");r.innerHTML="Revert",M.addClass(r,"button"),M.addClass(r,"revert");var o=i.__preset_select=document.createElement("select");if(i.load&&i.load.remembered?D.each(i.load.remembered,function(f,d){fr(i,d,d===i.preset)}):fr(i,ji,!1),M.bind(o,"change",function(){for(var f=0;f<i.__preset_select.length;f++)i.__preset_select[f].innerHTML=i.__preset_select[f].value;i.preset=this.value}),t.appendChild(o),t.appendChild(e),t.appendChild(s),t.appendChild(n),t.appendChild(r),Ii){var a=document.getElementById("dg-local-explain"),h=document.getElementById("dg-local-storage"),c=document.getElementById("dg-save-locally");c.style.display="block",localStorage.getItem(qe(i,"isLocal"))==="true"&&h.setAttribute("checked","checked"),ua(i,a),M.bind(h,"change",function(){i.useLocalStorage=!i.useLocalStorage,ua(i,a)})}var l=document.getElementById("dg-new-constructor");M.bind(l,"keydown",function(f){f.metaKey&&(f.which===67||f.keyCode===67)&&Mi.hide()}),M.bind(e,"click",function(){l.innerHTML=JSON.stringify(i.getSaveObject(),void 0,2),Mi.show(),l.focus(),l.select()}),M.bind(s,"click",function(){i.save()}),M.bind(n,"click",function(){var f=prompt("Enter a new preset name.");f&&i.saveAs(f)}),M.bind(r,"click",function(){i.revert()})}function A0(i){var t=void 0;i.__resize_handle=document.createElement("div"),D.extend(i.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});function e(r){return r.preventDefault(),i.width+=t-r.clientX,i.onResize(),t=r.clientX,!1}function s(){M.removeClass(i.__closeButton,lt.CLASS_DRAG),M.unbind(window,"mousemove",e),M.unbind(window,"mouseup",s)}function n(r){return r.preventDefault(),t=r.clientX,M.addClass(i.__closeButton,lt.CLASS_DRAG),M.bind(window,"mousemove",e),M.bind(window,"mouseup",s),!1}M.bind(i.__resize_handle,"mousedown",n),M.bind(i.__closeButton,"mousedown",n),i.domElement.insertBefore(i.__resize_handle,i.domElement.firstElementChild)}function pr(i,t){i.domElement.style.width=t+"px",i.__save_row&&i.autoPlace&&(i.__save_row.style.width=t+"px"),i.__closeButton&&(i.__closeButton.style.width=t+"px")}function _s(i,t){var e={};return D.each(i.__rememberedObjects,function(s,n){var r={},o=i.__rememberedObjectIndecesToControllers[n];D.each(o,function(a,h){r[h]=t?a.initialValue:a.getValue()}),e[n]=r}),e}function E0(i){for(var t=0;t<i.__preset_select.length;t++)i.__preset_select[t].value===i.preset&&(i.__preset_select.selectedIndex=t)}function il(i){i.length!==0&&_0.call(window,function(){il(i)}),D.each(i,function(t){t.updateDisplay()})}var T0=lt;class S0{constructor(t){N(this,"gui",new T0);this.generator=t;let e=t.options;this.gui.add(e,"seed",1,99999,1),this.gui.add(this,"onButtonGrow").name("\u91CD\u65B0\u751F\u9577"),this.gui.add(this,"onButtonNext").name("\u4E0B\u4E00\u9846\u6A39"),this.gui.add(e,"trunkSize",1,10,1).name("\u4E3B\u5E79\u7C97\u7D30"),this.gui.add(e,"trunkLength",1,200,1).name("\u4E3B\u5E79\u9577\u5EA6"),this.gui.add(e,"branchRate",0,1,.1).name("\u5206\u652F\u6A5F\u7387"),this.gui.add(e,"drawSpeed",1,20,1).name("\u751F\u9577\u901F\u5EA6"),this.gui.add(e,"leafBranchSize",1,10,1).name("\u9577\u8449\u652F\u5E79\u7C97\u7D30"),this.gui.addColor(e,"branchColor").name("\u679D\u5E79\u984F\u8272"),this.gui.addColor(e,"leafColor").name("\u6A39\u8449\u984F\u8272"),this.gui.addColor(e,"flowerColor").name("\u82B1\u6735\u984F\u8272")}onButtonGrow(){this.generator.newTree()}onButtonNext(){this.generator.options.seed++,this.generator.newTree(),this.gui.updateDisplay()}}class C0{constructor(t){N(this,"options",{seed:1,trunkSize:10,trunkLength:120,branchRate:.8,drawSpeed:3,leafBranchSize:4,branchColor:16777215,leafColor:43520,flowerColor:16737894});N(this,"drawingData");this.app=t,this.newTree(),t.ticker.add(this.drawUpdate,this),new S0(this)}newTree(){this.drawingData&&this.drawingData.mainTrunk.destroy();const t=this.options,e=et();let s=new G(e.width/2,e.height),n=new si(this,{position:s,angle:-90,size:t.trunkSize,length:t.trunkLength,seed:t.seed,color:t.branchColor});n.createChildren(),this.drawingData={mainTrunk:n,timepassed:0}}drawUpdate(t){const e=this.drawingData;e&&(e.timepassed+=t,e.mainTrunk.drawDeeply(e.timepassed))}}class I0 extends ct{constructor(t){super(),this.app=t,t.stage.addChild(this),this.createButton("\u5C0F\u6A39\u679D\u4E0A\u958B\u6735\u82B1",80,()=>{new C0(t)}),this.createButton("\u7D93\u5178\u5C0F\u871C\u8702",160,()=>{new Zh(t)}),this.createButton("\u602A\u7378\u6383\u8569\u968A",240,()=>{new Ri(t)}),this.createButton("\u9B54\u738B\u57CE\u7684\u9695\u843D",320,()=>{new Sv(t)})}createButton(t,e,s){let n=new Xh({width:480,height:48,cornerRadius:24,backgroundColor:{default:6710886,hover:4149685,active:2245802},labelColor:{default:16777215,hover:16777215,active:16776960},label:t,labelSize:32,onClick:()=>{this.destroy(),s()}});this.addChild(n),n.x=(et().width-n.width)/2,n.y=e}}let $t=new Er;document.body.appendChild($t.view);let Ht={width:0,height:0};const Gt=new q,ze=new Ws.exports.EventEmitter;let Ts=new Dt;$t.stage.addChild(Ts);function P0(){Ts.clear(),Ts.lineStyle({color:16711680,width:2}),Ts.drawRect(0,0,Ht.width,Ht.height)}function R0(i,t){Ht.width=i,Ht.height=t,P0(),sl()}function sl(){let i={width:window.innerWidth,height:window.innerHeight};$t.renderer.resize(i.width,i.height);let t=Math.min(i.width/Ht.width,i.height/Ht.height);$t.stage.scale.set(t);let e={width:Ht.width*t,height:Ht.height*t};$t.stage.position.set((i.width-e.width)/2,(i.height-e.height)/2),Gt.x=-$t.stage.x/t,Gt.y=-$t.stage.y/t,Gt.width=i.width/t,Gt.height=i.height/t,ze.emit("resize",Ht)}R0(640,480);window.addEventListener("resize",sl);function et(){return{width:Ht.width,height:Ht.height}}let M0=new ag($t.ticker);function It(i){return M0.add(i)}function B0(i){return new Promise(t=>{i.onComplete(t)})}hg($t);new I0($t);
